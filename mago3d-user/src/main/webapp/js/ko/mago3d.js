"use strict";function getFlagFromKeyCode(e){switch(e){case 37:return"moveLeft";case 38:return"moveForward";case 39:return"moveRight";case 40:return"moveBackward";default:return}}function onKeyDown(e){var t=getFlagFromKeyCode(e.keyCode);void 0!==t&&(keyFlags[t]=!0)}function onKeyUp(e){var t=getFlagFromKeyCode(e.keyCode);void 0!==t&&(keyFlags[t]=!1)}function FirstPersonView(){this._camera=void 0,this._cameraBAK=void 0,this._position=new Point3D,this._rotation=new Point3D,this._positionSpeed=1,this._ratationSpeed=1}function genNoiseTextureRGBA(e,t,r,i){var o=e.createTexture();if(e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,o),4===t&&4===r){var a=0;i[a]=50,i[++a]=58,i[++a]=229,i[++a]=120,i[++a]=212,i[++a]=236,i[++a]=251,i[++a]=148,i[++a]=75,i[++a]=92,i[++a]=246,i[++a]=59,i[++a]=197,i[++a]=95,i[++a]=235,i[++a]=216,i[++a]=130,i[++a]=124,i[++a]=215,i[++a]=154,i[++a]=25,i[++a]=41,i[++a]=221,i[++a]=146,i[++a]=187,i[++a]=217,i[++a]=130,i[++a]=199,i[++a]=142,i[++a]=112,i[++a]=61,i[++a]=135,i[++a]=67,i[++a]=125,i[++a]=159,i[++a]=153,i[++a]=215,i[++a]=49,i[++a]=49,i[++a]=69,i[++a]=126,i[++a]=168,i[++a]=61,i[++a]=215,i[++a]=21,i[++a]=93,i[++a]=183,i[++a]=1,i[++a]=125,i[++a]=44,i[++a]=22,i[++a]=130,i[++a]=197,i[++a]=118,i[++a]=109,i[++a]=23,i[++a]=195,i[++a]=4,i[++a]=148,i[++a]=245,i[++a]=124,i[++a]=125,i[++a]=185,i[++a]=28,a++}else for(var n=0;n<r;n++)for(var s=0;s<t;s++)i[4*(n*t+s)+0]=Math.floor(255*Math.random()),i[4*(n*t+s)+1]=Math.floor(255*Math.random()),i[4*(n*t+s)+2]=Math.floor(255*Math.random()),i[4*(n*t+s)+3]=Math.floor(255*Math.random());return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,t,r,0,e.RGBA,e.UNSIGNED_BYTE,i),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT),e.bindTexture(e.TEXTURE_2D,null),o.width=t,o.height=r,o}function handleTextureLoaded(e,t,r){e.bindTexture(e.TEXTURE_2D,r),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_NEAREST),e.generateMipmap(e.TEXTURE_2D),e.bindTexture(e.TEXTURE_2D,null)}function API(e){if(!(this instanceof API))throw new Error(Messages.CONSTRUCT_ERROR);this.magoEnable=!0,this.apiName=e,this.projectId=null,this.blockId=null,this.blockIds=null,this.objectIds=null,this.dataKey=null,this.issueId=null,this.issueType=null,this.drawType=0,this.renderMode=0,this.latitude=0,this.longitude=0,this.elevation=0,this.heading=0,this.pitch=0,this.roll=0,this.color=0,this.blockType=null,this.showOutFitting=!1,this.showLabelInfo=!0,this.showBoundingBox=!1,this.showShadow=!1,this.frustumFarDistance=0,this.mouseMoveMode=CODE.moveMode.NONE,this.issueInsertEnable=!1,this.objectInfoViewEnable=!1,this.nearGeoIssueListEnable=!1,this.occlusionCullingEnable=!1,this.insertIssueState=0,this.lod0DistInMeters=null,this.lod1DistInMeters=null,this.lod2DistInMeters=null,this.lod3DistInMeters=null,this.ambientReflectionCoef=null,this.diffuseReflectionCoef=null,this.specularReflectionCoef=null,this.ambientColor=null,this.specularColor=null,this.ssaoRadius=null,this.FPVMode=!1}function selectedObjectCallback(e,t,r,i,o,a,n,s,l){window[e](t,r,i,o,a,n,s,l)}function insertIssueCallback(e,t,r,i,o,a){window[e](t,r,i,o,a)}function clickPositionCallback(e,t){window[e](t)}function changeMagoStateAPI(e){var t=new API("changeMagoState");t.setMagoEnable(e),null!==managerFactory&&managerFactory.callAPI(t)}function changeRenderAPI(e){var t=new API("changeRender");t.setRenderMode(e),null!==managerFactory&&managerFactory.callAPI(t)}function changeOutFittingAPI(e){var t=new API("changeOutFitting");t.setShowOutFitting(e),null!==managerFactory&&managerFactory.callAPI(t)}function changeLabelAPI(e){var t=new API("changeLabel");t.setShowLabelInfo(e),null!==managerFactory&&managerFactory.callAPI(t)}function changeBoundingBoxAPI(e){var t=new API("changeBoundingBox");t.setShowBoundingBox(e),null!==managerFactory&&managerFactory.callAPI(t)}function changeShadowAPI(e){var t=new API("changeShadow");t.setShowShadow(e),null!==managerFactory&&managerFactory.callAPI(t)}function changeFrustumFarDistanceAPI(e){var t=new API("changefrustumFarDistance");t.setFrustumFarDistance(e),null!==managerFactory&&managerFactory.callAPI(t)}function searchDataAPI(e){var t=new API("searchData");t.setDataKey(e),null!==managerFactory&&managerFactory.callAPI(t)}function changeHighLightingAPI(e,t,r){var i=new API("changeHighLighting");i.setProjectId(e),i.setBlockIds(t),i.setObjectIds(r),null!==managerFactory&&managerFactory.callAPI(i)}function changeColorAPI(e,t,r,i){var o=new API("changeColor");o.setProjectId(e),o.setBlockIds(t),o.setObjectIds(r),o.setColor(i),null!==managerFactory&&managerFactory.callAPI(o)}function changeLocationAndRotationAPI(e,t,r,i,o,a,n){var s=new API("changeLocationAndRotation");s.setDataKey(e),s.setLatitude(t),s.setLongitude(r),s.setElevation(i),s.setHeading(o),s.setPitch(a),s.setRoll(n),null!==managerFactory&&managerFactory.callAPI(s)}function changeMouseMoveAPI(e){var t=new API("changeMouseMove");t.setMouseMoveMode(e),null!==managerFactory&&managerFactory.callAPI(t)}function changeInsertIssueModeAPI(e){var t=new API("changeInsertIssueMode");t.setIssueInsertEnable(e),null!==managerFactory&&managerFactory.callAPI(t)}function changeObjectInfoViewModeAPI(e){var t=new API("changeObjectInfoViewMode");t.setObjectInfoViewEnable(e),null!==managerFactory&&managerFactory.callAPI(t)}function changeOcclusionCullingAPI(e,t){var r=new API("changeOcclusionCulling");r.setOcclusionCullingEnable(e),r.setDataKey(t),null!==managerFactory&&managerFactory.callAPI(r)}function changeFPVModeAPI(e){var t=new API("changeFPVMode");t.setFPVMode(e),null!==managerFactory&&managerFactory.callAPI(t)}function changeNearGeoIssueListViewModeAPI(e){var t=new API("changeNearGeoIssueListViewMode");t.setNearGeoIssueListEnable(e),null!==managerFactory&&managerFactory.callAPI(t)}function drawInsertIssueImageAPI(e,t,r,i,o,a,n){var s=new API("drawInsertIssueImage");s.setDrawType(e),s.setIssueId(t),s.setIssueId(r),s.setDataKey(i),s.setLatitude(o),s.setLongitude(a),s.setElevation(n),null!==managerFactory&&managerFactory.callAPI(s)}function changeInsertIssueStateAPI(e){var t=new API("changeInsertIssueState");t.setInsertIssueState(e),null!==managerFactory&&managerFactory.callAPI(t)}function mouseMoveAPI(e){null!==managerFactory&&managerFactory.mouseMove(e)}function changeLodAPI(e,t,r,i){var o=new API("changeLod");o.setLod0DistInMeters(e),o.setLod1DistInMeters(t),o.setLod2DistInMeters(r),o.setLod3DistInMeters(i),null!==managerFactory&&managerFactory.callAPI(o)}function changeLightingAPI(e,t,r,i,o){var a=new API("changeLighting");a.setAmbientReflectionCoef(e),a.setDiffuseReflectionCoef(t),a.setSpecularReflectionCoef(r),a.setAmbientColor(i),a.setSpecularColor(o),null!==managerFactory&&managerFactory.callAPI(a)}function changeSsadRadiusAPI(e){var t=new API("changeSsadRadius");t.setSsaoRadius(e),null!==managerFactory&&managerFactory.callAPI(t)}function loadWithXhr(e){var t=$.Deferred(),r=new XMLHttpRequest;return r.open("GET",e,!0),r.responseType="arraybuffer",r.onload=function(){r.status<200||r.status>=300?t.reject(r.status):t.resolve(r.response)},r.onerror=function(e){t.reject(r.status)},r.send(null),t.promise()}function defaultValue(e,t){return void 0!==e?e:t}function setTest(e){squareDistUmbral=e}function possibleCameraPositionChanged(e){var t=e.data[0],r=e.data[1],i=e.data[2],o=i.x,a=i.y,n=i.z,s=geoModifier.compoundReferencesListContainerGetVisibleCompRefObjectsList(r,o,a,n);return geoModifier.compoundReferencesListContainerGetVisibleCompRefObjectsList(t,o,a,n).concat(s)}var Atmosphere=function(){if(!(this instanceof Atmosphere))throw new Error(Messages.CONSTRUCT_ERROR);this.cloudsManager=new CloudsManager,this.shadowBlendingCube=new ShadowBlendingCube},ShadowBlendingCube=function(){if(!(this instanceof ShadowBlendingCube))throw new Error(Messages.CONSTRUCT_ERROR);this.vertexMatrix=new VertexMatrix,this.tTrianglesMatrix=new TTrianglesMatrix,this.init(this.vertexMatrix,this.tTrianglesMatrix),this.vboVertexCacheKey,this.vboIndexCacheKey,this.indicesCount=0};ShadowBlendingCube.prototype.init=function(e,t){var r=.1,i=.1,o=.1,a=e.newVertexList(),n=a.newVertex();n.setPosition(0,0,-150.5),n.setColorRGBA(r,i,o,.6),(n=a.newVertex()).setPosition(0,0,-150.5),n.setColorRGBA(r,i,o,.6),(n=a.newVertex()).setPosition(0,0,-150.5),n.setColorRGBA(r,i,o,.6),(n=a.newVertex()).setPosition(0,0,-150.5),n.setColorRGBA(r,i,o,.6),(n=(a=e.newVertexList()).newVertex()).setPosition(-150.5,-150.5,-150.5),n.setColorRGBA(r,i,o,.6),(n=a.newVertex()).setPosition(150.5,-150.5,-150.5),n.setColorRGBA(r,i,o,.6),(n=a.newVertex()).setPosition(150.5,150.5,-150.5),n.setColorRGBA(r,i,o,.6),(n=a.newVertex()).setPosition(-150.5,150.5,-150.5),n.setColorRGBA(r,i,o,.6),(n=(a=e.newVertexList()).newVertex()).setPosition(-150.5,-150.5,150.5),n.setColorRGBA(r,i,o,.6),(n=a.newVertex()).setPosition(150.5,-150.5,150.5),n.setColorRGBA(r,i,o,.6),(n=a.newVertex()).setPosition(150.5,150.5,150.5),n.setColorRGBA(r,i,o,.6),(n=a.newVertex()).setPosition(-150.5,150.5,150.5),n.setColorRGBA(r,i,o,.6),(n=(a=e.newVertexList()).newVertex()).setPosition(0,0,150.5),n.setColorRGBA(r,i,o,.6),(n=a.newVertex()).setPosition(0,0,150.5),n.setColorRGBA(r,i,o,.6),(n=a.newVertex()).setPosition(0,0,150.5),n.setColorRGBA(r,i,o,.6),(n=a.newVertex()).setPosition(0,0,150.5),n.setColorRGBA(r,i,o,.6),e.makeTTrianglesLateralSidesLOOP(t)},ShadowBlendingCube.prototype.getVBOVertexColorRGBAFloatArray=function(){return this.vertexMatrix.getVBOVertexColorRGBAFloatArray()},ShadowBlendingCube.prototype.getVBOIndicesShortArray=function(){this.vertexMatrix.setVertexIdxInList();var e=this.tTrianglesMatrix.getVBOIndicesShortArray();return this.indicesCount=e.length,e};var CloudsManager=function(){if(!(this instanceof CloudsManager))throw new Error(Messages.CONSTRUCT_ERROR);this.circularCloudsArray=[]};CloudsManager.prototype.newCircularCloud=function(){var e=new CircularCloud;return this.circularCloudsArray.push(e),e};var CircularCloud=function(){if(!(this instanceof CircularCloud))throw new Error(Messages.CONSTRUCT_ERROR);this.radius=200,this.depth=150,this.numPointsForCicle=8,this.vertexMatrix=new VertexMatrix,this.tTrianglesMatrix=new TTrianglesMatrix,this.shadowVertexMatrix=new VertexMatrix,this.shadowTTrianglesMatrix=new TTrianglesMatrix,this.sunLightDirection=new Point3D,this.sunLightDirection.set(1,1,-5),this.sunLightDirection.unitary(),this.longitude,this.latitude,this.altitude,this.position,this.positionHIGH,this.positionLOW,this.bbox=new BoundingBox,this.cullingPosition,this.cullingRadius,this.vboVertexCacheKey,this.vboIndexCacheKey,this.vboShadowVertexCacheKey,this.vboShadowIndexCacheKey,this.indicesCount=0,this.rendered=!1,this.point3dSC=new Point3D,this.vertexSC=new Vertex};CircularCloud.prototype.getVBOVertexColorFloatArray=function(){var e;return e=this.vertexMatrix.getVBOVertexColorFloatArray(e)},CircularCloud.prototype.getVBOIndicesShortArray=function(){this.vertexMatrix.setVertexIdxInList();var e=this.tTrianglesMatrix.getVBOIndicesShortArray();return this.indicesCount=e.length,e},CircularCloud.prototype.getVBOShadowVertexFloatArray=function(){var e;return e=this.shadowVertexMatrix.getVBOVertexFloatArray(e)},CircularCloud.prototype.getVBOShadowIndicesShortArray=function(){this.shadowVertexMatrix.setVertexIdxInList();var e=this.shadowTTrianglesMatrix.getVBOIndicesShortArray();return this.indicesCount=e.length,e},CircularCloud.prototype.rotateMeshByLocation=function(e){var t=new Matrix4;t.rotationAxisAngDeg(-this.longitude,0,0,1),e.transformPointsByMatrix4(t);var r,i=this.longitude*Math.PI/180,o=new Point3D,a=new Point3D;o.set(Math.cos(i),Math.sin(i),0),a.set(0,0,1),(r=o.crossProduct(a,r)).unitary(),t.rotationAxisAngDeg(90-this.latitude,r.x,r.y,0),e.transformPointsByMatrix4(t)},CircularCloud.prototype.doShadowMeshWithSunDirection=function(){var e=this.shadowVertexMatrix.getVertexList(5);e.translateVertices(this.sunLightDirection.x,this.sunLightDirection.y,this.sunLightDirection.z,3e3),(e=this.shadowVertexMatrix.getVertexList(4)).translateVertices(this.sunLightDirection.x,this.sunLightDirection.y,this.sunLightDirection.z,3e3),(e=this.shadowVertexMatrix.getVertexList(3)).translateVertices(this.sunLightDirection.x,this.sunLightDirection.y,this.sunLightDirection.z,3e3)},CircularCloud.prototype.createCloud=function(e,t,r,i,o,a){this.longitude=e,this.latitude=t,this.altitude=r,this.radius=i,this.depth=o,this.numPointsForCicle=a,this.makeMesh(this.vertexMatrix,this.tTrianglesMatrix,this.shadowVertexMatrix,this.shadowTTrianglesMatrix),this.doShadowMeshWithSunDirection(),this.rotateMeshByLocation(this.vertexMatrix),this.rotateMeshByLocation(this.shadowVertexMatrix);var n=Cesium.Cartesian3.fromDegrees(this.longitude,this.latitude,this.altitude);this.position=n;var s=Cesium.EncodedCartesian3.encode(n.x),l=Cesium.EncodedCartesian3.encode(n.y),c=Cesium.EncodedCartesian3.encode(n.z);this.positionHIGH=new Float32Array([s.high,l.high,c.high]),this.positionLOW=new Float32Array([s.low,l.low,c.low]),this.bbox=this.shadowVertexMatrix.getBoundingBox(this.bbox);var h;h=this.bbox.getCenterPoint(h),this.cullingPosition=new Cesium.Cartesian3(h.x+this.position.x,h.y+this.position.y,h.z+this.position.z),this.cullingRadius=this.bbox.getMaxLength()/2},CircularCloud.prototype.makeMesh=function(e,t,r,i){var o,a,n=2*Math.PI/16,s=0,l=this.depth/2,c=0,h=0,d=0,u=e.newVertexList(),f=r.newVertexList();d=.9+.3*Math.random();for(m=0;m<16;m++)(o=u.newVertex()).setPosition(c,h,l),(a=f.newVertex()).setPosition(c,h,1.2*-l),o.setColorRGB(d,d,d);s=0;var g=.7*this.radius;u=e.newVertexList(),f=r.newVertexList();for(m=0;m<16;m++)d=(2+Math.random())/2,o=u.newVertex(),a=f.newVertex(),c=g*Math.cos(s)*d,h=g*Math.sin(s)*d,a.setPosition(c,h,2*-l),o.setPosition(c,h,.8*l),d=.9+.3*Math.random(),o.setColorRGB(d,d,d),s+=n;s=0,u=e.newVertexList(),f=r.newVertexList();for(m=0;m<16;m++)d=(2+Math.random())/2,o=u.newVertex(),a=f.newVertex(),c=this.radius*Math.cos(s)*d,h=this.radius*Math.sin(s)*d,a.setPosition(c,h,2*-l),o.setPosition(c,h,.4*l),d=.9+.3*Math.random(),o.setColorRGB(d,d,d),s+=n;s=0,u=e.newVertexList(),f=r.newVertexList();for(m=0;m<16;m++)d=(2+Math.random())/2,o=u.newVertex(),a=f.newVertex(),c=this.radius*Math.cos(s)*d,h=this.radius*Math.sin(s)*d,a.setPosition(c,h,2*-l),o.setPosition(c,h,.4*-l),d=.8+.3*Math.random(),o.setColorRGB(d,d,d),s+=n;s=0,g=.7*this.radius,u=e.newVertexList(),f=r.newVertexList();for(m=0;m<16;m++)d=(2+Math.random())/2,o=u.newVertex(),a=f.newVertex(),c=g*Math.cos(s)*d,h=g*Math.sin(s)*d,o.setPosition(c,h,.8*-l),a.setPosition(c,h,1.2*-l),d=.6+.3*Math.random(),o.setColorRGB(d,d,d),s+=n;u=e.newVertexList(),f=r.newVertexList(),d=.6+.3*Math.random();for(var m=0;m<16;m++)o=u.newVertex(),a=f.newVertex(),o.setPosition(0,0,-l),a.setPosition(0,0,-l),o.setColorRGB(d,d,d);e.makeTTrianglesLateralSidesLOOP(t),r.makeTTrianglesLateralSidesLOOP(i)};var AuxiliarSegment=function(){if(!(this instanceof AuxiliarSegment))throw new Error(Messages.CONSTRUCT_ERROR);this.point1,this.point2};AuxiliarSegment.prototype.setPoints=function(e,t,r,i,o,a){this.point1[0]=e,this.point1[1]=t,this.point1[2]=r,this.point2[0]=i,this.point2[1]=o,this.point2[2]=a};var BoundingBox=function(){if(!(this instanceof BoundingBox))throw new Error(Messages.CONSTRUCT_ERROR);this.minX=1e6,this.minY=1e6,this.minZ=1e6,this.maxX=-1e6,this.maxY=-1e6,this.maxZ=-1e6};BoundingBox.prototype.init=function(e){e=e||new Point3D,this.minX=e.x,this.minY=e.y,this.minZ=e.z,this.maxX=e.x,this.maxY=e.y,this.maxZ=e.z},BoundingBox.prototype.deleteObjects=function(){this.minX=void 0,this.minY=void 0,this.minZ=void 0,this.maxX=void 0,this.maxY=void 0,this.maxZ=void 0},BoundingBox.prototype.copyFrom=function(e){this.minX=e.minX,this.minY=e.minY,this.minZ=e.minZ,this.maxX=e.maxX,this.maxY=e.maxY,this.maxZ=e.maxZ},BoundingBox.prototype.expand=function(e){e=e||0,e=Math.abs(e),this.minX-=e,this.minY-=e,this.minZ-=e,this.maxX+=e,this.maxY+=e,this.maxZ+=e},BoundingBox.prototype.addPoint=function(e){void 0===e&&(e.x<this.minX?this.minX=e.x:e.x>this.maxX&&(this.maxX=e.x),e.y<this.minY?this.minY=e.y:e.y>this.maxY&&(this.maxY=e.y),e.z<this.minZ?this.minZ=e.z:e.z>this.maxZ&&(this.maxZ=e.z))},BoundingBox.prototype.addBox=function(e){void 0===e&&(e.minX<this.minX&&(this.minX=e.minX),e.maxX>this.maxX&&(this.maxX=e.maxX),e.minY<this.minY&&(this.minY=e.minY),e.maxY>this.maxY&&(this.maxY=e.maxY),e.minZ<this.minZ&&(this.minZ=e.minZ),e.maxZ>this.maxZ&&(this.maxZ=e.maxZ))},BoundingBox.prototype.getMinLength=function(){return Math.min(this.maxX-this.minX,this.maxY-this.minY,this.maxZ-this.minZ)},BoundingBox.prototype.getMaxLength=function(){return Math.max(this.maxX-this.minX,this.maxY-this.minY,this.maxZ-this.minZ)},BoundingBox.prototype.getXLength=function(){return this.maxX-this.minX},BoundingBox.prototype.getYLength=function(){return this.maxY-this.minY},BoundingBox.prototype.getZLength=function(){return this.maxZ-this.minZ},BoundingBox.prototype.getCenterPoint=function(e){return void 0===e&&(e=new Point3D),e.set((this.maxX+this.minX)/2,(this.maxY+this.minY)/2,(this.maxZ+this.minZ)/2),e},BoundingBox.prototype.getRadiusAprox=function(){return this.getMaxLength()/1.5},BoundingBox.prototype.intersectWithPoint=function(e){return void 0!==e&&!(e.x<this.minX||e.x>this.maxX||e.y<this.minY||e.y>this.maxY||e.z<this.minZ||e.z>this.maxZ)},BoundingBox.prototype.isPoint3dInside=function(e,t,r){return!(e<this.minX||e>this.maxX)&&(!(t<this.minY||t>this.maxY)&&!(r<this.minZ||r>this.maxZ))},BoundingBox.prototype.intersectWithBox=function(e){return void 0!==e&&!(e.minX>this.maxX||e.maxX<this.minX||e.minY>this.maxY||e.maxY<this.minY||e.minZ>this.maxZ||e.maxZ<this.minZ)},BoundingBox.prototype.intersectsWithBBox=function(e){var t=!0;return this.maxX<e.minX?t=!1:this.minX>e.maxX?t=!1:this.maxY<e.minY?t=!1:this.minY>e.maxY?t=!1:this.maxZ<e.minZ?t=!1:this.minZ>e.maxZ&&(t=!1),t};var BoundingSphere=function(){if(!(this instanceof BoundingSphere))throw new Error(Messages.CONSTRUCT_ERROR);this.center=new Point3D,this.radius=0},Box=function(){if(!(this instanceof Box))throw new Error(Messages.CONSTRUCT_ERROR);this.triPolyhedron=new TriPolyhedron,this.vbo_vicks_container=new VBOVertexIdxCacheKeysContainer,this.vBOVertexIdxCacheKey=this.vbo_vicks_container.newVBOVertexIdxCacheKey()};Box.prototype.makeAABB=function(e,t,r){var i=-e/2,o=-t/2,a=-r/2,n=e/2,s=t/2,l=r/2,c=this.triPolyhedron.vertexList,h=c.newVertex();h.setPosition(i,o,a),(h=c.newVertex()).setPosition(n,o,a),(h=c.newVertex()).setPosition(n,s,a),(h=c.newVertex()).setPosition(i,s,a),(h=c.newVertex()).setPosition(i,o,l),(h=c.newVertex()).setPosition(n,o,l),(h=c.newVertex()).setPosition(n,s,l),(h=c.newVertex()).setPosition(i,s,l);var d;(d=this.triPolyhedron.newTriSurface()).newTriangle().setVertices(c.getVertex(0),c.getVertex(2),c.getVertex(1)),d.newTriangle().setVertices(c.getVertex(0),c.getVertex(3),c.getVertex(2)),(d=this.triPolyhedron.newTriSurface()).newTriangle().setVertices(c.getVertex(4),c.getVertex(5),c.getVertex(6)),d.newTriangle().setVertices(c.getVertex(4),c.getVertex(6),c.getVertex(7)),(d=this.triPolyhedron.newTriSurface()).newTriangle().setVertices(c.getVertex(0),c.getVertex(1),c.getVertex(5)),d.newTriangle().setVertices(c.getVertex(0),c.getVertex(5),c.getVertex(4)),(d=this.triPolyhedron.newTriSurface()).newTriangle().setVertices(c.getVertex(1),c.getVertex(2),c.getVertex(6)),d.newTriangle().setVertices(c.getVertex(1),c.getVertex(6),c.getVertex(5)),(d=this.triPolyhedron.newTriSurface()).newTriangle().setVertices(c.getVertex(2),c.getVertex(3),c.getVertex(7)),d.newTriangle().setVertices(c.getVertex(2),c.getVertex(7),c.getVertex(6)),(d=this.triPolyhedron.newTriSurface()).newTriangle().setVertices(c.getVertex(3),c.getVertex(0),c.getVertex(4)),d.newTriangle().setVertices(c.getVertex(3),c.getVertex(4),c.getVertex(7))};var BuildingSeed=function(){if(!(this instanceof BuildingSeed))throw new Error(Messages.CONSTRUCT_ERROR);this.fisrtName,this.name="",this.buildingId,this.buildingFileName,this.geographicCoord,this.rotationsDegree,this.bBox,this.geographicCoordOfBBox},BuildingSeedList=function(){if(!(this instanceof BuildingSeedList))throw new Error(Messages.CONSTRUCT_ERROR);this.buildingSeedArray=[],this.minGeographicCoord,this.maxGeographicCoord,this.dataArrayBuffer};BuildingSeedList.prototype.newBuildingSeed=function(){var e=new BuildingSeed;return this.buildingSeedArray.push(e),e},BuildingSeedList.prototype.parseBuildingSeedArrayBuffer=function(){if(void 0===this.dataArrayBuffer)return!1;var e,t,r,i,o=this.dataArrayBuffer,a=0,n=new Int32Array(o.slice(a,a+4))[0];a+=4;for(var s=0;s<n;s++){var l=this.newBuildingSeed();void 0===l.geographicCoord&&(l.geographicCoord=new GeographicCoord),void 0===l.bBox&&(l.bBox=new BoundingBox),e=new Int32Array(o.slice(a,a+4))[0],a+=4;var c=String.fromCharCode.apply(null,new Int8Array(o.slice(a,a+e)));a+=e,t=new Float64Array(o.slice(a,a+8))[0],a+=8,r=new Float64Array(o.slice(a,a+8))[0],a+=8,i=new Float32Array(o.slice(a,a+4))[0],a+=4,l.bBox.minX=new Float32Array(o.slice(a,a+4))[0],a+=4,l.bBox.minY=new Float32Array(o.slice(a,a+4))[0],a+=4,l.bBox.minZ=new Float32Array(o.slice(a,a+4))[0],a+=4,l.bBox.maxX=new Float32Array(o.slice(a,a+4))[0],a+=4,l.bBox.maxY=new Float32Array(o.slice(a,a+4))[0],a+=4,l.bBox.maxZ=new Float32Array(o.slice(a,a+4))[0],a+=4,l.buildingId=c.substr(4,e-4),l.buildingFileName=c,l.geographicCoord.setLonLatAlt(t,r,i)}return!0};var Camera=function(){if(!(this instanceof Camera))throw new Error(Messages.CONSTRUCT_ERROR);this.position=new Point3D,this.direction=new Point3D,this.up=new Point3D,this.right=new Point3D,this.frustum=new Frustum,this.dirty=!0,this.nearCenterPoint=new Point3D,this.farCenterPoint=new Point3D,this.farLeftBottomPoint=new Point3D,this.farRightTopPoint=new Point3D,this.leftBottomDir=new Point3D,this.rightTopDir=new Point3D,this.leftNormal=new Point3D,this.rightNormal=new Point3D,this.bottomNormal=new Point3D,this.topNormal=new Point3D};Camera.prototype.setDirty=function(e){this.dirty=e},Camera.prototype.getDirty=function(){return this.dirty},Camera.prototype.calculateFrustumPlanes=function(){var e=this.frustum.tangentOfHalfFovy*this.frustum.near*2,t=this.frustum.tangentOfHalfFovy*this.frustum.far*2,r=(this.frustum.aspectRatio,t*this.frustum.aspectRatio);this.right=this.direction.crossProduct(this.up,this.right),this.nearCenterPoint.set(this.position.x+this.direction.x*this.frustum.near,this.position.y+this.direction.y*this.frustum.near,this.position.z+this.direction.z*this.frustum.near),this.farCenterPoint.set(this.position.x+this.direction.x*this.frustum.far,this.position.y+this.direction.y*this.frustum.far,this.position.z+this.direction.z*this.frustum.far),this.farLeftBottomPoint.set(this.farCenterPoint.x-this.right.x*r*.5-this.up.x*t*.5,this.farCenterPoint.y-this.right.y*r*.5-this.up.y*t*.5,this.farCenterPoint.z-this.right.z*r*.5-this.up.z*t*.5),this.farRightTopPoint.set(this.farLeftBottomPoint.x+this.right.x*r+this.up.x*t,this.farLeftBottomPoint.y+this.right.y*r+this.up.y*t,this.farLeftBottomPoint.z+this.right.z*r+this.up.z*t),this.leftBottomDir.set(this.farLeftBottomPoint.x-this.position.x,this.farLeftBottomPoint.y-this.position.y,this.farLeftBottomPoint.z-this.position.z),this.leftBottomDir.unitary(),this.rightTopDir.set(this.farRightTopPoint.x-this.position.x,this.farRightTopPoint.y-this.position.y,this.farRightTopPoint.z-this.position.z),this.rightTopDir.unitary(),this.frustum.planesArray[0].setPointAndNormal(this.nearCenterPoint.x,this.nearCenterPoint.y,this.nearCenterPoint.z,this.direction.x,this.direction.y,this.direction.z),this.frustum.planesArray[1].setPointAndNormal(this.farCenterPoint.x,this.farCenterPoint.y,this.farCenterPoint.z,-this.direction.x,-this.direction.y,-this.direction.z),this.leftNormal=this.leftBottomDir.crossProduct(this.up,this.leftNormal),this.leftNormal.unitary(),this.frustum.planesArray[2].setPointAndNormal(this.position.x,this.position.y,this.position.z,this.leftNormal.x,this.leftNormal.y,this.leftNormal.z),this.bottomNormal=this.right.crossProduct(this.leftBottomDir,this.bottomNormal),this.bottomNormal.unitary(),this.frustum.planesArray[3].setPointAndNormal(this.position.x,this.position.y,this.position.z,this.bottomNormal.x,this.bottomNormal.y,this.bottomNormal.z),this.rightNormal=this.up.crossProduct(this.rightTopDir,this.rightNormal),this.rightNormal.unitary(),this.frustum.planesArray[4].setPointAndNormal(this.position.x,this.position.y,this.position.z,this.rightNormal.x,this.rightNormal.y,this.rightNormal.z),this.topNormal=this.rightTopDir.crossProduct(this.right,this.topNormal),this.topNormal.unitary(),this.frustum.planesArray[5].setPointAndNormal(this.position.x,this.position.y,this.position.z,this.topNormal.x,this.topNormal.y,this.topNormal.z)};var CODE={};CODE.fileLoadState={READY:0,LOADING_STARTED:1,LOADING_FINISHED:2,PARSE_STARTED:3,PARSE_FINISHED:4},CODE.moveMode={ALL:"0",OBJECT:"1",NONE:"2"};var Color=function(){if(!(this instanceof Color))throw new Error(Messages.CONSTRUCT_ERROR);this.r=0,this.g=0,this.b=0,this.a=1};Color.prototype.deleteObjects=function(){this.r=void 0,this.g=void 0,this.b=void 0,this.a=void 0},Color.prototype.set=function(e,t,r,i){this.r=e,this.g=t,this.b=r,this.a=i},Color.prototype.setRGB=function(e,t,r){this.r=e,this.g=t,this.b=r},Color.prototype.setRGBA=function(e,t,r,i){this.r=e,this.g=t,this.b=r,this.a=i};var SelectionColor=function(){if(!(this instanceof SelectionColor))throw new Error(Messages.CONSTRUCT_ERROR);this.color=new Color};SelectionColor.prototype.init=function(){this.color.r=0,this.color.g=0,this.color.b=0,this.cycle=0},SelectionColor.prototype.getAvailableColor=function(e){return void 0===e&&(e=new Color),e.setRGB(this.color.r,this.color.g,this.color.b),this.color.b+=1,this.color.b>=254&&(this.color.b=0,this.color.g+=1,this.color.g>=254&&(this.color.g=0,this.color.r+=1,this.color.r>=254&&(this.color.r=0,this.cycle+=1))),e},SelectionColor.prototype.decodeColor3=function(e,t,r){return 64516*e+254*t+r};var Constant={};Constant.CESIUM="cesium",Constant.WORLDWIND="worldwind",Constant.OBJECT_INDEX_FILE="/objectIndexFile.ihe",Constant.CACHE_VERSION="?cache_version=",Constant.SIMPLE_BUILDING_TEXTURE3x3_BMP="/SimpleBuildingTexture3x3.bmp",Constant.RESULT_XDO2F4D="/Result_xdo2f4d/Images/",Constant.RESULT_XDO2F4D_TERRAINTILES="/Result_xdo2f4d/F4D_TerrainTiles/",Constant.RESULT_XDO2F4D_TERRAINTILEFILE_TXT="/Result_xdo2f4d/f4dTerranTileFile.txt",Constant.INTERSECTION_OUTSIDE=0,Constant.INTERSECTION_INTERSECT=1,Constant.INTERSECTION_INSIDE=2;var FBO=function(e,t,r){if(!(this instanceof FBO))throw new Error(Messages.CONSTRUCT_ERROR);if(this.gl=e,this.width=t,this.height=r,this.fbo=e.createFramebuffer(),this.depthBuffer=e.createRenderbuffer(),this.colorBuffer=e.createTexture(),this.dirty=!0,e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this.colorBuffer),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,t,r,0,e.RGBA,e.UNSIGNED_BYTE,null),e.bindFramebuffer(e.FRAMEBUFFER,this.fbo),e.bindRenderbuffer(e.RENDERBUFFER,this.depthBuffer),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,t,r),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,this.depthBuffer),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.colorBuffer,0),e.checkFramebufferStatus(e.FRAMEBUFFER)!==e.FRAMEBUFFER_COMPLETE)throw"Incomplete frame buffer object.";e.bindFramebuffer(e.FRAMEBUFFER,null)};FBO.prototype.bind=function(){this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.fbo)},FBO.prototype.unbind=function(){this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null)};var FileRequestControler=function(){if(!(this instanceof FileRequestControler))throw new Error(Messages.CONSTRUCT_ERROR);this.maxFilesRequestedCount=1,this.filesRequestedCount=0,this.headerFilesRequestedCount=0,this.modelRefFilesRequestedCount=0};FileRequestControler.prototype.isFull=function(){return this.filesRequestedCount>=this.maxFilesRequestedCount},FileRequestControler.prototype.isFullHeaders=function(){return this.headerFilesRequestedCount>=1},FileRequestControler.prototype.isFullPlus=function(e){return this.filesRequestedCount>=this.maxFilesRequestedCount+e},FileRequestControler.prototype.isFullPlusModelReferences=function(e){return this.modelRefFilesRequestedCount>=this.maxFilesRequestedCount+e};var keyFlags={moveForward:!1,moveBackward:!1,moveLeft:!1,moveRight:!1};Object.defineProperties(FirstPersonView.prototype,{camera:{get:function(){return this._camera},set:function(e){this._camera=e}},position:{get:function(){return this._position},set:function(e){this._position=e}},rotation:{get:function(){return this._rotation},set:function(e){this._rotation=e}},positionSpeed:{get:function(){return this._positionSpeed},set:function(e){this._positionSpeed=e}},rotationSpeed:{get:function(){return this._ratationSpeed},set:function(e){this._ratationSpeed=e}}}),FirstPersonView.prototype.init=function(){this._position.set(0,0,0),this._rotation.set(0,0,0),document.addEventListener("keydown",onKeyDown,!1),document.addEventListener("keyup",onKeyUp,!1)},FirstPersonView.prototype.release=function(){this._camera=void 0,this._cameraBAK=void 0,document.removeEventListener("keydown",onKeyDown,!1),document.removeEventListener("keyup",onKeyUp,!1)},FirstPersonView.prototype.move=function(e){var t=vec3.fromValues(this._position.x,this._position.y,this.position.z),r=mat4.create();mat4.rotateY(r,r,this._rotation.y),vec3.transformMat4(e,e,r),vec3.add(t,t,e),this._position.set(t[0],t[1],t[2])},FirstPersonView.prototype.update=function(e){void 0!==this._camera&&(keyFlags.moveForward&&(this._camera.moveForward(.5),this.move(vec3.fromValues(0,1,0))),keyFlags.moveBackward&&(this._camera.moveBackward(.5),this.move(vec3.fromValues(0,-1,0))),keyFlags.moveLeft&&(this._camera.lookLeft(.1),this.move(vec3.fromValues(-1,0,0))),keyFlags.moveRight&&(this._camera.lookRight(.1),this.move(vec3.fromValues(1,0,0))))};var Frustum=function(){if(!(this instanceof Frustum))throw new Error(Messages.CONSTRUCT_ERROR);this.near=new Float32Array([.1]),this.far=new Float32Array([1e3]),this.fovyRad=new Float32Array([.8037]),this.tangentOfHalfFovy=new Float32Array([0]),this.fovRad=new Float32Array([1.047]),this.aspectRatio=new Float32Array([1.3584]),this.planesArray=[],this.dirty=!0;for(var e=0;e<6;e++){var t=new Plane;this.planesArray.push(t)}};Frustum.prototype.intersectionSphere=function(e){for(var t=!1,r=0;r<6;r++){var i=this.planesArray[r].intersectionSphere(e);if(i===Constant.INTERSECTION_OUTSIDE)return Constant.INTERSECTION_OUTSIDE;i===Constant.INTERSECTION_INTERSECT&&(t=!0)}return t?Constant.INTERSECTION_INTERSECT:Constant.INTERSECTION_INSIDE};var GeographicCoord=function(){if(!(this instanceof GeographicCoord))throw new Error(Messages.CONSTRUCT_ERROR);this.longitude,this.latitude,this.altitude};GeographicCoord.prototype.deleteObjects=function(){this.longitude=void 0,this.latitude=void 0,this.altitude=void 0},GeographicCoord.prototype.copyFrom=function(e){this.longitude=e.longitude,this.latitude=e.latitude,this.altitude=e.altitude},GeographicCoord.prototype.setLonLatAlt=function(e,t,r){this.longitude=e,this.latitude=t,this.altitude=r};var GeographicExtent=function(){if(!(this instanceof GeographicExtent))throw new Error(Messages.CONSTRUCT_ERROR);this.minGeographicCoord,this.maxGeographicCoord},GeoLocationData=function(e){if(!(this instanceof GeoLocationData))throw new Error(Messages.CONSTRUCT_ERROR);this.name,this.name=void 0===e?"noName":e,this.geographicCoord,this.heading,this.pitch,this.roll,this.date,this.position,this.positionHIGH,this.positionLOW,this.pivotPoint,this.geoLocMatrix,this.geoLocMatrixInv,this.tMatrix,this.tMatrixInv,this.rotMatrix,this.rotMatrixInv,this.pivotPointTraslation};GeoLocationData.prototype.doEffectivePivotPointTranslation=function(){if(void 0!==this.pivotPointTraslation){var e;e=this.tMatrix.rotatePoint3D(this.pivotPointTraslation,e),this.position.x+=e.x,this.position.y+=e.y,this.position.z+=e.z,this.positionLOW[0]+=e.x,this.positionLOW[1]+=e.y,this.positionLOW[2]+=e.z,void 0===this.pivotPoint&&(this.pivotPoint=new Point3D),this.pivotPoint.set(this.position.x,this.position.y,this.position.z)}},GeoLocationData.prototype.copyFrom=function(e){void 0!==e&&(this.name=e.name,e.geographicCoord&&(void 0===this.geographicCoord&&(this.geographicCoord=new GeographicCoord),this.geographicCoord.copyFrom(e.geographicCoord)),this.heading=e.heading,this.pitch=e.pitch,this.roll=e.roll,this.date=e.date,e.position&&(void 0===this.position&&(this.position=new Point3D),this.position.copyFrom(e.position)),e.positionHIGH&&(void 0===this.positionHIGH&&(this.positionHIGH=new Float32Array(3)),this.positionHIGH[0]=e.positionHIGH[0],this.positionHIGH[1]=e.positionHIGH[1],this.positionHIGH[2]=e.positionHIGH[2]),e.positionLOW&&(void 0===this.positionLOW&&(this.positionLOW=new Float32Array(3)),this.positionLOW[0]=e.positionLOW[0],this.positionLOW[1]=e.positionLOW[1],this.positionLOW[2]=e.positionLOW[2]),e.pivotPoint&&(void 0===this.pivotPoint&&(this.pivotPoint=new Point3D),this.pivotPoint.copyFrom(e.pivotPoint)),e.geoLocMatrix&&(void 0===this.geoLocMatrix&&(this.geoLocMatrix=new Matrix4),this.geoLocMatrix.copyFromMatrix4(e.geoLocMatrix)),e.geoLocMatrixInv&&(void 0===this.geoLocMatrixInv&&(this.geoLocMatrixInv=new Matrix4),this.geoLocMatrixInv.copyFromMatrix4(e.geoLocMatrixInv)),e.tMatrix&&(void 0===this.tMatrix&&(this.tMatrix=new Matrix4),this.tMatrix.copyFromMatrix4(e.tMatrix)),e.tMatrixInv&&(void 0===this.tMatrixInv&&(this.tMatrixInv=new Matrix4),this.tMatrixInv.copyFromMatrix4(e.tMatrixInv)),e.rotMatrix&&(void 0===this.rotMatrix&&(this.rotMatrix=new Matrix4),this.rotMatrix.copyFromMatrix4(e.rotMatrix)),e.rotMatrixInv&&(void 0===this.rotMatrixInv&&(this.rotMatrixInv=new Matrix4),this.rotMatrixInv.copyFromMatrix4(e.rotMatrixInv)),e.aditionalTraslation&&(void 0===this.aditionalTraslation&&(this.aditionalTraslation=new Point3D),this.aditionalTraslation.copyFrom(e.aditionalTraslation)))},GeoLocationData.prototype.getTransformedRelativeCamera=function(e,t){var r=new Point3D;return r.set(e.position.x-this.position.x,e.position.y-this.position.y,e.position.z-this.position.z),t.position=this.rotMatrixInv.transformPoint3D(r,t.position),r.set(e.direction.x,e.direction.y,e.direction.z),t.direction=this.rotMatrixInv.transformPoint3D(r,t.direction),r.set(e.up.x,e.up.y,e.up.z),t.up=this.rotMatrixInv.transformPoint3D(r,t.up),r.x=void 0,r.y=void 0,r.z=void 0,r=void 0,t};var GeoLocationDataManager=function(){if(!(this instanceof GeoLocationDataManager))throw new Error(Messages.CONSTRUCT_ERROR);this.geoLocationDataArray=[],this.geoLocationDataCache={}};GeoLocationDataManager.prototype.newGeoLocationData=function(e){void 0===e&&(e="noName"+this.geoLocationDataArray.length.toString());var t=new GeoLocationData(e);return this.geoLocationDataArray.push(t),this.geoLocationDataCache[e]=t,t},GeoLocationDataManager.prototype.getGeoLocationData=function(e){return this.geoLocationDataArray[e]};var GeometryModifier=function(){if(!(this instanceof GeometryModifier))throw new Error(Messages.CONSTRUCT_ERROR)};GeometryModifier.prototype.setPoint3d=function(e,t,r,i){e.x=t,e.y=r,e.z=i},GeometryModifier.prototype.point3dSquareDistTo=function(e,t,r,i){var o=e.x-t,a=e.y-r,n=e.z-i;return o*o+a*a+n*n},GeometryModifier.prototype.Matrix4SetByFloat32Array=function(e,t){for(var r=0;r<16;r++)e._floatArrays[r]=t[r]},GeometryModifier.prototype.Matrix4TransformPoint3D=function(e,t){var r=new Point3D;return r.x=t.x*e._floatArrays[0]+t.y*e._floatArrays[4]+t.z*e._floatArrays[8]+e._floatArrays[12],r.y=t.x*e._floatArrays[1]+t.y*e._floatArrays[5]+t.z*e._floatArrays[9]+e._floatArrays[13],r.z=t.x*e._floatArrays[2]+t.y*e._floatArrays[6]+t.z*e._floatArrays[10]+e._floatArrays[14],r},GeometryModifier.prototype.Matrix4GetMultipliedByMatrix=function(e,t){for(var r=new Matrix4,i=0;i<4;i++)for(var o=0;o<4;o++){var a=4*i+o;r._floatArrays[a]=0;for(var n=0;n<4;n++)r._floatArrays[a]+=t._floatArrays[4*n+o]*e._floatArrays[4*i+n]}return r},GeometryModifier.prototype.referenceMultiplyTransformMatrix=function(e,t){var r=this.Matrix4GetMultipliedByMatrix(e._matrix4,t);e._matrix4=r},GeometryModifier.prototype.compoundReferencesListMultiplyReferencesMatrices=function(e,t){for(var r=e._compoundRefsArray.length,i=0;i<r;i++)for(var o=e._compoundRefsArray[i],a=o._referencesList.length,n=0;n<a;n++){var s=o._referencesList[n];this.referenceMultiplyTransformMatrix(s,t)}},GeometryModifier.prototype.compoundReferencesListGetVisibleCompRefObjectsList=function(e,t,r,i){var o=new CompoundReferencesList;o._myBlocksList=e._myBlocksList;var a=e._ocCulling._ocCulling_box,n=this.occlusionCullingOctreeCellGetIndicesVisiblesForEye(a,t,r,i);if(n)for(var s=n.length,l=0;l<s;l++)o._compoundRefsArray.push(e._compoundRefsArray[n[l]]);var c=e._ocCulling._infinite_ocCulling_box,h=this.occlusionCullingOctreeCellGetIndicesVisiblesForEye(c,eye_x,eye_y,eye_z);if(h)for(var s=h.length,l=0;l<s;l++)o._compoundRefsArray.push(e._compoundRefsArray[h[l]]);return o&&0===o.length?null:o},GeometryModifier.prototype.compoundReferencesListContainerGetVisibleCompRefObjectsList=function(e,t,r,i){for(var o=[],a=void 0,n=e.compRefsListArray.length,s=0;s<n;s++){a=e.compRefsListArray[s];var l=this.compoundReferencesListGetVisibleCompRefObjectsList(a,t,r,i);null!==l&&o.push(l)}return o},GeometryModifier.prototype.bRbuildingProjectGetVisibleCompRefLists=function(e,t,r,i){var o=e._interiorCompRefList_Container,a=this.compoundReferencesListContainerGetVisibleCompRefObjectsList(o,eye_x,eye_y,eye_z),n=e._compRefList_Container;return this.compoundReferencesListContainerGetVisibleCompRefObjectsList(n,t,r,i).concat(a)},GeometryModifier.prototype.occlusionCullingOctreeCellSetDimensions=function(e,t,r,i,o,a,n){e.minX=t,e.maxX=r,e.minY=i,e.maxY=o,e.minZ=a,e.maxZ=n},GeometryModifier.prototype.occlusionCullingOctreeCellSetSizesSubBoxes=function(e){if(e._subBoxesArray.length>0){var t=(e.maxX+e.minX)/2,r=(e.maxY+e.minY)/2,i=(e.maxZ+e.minZ)/2;this.occlusionCullingOctreeCellSetDimensions(e._subBoxesArray[0],e.minX,t,e.minY,r,e.minZ,i),this.occlusionCullingOctreeCellSetDimensions(e._subBoxesArray[1],t,e.maxX,e.minY,r,e.minZ,i),this.occlusionCullingOctreeCellSetDimensions(e._subBoxesArray[2],t,e.maxX,r,e.maxY,e.minZ,i),this.occlusionCullingOctreeCellSetDimensions(e._subBoxesArray[3],e.minX,t,r,e.maxY,e.minZ,half_z),this.occlusionCullingOctreeCellSetDimensions(e._subBoxesArray[4],e.minX,t,e.minY,r,i,e.maxZ),this.occlusionCullingOctreeCellSetDimensions(e._subBoxesArray[5],t,e.maxX,e.minY,r,i,e.maxZ),this.occlusionCullingOctreeCellSetDimensions(e._subBoxesArray[6],t,e.maxX,r,e.maxY,i,e.maxZ),this.occlusionCullingOctreeCellSetDimensions(e._subBoxesArray[7],e.minX,t,r,e.maxY,i,e.maxZ);for(var o=0;o<e._subBoxesArray.length;o++)this.occlusionCullingOctreeCellSetSizesSubBoxes(e._subBoxesArray[o])}},GeometryModifier.prototype.occlusionCullingOctreeCellIntersectsWithPoint3D=function(e,t,r,i){var o=!1;return t>e.minX&&t<e.maxX&&r>e.minY&&r<e.maxY&&i>e.minZ&&i<e.maxZ&&(o=!0),o},GeometryModifier.prototype.occlusionCullingOctreeCellGetIntersectedSubBoxByPoint3D=function(e,t,r,i){var o=null;if(null===e._ocCulling_Cell_owner&&!this.occlusionCullingOctreeCellIntersectsWithPoint3D(e,t,r,i))return null;if(e._subBoxesArray.length>0){var a=(e.minX+e.maxX)/2,n=(e.minY+e.maxY)/2,s=(e.minZ+e.maxZ)/2,l=null,c=void 0;c=t<a?r<n?i<s?0:4:i<s?3:7:r<center_y?i<center_z?1:5:i<center_z?2:6,l=e._subBoxesArray[c],o=this.occlusionCullingOctreeCellGetIntersectedSubBoxByPoint3D(l,t,r,i)}else o=e;return o},GeometryModifier.prototype.occlusionCullingOctreeCellGetIndicesVisiblesForEye=function(e,t,r,i){var o=null,a=this.occlusionCullingOctreeCellGetIntersectedSubBoxByPoint3D(e,t,r,i);return null!==a&&a._indicesArray.length>0&&(o=a._indicesArray),o},GeometryModifier.prototype.occlusionCullingOctreeCellExpandBox=function(e,t){e.minX-=t,e.maxX+=t,e.minY-=t,e.maxY+=t,e.minZ-=t,e.maxZ+=t},GeometryModifier.prototype.vertexTexcoordsArraysCacheKeysContainerNewVertexTexcoordsArraysCacheKey=function(e){var t=new VertexTexcoordsArraysCacheKeys;return e._vtArrays_cacheKeys_array.push(t),t},GeometryModifier.prototype.blocksListGetBlock=function(e,t){var r=null;return t>=0&&t<e.blocksArray.length&&(r=e.blocksArray[t]),r},GeometryModifier.prototype.blocksListsContainerNewBlocksList=function(e,t){var r=new BlocksList;return r.name=t,e.blocksListsArray.push(r),r},GeometryModifier.prototype.blocksListsContainerGetBlockList=function(e,t){for(var r=e.blocksListsArray.length,i=!1,o=0,a=null;!i&&o<r;){var n=e.blocksListsArray[o];n.name===t&&(i=!0,a=n),o++}return a},GeometryModifier.prototype.bRbuildingProjectCreateDefaultBlockReferencesLists=function(e){this.f4dBlocksListsContainerNewBlocksList(e._blocksList_Container,"Blocks1"),this.f4dBlocksListsContainerNewBlocksList(e._blocksList_Container,"Blocks2"),this.f4dBlocksListsContainerNewBlocksList(e._blocksList_Container,"Blocks3"),this.f4dBlocksListsContainerNewBlocksList(e._blocksList_Container,"Blocks4"),this.f4dBlocksListsContainerNewBlocksList(e._blocksList_Container,"BlocksBone")},GeometryModifier.prototype.bRbuildingProjectsListNewBRProject=function(e){var t=new BRBuildingProject;return this.bRbuildingProjectCreateDefaultBlockReferencesLists(t),e._BR_buildingsArray.push(t),t};var GlobeTile=function(){if(!(this instanceof GlobeTile))throw new Error(Messages.CONSTRUCT_ERROR);this.globeTileOwner,this.depth,this.numberName,this.minGeographicCoord,this.maxGeographicCoord,this.subTilesArray};GlobeTile.prototype.newSubTile=function(){var e=this.subTilesArray.length,t=new GlobeTile;return t.depth=this.depth+1,t.numberName=10*this.numberName+e+1,this.subTilesArray.push(t),t};var Line=function(){if(!(this instanceof Line))throw new Error(Messages.CONSTRUCT_ERROR);this.point=new Point3D,this.direction=new Point3D};Line.prototype.setPointAndDir=function(e,t,r,i,o,a){this.point.set(e,t,r),this.direction.set(i,o,a),this.direction.unitary()};var MagoManager=function(){if(!(this instanceof MagoManager))throw new Error(Messages.CONSTRUCT_ERROR);this.terranTile=new TerranTile,this.renderer=new Renderer,this.selectionCandidates=new SelectionCandidates,this.shadersManager=new ShadersManager,this.postFxShadersManager=new PostFxShadersManager,this.vBOManager=new VBOManager,this.readerWriter=new ReaderWriter,this.magoPolicy=new Policy,this.smartTileManager=new SmartTileManager,this.processQueue=new ProcessQueue,this.parseQueue=new ParseQueue,this.noiseTexture,this.depthFbo,this.normalFbo,this.ssaoFbo,this.pixels=new Uint8Array(64),this.depthFboNeo,this.ssaoFboNeo,this.selectionFbo,this.handler,this.mouse_x=0,this.mouse_y=0,this.mouseLeftDown=!1,this.mouseMiddleDown=!1,this.mouseDragging=!1,this.selObjMovePlane,this.objectSelected,this.buildingSelected,this.octreeSelected,this.mustCheckIfDragging=!0,this.thereAreStartMovePoint=!1,this.startMovPoint=new Point3D,this.TEST_maxWheelZoomAmount=0,this.TEST_maxZoomAmount=0,this.configInformation,this.cameraFPV=new FirstPersonView,this.kernel=[.33,0,.85,.25,.3,.5,.1,.3,.85,-.15,.2,.85,-.33,.05,.6,-.1,-.15,.85,-.05,-.32,.25,.2,-.15,.85,.6,0,.55,.5,.6,.45,-.01,.7,.35,-.33,.5,.45,-.45,0,.55,-.65,-.5,.7,0,-.5,.55,.33,.3,.35],this.atmosphere=new Atmosphere,this.sceneState=new SceneState,this.selectionColor=new SelectionColor,this.vboMemoryManager=new VBOMemoryManager,this.fileRequestControler=new FileRequestControler,this.visibleObjControlerOctrees=new VisibleObjectsController,this.visibleObjControlerNodes=new VisibleObjectsController,this.boundingSphere_Aux,this.radiusAprox_aux,this.lastCamPos=new Point3D,this.squareDistUmbral=22,this.lowestOctreeArray=[],this.backGround_fileReadings_count=0,this.backGround_imageReadings_count=0,this.isCameraMoving=!1,this.isCameraInsideNeoBuilding=!1,this.renderingFase=0,this.bPicking=!1,this.scene,this.renderingModeTemp=0,this.numFrustums,this.isLastFrustum=!1,this.highLightColor4=new Float32Array([.2,1,.2,1]),this.thereAreUrgentOctrees=!1,this.hierarchyManager=new HierarchyManager,this.smallObjectSize=.153,this.sqrtTable=new Float32Array(11);for(var e=0;e<11;e++)this.sqrtTable[e]=Math.sqrt(1+.1*e*(.1*e));this.managerUtil=new ManagerUtils,this.currentSelectedObj_idx=-1,this.currentByteColorPicked=new Uint8Array(4),this.currentShader,this.pointSC=new Point3D,this.pointSC_2=new Point3D,this.arrayAuxSC=[],this.currentTimeSC,this.dateSC,this.startTimeSC,this.maxMilisecondsForRender=10,this.terranTileSC,this.textureAux_1x1,this.resultRaySC=new Float32Array(3),this.matrix4SC=new Matrix4,this.unitaryBoxSC=new Box,this.unitaryBoxSC.makeAABB(1,1,1),this.unitaryBoxSC.vBOVertexIdxCacheKey=this.unitaryBoxSC.triPolyhedron.getVBOArrayModePosNorCol(this.unitaryBoxSC.vBOVertexIdxCacheKey),this.demoBlocksLoaded=!1,this.objMarkerManager=new ObjectMarkerManager,this.pin=new Pin};MagoManager.prototype.start=function(e,t,r,i){if(this.magoPolicy.getMagoEnable()){var o=!1;this.numFrustums=i,r===i-1&&(o=!0,this.isLastFrustum=!0),t.pick||(void 0===this.configInformation&&(this.configInformation=MagoConfig.getPolicy()),this.sceneState.gl=e.context._gl,this.startRender(e,o,r,i))}},MagoManager.prototype.render=function(e){e.addOrderedRenderable(this,1e3)},MagoManager.prototype.renderOrdered=function(e){void 0===this.configInformation&&(this.configInformation=MagoConfig.getPolicy());this.sceneState.dc=e,this.sceneState.gl=e.currentGlContext;this.startRender(void 0,!0,0,1)},MagoManager.prototype.isCameraMoved=function(e,t){var r=!1;return this.lastCamPos.squareDistTo(e.x,e.y,e.z)>t&&(r=!0,this.lastCamPos.x=e.x,this.lastCamPos.y=e.y,this.lastCamPos.z=e.z),r},MagoManager.prototype.renderAtmosphere=function(e,t,r,i){var o=this.atmosphere.cloudsManager.circularCloudsArray.length;if(0!==o){var a=Cesium.EncodedCartesian3.encode(t.x),n=Cesium.EncodedCartesian3.encode(t.y),s=Cesium.EncodedCartesian3.encode(t.z);this.encodedCamPosMC_High[0]=a.high,this.encodedCamPosMC_High[1]=n.high,this.encodedCamPosMC_High[2]=s.high,this.encodedCamPosMC_Low[0]=a.low,this.encodedCamPosMC_Low[1]=n.low,this.encodedCamPosMC_Low[2]=s.low;var l=this.shadersManager.getMagoShader(4),c=l.SHADER_PROGRAM;e.useProgram(c),e.enableVertexAttribArray(l._color),e.enableVertexAttribArray(l._position),Cesium.Matrix4.toArray(i,this.modelViewProjRelToEye_matrix),e.uniformMatrix4fv(l._ModelViewProjectionMatrixRelToEye,!1,this.modelViewProjRelToEye_matrix),e.uniform3fv(l._encodedCamPosHIGH,this.encodedCamPosMC_High),e.uniform3fv(l._encodedCamPosLOW,this.encodedCamPosMC_Low),e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL),e.depthRange(0,1);for(var h,d=0;d<o;d++)h=this.atmosphere.cloudsManager.circularCloudsArray[d],e.uniform3fv(l._cloudPosHIGH,h.positionHIGH),e.uniform3fv(l._cloudPosLOW,h.positionLOW),void 0===h.vbo_vertexCacheKey&&(h.vbo_vertexCacheKey=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,h.vbo_vertexCacheKey),e.bufferData(e.ARRAY_BUFFER,h.getVBOVertexColorFloatArray(),e.STATIC_DRAW)),void 0===h.vbo_indexCacheKey&&(h.vbo_indexCacheKey=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,h.vbo_indexCacheKey),e.bufferData(e.ELEMENT_ARRAY_BUFFER,h.getVBOIndicesShortArray(),e.STATIC_DRAW)),e.bindBuffer(e.ARRAY_BUFFER,h.vbo_vertexCacheKey),e.vertexAttribPointer(l._position,3,e.FLOAT,!1,24,0),e.vertexAttribPointer(l._color,3,e.FLOAT,!1,24,12),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,h.vbo_indexCacheKey),e.drawElements(e.TRIANGLES,h.indicesCount,e.UNSIGNED_SHORT,0);e.disableVertexAttribArray(l._color),e.disableVertexAttribArray(l._position),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)}},MagoManager.prototype.renderCloudShadows=function(e,t,r,i){var o=this.atmosphere.cloudsManager.circularCloudsArray.length;if(0!==o){var a=Cesium.EncodedCartesian3.encode(t.x),n=Cesium.EncodedCartesian3.encode(t.y),s=Cesium.EncodedCartesian3.encode(t.z);this.encodedCamPosMC_High[0]=a.high,this.encodedCamPosMC_High[1]=n.high,this.encodedCamPosMC_High[2]=s.high,this.encodedCamPosMC_Low[0]=a.low,this.encodedCamPosMC_Low[1]=n.low,this.encodedCamPosMC_Low[2]=s.low;var l=this.shadersManager,c=l.getMagoShader(4),h=c.SHADER_PROGRAM;e.useProgram(h),e.enableVertexAttribArray(c._position),Cesium.Matrix4.toArray(i,this.modelViewProjRelToEye_matrix),e.uniformMatrix4fv(c._ModelViewProjectionMatrixRelToEye,!1,this.modelViewProjRelToEye_matrix),e.uniform3fv(c._encodedCamPosHIGH,this.encodedCamPosMC_High),e.uniform3fv(c._encodedCamPosLOW,this.encodedCamPosMC_Low),e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL),e.depthRange(0,1),e.colorMask(!1,!1,!1,!1),e.depthMask(!1),e.enable(e.CULL_FACE),e.enable(e.STENCIL_TEST),e.enable(e.POLYGON_OFFSET_FILL),e.polygonOffset(1,2),e.cullFace(e.FRONT),e.stencilFunc(e.ALWAYS,0,255),e.stencilOp(e.KEEP,e.INCR,e.KEEP),e.clearStencil(0);for(var d,u=0;u<o;u++)d=this.atmosphere.cloudsManager.circularCloudsArray[u],e.uniform3fv(c._cloudPosHIGH,d.positionHIGH),e.uniform3fv(c._cloudPosLOW,d.positionLOW),void 0===d.vbo_shadowVertexCacheKey&&(d.vbo_shadowVertexCacheKey=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,d.vbo_shadowVertexCacheKey),e.bufferData(e.ARRAY_BUFFER,d.getVBOShadowVertexFloatArray(),e.STATIC_DRAW)),void 0===d.vbo_shadowIndexCacheKey&&(d.vbo_shadowIndexCacheKey=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,d.vbo_shadowIndexCacheKey),e.bufferData(e.ELEMENT_ARRAY_BUFFER,d.getVBOShadowIndicesShortArray(),e.STATIC_DRAW)),e.bindBuffer(e.ARRAY_BUFFER,d.vbo_shadowVertexCacheKey),e.vertexAttribPointer(c._position,3,e.FLOAT,!1,0,0),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,d.vbo_shadowIndexCacheKey),e.drawElements(e.TRIANGLES,d.indicesCount,e.UNSIGNED_SHORT,0);e.cullFace(e.BACK),e.stencilFunc(e.ALWAYS,0,255),e.stencilOp(e.KEEP,e.DECR,e.KEEP);for(u=0;u<o;u++)d=this.atmosphere.cloudsManager.circularCloudsArray[u],e.uniform3fv(c._cloudPosHIGH,d.positionHIGH),e.uniform3fv(c._cloudPosLOW,d.positionLOW),void 0===d.vbo_shadowVertexCacheKey&&(d.vbo_shadowVertexCacheKey=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,d.vbo_shadowVertexCacheKey),e.bufferData(e.ARRAY_BUFFER,d.getVBOShadowVertexFloatArray(),e.STATIC_DRAW)),void 0===d.vbo_shadowIndexCacheKey&&(d.vbo_shadowIndexCacheKey=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,d.vbo_shadowIndexCacheKey),e.bufferData(e.ELEMENT_ARRAY_BUFFER,d.getVBOShadowIndicesShortArray(),e.STATIC_DRAW)),e.bindBuffer(e.ARRAY_BUFFER,d.vbo_shadowVertexCacheKey),e.vertexAttribPointer(c._position,3,e.FLOAT,!1,0,0),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,d.vbo_shadowIndexCacheKey),e.drawElements(e.TRIANGLES,d.indicesCount,e.UNSIGNED_SHORT,0);e.disableVertexAttribArray(c._position),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.CULL_FACE),e.colorMask(!0,!0,!0,!0),e.depthMask(!1),e.stencilMask(0),e.stencilFunc(e.NOTEQUAL,1,255),e.stencilOp(e.REPLACE,e.REPLACE,e.REPLACE),e.disable(e.DEPTH_TEST),e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),e.cullFace(e.FRONT),c=l.getMagoShader(5),e.useProgram(c.SHADER_PROGRAM),e.enableVertexAttribArray(c._color),e.enableVertexAttribArray(c._position),e.uniformMatrix4fv(c._ModelViewProjectionMatrixRelToEye,!1,this.modelViewProjRelToEye_matrix),e.uniform3fv(c._encodedCamPosHIGH,this.encodedCamPosMC_High),e.uniform3fv(c._encodedCamPosLOW,this.encodedCamPosMC_Low);var f=this.atmosphere.shadowBlendingCube;void 0===f.vbo_vertexCacheKey&&(f.vbo_vertexCacheKey=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,f.vbo_vertexCacheKey),e.bufferData(e.ARRAY_BUFFER,f.getVBOVertexColorRGBAFloatArray(),e.STATIC_DRAW)),void 0===f.vbo_indexCacheKey&&(f.vbo_indexCacheKey=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,f.vbo_indexCacheKey),e.bufferData(e.ELEMENT_ARRAY_BUFFER,f.getVBOIndicesShortArray(),e.STATIC_DRAW)),e.bindBuffer(e.ARRAY_BUFFER,f.vbo_vertexCacheKey),e.vertexAttribPointer(c._position,3,e.FLOAT,!1,28,0),e.vertexAttribPointer(c._color,4,e.FLOAT,!1,28,12),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,f.vbo_indexCacheKey),e.drawElements(e.TRIANGLES,f.indicesCount,e.UNSIGNED_SHORT,0),e.disableVertexAttribArray(c._position),e.disableVertexAttribArray(c._color),e.enable(e.DEPTH_TEST),e.disable(e.BLEND),e.disable(e.STENCIL_TEST)}},MagoManager.prototype.prepareNeoBuildingsAsimetricVersion=function(e){var t,r=this.readerWriter.geometryDataPath;void 0===this.headersRequestedCounter&&(this.headersRequestedCounter=0);for(var i=[].concat(this.visibleObjControlerNodes.currentVisibles0,this.visibleObjControlerNodes.currentVisibles2),o=0,a=i.length;o<a;o++)if((t=i[o].data.neoBuilding).metaData.fileLoadState===CODE.fileLoadState.READY){if(this.fileRequestControler.isFullHeaders())return;if(this.headersRequestedCounter<2)return void this.headersRequestedCounter++;var n=r+"/"+t.buildingFileName+"/HeaderAsimetric.hed";this.readerWriter.getNeoHeaderAsimetricVersion(e,n,t,this.readerWriter,this),this.headersRequestedCounter=0}i.length=0},MagoManager.prototype.upDateSceneStateMatrices=function(e){if(void 0===this.myCameraSCX&&(this.myCameraSCX=new Camera),this.configInformation.geo_view_library===Constant.WORLDWIND){var t=e.dc,r=WorldWind.Matrix.fromIdentity(),i=WorldWind.Matrix.fromIdentity(),o=WorldWind.Matrix.fromIdentity();o.copy(t.navigatorState.modelview),o[3]=0,o[7]=0,o[11]=0;var a=WorldWind.Matrix.fromIdentity();a.copy(t.navigatorState.modelview),r=a.columnMajorComponents(i),e.modelViewMatrix.copyFromFloatArray(r);var n=WorldWind.Matrix.fromIdentity();n.invertOrthonormalMatrix(a),r=n.columnMajorComponents(i),e.modelViewMatrixInv.copyFromFloatArray(r),e.normalMatrix4.copyFromFloatArray(n);var s=WorldWind.Matrix.fromIdentity();s.copy(t.navigatorState.projection),r=s.columnMajorComponents(i),e.projectionMatrix.copyFromFloatArray(r),(a=WorldWind.Matrix.fromIdentity()).copy(t.navigatorState.modelview),r=o.columnMajorComponents(r),e.modelViewRelToEyeMatrix.copyFromFloatArray(r);var l=WorldWind.Matrix.fromIdentity();l.invertOrthonormalMatrix(o),r=l.columnMajorComponents(i),e.modelViewRelToEyeMatrixInv.copyFromFloatArray(r);var c=WorldWind.Matrix.fromIdentity();c.copy(s),c.multiplyMatrix(o);var i=WorldWind.Matrix.fromIdentity(),r=c.columnMajorComponents(i);e.modelViewProjRelToEyeMatrix.copyFromFloatArray(r);var h=WorldWind.Matrix.fromIdentity();h.copy(s),h.multiplyMatrix(a);var i=WorldWind.Matrix.fromIdentity(),r=h.columnMajorComponents(i);e.modelViewProjMatrix.copyFromFloatArray(r);b=t.navigatorState.eyePoint;e.camera.position.set(b[0],b[1],b[2]);t.navigatorState.heading,t.navigatorState.tilt;var d=new Point3D;d.set(0,0,-1);var u=new Point3D;u.set(0,0,0);var f=new Point3D;f.set(0,1,0);var g=new Point3D;g.set(0,0,0),(u=e.modelViewMatrixInv.rotatePoint3D(d,u)).unitary(),(g=e.modelViewMatrixInv.rotatePoint3D(f,g)).unitary(),e.camera.direction.set(u.x,u.y,u.z),e.camera.up.set(g.x,g.y,g.z),ManagerUtils.calculateSplited3fv([b[0],b[1],b[2]],e.encodedCamPosHigh,e.encodedCamPosLow);var m=this.wwd.viewport;if(e.camera.frustum.aspectRatio=m.width/m.height,e.camera.frustum.near[0]=.1,e.camera.frustum.far=1e3,e.camera.frustum.dirty){var y=t.navigatorState.projection,p=e.camera.frustum.aspectRatio,v=2*Math.atan(1/(p*y[0]));e.camera.frustum.fovyRad=v,e.camera.frustum.fovRad=e.camera.frustum.fovyRad*e.camera.frustum.aspectRatio,e.camera.frustum.dirty=!1,e.camera.frustum.tangentOfHalfFovy=Math.tan(e.camera.frustum.fovyRad/2)}e.drawingBufferWidth=m.width,e.drawingBufferHeight=m.height}else if(this.configInformation.geo_view_library===Constant.CESIUM){var _=this.scene,x=_._context.uniformState;Cesium.Matrix4.toArray(x._modelViewProjectionRelativeToEye,e.modelViewProjRelToEyeMatrix._floatArrays),Cesium.Matrix4.toArray(x._modelViewProjection,e.modelViewProjMatrix._floatArrays),Cesium.Matrix4.toArray(x._modelViewRelativeToEye,e.modelViewRelToEyeMatrix._floatArrays),e.modelViewRelToEyeMatrixInv._floatArrays=Cesium.Matrix4.inverseTransformation(e.modelViewRelToEyeMatrix._floatArrays,e.modelViewRelToEyeMatrixInv._floatArrays),e.modelViewMatrix._floatArrays=Cesium.Matrix4.clone(x.view,e.modelViewMatrix._floatArrays),Cesium.Matrix4.toArray(x._projection,e.projectionMatrix._floatArrays);var b=_.context._us._cameraPosition;ManagerUtils.calculateSplited3fv([b.x,b.y,b.z],e.encodedCamPosHigh,e.encodedCamPosLow),e.modelViewMatrixInv._floatArrays=Cesium.Matrix4.inverseTransformation(e.modelViewMatrix._floatArrays,e.modelViewMatrixInv._floatArrays),e.normalMatrix4._floatArrays=Cesium.Matrix4.transpose(e.modelViewMatrixInv._floatArrays,e.normalMatrix4._floatArrays),e.camera.frustum.far[0]=_._frustumCommandsList[0].far,e.camera.frustum.near[0]=_._frustumCommandsList[0].near,e.camera.frustum.fovRad=_._camera.frustum._fov,e.camera.frustum.fovyRad=_._camera.frustum._fovy,e.camera.frustum.aspectRatio=_._camera.frustum._aspectRatio,e.camera.frustum.tangentOfHalfFovy=Math.tan(e.camera.frustum.fovyRad/2),e.camera.position.set(_.context._us._cameraPosition.x,_.context._us._cameraPosition.y,_.context._us._cameraPosition.z),e.camera.direction.set(_._camera.direction.x,_._camera.direction.y,_._camera.direction.z),e.camera.up.set(_._camera.up.x,_._camera.up.y,_._camera.up.z),e.drawingBufferWidth=_.drawingBufferWidth,e.drawingBufferHeight=_.drawingBufferHeight}this.myCameraSCX.direction.set(e.camera.direction.x,e.camera.direction.y,e.camera.direction.z),this.myCameraSCX.up.set(e.camera.up.x,e.camera.up.y,e.camera.up.z),this.myCameraSCX.frustum.near=e.camera.frustum.near,this.myCameraSCX.frustum.far=e.camera.frustum.far,this.myCameraSCX.frustum.fovyRad=e.camera.frustum.fovyRad,this.myCameraSCX.frustum.tangentOfHalfFovy=e.camera.frustum.tangentOfHalfFovy,this.myCameraSCX.frustum.fovRad=e.camera.frustum.fovRad,this.myCameraSCX.frustum.aspectRatio=e.camera.frustum.aspectRatio},MagoManager.prototype.upDateCamera=function(e){if(this.configInformation.geo_view_library===Constant.WORLDWIND)for(var t=this.sceneState.dc.navigatorState.frustumInModelCoordinates,r=0;r<6;r++){n=t._planes[r];e.frustum.planesArray[r].setNormalAndDistance(n.normal[0],n.normal[1],n.normal[2],n.distance)}else if(this.configInformation.geo_view_library===Constant.CESIUM){var i=this.scene.frameState.camera,o=i.frustum.far;i.frustum.far=1e4;for(var a=i.frustum.computeCullingVolume(i.position,i.direction,i.up),r=0;r<6;r++){var n=a.planes[r];e.frustum.planesArray[r].setNormalAndDistance(n.x,n.y,n.z,n.w)}i.frustum.far=o}},MagoManager.prototype.startRender=function(e,t,r,i){if(0!==this.renderingModeTemp||t){this.numFrustums=i,this.isLastFrustum=t,this.upDateSceneStateMatrices(this.sceneState);var o=this.sceneState.gl;if(void 0===this.textureAux_1x1&&(this.textureAux_1x1=o.createTexture(),o.bindTexture(o.TEXTURE_2D,this.textureAux_1x1),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,1,1,0,o.RGBA,o.UNSIGNED_BYTE,new Uint8Array([200,200,200,255])),o.bindTexture(o.TEXTURE_2D,null)),void 0===this.pin.texture){this.pin.texture=new Texture;var a=this.magoPolicy.imagePath+"/bugger.png";this.pin.texture.texId=o.createTexture(),this.readerWriter.readNeoReferenceTexture(o,a,this.pin.texture,void 0,this),this.pin.texturesArray.push(this.pin.texture);n=new Texture;a=this.magoPolicy.imagePath+"/improve.png",n.texId=o.createTexture(),this.readerWriter.readNeoReferenceTexture(o,a,n,void 0,this),this.pin.texturesArray.push(n);n=new Texture;a=this.magoPolicy.imagePath+"/etc.png",n.texId=o.createTexture(),this.readerWriter.readNeoReferenceTexture(o,a,n,void 0,this),this.pin.texturesArray.push(n);var n=new Texture;a=this.magoPolicy.imagePath+"/new.png",n.texId=o.createTexture(),this.readerWriter.readNeoReferenceTexture(o,a,n,void 0,this),this.pin.texturesArray.push(n)}void 0===this.depthFboNeo&&(this.depthFboNeo=new FBO(o,this.sceneState.drawingBufferWidth,this.sceneState.drawingBufferHeight)),this.sceneState.drawingBufferWidth===this.depthFboNeo.width&&this.sceneState.drawingBufferHeight===this.depthFboNeo.height||(this.depthFboNeo=new FBO(o,this.sceneState.drawingBufferWidth,this.sceneState.drawingBufferHeight),this.sceneState.camera.frustum.dirty=!0);var s=this.sceneState.camera.position;this.isCameraMoving||this.mouseLeftDown||this.mouseMiddleDown||this.isLastFrustum&&(void 0===this.myCameraSCX&&(this.myCameraSCX=new Camera),this.upDateCamera(this.myCameraSCX),this.doFrustumCullingSmartTiles(this.myCameraSCX.frustum,s),this.prepareNeoBuildingsAsimetricVersion(o));if(!this.isCameraMoving&&!this.mouseLeftDown&&!this.mouseMiddleDown&&this.isLastFrustum){this.visibleObjControlerOctrees.initArrays();for(var l,c=this.visibleObjControlerNodes.currentVisibles0.length,h=0;h<c;h++)l=this.visibleObjControlerNodes.currentVisibles0[h],this.getRenderablesDetailedNeoBuildingAsimetricVersion(o,e,l,this.visibleObjControlerOctrees,0)||(this.visibleObjControlerNodes.currentVisibles0.splice(h,1),h--,c=this.visibleObjControlerNodes.currentVisibles0.length);var d=1;this.prepareVisibleOctreesSortedByDistanceLOD2(o,e,this.visibleObjControlerOctrees,d),(d=this.visibleObjControlerOctrees.currentVisibles0.length)>2&&(d=2),this.prepareVisibleOctreesSortedByDistance(o,e,this.visibleObjControlerOctrees,d),c=this.visibleObjControlerNodes.currentVisibles2.length;for(h=0;h<c;h++)l=this.visibleObjControlerNodes.currentVisibles2[h],this.getRenderablesDetailedNeoBuildingAsimetricVersion(o,e,l,this.visibleObjControlerOctrees,2)||(this.visibleObjControlerNodes.currentVisibles2.splice(h,1),h--,c=this.visibleObjControlerNodes.currentVisibles2.length);d=2,this.prepareVisibleOctreesSortedByDistanceLOD2(o,e,this.visibleObjControlerOctrees,d);for(h=(c=this.visibleObjControlerNodes.currentVisibles2.length)-1;h>=0;h--)l=this.visibleObjControlerNodes.currentVisibles2[h],this.processQueue.putNodeToDeleteModelReferences(l,0);this.manageQueue()}if(!0===this.bPicking&&t){var u;!0===this.magoPolicy.issueInsertEnable&&(void 0===this.objMarkerSC&&(this.objMarkerSC=new ObjectMarker),u=new Point3D,u=this.calculatePixelPositionWorldCoord(o,this.mouse_x,this.mouse_y,u),ManagerUtils.calculateGeoLocationDataByAbsolutePoint(u.x,u.y,u.z,this.objMarkerSC.geoLocationData,this),this.renderingFase=!this.renderingFase),!0===this.magoPolicy.objectInfoViewEnable&&(void 0===this.objMarkerSC&&(this.objMarkerSC=new ObjectMarker),void 0===u&&(u=new Point3D,u=this.calculatePixelPositionWorldCoord(o,this.mouse_x,this.mouse_y,u)),ManagerUtils.calculateGeoLocationDataByAbsolutePoint(u.x,u.y,u.z,this.objMarkerSC.geoLocationData,this),this.renderingFase=!this.renderingFase)}!0===this.bPicking&&t&&(this.arrayAuxSC.length=0,this.objectSelected=this.getSelectedObjects(o,this.mouse_x,this.mouse_y,this.visibleObjControlerNodes,this.arrayAuxSC),this.buildingSelected=this.arrayAuxSC[0],this.octreeSelected=this.arrayAuxSC[1],this.arrayAuxSC.length=0,void 0!==this.buildingSelected&&(this.displayLocationAndRotation(this.buildingSelected),this.selectedObjectNotice(this.buildingSelected)),this.objectSelected),this.depthFboNeo.bind();var f=0;o.clearColor(0,0,0,1),o.clear(o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT),o.viewport(0,0,this.sceneState.drawingBufferWidth,this.sceneState.drawingBufferHeight),this.renderLowestOctreeAsimetricVersion(o,s,void 0,!1,f,this.visibleObjControlerNodes),this.depthFboNeo.unbind(),this.renderingFase=!this.renderingFase,this.configInformation.geo_view_library===Constant.WORLDWIND||this.configInformation.geo_view_library===Constant.CESIUM&&e._context._currentFramebuffer._bind(),void 0===this.noiseTexture&&(this.noiseTexture=genNoiseTextureRGBA(o,4,4,this.pixels)),f=1,this.renderLowestOctreeAsimetricVersion(o,s,void 0,!1,f,this.visibleObjControlerNodes),this.magoPolicy.getShowLabelInfo()&&this.drawBuildingNames(this.visibleObjControlerNodes),this.renderingFase=!this.renderingFase,this.configInformation.geo_view_library===Constant.WORLDWIND&&(o.activeTexture(o.TEXTURE0),this.wwd.drawContext.redrawRequested=!0)}},MagoManager.prototype.drawBuildingNames=function(e){var t=document.getElementById("objectLabel");if(void 0!==t){t.style.opacity=1,t.width=this.sceneState.drawingBufferWidth,t.height=this.sceneState.drawingBufferHeight;var r=t.getContext("2d");r.strokeStyle="DarkSlateGray",r.fillStyle="PapayaWhip",r.lineWidth=4,r.font="20px Arial",r.textAlign="center",r.fillRect(0,0,r.canvas.width,r.canvas.height),r.save(),r.clearRect(0,0,r.canvas.width,r.canvas.height);for(var i,o,a,n=1.1*r.measureText("M").width,s=this.sceneState.gl,l=e.currentVisibles2.length,c=0;c<l;c++)o=(i=e.currentVisibles2[c].data.neoBuilding).getBBoxCenterPositionWorldCoord(),(a=this.calculateWorldPositionToScreenCoord(s,o.x,o.y,o.z,a)).x>=0&&a.y>=0&&(r.font="13px Arial",r.strokeText(i.name,a.x,a.y),r.fillText(i.name,a.x,a.y),r.font="9px Arial",r.strokeText("("+i.buildingId+")",a.x,a.y+n),r.fillText("("+i.buildingId+")",a.x,a.y+n));r.restore()}},MagoManager.prototype.cameraMoved=function(){this.sceneState.camera.setDirty(!0),void 0===this.selectionFbo&&(this.selectionFbo=new FBO(this.sceneState.gl,this.sceneState.drawingBufferWidth,this.sceneState.drawingBufferHeight)),this.selectionFbo.dirty=!0},MagoManager.prototype.getSelectedObjects=function(e,t,r,i,o){this.bPicking=!1,void 0===this.selectionFbo&&(this.selectionFbo=new FBO(e,this.sceneState.drawingBufferWidth,this.sceneState.drawingBufferHeight)),this.selectionColor.init(),this.selectionFbo.bind(),this.selectionCandidates.clearCandidates();var a,n,s,l,c,h=0,d=e.TRIANGLES,u=this.postFxShadersManager.pFx_shaders_array[5];e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL),e.depthRange(0,1),e.clearColor(1,1,1,1),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.disable(e.CULL_FACE);var f=u.program;e.useProgram(f),e.enableVertexAttribArray(u.position3_loc),e.uniformMatrix4fv(u.modelViewProjectionMatrix4RelToEye_loc,!1,this.sceneState.modelViewProjRelToEyeMatrix._floatArrays),e.uniform3fv(u.cameraPosHIGH_loc,this.sceneState.encodedCamPosHigh),e.uniform3fv(u.cameraPosLOW_loc,this.sceneState.encodedCamPosLow);for(var g,m=i.currentVisibles0.length,y=0;y<m;y++){v=(n=(a=i.currentVisibles0[y]).data.neoBuilding).getGeoLocationData();if(e.uniformMatrix4fv(u.buildingRotMatrix_loc,!1,v.rotMatrix._floatArrays),e.uniform3fv(u.buildingPosHIGH_loc,v.positionHIGH),e.uniform3fv(u.buildingPosLOW_loc,v.positionLOW),void 0!==(s=n.currentVisibleOctreesControler)){l=s.currentVisibles0.length;for(_=0;_<l;_++)c=s.currentVisibles0[_],h=0,this.renderer.renderNeoRefListsAsimetricVersionColorSelection(e,c,n,this,!1,u,h,0,d);l=s.currentVisibles1.length;for(_=0;_<l;_++)c=s.currentVisibles1[_],h=0,this.renderer.renderNeoRefListsAsimetricVersionColorSelection(e,c,n,this,!1,u,h,0,d);void 0===this.colorAux&&(this.colorAux=new Color),e.uniformMatrix4fv(u.RefTransfMatrix,!1,v.rotMatrix._floatArrays),l=s.currentVisibles2.length;for(_=0;_<l;_++)if(void 0!==(c=s.currentVisibles2[_]).lego&&c.lego.fileLoadState!==CODE.fileLoadState.READY&&2!==c.lego.fileLoadState){if("gangnam_del"==n.buildingId);this.colorAux=this.selectionColor.getAvailableColor(this.colorAux),g=this.selectionColor.decodeColor3(this.colorAux.r,this.colorAux.g,this.colorAux.b),this.selectionCandidates.setCandidates(g,void 0,c,n),e.uniform1i(u.hasTexture_loc,!1),e.uniform4fv(u.color4Aux_loc,[this.colorAux.r/255,this.colorAux.g/255,this.colorAux.b/255,1]),e.uniform1i(u.hasAditionalMov_loc,!1),e.uniform3fv(u.aditionalMov_loc,[0,0,0]),this.renderer.renderLodBuildingColorSelection(e,c.lego,this,u)}}}for(var p=i.currentVisibles2.length,y=0;y<p;y++){var v=(n=(a=i.currentVisibles2[y]).data.neoBuilding).getGeoLocationData();if(e.uniform3fv(u.buildingPosHIGH_loc,v.positionHIGH),e.uniform3fv(u.buildingPosLOW_loc,v.positionLOW),s=n.currentVisibleOctreesControler){e.uniformMatrix4fv(u.RefTransfMatrix,!1,v.rotMatrix._floatArrays),l=s.currentVisibles2.length;for(var _=0;_<l;_++)void 0!==(c=s.currentVisibles2[_]).lego&&c.lego.fileLoadState!==CODE.fileLoadState.READY&&2!==c.lego.fileLoadState&&(this.colorAux=this.selectionColor.getAvailableColor(this.colorAux),g=this.selectionColor.decodeColor3(this.colorAux.r,this.colorAux.g,this.colorAux.b),this.selectionCandidates.setCandidates(g,void 0,c,n),e.uniform1i(u.hasTexture_loc,!1),e.uniform4fv(u.color4Aux_loc,[this.colorAux.r/255,this.colorAux.g/255,this.colorAux.b/255,1]),e.uniform1i(u.hasAditionalMov_loc,!1),e.uniform3fv(u.aditionalMov_loc,[0,0,0]),this.renderer.renderLodBuildingColorSelection(e,c.lego,this,u))}}-1!==u.position3_loc&&e.disableVertexAttribArray(u.position3_loc),e.disableVertexAttribArray(u.position3_loc),this.selectionFbo.dirty=!1;var x=new Uint8Array(4);e.readPixels(t,this.sceneState.drawingBufferHeight-r,1,1,e.RGBA,e.UNSIGNED_BYTE,x),e.bindFramebuffer(e.FRAMEBUFFER,null);var b=64516*x[0]+254*x[1]+x[2];this.selectionCandidates.selectObjects(b);var C=this.selectionCandidates.currentReferenceSelected;return o[0]=this.selectionCandidates.currentBuildingSelected,o[1]=this.selectionCandidates.currentOctreeSelected,o[2]=this.selectionCandidates.currentReferenceSelected,C},MagoManager.prototype.getRayWorldSpace=function(e,t,r,i){void 0===i&&(i=new Line);var o=this.sceneState.camera.position,a=new Float32Array(3);return a=this.getRayCamSpace(e,t,r,a),void 0===this.pointSC&&(this.pointSC=new Point3D),this.pointSC.set(a[0],a[1],a[2]),this.pointSC2=this.sceneState.modelViewMatrixInv.rotatePoint3D(this.pointSC,this.pointSC2),this.pointSC2.unitary(),i.setPointAndDir(o.x,o.y,o.z,this.pointSC2.x,this.pointSC2.y,this.pointSC2.z),i},MagoManager.prototype.getRayCamSpace=function(e,t,r,i){var o=this.sceneState.camera.frustum.fovyRad,a=this.sceneState.camera.frustum.aspectRatio,n=2*Math.tan(o/2)*1,s=n*a,l=t,c=this.sceneState.drawingBufferHeight-r;return void 0===i&&(i=new Float32Array(3)),i[0]=s*(l/this.sceneState.drawingBufferWidth-.5),i[1]=n*(c/this.sceneState.drawingBufferHeight-.5),i[2]=-1,i},MagoManager.prototype.calculateSelObjMovePlaneAsimetricMode=function(e,t,r,i){void 0===this.pointSC&&(this.pointSC=new Point3D),void 0===this.pointSC2&&(this.pointSC2=new Point3D),this.calculatePixelPositionWorldCoord(e,t,r,this.pointSC2);var o=this.buildingSelected.getGeoLocationData();return this.pointSC=o.tMatrixInv.transformPoint3D(this.pointSC2,this.pointSC),void 0===i&&(i=new Plane),i.setPointAndNormal(this.pointSC.x,this.pointSC.y,this.pointSC.z,0,0,1),i},MagoManager.prototype.calculatePixelPositionCamCoord=function(e,t,r,i){e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL),e.depthRange(0,1),e.frontFace(e.CCW);var o=this.sceneState.camera.frustum.far;void 0===this.selectionFbo&&(this.selectionFbo=new FBO(e,this.sceneState.drawingBufferWidth,this.sceneState.drawingBufferHeight)),this.selectionFbo.bind(),e.clearColor(1,1,1,1),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.disable(e.BLEND);this.depthRenderLowestOctreeAsimetricVersion(e,0,this.visibleObjControlerNodes);var a=new Uint8Array(4);e.readPixels(t,this.sceneState.drawingBufferHeight-r,1,1,e.RGBA,e.UNSIGNED_BYTE,a);var n=a[0]/16777216+a[1]/65536+a[2]/256+a[3],s=(n/=256)*o;return this.resultRaySC=this.getRayCamSpace(e,t,r,this.resultRaySC),void 0===i&&(i=new Point3D),i.set(this.resultRaySC[0]*s,this.resultRaySC[1]*s,this.resultRaySC[2]*s),e.bindFramebuffer(e.FRAMEBUFFER,null),i},MagoManager.prototype.calculatePixelPositionWorldCoord=function(e,t,r,i){var o=new Point3D;o=this.calculatePixelPositionCamCoord(e,t,r,o);var a=this.sceneState.modelViewMatrixInv;if(void 0===i)var i=new Point3D;return i=a.transformPoint3D(o,i)},MagoManager.prototype.calculateWorldPositionToScreenCoord=function(e,t,r,i,o){void 0===o&&(o=new Point3D),void 0===this.pointSC&&(this.pointSC=new Point3D),void 0===this.pointSC2&&(this.pointSC2=new Point3D),this.pointSC.set(t,r,i),this.pointSC2=this.sceneState.modelViewMatrix.transformPoint3D(this.pointSC,this.pointSC2);var a=this.pointSC2.z;if(a>0)return o.set(-1,-1,0),o;var n=this.sceneState.camera.frustum.tangentOfHalfFovy*a*2,s=n*this.sceneState.camera.frustum.aspectRatio,l=-this.pointSC2.x*this.sceneState.drawingBufferWidth/s,c=-this.pointSC2.y*this.sceneState.drawingBufferHeight/n;return l+=this.sceneState.drawingBufferWidth/2,c+=this.sceneState.drawingBufferHeight/2,c=this.sceneState.drawingBufferHeight-c,o.set(l,c,0),o},MagoManager.prototype.isDragging=function(){var e=this.sceneState.gl;if(this.magoPolicy.mouseMoveMode===CODE.moveMode.ALL){this.arrayAuxSC.length=0;var t=this.getSelectedObjects(e,this.mouse_x,this.mouse_y,this.visibleObjControlerNodes,this.arrayAuxSC),r=this.arrayAuxSC[0];return this.arrayAuxSC.length=0,r===this.buildingSelected}if(this.magoPolicy.mouseMoveMode===CODE.moveMode.OBJECT){this.arrayAuxSC.length=0;t=this.getSelectedObjects(e,this.mouse_x,this.mouse_y,this.visibleObjControlerNodes,this.arrayAuxSC);return this.arrayAuxSC.length=0,t===this.objectSelected}return!1},MagoManager.prototype.setCameraMotion=function(e){this.configInformation.geo_view_library===Constant.WORLDWIND?this.wwd.navigator.panRecognizer.enable=e:this.configInformation.geo_view_library===Constant.CESIUM&&(this.scene.screenSpaceCameraController.enableRotate=e,this.scene.screenSpaceCameraController.enableZoom=e,this.scene.screenSpaceCameraController.enableLook=e,this.scene.screenSpaceCameraController.enableTilt=e,this.scene.screenSpaceCameraController.enableTranslate=e)},MagoManager.prototype.mouseActionLeftDown=function(e,t){this.dateSC=new Date,this.startTimeSC=this.dateSC.getTime(),this.mouse_x=e,this.mouse_y=t,this.mouseLeftDown=!0},MagoManager.prototype.mouseActionLeftUp=function(e,t){this.isCameraMoving=!1,this.mouseLeftDown=!1,this.mouseDragging=!1,this.selObjMovePlane=void 0,this.mustCheckIfDragging=!0,this.thereAreStartMovePoint=!1,this.dateSC=new Date,this.currentTimeSC=this.dateSC.getTime(),this.currentTimeSC-this.startTimeSC<1500&&this.mouse_x===e&&this.mouse_y===t&&(this.bPicking=!0),this.enableCameraMotion(!0)},MagoManager.prototype.mouseActionMiddleDown=function(e,t){this.dateSC=new Date,this.startTimeSC=this.dateSC.getTime(),this.mouse_x=e,this.mouse_y=t,this.mouseMiddleDown=!0,this.isCameraMoving=!0},MagoManager.prototype.mouseActionMiddleUp=function(e,t){this.isCameraMoving=!1,this.mouseMiddleDown=!1,this.mouseDragging=!1,this.selObjMovePlane=void 0,this.mustCheckIfDragging=!0,this.thereAreStartMovePoint=!1,this.enableCameraMotion(!1)},MagoManager.prototype.mouseActionRightDown=function(e,t){},MagoManager.prototype.mouseActionRightUp=function(e,t){},MagoManager.prototype.mouseActionMove=function(e,t){this.mouseLeftDown?this.manageMouseDragging(e,t):this.mouseMiddleDown?this.sceneState.camera.setDirty(!0):this.mouseRightDown?this.sceneState.camera.setDirty(!0):(this.mouseDragging=!1,this.enableCameraMotion(!1),this.mouseMiddleDown&&(this.isCameraMoving=!0))},MagoManager.prototype.enableCameraMotion=function(e){this.configInformation.geo_view_library===Constant.CESIUM?(this.scene.screenSpaceCameraController.enableRotate=e,this.scene.screenSpaceCameraController.enableZoom=e,this.scene.screenSpaceCameraController.enableLook=e,this.scene.screenSpaceCameraController.enableTilt=e,this.scene.screenSpaceCameraController.enableTranslate=e):(this.configInformation.geo_view_library,Constant.WORLDWIND)},MagoManager.prototype.manageMouseDragging=function(e,t){this.sceneState.camera.setDirty(!0),this.configInformation.geo_view_library===Constant.CESIUM?(this.magoPolicy.mouseMoveMode===CODE.moveMode.ALL?void 0!==this.buildingSelected?(this.mouse_x=e,this.mouse_y=t,this.mustCheckIfDragging&&(this.isDragging()&&(this.mouseDragging=!0,this.setCameraMotion(!1)),this.mustCheckIfDragging=!1)):this.isCameraMoving=!0:this.magoPolicy.mouseMoveMode===CODE.moveMode.OBJECT&&(void 0!==this.objectSelected?(this.mouse_x=e,this.mouse_y=t,this.mustCheckIfDragging&&(this.isDragging()&&(this.mouseDragging=!0,this.setCameraMotion(!1)),this.mustCheckIfDragging=!1)):this.isCameraMoving=!0),this.isCameraMoving=!0,this.mouseDragging&&this.moveSelectedObjectAsimetricMode(this.sceneState.gl)):(this.configInformation.geo_view_library,Constant.WORLDWIND)},MagoManager.prototype.moveSelectedObjectAsimetricMode=function(e){if(this.magoPolicy.mouseMoveMode===CODE.moveMode.ALL){if(void 0===this.buildingSelected)return;var t;if(void 0===this.selObjMovePlane){d=this.renderingFase;this.renderingFase=-1,this.selObjMovePlane=new Plane;var r=new Point3D;r=this.calculatePixelPositionWorldCoord(e,this.mouse_x,this.mouse_y,r);var i=(t=this.buildingSelected.getGeoLocationData()).tMatrixInv.transformPoint3D(r,i);this.selObjMovePlane.setPointAndNormal(i.x,i.y,i.z,0,0,1),this.renderingFase=d}void 0===this.lineSC&&(this.lineSC=new Line),this.lineSC=this.getRayWorldSpace(e,this.mouse_x,this.mouse_y,this.lineSC);var o=new Point3D,a=new Point3D;o=(u=this.buildingSelected.getGeoLocationData()).geoLocMatrixInv.transformPoint3D(this.lineSC.point,o),this.pointSC=u.geoLocMatrixInv.rotatePoint3D(this.lineSC.direction,this.pointSC),a.x=this.pointSC.x,a.y=this.pointSC.y,a.z=this.pointSC.z,(f=new Line).setPointAndDir(o.x,o.y,o.z,a.x,a.y,a.z);g=new Point3D;if((g=this.selObjMovePlane.intersectionLine(f,g)).set(-g.x,-g.y,-g.z),void 0===this.pointSC&&(this.pointSC=new Point3D),this.pointSC=u.geoLocMatrix.transformPoint3D(g,this.pointSC),g.set(this.pointSC.x,this.pointSC.y,this.pointSC.z),this.thereAreStartMovePoint){h=ManagerUtils.pointToGeographicCoord(g,h,this);this.pointSC.x=h.longitude,this.pointSC.y=h.latitude;var n=this.pointSC.x-this.startMovPoint.x,s=this.pointSC.y-this.startMovPoint.y,l=(t=this.buildingSelected.getGeoLocationData()).geographicCoord.longitude-n,c=t.geographicCoord.latitude-s;this.changeLocationAndRotation(this.buildingSelected.buildingId,c,l,void 0,void 0,void 0,void 0),this.displayLocationAndRotation(this.buildingSelected),this.startMovPoint.x-=n,this.startMovPoint.y-=s}else{var h=ManagerUtils.pointToGeographicCoord(g,h,this);this.startMovPoint.x=h.longitude,this.startMovPoint.y=h.latitude,this.thereAreStartMovePoint=!0}this.buildingSelected.calculateBBoxCenterPositionWorldCoord()}else if(this.magoPolicy.mouseMoveMode===CODE.moveMode.OBJECT){if(void 0===this.objectSelected)return;if(void 0===this.selObjMovePlane){var d=this.renderingFase;this.renderingFase=-1,this.selObjMovePlane=this.calculateSelObjMovePlaneAsimetricMode(e,this.mouse_x,this.mouse_y,this.selObjMovePlane),this.renderingFase=d}void 0===this.lineSC&&(this.lineSC=new Line),this.getRayWorldSpace(e,this.mouse_x,this.mouse_y,this.lineSC);var u=this.buildingSelected.getGeoLocationData(),o=new Point3D,a=new Point3D;o=u.tMatrixInv.transformPoint3D(this.lineSC.point,o),a=u.tMatrixInv.rotatePoint3D(this.lineSC.direction,a);var f=new Line;f.setPointAndDir(o.x,o.y,o.z,a.x,a.y,a.z);var g=new Point3D;if(g=this.selObjMovePlane.intersectionLine(f,g),void 0===this.objectSelected.moveVectorRelToBuilding&&(this.objectSelected.moveVectorRelToBuilding=new Point3D),this.thereAreStartMovePoint){var n=g.x-this.startMovPoint.x,s=g.y-this.startMovPoint.y,m=g.z-this.startMovPoint.z;this.objectSelected.moveVectorRelToBuilding.set(n,s,m),this.objectSelected.moveVector=u.tMatrix.rotatePoint3D(this.objectSelected.moveVectorRelToBuilding,this.objectSelected.moveVector)}else this.startMovPoint=g,this.startMovPoint.add(-this.objectSelected.moveVectorRelToBuilding.x,-this.objectSelected.moveVectorRelToBuilding.y,-this.objectSelected.moveVectorRelToBuilding.z),this.thereAreStartMovePoint=!0}},MagoManager.prototype.getRenderablesDetailedNeoBuildingAsimetricVersion=function(e,t,r,i,o){var a=r.data.neoBuilding;if(void 0!==a&&void 0!==a.octree){var n=a.getGeoLocationData();if(void 0===n)return!1;if(void 0===a.currentVisibleOctreesControler&&(a.currentVisibleOctreesControler=new VisibleObjectsController),0===o||1===o||2===o){var s=this.magoPolicy.getLod0DistInMeters(),l=this.magoPolicy.getLod1DistInMeters(),c=this.magoPolicy.getLod2DistInMeters();"Sea_Port"!==a.buildingId&&"ctships"!==a.buildingId||(s=350,l=550,c=25e3);var h=!1;this.myCameraSCX=n.getTransformedRelativeCamera(this.sceneState.camera,this.myCameraSCX);var d=a.isCameraInsideOfBuilding(this.myCameraSCX.position.x,this.myCameraSCX.position.y,this.myCameraSCX.position.z);if(a.currentVisibleOctreesControler.clear(),2===o?(a.octree.extractLowestOctreesByLOD(a.currentVisibleOctreesControler,i,this.boundingSphere_Aux,this.myCameraSCX.position,s,l,c),h=!0):(this.myCameraSCX.calculateFrustumPlanes(),h=a.octree.getFrustumVisibleLowestOctreesByLOD(this.myCameraSCX.frustum,a.currentVisibleOctreesControler,i,this.boundingSphere_Aux,this.myCameraSCX.position,s,l,c)),!h)return a.distToCam>15&&this.processQueue.putNodeToDelete(r,0),!1;this.processQueue.eraseNodeToDelete(r)}else a.currentVisibleOctreesControler.currentVisibles2.length=0,a.octree.extractLowestOctreesIfHasTriPolyhedrons(a.currentVisibleOctreesControler.currentVisibles2);var u,f=[].concat(a.currentVisibleOctreesControler.currentVisibles0,a.currentVisibleOctreesControler.currentVisibles1),g=a.getRenderSettingApplyOcclusionCulling();0===f.length?this.processQueue.putNodeToDeleteModelReferences(r,0):this.processQueue.eraseNodeToDeleteModelReferences(r);for(var m=!1,y=0,p=f.length;y<p;y++)if(m=!1,0!==(u=f[y]).triPolyhedronsCount){if(void 0===u.neoReferencesMotherAndIndices)u.neoReferencesMotherAndIndices=new NeoReferencesMotherAndIndices,u.neoReferencesMotherAndIndices.motherNeoRefsList=a.motherNeoReferencesArray,m=!0;else{var v=!d;u.neoReferencesMotherAndIndices.updateCurrentVisibleIndices(v,this.myCameraSCX.position.x,this.myCameraSCX.position.y,this.myCameraSCX.position.z,g)}var _=u.neoReferencesMotherAndIndices.blocksList;void 0!==_&&_.fileLoadState===CODE.fileLoadState.PARSE_FINISHED||(m=!0),m&&a.currentVisibleOctreesControler.currentVisibles2.push(u)}return f.length=0,!0}},MagoManager.prototype.manageQueue=function(){var e=this.sceneState.gl,t=8,r=this.processQueue.nodesToDeleteMap.size;r<t&&(t=r);for(var i,o=Array.from(this.processQueue.nodesToDeleteMap.keys()),a=0;a<t;a++)c=(i=o[a]).data.neoBuilding,this.processQueue.eraseNodeToDelete(i),this.deleteNeoBuilding(e,c);o=[],o=void 0;for(var n=0,o=this.processQueue.nodesToDeleteModelReferencesMap.size,s=Array.from(this.processQueue.nodesToDeleteModelReferencesMap.keys()),a=0;a<o&&(i=s[a],c=i.data.neoBuilding,this.processQueue.eraseNodeToDeleteModelReferences(c),!(void 0!==c&&(c.octree&&c.octree.deleteObjectsModelReferences(e,this.vboMemoryManager),(c.motherBlocksArray.length>0||c.motherNeoReferencesArray.length>0)&&n++,c.deleteObjectsModelReferences(e,this.vboMemoryManager),n>10)));a++);var l,c,h,d=1,u=0;if(void 0===this.matrix4SC&&(this.matrix4SC=new Matrix4),u=0,d=10,this.parseQueue.parseOctreesLod0References(e,this.visibleObjControlerOctrees,this,d)&&this.selectionFbo&&(this.selectionFbo.dirty=!0),u=0,d=10,this.parseQueue.octreesLod0ReferencesToParseMap.size>0){for(var f=this.visibleObjControlerOctrees.currentVisibles1.length,a=0;a<f;a++){if(l=this.visibleObjControlerOctrees.currentVisibles1[a],this.parseQueue.octreesLod0ReferencesToParseMap.delete(l)){if(void 0===l.neoReferencesMotherAndIndices)continue;if(void 0===l.neoReferencesMotherAndIndices.dataArraybuffer)continue;if(l.neoReferencesMotherAndIndices.fileLoadState!==CODE.fileLoadState.LOADING_FINISHED)continue;m=(c=l.neoBuildingOwner).getGeoLocationData();h=c.getHeaderVersion(),this.matrix4SC.setByFloat32Array(m.rotMatrix._floatArrays),"v"===h[0]?l.neoReferencesMotherAndIndices.parseArrayBufferReferences(e,l.neoReferencesMotherAndIndices.dataArraybuffer,this.readerWriter,c.motherNeoReferencesArray,this.matrix4SC,this):l.neoReferencesMotherAndIndices.parseArrayBufferReferencesVersioned(e,l.neoReferencesMotherAndIndices.dataArraybuffer,this.readerWriter,c.motherNeoReferencesArray,this.matrix4SC,this),l.neoReferencesMotherAndIndices.multiplyKeyTransformMatrix(0,m.rotMatrix),l.neoReferencesMotherAndIndices.dataArraybuffer=void 0,u++}else if(l.neoReferencesMotherAndIndices&&l.neoReferencesMotherAndIndices.fileLoadState===CODE.fileLoadState.LOADING_FINISHED);if(u>d)break}if(0===u)for(var g=Array.from(this.parseQueue.octreesLod0ReferencesToParseMap.keys()),a=0;a<g.length;a++)if(l=g[a],this.parseQueue.octreesLod0ReferencesToParseMap.delete(l),void 0!==l.neoReferencesMotherAndIndices&&void 0!==l.neoReferencesMotherAndIndices.dataArraybuffer&&l.neoReferencesMotherAndIndices.fileLoadState===CODE.fileLoadState.LOADING_FINISHED){var m=(c=l.neoBuildingOwner).getGeoLocationData();if(h=c.getHeaderVersion(),this.matrix4SC.setByFloat32Array(m.rotMatrix._floatArrays),"v"===h[0]?l.neoReferencesMotherAndIndices.parseArrayBufferReferences(e,l.neoReferencesMotherAndIndices.dataArraybuffer,this.readerWriter,c.motherNeoReferencesArray,this.matrix4SC,this):l.neoReferencesMotherAndIndices.parseArrayBufferReferencesVersioned(e,l.neoReferencesMotherAndIndices.dataArraybuffer,this.readerWriter,c.motherNeoReferencesArray,this.matrix4SC,this),l.neoReferencesMotherAndIndices.multiplyKeyTransformMatrix(0,m.rotMatrix),l.neoReferencesMotherAndIndices.dataArraybuffer=void 0,++u>d)break}u>0&&this.selectionFbo&&(this.selectionFbo.dirty=!0)}if(u=0,d=10,this.parseQueue.octreesLod0ModelsToParseMap.size>0){for(var f=this.visibleObjControlerOctrees.currentVisibles0.length,a=0;a<f;a++){if(l=this.visibleObjControlerOctrees.currentVisibles0[a],this.parseQueue.octreesLod0ModelsToParseMap.delete(l)){if(void 0===l.neoReferencesMotherAndIndices)continue;if(void 0===(y=l.neoReferencesMotherAndIndices.blocksList))continue;if(void 0===y.dataArraybuffer)continue;if(y.fileLoadState!==CODE.fileLoadState.LOADING_FINISHED)continue;"v"===(h=(c=l.neoBuildingOwner).getHeaderVersion())[0]?y.parseBlocksList(y.dataArraybuffer,this.readerWriter,c.motherBlocksArray,this):y.parseBlocksListVersioned(y.dataArraybuffer,this.readerWriter,c.motherBlocksArray,this),y.dataArraybuffer=void 0,u++}else if(l.neoReferencesMotherAndIndices&&l.neoReferencesMotherAndIndices.blocksList&&l.neoReferencesMotherAndIndices.blocksList.fileLoadState===CODE.fileLoadState.LOADING_FINISHED);if(u>d)break}if(0===u)for(var g=Array.from(this.parseQueue.octreesLod0ModelsToParseMap.keys()),a=0;a<g.length&&(l=g[a],this.parseQueue.octreesLod0ModelsToParseMap.delete(l),!(void 0!==l.neoReferencesMotherAndIndices&&void 0!==(y=l.neoReferencesMotherAndIndices.blocksList)&&void 0!==y.dataArraybuffer&&y.fileLoadState===CODE.fileLoadState.LOADING_FINISHED&&(c=l.neoBuildingOwner,"v"===(h=c.getHeaderVersion())[0]?y.parseBlocksList(y.dataArraybuffer,this.readerWriter,c.motherBlocksArray,this):y.parseBlocksListVersioned(y.dataArraybuffer,this.readerWriter,c.motherBlocksArray,this),y.dataArraybuffer=void 0,++u>d)));a++);u>0&&this.selectionFbo&&(this.selectionFbo.dirty=!0)}if(u=0,d=10,this.parseQueue.octreesLod0ModelsToParseMap.size>0){for(var f=this.visibleObjControlerOctrees.currentVisibles1.length,a=0;a<f;a++){if(l=this.visibleObjControlerOctrees.currentVisibles1[a],this.parseQueue.octreesLod0ModelsToParseMap.delete(l)){if(void 0===l.neoReferencesMotherAndIndices)continue;if(void 0===(y=l.neoReferencesMotherAndIndices.blocksList))continue;if(void 0===y.dataArraybuffer)continue;if(y.fileLoadState!==CODE.fileLoadState.LOADING_FINISHED)continue;"v"===(h=(c=l.neoBuildingOwner).getHeaderVersion())[0]?y.parseBlocksList(y.dataArraybuffer,this.readerWriter,c.motherBlocksArray,this):y.parseBlocksListVersioned(y.dataArraybuffer,this.readerWriter,c.motherBlocksArray,this),y.dataArraybuffer=void 0,u++}else if(l.neoReferencesMotherAndIndices&&l.neoReferencesMotherAndIndices.blocksList&&l.neoReferencesMotherAndIndices.blocksList.fileLoadState===CODE.fileLoadState.LOADING_FINISHED);if(u>d)break}if(0===u)for(var g=Array.from(this.parseQueue.octreesLod0ModelsToParseMap.keys()),a=0;a<g.length;a++)if(l=g[a],this.parseQueue.octreesLod0ModelsToParseMap.delete(l),void 0!==l.neoReferencesMotherAndIndices){var y=l.neoReferencesMotherAndIndices.blocksList;if(void 0!==y&&void 0!==y.dataArraybuffer&&y.fileLoadState===CODE.fileLoadState.LOADING_FINISHED&&(c=l.neoBuildingOwner,"v"===(h=c.getHeaderVersion())[0]?y.parseBlocksList(y.dataArraybuffer,this.readerWriter,c.motherBlocksArray,this):y.parseBlocksListVersioned(y.dataArraybuffer,this.readerWriter,c.motherBlocksArray,this),y.dataArraybuffer=void 0,++u>d))break}u>0&&this.selectionFbo&&(this.selectionFbo.dirty=!0)}if(u=0,d=6,this.parseQueue.octreesLod2LegosToParseMap.size>0){for(var f=this.visibleObjControlerOctrees.currentVisibles2.length,a=0;a<f;a++){if(l=this.visibleObjControlerOctrees.currentVisibles2[a],this.parseQueue.octreesLod2LegosToParseMap.delete(l)){if(void 0===l.lego)continue;l.lego.parseArrayBuffer(e,l.lego.dataArrayBuffer,this),l.lego.dataArrayBuffer=void 0,u++}if(u>d)break}if(0===u)for(var g=Array.from(this.parseQueue.octreesLod2LegosToParseMap.keys()),a=0;a<g.length;a++){if(l=g[a],this.parseQueue.octreesLod2LegosToParseMap.delete(l)){if(void 0===l.lego)continue;l.lego.parseArrayBuffer(e,l.lego.dataArrayBuffer,this),l.lego.dataArrayBuffer=void 0,u++}if(u>d)break}u>0&&this.selectionFbo&&(this.selectionFbo.dirty=!0)}},MagoManager.prototype.prepareVisibleOctreesSortedByDistance=function(e,t,r,i){var o,a,n,s=this.readerWriter.geometryDataPath,l=[].concat(r.currentVisibles0,r.currentVisibles1);this.thereAreUrgentOctrees=!1;for(var c=0,h=l.length;c<h;c++)if(n=l[c],void 0!==(a=n.neoBuildingOwner)&&0!==n.triPolyhedronsCount&&void 0!==n.octree_number_name){if(o=a.buildingFileName,void 0===n.neoReferencesMotherAndIndices&&(n.neoReferencesMotherAndIndices=new NeoReferencesMotherAndIndices,n.neoReferencesMotherAndIndices.motherNeoRefsList=a.motherNeoReferencesArray),this.fileRequestControler.isFullPlusModelReferences(i))return;if(n.neoReferencesMotherAndIndices.fileLoadState===CODE.fileLoadState.READY){void 0===n.neoReferencesMotherAndIndices.blocksList&&(n.neoReferencesMotherAndIndices.blocksList=new BlocksList);var d=s+"/"+o+"/References"+"/"+(f=n.octree_number_name.toString())+"_Ref";this.readerWriter.getNeoReferencesArraybuffer(d,n,this)}var u=n.neoReferencesMotherAndIndices.blocksList;if(void 0!==u)if(u.fileLoadState!==CODE.fileLoadState.READY)n.neoReferencesMotherAndIndices.fileLoadState!==CODE.fileLoadState.PARSE_FINISHED&&r.currentVisibles2.push(n);else{if(this.fileRequestControler.isFullPlusModelReferences(i))return;var f=n.octree_number_name.toString(),g=s+"/"+o+"/Models"+"/"+f+"_Model";this.readerWriter.getNeoBlocksArraybuffer(g,n,this)}}},MagoManager.prototype.prepareVisibleOctreesSortedByDistanceLOD2=function(e,t,r,i){var o=i;if(void 0!==r)for(var a,n,s=this.readerWriter.geometryDataPath,l=0,c=r.currentVisibles2.length;l<c;l++){if(this.fileRequestControler.isFullPlus(o))return;if(void 0!==(n=r.currentVisibles2[l]).octree_number_name&&(void 0===n.lego&&(n.lego=new Lego,n.lego.fileLoadState=CODE.fileLoadState.READY),(void 0!==n.lego||void 0!==n.lego.dataArrayBuffer)&&void 0!==(a=n.neoBuildingOwner)))if(h=a.buildingFileName,n.lego.fileLoadState!==CODE.fileLoadState.READY||this.isCameraMoving){if(n.lego.vbo_vicks_container.vboCacheKeysArray[0]&&n.lego.vbo_vicks_container.vboCacheKeysArray[0].meshTexcoordsCacheKey&&void 0===a.simpleBuilding3x3Texture){a.simpleBuilding3x3Texture=new Texture;var h=a.buildingFileName,d=this.readerWriter.geometryDataPath+"/"+h+"/SimpleBuildingTexture3x3.bmp";this.readerWriter.readLegoSimpleBuildingTexture(e,d,a.simpleBuilding3x3Texture,this)}}else if(!this.fileRequestControler.isFullPlus(o)){var u=s+"/"+h+"/Bricks"+"/"+n.octree_number_name.toString()+"_Brick";this.readerWriter.getOctreeLegoArraybuffer(u,n,this)}}},MagoManager.prototype.renderLowestOctreeAsimetricVersion=function(e,t,r,i,o,a){if(e.frontFace(e.CCW),e.depthRange(0,1),e.enable(e.DEPTH_TEST),-1===o);else{var n,s;if(i=!1,0===o&&(e.disable(e.BLEND),this.depthRenderLowestOctreeAsimetricVersion(e,o,a)),1===o){var l=a.currentVisibles0.length;if(l>0){void 0===this.noiseTexture&&(this.noiseTexture=genNoiseTextureRGBA(e,4,4,this.pixels)),u=(n=this.postFxShadersManager.pFx_shaders_array[4]).program,e.useProgram(u),e.enableVertexAttribArray(n.texCoord2_loc),e.enableVertexAttribArray(n.position3_loc),e.enableVertexAttribArray(n.normal3_loc),e.uniformMatrix4fv(n.modelViewProjectionMatrix4RelToEye_loc,!1,this.sceneState.modelViewProjRelToEyeMatrix._floatArrays),e.uniformMatrix4fv(n.modelViewMatrix4RelToEye_loc,!1,this.sceneState.modelViewRelToEyeMatrix._floatArrays),e.uniformMatrix4fv(n.modelViewMatrix4_loc,!1,this.sceneState.modelViewMatrix._floatArrays),e.uniformMatrix4fv(n.projectionMatrix4_loc,!1,this.sceneState.projectionMatrix._floatArrays),e.uniform3fv(n.cameraPosHIGH_loc,this.sceneState.encodedCamPosHigh),e.uniform3fv(n.cameraPosLOW_loc,this.sceneState.encodedCamPosLow),e.uniformMatrix4fv(n.normalMatrix4_loc,!1,this.sceneState.normalMatrix4._floatArrays),e.uniform1f(n.near_loc,this.sceneState.camera.frustum.near),e.uniform1f(n.far_loc,this.sceneState.camera.frustum.far),e.uniform1f(n.fov_loc,this.sceneState.camera.frustum.fovyRad),e.uniform1f(n.aspectRatio_loc,this.sceneState.camera.frustum.aspectRatio),e.uniform1f(n.screenWidth_loc,this.sceneState.drawingBufferWidth),e.uniform1f(n.screenHeight_loc,this.sceneState.drawingBufferHeight),e.uniform1f(n.shininessValue_loc,40),e.uniform1i(n.depthTex_loc,0),e.uniform1i(n.noiseTex_loc,1),e.uniform1i(n.diffuseTex_loc,2),e.uniform2fv(n.noiseScale2_loc,[this.depthFboNeo.width/this.noiseTexture.width,this.depthFboNeo.height/this.noiseTexture.height]),e.uniform3fv(n.kernel16_loc,this.kernel),e.uniform1i(n.textureFlipYAxis_loc,this.sceneState.textureFlipYAxis),e.uniform3fv(n.specularColor_loc,[.7,.7,.7]),e.uniform1f(n.ssaoRadius_loc,this.magoPolicy.getSsaoRadius()),e.uniform1f(n.ambientReflectionCoef_loc,this.magoPolicy.getAmbientReflectionCoef()),e.uniform1f(n.diffuseReflectionCoef_loc,this.magoPolicy.getDiffuseReflectionCoef()),e.uniform1f(n.specularReflectionCoef_loc,this.magoPolicy.getSpecularReflectionCoef()),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this.depthFboNeo.colorBuffer),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,this.noiseTexture);var i;this.isLastFrustum&&this.renderer.renderNeoBuildingsAsimetricVersion(e,a.currentVisibles0,this,n,i,o,0,0,0),n&&(-1!==n.texCoord2_loc&&e.disableVertexAttribArray(n.texCoord2_loc),-1!==n.position3_loc&&e.disableVertexAttribArray(n.position3_loc),-1!==n.normal3_loc&&e.disableVertexAttribArray(n.normal3_loc),-1!==n.color4_loc&&e.disableVertexAttribArray(n.color4_loc))}if((a.currentVisibles2.length>0||l>0)&&(u=(n=this.postFxShadersManager.pFx_shaders_array[8]).program,e.useProgram(u),e.enableVertexAttribArray(n.position3_loc),e.enableVertexAttribArray(n.normal3_loc),e.enableVertexAttribArray(n.color4_loc),e.uniformMatrix4fv(n.modelViewProjectionMatrix4RelToEye_loc,!1,this.sceneState.modelViewProjRelToEyeMatrix._floatArrays),e.uniformMatrix4fv(n.modelViewMatrix4RelToEye_loc,!1,this.sceneState.modelViewRelToEyeMatrix._floatArrays),e.uniformMatrix4fv(n.modelViewMatrix4_loc,!1,this.sceneState.modelViewMatrix._floatArrays),e.uniformMatrix4fv(n.projectionMatrix4_loc,!1,this.sceneState.projectionMatrix._floatArrays),e.uniform3fv(n.cameraPosHIGH_loc,this.sceneState.encodedCamPosHigh),e.uniform3fv(n.cameraPosLOW_loc,this.sceneState.encodedCamPosLow),e.uniform1f(n.near_loc,this.sceneState.camera.frustum.near),e.uniform1f(n.far_loc,this.sceneState.camera.frustum.far),e.uniformMatrix4fv(n.normalMatrix4_loc,!1,this.sceneState.normalMatrix4._floatArrays),e.uniform1i(n.hasAditionalMov_loc,!0),e.uniform3fv(n.aditionalMov_loc,[0,0,0]),e.uniform1i(n.hasTexture_loc,!1),e.uniform1i(n.textureFlipYAxis_loc,this.sceneState.textureFlipYAxis),e.uniform1i(n.depthTex_loc,0),e.uniform1i(n.noiseTex_loc,1),e.uniform1i(n.diffuseTex_loc,2),e.uniform1f(n.fov_loc,this.sceneState.camera.frustum.fovyRad),e.uniform1f(n.aspectRatio_loc,this.sceneState.camera.frustum.aspectRatio),e.uniform1f(n.screenWidth_loc,this.sceneState.drawingBufferWidth),e.uniform1f(n.screenHeight_loc,this.sceneState.drawingBufferHeight),e.uniform2fv(n.noiseScale2_loc,[this.depthFboNeo.width/this.noiseTexture.width,this.depthFboNeo.height/this.noiseTexture.height]),e.uniform3fv(n.kernel16_loc,this.kernel),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this.depthFboNeo.colorBuffer),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,this.noiseTexture),e.activeTexture(e.TEXTURE2),e.bindTexture(e.TEXTURE_2D,this.textureAux_1x1),this.renderer.renderNeoBuildingsLOD2AsimetricVersion(e,a.currentVisibles0,this,n,i,o),this.renderer.renderNeoBuildingsLOD2AsimetricVersion(e,a.currentVisibles2,this,n,i,o),n&&(-1!==n.texCoord2_loc&&e.disableVertexAttribArray(n.texCoord2_loc),-1!==n.position3_loc&&e.disableVertexAttribArray(n.position3_loc),-1!==n.normal3_loc&&e.disableVertexAttribArray(n.normal3_loc),-1!==n.color4_loc&&e.disableVertexAttribArray(n.color4_loc))),this.buildingSelected&&this.objectSelected){var c=(s=this.buildingSelected).getGeoLocationData(),h=this.octreeSelected.neoReferencesMotherAndIndices,d=e.POINTS;d=e.TRIANGLES;var u=(n=this.postFxShadersManager.pFx_shaders_array[14]).program;e.useProgram(u),e.enableVertexAttribArray(n.position3_loc),e.uniformMatrix4fv(n.buildingRotMatrix_loc,!1,c.rotMatrix._floatArrays),e.uniformMatrix4fv(n.modelViewProjectionMatrix4RelToEye_loc,!1,this.sceneState.modelViewProjRelToEyeMatrix._floatArrays),e.uniformMatrix4fv(n.ModelViewMatrixRelToEye_loc,!1,this.sceneState.modelViewRelToEyeMatrix._floatArrays),e.uniform3fv(n.cameraPosHIGH_loc,this.sceneState.encodedCamPosHigh),e.uniform3fv(n.cameraPosLOW_loc,this.sceneState.encodedCamPosLow),e.uniform3fv(n.buildingPosHIGH_loc,c.positionHIGH),e.uniform3fv(n.buildingPosLOW_loc,c.positionLOW),e.uniform4fv(n.color4Aux_loc,[0,1,0,1]),e.uniform2fv(n.screenSize_loc,[this.sceneState.drawingBufferWidth,this.sceneState.drawingBufferHeight]),e.uniformMatrix4fv(n.ProjectionMatrix_loc,!1,this.sceneState.projectionMatrix._floatArrays),e.enable(e.STENCIL_TEST),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.depthRange(0,0),e.stencilFunc(e.EQUAL,0,1),e.stencilOp(e.KEEP,e.KEEP,e.REPLACE),d=e.TRIANGLES;e.uniform2fv(n.camSpacePixelTranslation_loc,[.003,.003]),this.renderer.renderNeoReferenceAsimetricVersionColorSelection(e,this.objectSelected,h,s,this,n,0,0,d),e.uniform2fv(n.camSpacePixelTranslation_loc,[-.003,.003]),this.renderer.renderNeoReferenceAsimetricVersionColorSelection(e,this.objectSelected,h,s,this,n,0,0,d),e.uniform2fv(n.camSpacePixelTranslation_loc,[.003,-.003]),this.renderer.renderNeoReferenceAsimetricVersionColorSelection(e,this.objectSelected,h,s,this,n,0,0,d),e.uniform2fv(n.camSpacePixelTranslation_loc,[-.003,-.003]),this.renderer.renderNeoReferenceAsimetricVersionColorSelection(e,this.objectSelected,h,s,this,n,0,0,d),e.enable(e.DEPTH_TEST),e.disable(e.STENCIL_TEST),e.depthRange(0,1),e.disableVertexAttribArray(n.position3_loc),n&&(-1!==n.texCoord2_loc&&e.disableVertexAttribArray(n.texCoord2_loc),-1!==n.position3_loc&&e.disableVertexAttribArray(n.position3_loc),-1!==n.normal3_loc&&e.disableVertexAttribArray(n.normal3_loc),-1!==n.color4_loc&&e.disableVertexAttribArray(n.color4_loc))}if(this.magoPolicy.getShowBoundingBox()){u=(n=this.postFxShadersManager.pFx_shaders_array[12]).program,e.useProgram(u),e.enableVertexAttribArray(n.position3_loc),e.enableVertexAttribArray(n.normal3_loc),e.disableVertexAttribArray(n.color4_loc),e.uniformMatrix4fv(n.modelViewProjectionMatrix4RelToEye_loc,!1,this.sceneState.modelViewProjRelToEyeMatrix._floatArrays),e.uniformMatrix4fv(n.modelViewMatrix4RelToEye_loc,!1,this.sceneState.modelViewRelToEyeMatrix._floatArrays),e.uniformMatrix4fv(n.modelViewMatrix4_loc,!1,this.sceneState.modelViewMatrix._floatArrays),e.uniformMatrix4fv(n.projectionMatrix4_loc,!1,this.sceneState.projectionMatrix._floatArrays),e.uniform3fv(n.cameraPosHIGH_loc,this.sceneState.encodedCamPosHigh),e.uniform3fv(n.cameraPosLOW_loc,this.sceneState.encodedCamPosLow),e.uniform1f(n.near_loc,this.sceneState.camera.frustum.near),e.uniform1f(n.far_loc,this.sceneState.camera.frustum.far),e.uniformMatrix4fv(n.normalMatrix4_loc,!1,this.sceneState.normalMatrix4._floatArrays),e.uniform1i(n.hasAditionalMov_loc,!0),e.uniform3fv(n.aditionalMov_loc,[0,0,0]),e.uniform1i(n.bScale_loc,!0),e.uniform1i(n.bUse1Color_loc,!0),e.uniform4fv(n.oneColor4_loc,[1,0,1,1]),e.uniform1i(n.depthTex_loc,0),e.uniform1i(n.noiseTex_loc,1),e.uniform1i(n.diffuseTex_loc,2),e.uniform1f(n.fov_loc,this.sceneState.camera.frustum.fovyRad),e.uniform1f(n.aspectRatio_loc,this.sceneState.camera.frustum.aspectRatio),e.uniform1f(n.screenWidth_loc,this.sceneState.drawingBufferWidth),e.uniform1f(n.screenHeight_loc,this.sceneState.drawingBufferHeight),e.uniform2fv(n.noiseScale2_loc,[this.depthFboNeo.width/this.noiseTexture.width,this.depthFboNeo.height/this.noiseTexture.height]),e.uniform3fv(n.kernel16_loc,this.kernel),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this.depthFboNeo.colorBuffer),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,this.noiseTexture);for(var f=this.visibleObjControlerNodes.currentVisibles0.length,g=0;g<f;g++){s=this.visibleObjControlerNodes.currentVisibles0[g].data.neoBuilding,e.uniform3fv(n.scale_loc,[s.bbox.getXLength(),s.bbox.getYLength(),s.bbox.getZLength()]);c=s.getGeoLocationData();e.uniformMatrix4fv(n.buildingRotMatrix_loc,!1,c.rotMatrix._floatArrays),e.uniform3fv(n.buildingPosHIGH_loc,c.positionHIGH),e.uniform3fv(n.buildingPosLOW_loc,c.positionLOW),this.pointSC=s.bbox.getCenterPoint(this.pointSC),e.uniform3fv(n.aditionalMov_loc,[this.pointSC.x,this.pointSC.y,this.pointSC.z]),this.renderer.renderTriPolyhedron(e,this.unitaryBoxSC,this,n,o)}for(var m=this.visibleObjControlerNodes.currentVisibles2.length,g=0;g<m;g++){s=this.visibleObjControlerNodes.currentVisibles2[g].data.neoBuilding,e.uniform3fv(n.scale_loc,[s.bbox.getXLength(),s.bbox.getYLength(),s.bbox.getZLength()]);c=s.getGeoLocationData();e.uniformMatrix4fv(n.buildingRotMatrix_loc,!1,c.rotMatrix._floatArrays),e.uniform3fv(n.buildingPosHIGH_loc,c.positionHIGH),e.uniform3fv(n.buildingPosLOW_loc,c.positionLOW),this.pointSC=s.bbox.getCenterPoint(this.pointSC),e.uniform3fv(n.aditionalMov_loc,[this.pointSC.x,this.pointSC.y,this.pointSC.z]),this.renderer.renderTriPolyhedron(e,this.unitaryBoxSC,this,n,o)}n&&(-1!==n.texCoord2_loc&&e.disableVertexAttribArray(n.texCoord2_loc),-1!==n.position3_loc&&e.disableVertexAttribArray(n.position3_loc),-1!==n.normal3_loc&&e.disableVertexAttribArray(n.normal3_loc),-1!==n.color4_loc&&e.disableVertexAttribArray(n.color4_loc))}var y=this.objMarkerManager.objectMarkerArray.length;if(y>0){void 0===this.pin.positionBuffer&&this.pin.createPinCenterBottom(e),u=(n=this.postFxShadersManager.pFx_shaders_array[13]).program,e.useProgram(u),e.uniformMatrix4fv(n.modelViewProjectionMatrix4RelToEye_loc,!1,this.sceneState.modelViewProjRelToEyeMatrix._floatArrays),e.uniform3fv(n.cameraPosHIGH_loc,this.sceneState.encodedCamPosHigh),e.uniform3fv(n.cameraPosLOW_loc,this.sceneState.encodedCamPosLow),e.uniformMatrix4fv(n.buildingRotMatrix_loc,!1,this.sceneState.modelViewRelToEyeMatrixInv._floatArrays),e.uniform1i(n.textureFlipYAxis_loc,this.sceneState.textureFlipYAxis),e.uniform1i(n.texture_loc,0),e.enableVertexAttribArray(n.texCoord2_loc),e.enableVertexAttribArray(n.position3_loc),e.activeTexture(e.TEXTURE0),e.depthRange(0,0),e.bindBuffer(e.ARRAY_BUFFER,this.pin.positionBuffer),e.vertexAttribPointer(n.position3_loc,3,e.FLOAT,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,this.pin.texcoordBuffer),e.vertexAttribPointer(n.texCoord2_loc,2,e.FLOAT,!1,0,0);for(var p=0,v=0;v<y;v++){p>=this.pin.texturesArray.length&&(p=0);var _=this.pin.texturesArray[p],x=this.objMarkerManager.objectMarkerArray[v].geoLocationData;e.bindTexture(e.TEXTURE_2D,_.texId),e.uniform3fv(n.buildingPosHIGH_loc,x.positionHIGH),e.uniform3fv(n.buildingPosLOW_loc,x.positionLOW),e.drawArrays(e.TRIANGLES,0,6),p++}e.depthRange(0,1),e.useProgram(null),e.bindTexture(e.TEXTURE_2D,null),e.disableVertexAttribArray(n.texCoord2_loc),e.disableVertexAttribArray(n.position3_loc)}}n&&(-1!==n.texCoord2_loc&&e.disableVertexAttribArray(n.texCoord2_loc),-1!==n.position3_loc&&e.disableVertexAttribArray(n.position3_loc),-1!==n.normal3_loc&&e.disableVertexAttribArray(n.normal3_loc),-1!==n.color4_loc&&e.disableVertexAttribArray(n.color4_loc))}},MagoManager.prototype.depthRenderLowestOctreeAsimetricVersion=function(e,t,r){var i,o,a=r.currentVisibles0.length;if(a>0){o=(i=this.postFxShadersManager.pFx_shaders_array[3]).program,e.useProgram(o),e.enableVertexAttribArray(i.position3_loc),e.uniformMatrix4fv(i.modelViewProjectionMatrix4RelToEye_loc,!1,this.sceneState.modelViewProjRelToEyeMatrix._floatArrays),e.uniformMatrix4fv(i.modelViewMatrix4RelToEye_loc,!1,this.sceneState.modelViewRelToEyeMatrix._floatArrays),e.uniformMatrix4fv(i.modelViewMatrix4_loc,!1,this.sceneState.modelViewMatrix._floatArrays),e.uniformMatrix4fv(i.projectionMatrix4_loc,!1,this.sceneState.projectionMatrix._floatArrays),e.uniform3fv(i.cameraPosHIGH_loc,this.sceneState.encodedCamPosHigh),e.uniform3fv(i.cameraPosLOW_loc,this.sceneState.encodedCamPosLow),e.uniform1f(i.near_loc,this.sceneState.camera.frustum.near),e.uniform1f(i.far_loc,this.sceneState.camera.frustum.far);this.isLastFrustum&&this.renderer.renderNeoBuildingsAsimetricVersion(e,r.currentVisibles0,this,i,!1,t,0,0,0)}(r.currentVisibles2.length>0||a>0)&&(o=(i=this.postFxShadersManager.pFx_shaders_array[7]).program,e.useProgram(o),e.enableVertexAttribArray(i.position3_loc),e.uniformMatrix4fv(i.modelViewProjectionMatrix4RelToEye_loc,!1,this.sceneState.modelViewProjRelToEyeMatrix._floatArrays),e.uniformMatrix4fv(i.modelViewMatrix4RelToEye_loc,!1,this.sceneState.modelViewRelToEyeMatrix._floatArrays),e.uniformMatrix4fv(i.modelViewMatrix4_loc,!1,this.sceneState.modelViewMatrix._floatArrays),e.uniformMatrix4fv(i.projectionMatrix4_loc,!1,this.sceneState.projectionMatrix._floatArrays),e.uniform3fv(i.cameraPosHIGH_loc,this.sceneState.encodedCamPosHigh),e.uniform3fv(i.cameraPosLOW_loc,this.sceneState.encodedCamPosLow),e.uniform1f(i.near_loc,this.sceneState.camera.frustum.near),e.uniform1f(i.far_loc,this.sceneState.camera.frustum.far),e.uniform1i(i.hasAditionalMov_loc,!0),e.uniform3fv(i.aditionalMov_loc,[0,0,0]),this.renderer.renderNeoBuildingsLOD2AsimetricVersion(e,r.currentVisibles0,this,i,!1,t),this.renderer.renderNeoBuildingsLOD2AsimetricVersion(e,r.currentVisibles2,this,i,!1,t))},MagoManager.prototype.createDefaultShaders=function(e){var t=this.postFxShadersManager.newShader("modelReferencesSsao"),r=ShaderSource.ModelRefSsaoVS,i=ShaderSource.ModelRefSsaoFS;t.program=e.createProgram(),t.shader_vertex=this.postFxShadersManager.getShader(e,r,e.VERTEX_SHADER,"VERTEX"),t.shader_fragment=this.postFxShadersManager.getShader(e,i,e.FRAGMENT_SHADER,"FRAGMENT"),e.attachShader(t.program,t.shader_vertex),e.attachShader(t.program,t.shader_fragment),e.linkProgram(t.program);var o;(o=t.newUniformDataPair("Matrix4fv","mvpMat4RelToEye")).uniformLocation=e.getUniformLocation(t.program,"ModelViewProjectionMatrixRelToEye"),o.matrix4fv=this.sceneState.modelViewProjRelToEyeMatrix._floatArrays,(o=t.newUniformDataPair("Matrix4fv","mvMat4RelToEye")).uniformLocation=e.getUniformLocation(t.program,"modelViewMatrixRelToEye"),o.matrix4fv=this.sceneState.modelViewRelToEyeMatrix._floatArrays,(o=t.newUniformDataPair("Matrix4fv","pMat4")).uniformLocation=e.getUniformLocation(t.program,"projectionMatrix"),o.matrix4fv=this.sceneState.projectionMatrix._floatArrays,(o=t.newUniformDataPair("Vec3fv","encodedCamPosHigh")).uniformLocation=e.getUniformLocation(t.program,"encodedCameraPositionMCHigh"),o.vec3fv=this.sceneState.encodedCamPosHigh,(o=t.newUniformDataPair("Vec3fv","encodedCamPosLow")).uniformLocation=e.getUniformLocation(t.program,"encodedCameraPositionMCLow"),o.vec3fv=this.sceneState.encodedCamPosLow,(o=t.newUniformDataPair("Matrix4fv","normalMat4")).uniformLocation=e.getUniformLocation(t.program,"normalMatrix4"),o.matrix4fv=this.sceneState.normalMatrix4._floatArrays,(o=t.newUniformDataPair("1f","frustumFar")).uniformLocation=e.getUniformLocation(t.program,"far"),o.floatValue=this.sceneState.camera.frustum.far,(o=t.newUniformDataPair("1f","fovy")).uniformLocation=e.getUniformLocation(t.program,"fov"),o.floatValue=this.sceneState.camera.frustum.fovyRad,(o=t.newUniformDataPair("1f","aspectRatio")).uniformLocation=e.getUniformLocation(t.program,"aspectRatio"),o.floatValue=this.sceneState.camera.frustum.aspectRatio,(o=t.newUniformDataPair("1i","drawBuffWidht")).uniformLocation=e.getUniformLocation(t.program,"screenWidth"),o.intValue=this.sceneState.drawingBufferWidth,(o=t.newUniformDataPair("1i","drawBuffHeight")).uniformLocation=e.getUniformLocation(t.program,"screenHeight"),o.intValue=this.sceneState.drawingBufferHeight,(o=t.newUniformDataPair("1i","depthTex")).uniformLocation=e.getUniformLocation(t.program,"depthTex"),o.intValue=0,(o=t.newUniformDataPair("1i","noiseTex")).uniformLocation=e.getUniformLocation(t.program,"noiseTex"),o.intValue=1},MagoManager.prototype.renderLodBuilding=function(e,t,r,i,o,a,n){n.fileLoadState===CODE.fileLoadState.LOADING_FINISHED&&n.parseArrayBuffer(e,this.readerWriter),this.renderer.renderLodBuilding(e,n,this,i,a)},MagoManager.prototype.createFirstTimeVBOCacheKeys=function(e,t){var r=t._simpleBuilding_v1,i=t._simpleBuilding_v1._simpleObjects_array[0],o=i._vtCacheKeys_container._vtArrays_cacheKeys_array[0];o._verticesArray_cacheKey=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,o._verticesArray_cacheKey),e.bufferData(e.ARRAY_BUFFER,i._vtCacheKeys_container._vtArrays_cacheKeys_array[0].verticesArrayBuffer,e.STATIC_DRAW),i._vtCacheKeys_container._vtArrays_cacheKeys_array[0].verticesArrayBuffer=null,void 0!==i._vtCacheKeys_container._vtArrays_cacheKeys_array[0].normalsArrayBuffer&&(o._normalsArray_cacheKey=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,o._normalsArray_cacheKey),e.bufferData(e.ARRAY_BUFFER,i._vtCacheKeys_container._vtArrays_cacheKeys_array[0].normalsArrayBuffer,e.STATIC_DRAW),i._vtCacheKeys_container._vtArrays_cacheKeys_array[0].normalsArrayBuffer=null),void 0===r._simpleBuildingTexture&&(r._simpleBuildingTexture=e.createTexture()),e.bindTexture(e.TEXTURE_2D,r._simpleBuildingTexture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,new Uint8Array([240,240,240,255])),e.bindTexture(e.TEXTURE_2D,null),t._f4d_nailImage_readed_finished=!0},MagoManager.prototype.reCalculateModelViewProjectionRelToEyeMatrix=function(e){for(var t=0;t<16;t++)if(0===e.context._us._modelView[t])return;var r=new Cesium.Matrix4;(r=Cesium.Matrix4.clone(e.context._us._modelView))[12]=0,r[13]=0,r[14]=0;var i=new Cesium.Matrix4;Cesium.Matrix4.multiply(e.context._us._projection,r,i),Cesium.Matrix4.toArray(i,this.modelViewProjRelToEye_matrix)},MagoManager.prototype.renderTerranTileServiceFormatPostFxShader=function(e,t){if(t&&!this.isCameraInsideNeoBuilding){var r=e.context._gl,i=e.context._us._cameraPosition,o=e._frameState.cullingVolume;r.disable(r.CULL_FACE),this.detailed_building?this.squareDistUmbral=20.25:this.squareDistUmbral=2500,this.isCameraMoved(i,this.squareDistUmbral),void 0===this.depthFbo&&(this.depthFbo=new FBO(r,e.drawingBufferWidth,e.drawingBufferHeight)),void 0===this.ssaoFbo&&(this.ssaoFbo=new FBO(r,e.drawingBufferWidth,e.drawingBufferHeight)),this.depthFbo.width===e.drawingBufferWidth&&this.depthFbo.height===e.drawingBufferHeight||(this.depthFbo=new FBO(r,e.drawingBufferWidth,e.drawingBufferHeight)),this.isCameraMoving||(this.currentVisibleBuildings_array.length=0,this.currentVisibleBuildings_LOD0_array.length=0,this.detailed_building,this.doFrustumCullingTerranTileServiceFormat(r,o,this.currentVisibleBuildings_array,i)),this.reCalculateModelViewProjectionRelToEyeMatrix(e),Cesium.Matrix4.toArray(e._context._us._modelViewRelativeToEye,this.modelViewRelToEye_matrix),Cesium.Matrix4.toArray(e._context._us._modelView,this.modelView_matrix),Cesium.Matrix4.toArray(e._context._us._projection,this.projection_matrix),this.calculateEncodedCameraPositionMCHighLow(this.encodedCamPosMC_High,this.encodedCamPosMC_Low,i);var a;this.detailed_building&&t&&(a=this.shadersManager.getMagoShader(0)),r.enable(r.DEPTH_TEST),r.depthFunc(r.LEQUAL),r.depthRange(0,1);var n;this.isCameraMoved(i,10);var s=e._context._us._modelView,l=new Cesium.Matrix4;l=Cesium.Matrix4.inverseTransformation(s,l),this.normalMat4=Cesium.Matrix4.transpose(l,this.normalMat4),this.normalMat3=Cesium.Matrix4.getRotation(this.normalMat4,this.normalMat3),Cesium.Matrix3.toArray(this.normalMat3,this.normalMat3_array),Cesium.Matrix4.toArray(this.normalMat4,this.normalMat4_array),this.isCameraMoving&&(this.dateSC=new Date,this.currentTimeSC,this.startTimeSC=this.dateSC.getTime()),this.currentVisibleBuildingsPost_array.length=0;var c="",h=e._camera.frustum;e._context._us._currentFrustum.y;5e3,this.depthFbo.bind(),r.clearColor(0,0,0,1),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT),r.viewport(0,0,this.depthFbo.width,this.depthFbo.height),n=(a=this.postFxShadersManager.pFx_shaders_array[0]).program,r.useProgram(n),r.enableVertexAttribArray(a.position3_loc),r.enableVertexAttribArray(a.normal3_loc),r.uniformMatrix4fv(a.modelViewProjectionMatrix4RelToEye_loc,!1,this.modelViewProjRelToEye_matrix),r.uniformMatrix4fv(a.modelViewMatrix4RelToEye_loc,!1,this.modelViewRelToEye_matrix),r.uniformMatrix4fv(a.modelViewMatrix4_loc,!1,this.modelView_matrix),r.uniformMatrix4fv(a.projectionMatrix4_loc,!1,this.projection_matrix),r.uniform3fv(a.cameraPosHIGH_loc,this.encodedCamPosMC_High),r.uniform3fv(a.cameraPosLOW_loc,this.encodedCamPosMC_Low),r.uniform1f(a.near_loc,h._near),r.uniform1f(a.far_loc,5e3),r.uniformMatrix3fv(a.normalMatrix3_loc,!1,this.normalMat3_array),r.uniformMatrix4fv(a.normalMatrix4_loc,!1,this.normalMat4_array);for(var d=this.currentVisibleBuildings_LOD0_array.length,u=0;u<d;u++){if(2===(m=this.currentVisibleBuildings_LOD0_array[u])._header._f4d_version){if(null===(y=m._simpleBuilding_v1._simpleObjects_array[0])._vtCacheKeys_container._vtArrays_cacheKeys_array[0]._verticesArray_cacheKey){this.createFirstTimeVBOCacheKeys(r,m);continue}if(!m._f4d_nailImage_readed){if(this.backGround_imageReadings_count<100){this.backGround_imageReadings_count++,m._f4d_nailImage_readed=!0;p=m._simpleBuilding_v1;this.readerWriter.readNailImageOfArrayBuffer(r,p.textureArrayBuffer,m,this.readerWriter,this,3)}continue}!m._f4d_lod0Image_readed&&m._f4d_nailImage_readed_finished&&m._f4d_lod0Image_exists&&!this.isCameraMoving&&this.backGround_fileReadings_count<1&&(c=this.readerWriter.geometryDataPath+Constant.RESULT_XDO2F4D+m._header._global_unique_id+".jpg",this.readerWriter.readNailImage(r,c,m,this.readerWriter,this,0),this.backGround_fileReadings_count++)}else this.currentVisibleBuildingsPost_array.push(m);m._simpleBuilding_v1&&this.renderer.renderSimpleBuildingV1PostFxShader(r,m,this,-1,a)}for(var f=this.currentVisibleBuildings_array.length,g=0;g<f;g++){if(2===(m=this.currentVisibleBuildings_array[g])._header._f4d_version){if(null===(y=m._simpleBuilding_v1._simpleObjects_array[0])._vtCacheKeys_container._vtArrays_cacheKeys_array[0]._verticesArray_cacheKey){this.createFirstTimeVBOCacheKeys(r,m);continue}if(!m._f4d_nailImage_readed){if(this.backGround_imageReadings_count<100){this.backGround_imageReadings_count++,m._f4d_nailImage_readed=!0;p=m._simpleBuilding_v1;this.readerWriter.readNailImageOfArrayBuffer(r,p.textureArrayBuffer,m,this.readerWriter,this,3)}continue}}else this.currentVisibleBuildingsPost_array.push(m);m._simpleBuilding_v1&&m._f4d_nailImage_readed_finished&&this.renderer.renderSimpleBuildingV1PostFxShader(r,m,this,-1,a)}r.disableVertexAttribArray(a.position3_loc),r.disableVertexAttribArray(a.normal3_loc),this.depthFbo.unbind(),e._context._currentFramebuffer._bind(),this.depthFbo.width===e.drawingBufferWidth&&this.depthFbo.height===e.drawingBufferHeight||(this.depthFbo=new FBO(r,e.drawingBufferWidth,e.drawingBufferHeight)),r.clearColor(0,0,0,1),r.viewport(0,0,e.drawingBufferWidth,e.drawingBufferHeight),void 0===this.noiseTexture&&(this.noiseTexture=genNoiseTextureRGBA(r,4,4,this.pixels)),n=(a=this.postFxShadersManager.pFx_shaders_array[1]).program,r.useProgram(n),r.enableVertexAttribArray(a.texCoord2_loc),r.enableVertexAttribArray(a.position3_loc),r.enableVertexAttribArray(a.normal3_loc),r.uniformMatrix4fv(a.modelViewProjectionMatrix4RelToEye_loc,!1,this.modelViewProjRelToEye_matrix),r.uniform3fv(a.cameraPosHIGH_loc,this.encodedCamPosMC_High),r.uniform3fv(a.cameraPosLOW_loc,this.encodedCamPosMC_Low),r.uniformMatrix4fv(a.projectionMatrix4_loc,!1,this.projection_matrix),r.uniformMatrix4fv(a.modelViewMatrix4_loc,!1,this.modelView_matrix),r.uniform1f(a.near_loc,h._near),r.uniform1f(a.far_loc,5e3),r.uniformMatrix3fv(a.normalMatrix3_loc,!1,this.normalMat3_array),r.uniformMatrix4fv(a.normalMatrix4_loc,!1,this.normalMat4_array),r.uniform1i(a.depthTex_loc,0),r.uniform1i(a.noiseTex_loc,1),r.uniform1i(a.diffuseTex_loc,2),r.uniform1f(a.fov_loc,h._fovy),r.uniform1f(a.aspectRatio_loc,h._aspectRatio),r.uniform1f(a.screenWidth_loc,e.drawingBufferWidth),r.uniform1f(a.screenHeight_loc,e.drawingBufferHeight),r.uniform2fv(a.noiseScale2_loc,[this.depthFbo.width/this.noiseTexture.width,this.depthFbo.height/this.noiseTexture.height]),r.uniform3fv(a.kernel16_loc,this.kernel),r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,this.depthFbo.colorBuffer),r.activeTexture(r.TEXTURE1),r.bindTexture(r.TEXTURE_2D,this.noiseTexture);for(var d=this.currentVisibleBuildings_LOD0_array.length,u=0;u<d;u++){if(2===(m=this.currentVisibleBuildings_LOD0_array[u])._header._f4d_version){if(null===(y=m._simpleBuilding_v1._simpleObjects_array[0])._vtCacheKeys_container._vtArrays_cacheKeys_array[0]._verticesArray_cacheKey){this.createFirstTimeVBOCacheKeys(r,m);continue}if(!m._f4d_nailImage_readed){if(this.backGround_imageReadings_count<100){this.backGround_imageReadings_count++,m._f4d_nailImage_readed=!0;p=m._simpleBuilding_v1;this.readerWriter.readNailImageOfArrayBuffer(r,p.textureArrayBuffer,m,this.readerWriter,this,3)}continue}!m._f4d_lod0Image_readed&&m._f4d_nailImage_readed_finished&&m._f4d_lod0Image_exists&&!this.isCameraMoving&&this.backGround_fileReadings_count<1&&(c=this.readerWriter.geometryDataPath+Constant.RESULT_XDO2F4D+m._header._global_unique_id+".jpg",this.readerWriter.readNailImage(r,c,m,this.readerWriter,this,0),this.backGround_fileReadings_count++)}else this.currentVisibleBuildingsPost_array.push(m);m._simpleBuilding_v1&&(m._f4d_lod0Image_exists&&m._f4d_lod0Image_readed_finished?this.renderer.renderSimpleBuildingV1PostFxShader(r,m,this,0,a):m._f4d_nailImage_readed_finished&&this.renderer.renderSimpleBuildingV1PostFxShader(r,m,this,3,a))}for(var f=this.currentVisibleBuildings_array.length,g=0;g<f;g++){var m=this.currentVisibleBuildings_array[g];if(2===m._header._f4d_version){var y=m._simpleBuilding_v1._simpleObjects_array[0];if(null===y._vtCacheKeys_container._vtArrays_cacheKeys_array[0]._verticesArray_cacheKey){this.createFirstTimeVBOCacheKeys(r,m);continue}if(!m._f4d_nailImage_readed){if(this.backGround_imageReadings_count<100){this.backGround_imageReadings_count++,m._f4d_nailImage_readed=!0;var p=m._simpleBuilding_v1;this.readerWriter.readNailImageOfArrayBuffer(r,p.textureArrayBuffer,m,this.readerWriter,this,3)}continue}}else this.currentVisibleBuildingsPost_array.push(m);m._simpleBuilding_v1&&m._f4d_nailImage_readed_finished&&this.renderer.renderSimpleBuildingV1PostFxShader(r,m,this,3,a)}r.activeTexture(r.TEXTURE0),r.disableVertexAttribArray(a.texCoord2_loc),r.disableVertexAttribArray(a.position3_loc),r.disableVertexAttribArray(a.normal3_loc),r.viewport(0,0,e._canvas.width,e._canvas.height),e._context._currentFramebuffer._bind();for(var v=this.currentVisibleBuildingsPost_array.length,u=0;u<v;u++)this.renderer.render_F4D_simpleBuilding(r,this.currentVisibleBuildingsPost_array[u],this.modelViewProjRelToEye_matrix,this.encodedCamPosMC_High,this.encodedCamPosMC_Low,this.shadersManager);r.bindBuffer(r.ARRAY_BUFFER,null),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,null)}},MagoManager.prototype.deleteNeoBuilding=function(e,t){var r=this.vboMemoryManager;t===this.buildingSelected&&(this.buildingSelected=void 0,this.octreeSelected=void 0,this.objectSelected=void 0),t.deleteObjects(e,r)},MagoManager.prototype.getNodeIdxSortedByDist=function(e,t,r,i){var o=i.data.neoBuilding,a=r-t;if(a<6){for(var n,s=!1,l=t;!s&&l<=r;){var c=e[l].data.neoBuilding;o.distToCam<c.distToCam&&(n=l,s=!0),l++}return s?n:r+1}var h,d,u=t+Math.floor(a/2);return e[u].data.neoBuilding.distToCam>o.distToCam?(h=t,d=u):(h=u,d=r),this.getNodeIdxSortedByDist(e,h,d,i)},MagoManager.prototype.putNodeToArraySortedByDist=function(e,t){if(e.length>0){var r=e.length-1,i=this.getNodeIdxSortedByDist(e,0,r,t);e.splice(i,0,t)}else e.push(t)},MagoManager.prototype.getBuildingIdxSortedByDist=function(e,t,r,i){var o=r-t;if(o<6){for(var a,n=!1,s=t;!n&&s<=r;)i.distToCam<e[s].distToCam&&(a=s,n=!0),s++;return n?a:r+1}var l,c,h=t+Math.floor(o/2);return e[h].distToCam>i.distToCam?(l=t,c=h):(l=h,c=r),this.getBuildingIdxSortedByDist(e,l,c,i)},MagoManager.prototype.putBuildingToArraySortedByDist=function(e,t){if(e.length>0){var r=e.length-1,i=this.getBuildingIdxSortedByDist(e,0,r,t);e.splice(i,0,t)}else e.push(t)},MagoManager.prototype.doFrustumCullingSmartTiles=function(e,t){var r=this.smartTileManager.tilesArray[0],i=this.smartTileManager.tilesArray[1];void 0===this.fullyIntersectedLowestTilesArray&&(this.fullyIntersectedLowestTilesArray=[]),void 0===this.partiallyIntersectedLowestTilesArray&&(this.partiallyIntersectedLowestTilesArray=[]),void 0===this.lastIntersectedLowestTilesArray&&(this.lastIntersectedLowestTilesArray=[]),this.lastIntersectedLowestTilesArray.length=0,this.lastIntersectedLowestTilesArray.push.apply(this.lastIntersectedLowestTilesArray,this.fullyIntersectedLowestTilesArray),this.lastIntersectedLowestTilesArray.push.apply(this.lastIntersectedLowestTilesArray,this.partiallyIntersectedLowestTilesArray);for(var o=this.lastIntersectedLowestTilesArray.length,a=0;a<o;a++)(s=this.lastIntersectedLowestTilesArray[a]).isVisible=!1;this.fullyIntersectedLowestTilesArray.length=0,this.partiallyIntersectedLowestTilesArray.length=0,r.getFrustumIntersectedLowestTiles(e,this.fullyIntersectedLowestTilesArray,this.partiallyIntersectedLowestTilesArray),i.getFrustumIntersectedLowestTiles(e,this.fullyIntersectedLowestTilesArray,this.partiallyIntersectedLowestTilesArray);for(var n=this.fullyIntersectedLowestTilesArray.length,a=0;a<n;a++)(s=this.fullyIntersectedLowestTilesArray[a]).isVisible=!0;n=this.partiallyIntersectedLowestTilesArray.length;for(a=0;a<n;a++)(s=this.partiallyIntersectedLowestTilesArray[a]).isVisible=!0;for(var s,o=this.lastIntersectedLowestTilesArray.length,a=0;a<o;a++)(s=this.lastIntersectedLowestTilesArray[a]).isVisible||(this.processQueue.putNodesArrayToDelete(s.nodesArray),s.clearNodesArray());if(this.visibleObjControlerNodes.currentVisibles0.length=0,this.visibleObjControlerNodes.currentVisibles1.length=0,this.visibleObjControlerNodes.currentVisibles2.length=0,this.visibleObjControlerNodes.currentVisibles3.length=0,this.fullyIntersectedLowestTilesArray.length>0);this.tilesFrustumCullingFinished(this.fullyIntersectedLowestTilesArray,t,e,!1),this.tilesFrustumCullingFinished(this.partiallyIntersectedLowestTilesArray,t,e,!0)},MagoManager.prototype.testAproxDist3D=function(){var e,t=0,r=0,i=new Point3D,o=new Point3D;e=(new Date).getTime();for(a=0;a<1e6;a++)i.set(1e3*Math.random(),1e3*Math.random(),1e3*Math.random()),o.set(1e3*Math.random(),1e3*Math.random(),1e3*Math.random()),i.squareDistToPoint(o);(new Date).getTime(),e=(new Date).getTime();for(a=0;a<1e6;a++)i.set(1e3*Math.random(),1e3*Math.random(),1e3*Math.random()),o.set(1e3*Math.random(),1e3*Math.random(),1e3*Math.random()),i.aproxDistTo(o,this.sqrtTable);r+=((new Date).getTime()-e)/1e3,e=(new Date).getTime();for(var a=0;a<1e6;a++)i.set(1e3*Math.random(),1e3*Math.random(),1e3*Math.random()),o.set(1e3*Math.random(),1e3*Math.random(),1e3*Math.random()),i.distToPoint(o);t+=((new Date).getTime()-e)/1e3},MagoManager.prototype.calculateAproxDist3D=function(e,t){var r,i,o,a,n=Math.abs(e.x-t.x),s=Math.abs(e.y-t.y),l=Math.abs(e.z-t.z);if(n>s)return n>l?(o=~~(10*(s/(r=n))),i=l/(c=r*this.sqrtTable[o]),a=~~(10*i),c*this.sqrtTable[a]):(o=~~(10*(n/(r=l))),i=s/(c=r*this.sqrtTable[o]),a=~~(10*i),c*this.sqrtTable[a]);if(s>l)return o=~~(10*(n/(r=s))),i=l/(c=r*this.sqrtTable[o]),a=~~(10*i),c*this.sqrtTable[a];o=~~(10*(n/(r=l)));var c=r*this.sqrtTable[o];return i=s/c,a=~~(10*i),c*this.sqrtTable[a]},MagoManager.prototype.makeHierachyTest=function(){this.hierarchyManager.newProjectTree()},MagoManager.prototype.tilesFrustumCullingFinished=function(e,t,r,i){var o=e.length;if(0!==o)for(var a,n,s,l,c,h,d,u,f,g,m,y,p,v,_=this.magoPolicy.getLod1DistInMeters(),x=1,b=this.magoPolicy.getLod2DistInMeters(),C=10*b,M=0,A=0;A<o;A++)if(void 0!==(n=e[A]).sphereExtent&&!((a=t.distToSphere(n.sphereExtent))>C))if(n.nodesArray&&n.nodesArray.length>0)for(var R=n.nodesArray.length,S=0;S<R;S++)void 0!==(h=(c=(T=n.nodesArray[S]).data.neoBuilding).getGeoLocationData())&&void 0!==h.pivotPoint?(d=c.getBBoxCenterPositionWorldCoord(),"ctships"===c.buildingId&&(_=32,x=1,C=10*(b=316e3)),this.radiusAprox_aux=c.bbox.getRadiusAprox(),void 0===this.boundingSphere_Aux&&(this.boundingSphere_Aux=new Sphere),this.boundingSphere_Aux.setCenterPoint(d.x,d.y,d.z),this.boundingSphere_Aux.setRadius(this.radiusAprox_aux),a=t.distToSphere(this.boundingSphere_Aux),c.distToCam=a,a>this.magoPolicy.getFrustumFarDistance()||i&&r.intersectionSphere(this.boundingSphere_Aux)===Constant.INTERSECTION_OUTSIDE||(this.isLastFrustum&&a<_?this.putNodeToArraySortedByDist(this.visibleObjControlerNodes.currentVisibles0,T):a<x?this.putNodeToArraySortedByDist(this.visibleObjControlerNodes.currentVisibles1,T):a<b?this.putNodeToArraySortedByDist(this.visibleObjControlerNodes.currentVisibles2,T):a<C&&this.putNodeToArraySortedByDist(this.visibleObjControlerNodes.currentVisibles3,T))):(void 0===c.metaData.geographicCoord&&(c.metaData.geographicCoord=new GeographicCoord,(l=n.getBuildingSeedById(void 0,c.buildingId))&&(c.metaData.geographicCoord.setLonLatAlt(l.geographicCoord.longitude,l.geographicCoord.latitude,l.geographicCoord.altitude),c.metaData.heading=l.rotationsDegree.z,c.metaData.pitch=l.rotationsDegree.x,c.metaData.roll=l.rotationsDegree.y)),h=c.geoLocDataManager.newGeoLocationData("deploymentLoc"),f=c.metaData.geographicCoord.longitude,g=c.metaData.geographicCoord.latitude,m=c.metaData.geographicCoord.altitude,y=c.metaData.heading,p=c.metaData.pitch,v=c.metaData.roll,ManagerUtils.calculateGeoLocationData(f,g,m+10,y,p,v,h,this),u=c,this.pointSC=u.bbox.getCenterPoint(this.pointSC),c.buildingId);else{s=n.buildingSeedsArray.length;for(S=0;S<s;S++){var T=new Node;l=n.buildingSeedsArray[S],c=new NeoBuilding,T.data={nodeId:l.buildingId,neoBuilding:c},void 0===n.nodesArray&&(n.nodesArray=[]),n.nodesArray.push(T),void 0===c.metaData&&(c.metaData=new MetaData),void 0===c.metaData.geographicCoord&&(c.metaData.geographicCoord=new GeographicCoord),void 0===c.metaData.bbox&&(c.metaData.bbox=new BoundingBox),c.name=l.name,c.buildingId=l.buildingId,c.buildingType="basicBuilding",c.buildingFileName=l.buildingFileName,c.metaData.geographicCoord.setLonLatAlt(l.geographicCoord.longitude,l.geographicCoord.latitude,l.geographicCoord.altitude),c.metaData.bbox.copyFrom(l.bBox),void 0===c.bbox&&(c.bbox=new BoundingBox),c.bbox.copyFrom(l.bBox),c.metaData.heading=l.rotationsDegree.z,c.metaData.pitch=l.rotationsDegree.x,c.metaData.roll=l.rotationsDegree.y,void 0!==c.bbox||M<100&&(this.visibleObjControlerBuildings.currentVisibles0.push(c),M++)}}},MagoManager.prototype.flyToBuilding=function(e){var t=this.getBuildingSeedById(null,e);if(void 0!==t){var r;if(1===this.renderingModeTemp||2===this.renderingModeTemp)if(void 0===t.geoLocationDataAux){var i=MagoConfig.getData().alldata[t.dataKey];i?(t.geoLocationDataAux=ManagerUtils.calculateGeoLocationData(i.LONGITUDE,i.LATITUDE,i.ELEVATION,heading,pitch,roll,t.geoLocationDataAux,this),this.pointSC=t.bbox.getCenterPoint(this.pointSC),r=t.geoLocationDataAux.pivotPoint):(this.pointSC=t.bbox.getCenterPoint(this.pointSC),r=t.transfMat.transformPoint3D(this.pointSC,r))}else this.pointSC=t.bbox.getCenterPoint(this.pointSC),r=t.geoLocationDataAux.pivotPoint;else r=ManagerUtils.geographicCoordToWorldPoint(t.geographicCoordOfBBox.longitude,t.geographicCoordOfBBox.latitude,t.geographicCoordOfBBox.altitude,r,this);if(void 0!==r)if(0===this.renderingModeTemp&&(this.radiusAprox_aux=1.2*(t.bBox.maxX-t.bBox.minX)/2),1===this.renderingModeTemp&&(this.radiusAprox_aux=1.2*(t.bBox.maxX-t.bBox.minX)/2),2===this.renderingModeTemp&&(this.radiusAprox_aux=1.2*(t.bBox.maxX-t.bBox.minX)/2),void 0===this.boundingSphere_Aux&&(this.boundingSphere_Aux=new Sphere),this.boundingSphere_Aux.radius=this.radiusAprox_aux,this.configInformation.geo_view_library===Constant.CESIUM){this.boundingSphere_Aux.center=Cesium.Cartesian3.clone(r);this.scene.camera.flyToBoundingSphere(this.boundingSphere_Aux,3)}else if(this.configInformation.geo_view_library===Constant.WORLDWIND){var o=t.getGeoLocationData().geographicCoord;this.wwd.goToAnimator.travelTime=3e3,this.wwd.goTo(new WorldWind.Position(o.latitude,o.longitude,o.altitude+1e3))}}},MagoManager.prototype.getNeoBuildingById=function(e,t){return this.smartTileManager.getNeoBuildingById(e,t)},MagoManager.prototype.getBuildingSeedById=function(e,t){return this.smartTileManager.getBuildingSeedById(e,t)},MagoManager.prototype.doFrustumCullingTerranTileServiceFormat=function(e,t,r,i){var o,a,n;this.filteredVisibleTiles_array.length=0,this.detailedVisibleTiles_array.length=0,this.LOD0VisibleTiles_array.length=0;var s;this.currentVisible_terranTiles_array.length=0,this.terranTile.getIntersectedSmallestTiles(t,this.currentVisible_terranTiles_array,this.boundingSphere_Aux);var l=this.currentVisible_terranTiles_array.length;if(0!==l){for(f=0;f<l;f++)this.terranTileSC=this.currentVisible_terranTiles_array[f],(o=Cesium.Cartesian3.distanceSquared(i,this.terranTileSC.position))>this.min_squaredDist_to_see||(o<1.2*this.min_squaredDist_to_see_detailed?this.detailedVisibleTiles_array.push(this.terranTileSC):o<1.2*this.min_squaredDist_to_see_LOD0?this.LOD0VisibleTiles_array.push(this.terranTileSC):this.filteredVisibleTiles_array.push(this.terranTileSC));this.boundingSphere_Aux.radius=50;for(var c,h,d=!1,u=this.detailedVisibleTiles_array.length,f=0;f<u;f++)if(this.terranTileSC=this.detailedVisibleTiles_array[f],this.terranTileSC.fileReading_started){this.terranTileSC.fileReading_finished&&!this.terranTileSC.fileParsingFinished&&this.terranTileSC.parseFileAllBuildings(this),d=!1,this.terranTileSC.visibilityType===Cesium.Intersect.INTERSECTING&&(d=!0),n=this.terranTileSC._BR_buildingsArray.length;for(y=0;y<n;y++)void 0!==(s=this.detailedVisibleTiles_array[f]._BR_buildingsArray[y]).buildingPosition?(o=Cesium.Cartesian3.distanceSquared(i,s.buildingPosition))<this.min_squaredDist_to_see_detailed?s._compRefList_Container.compRefsListArray.length>0?1===s._header._f4d_version&&(a?o<a?(a=o,this.currentVisibleBuildings_LOD0_array.push(this.detailed_building),this.detailed_building=s):this.currentVisibleBuildings_LOD0_array.push(s):(a=o,this.detailed_building=s)):s._header.isSmall?r.push(s):this.currentVisibleBuildings_LOD0_array.push(s):o<this.min_squaredDist_to_see_LOD0?d?(this.boundingSphere_Aux.center=Cesium.Cartesian3.clone(s.buildingPosition),d&&t.computeVisibility(this.boundingSphere_Aux)!==Cesium.Intersect.OUTSIDE&&this.currentVisibleBuildings_LOD0_array.push(s)):this.currentVisibleBuildings_LOD0_array.push(s):d?(this.boundingSphere_Aux.center=Cesium.Cartesian3.clone(s.buildingPosition),d&&t.computeVisibility(this.boundingSphere_Aux)!==Cesium.Intersect.OUTSIDE&&r.push(s)):r.push(s):this.currentVisibleBuildings_LOD0_array.push(s)}else this.backGround_fileReadings_count<10&&(h=this.terranTileSC._numberName.toString(),c=this.readerWriter.geometryDataPath+Constant.RESULT_XDO2F4D_TERRAINTILES+h+".til",this.readerWriter.getTileArrayBuffer(e,c,this.terranTileSC,this.readerWriter,this),this.backGround_fileReadings_count++);for(var g=this.LOD0VisibleTiles_array.length,f=0;f<g;f++)if(this.terranTileSC=this.LOD0VisibleTiles_array[f],this.terranTileSC.fileReading_started){this.terranTileSC.fileReading_finished&&!this.terranTileSC.fileParsingFinished&&this.terranTileSC.parseFileAllBuildings(this),d=!1,this.terranTileSC.visibilityType===Cesium.Intersect.INTERSECTING&&(d=!0),n=this.terranTileSC._BR_buildingsArray.length;for(y=0;y<n;y++)void 0!==(s=this.LOD0VisibleTiles_array[f]._BR_buildingsArray[y]).buildingPosition?(o=Cesium.Cartesian3.distanceSquared(i,s.buildingPosition))<this.min_squaredDist_to_see_LOD0?d?(this.boundingSphere_Aux.center=Cesium.Cartesian3.clone(s.buildingPosition),t.computeVisibility(this.boundingSphere_Aux)!==Cesium.Intersect.OUTSIDE&&this.currentVisibleBuildings_LOD0_array.push(s)):this.currentVisibleBuildings_LOD0_array.push(s):d?(this.boundingSphere_Aux.center=Cesium.Cartesian3.clone(s.buildingPosition),t.computeVisibility(this.boundingSphere_Aux)!==Cesium.Intersect.OUTSIDE&&r.push(s)):r.push(s):r.push(s)}else this.backGround_fileReadings_count<10&&(h=this.terranTileSC._numberName.toString(),c=this.readerWriter.geometryDataPath+Constant.RESULT_XDO2F4D_TERRAINTILES+h+".til",this.readerWriter.getTileArrayBuffer(e,c,this.terranTileSC,this.readerWriter,this),this.backGround_fileReadings_count++);for(var m=this.filteredVisibleTiles_array.length,f=0;f<m;f++)if(this.terranTileSC=this.filteredVisibleTiles_array[f],this.terranTileSC.fileReading_started){this.terranTileSC.fileReading_finished&&!this.terranTileSC.fileParsingFinished&&this.terranTileSC.parseFileAllBuildings(this),d=!1,this.terranTileSC.visibilityType===Cesium.Intersect.INTERSECTING&&(d=!0),n=this.terranTileSC._BR_buildingsArray.length;for(var y=0;y<n;y++)void 0!==(s=this.filteredVisibleTiles_array[f]._BR_buildingsArray[y]).buildingPosition?(o=Cesium.Cartesian3.distanceSquared(i,s.buildingPosition),s._header.isSmall?o<this.min_squaredDist_to_see_smallBuildings&&(d?(this.boundingSphere_Aux.center=Cesium.Cartesian3.clone(s.buildingPosition),t.computeVisibility(this.boundingSphere_Aux)!==Cesium.Intersect.OUTSIDE&&r.push(s)):r.push(s)):o<this.min_squaredDist_to_see_LOD0?d?(this.boundingSphere_Aux.center=Cesium.Cartesian3.clone(s.buildingPosition),t.computeVisibility(this.boundingSphere_Aux)!==Cesium.Intersect.OUTSIDE&&this.currentVisibleBuildings_LOD0_array.push(s)):this.currentVisibleBuildings_LOD0_array.push(s):d?(this.boundingSphere_Aux.center=Cesium.Cartesian3.clone(s.buildingPosition),t.computeVisibility(this.boundingSphere_Aux)!==Cesium.Intersect.OUTSIDE&&r.push(s)):r.push(s)):r.push(s)}else this.backGround_fileReadings_count<10&&(h=this.terranTileSC._numberName.toString(),c=this.readerWriter.geometryDataPath+Constant.RESULT_XDO2F4D_TERRAINTILES+h+".til",this.readerWriter.getTileArrayBuffer(e,c,this.terranTileSC,this.readerWriter,this),this.backGround_fileReadings_count++);return r}},MagoManager.prototype.doFrustumCullingClouds=function(e,t){this.currentVisibleClouds_array.length=0;for(var r=this.atmosphere.cloudsManager.circularCloudsArray.length,i=0;i<r;i++){var o=this.atmosphere.cloudsManager.circularCloudsArray[i];void 0!==o.cullingPosition&&(this.boundingSphere_Aux.center=Cesium.Cartesian3.clone(o.cullingPosition),this.radiusAprox_aux=o.cullingRadius,this.radiusAprox_aux?this.boundingSphere_Aux.radius=this.radiusAprox_aux:this.boundingSphere_Aux.radius=50,e.computeVisibility(this.boundingSphere_Aux)!==Cesium.Intersect.OUTSIDE&&this.currentVisibleClouds_array.push(o))}return t},MagoManager.prototype.highLightBuildings=function(){for(var e=this.neoBuildingsList.neoBuildingsArray.length,t=0;t<e;t++)this.neoBuildingsList.neoBuildingsArray[t].isHighLighted=!1;for(var r=this.magoPolicy.highLightedBuildings.length,t=0;t<r;t++){var i=this.magoPolicy.highLightedBuildings[t],o=this.neoBuildingsList.getNeoBuildingByTypeId("structure",i.projectId+"_"+i.blockId);o&&(o.isHighLighted=!0)}},MagoManager.prototype.renderModeChanged=function(){0===this.renderModeTemp||1===this.renderModeTemp||this.renderModeTemp},MagoManager.prototype.buildingColorChanged=function(e,t){var r=this.getNeoBuildingById("structure",e);r&&(void 0===r.aditionalColor&&(r.aditionalColor=new Color),r.isColorChanged=!0,r.aditionalColor.setRGB(t[0],t[1],t[2]))},MagoManager.prototype.objectColorChanged=function(e,t,r){var i=this.getNeoBuildingById("structure",e);if(i){for(var o,a=i.motherNeoReferencesArray.length,n=!1,s=0;!n&&s<a;)i.motherNeoReferencesArray[s]&&i.motherNeoReferencesArray[s].objectId===t&&(o=i.motherNeoReferencesArray[s],n=!0),s++;o&&(void 0===o.aditionalColor&&(o.aditionalColor=new Color),o.aditionalColor.setRGB(r[0],r[1],r[2]))}},MagoManager.prototype.policyColorChanged=function(e,t){for(var r=this.getNeoBuildingById("structure",e),i=this.neoBuildingsList.neoBuildingsArray.length,o=0;o<i;o++)this.neoBuildingsList.neoBuildingsArray[o].isColorChanged=!1;r.isColorChanged=!0,this.magoPolicy.colorChangedObjectId=t},MagoManager.prototype.displayLocationAndRotation=function(e){var t=e.getGeoLocationData();t.geographicCoord.latitude,t.geographicCoord.longitude,t.geographicCoord.altitude,t.heading,t.pitch,t.roll,e.buildingId.split("_")},MagoManager.prototype.selectedObjectNotice=function(e){var t=e.getGeoLocationData(),r=e.buildingId.split("_"),i=r[0];if(void 0!==r[1]&&(i=r[0]+"_"+r[1]),"true"===MagoConfig.getPolicy().geo_callback_enable){if(void 0===this.objMarkerSC)return;var o=null;if(void 0!==this.objectSelected&&(o=this.objectSelected.objectId),this.magoPolicy.getObjectInfoViewEnable()&&selectedObjectCallback(MagoConfig.getPolicy().geo_callback_selectedobject,i,o,this.objMarkerSC.geoLocationData.geographicCoord.latitude,this.objMarkerSC.geoLocationData.geographicCoord.longitude,this.objMarkerSC.geoLocationData.geographicCoord.altitude,t.heading,t.pitch,t.roll),this.magoPolicy.getIssueInsertEnable()){if(void 0===this.objMarkerSC)return;insertIssueCallback(MagoConfig.getPolicy().geo_callback_insertissue,i,o,this.objMarkerSC.geoLocationData.geographicCoord.latitude,this.objMarkerSC.geoLocationData.geographicCoord.longitude,parseFloat(this.objMarkerSC.geoLocationData.geographicCoord.altitude))}}},MagoManager.prototype.changeLocationAndRotation=function(e,t,r,i,o,a,n){var s=this.getNeoBuildingById(void 0,e);if(void 0!==s){var l=s.getGeoLocationData();void 0!==(l=ManagerUtils.calculateGeoLocationData(r,t,i,o,a,n,l,this))&&s.octree&&s.octree.multiplyKeyTransformMatrix(0,l.rotMatrix)}},MagoManager.prototype.getObjectIndexFile=function(){void 0===this.configInformation&&(this.configInformation=MagoConfig.getPolicy()),this.buildingSeedList=new BuildingSeedList,this.readerWriter.getObjectIndexFileForSmartTile(this.readerWriter.geometryDataPath+Constant.OBJECT_INDEX_FILE+Constant.CACHE_VERSION+MagoConfig.getPolicy().content_cache_version,this,this.buildingSeedList)},MagoManager.prototype.makeSmartTile=function(e){var t,r,i,o=MagoConfig.getData().alldata;t=e.buildingSeedArray.length;for(h=0;h<t;h++)if((d=(r=e.buildingSeedArray[h]).buildingId.split("_")).length>0){var a=d[0];r.firstName=a,"testId"===a&&(2==d.length?(r.buildingId=d[0]+"_"+d[1],r.buildingType=void 0):3==d.length?(r.buildingId=d[0]+"_"+d[1]+"_"+d[2],r.buildingType=void 0):d.length>=4&&(r.buildingId=d[0]+"_"+d[1]+"_"+d[2],r.buildingType=d[3]))}for(var n,s=this.smartTileManager.tilesArray.length,l=0;l<s;l++){var c=this.smartTileManager.tilesArray[l];t=e.buildingSeedArray.length;for(var h=0;h<t;h++){if(r=e.buildingSeedArray[h],n=r.buildingId,"testId"===r.firstName){var d=r.buildingId.split("_");n=d[0]+"_"+d[1]}var u,f,g,m,y,p;(i=o[n])?(r.name=i.data_name,u=parseFloat(i.longitude),f=parseFloat(i.latitude),g=parseFloat(i.height),m=parseFloat(i.heading),y=parseFloat(i.pitch),p=parseFloat(i.roll),r.firstName):"testId"===r.firstName?(u=128.5894,f=34.90167,g=-400,m=0,y=0,p=0):(u=128.5894,f=35,g=50,m=0,y=0,p=0),void 0===r.geographicCoord&&(r.geographicCoord=new GeographicCoord),void 0===r.rotationsDegree&&(r.rotationsDegree=new Point3D),r.geographicCoord.setLonLatAlt(u,f,g),r.rotationsDegree.set(y,p,m),void 0===r.geographicCoordOfBBox&&(r.geographicCoordOfBBox=new GeographicCoord);var v=ManagerUtils.geographicCoordToWorldPoint(u,f,g,v,this),_=ManagerUtils.calculateTransformMatrixAtWorldPosition(v,m,y,p,void 0,_,this),x=r.bBox.getCenterPoint(x),b=_.transformPoint3D(x,b);r.geographicCoordOfBBox=ManagerUtils.pointToGeographicCoord(b,r.geographicCoordOfBBox,this)}c.buildingSeedsArray=e.buildingSeedArray,c.makeTreeByDepth(17,this)}this.buildingSeedList.buildingSeedArray.length=0},MagoManager.prototype.getNeoBuildingByTypeId=function(e,t){return this.smartTileManager.getNeoBuildingById(e,t)},MagoManager.prototype.callAPI=function(e){var t=e.getAPIName();if("changeMagoState"===t)this.magoPolicy.setMagoEnable(e.getMagoEnable());else if("changeRender"===t)this.renderingModeTemp=e.getRenderMode();else if("searchData"===t)this.flyToBuilding(e.getDataKey());else if("changeHighLighting"===t){this.magoPolicy.highLightedBuildings.length=0;var r=e.getProjectId(),i=e.getBlockIds().split(","),o=null,a=!1;null!==e.getObjectIds()&&0!==e.getObjectIds().length&&(o=e.getObjectIds().split(","),a=!0);for(var n=[],s=0,l=i.length;s<l;s++)(u=new ProjectLayer).setProjectId(r),u.setBlockId(i[s].trim()),a?u.setObjectId(o[s].trim()):u.setObjectId(null),n.push(u);this.magoPolicy.setHighLightedBuildings(n),this.highLightBuildings()}else if("changeColor"===t){this.magoPolicy.colorBuildings.length=0;var r=e.getProjectId(),i=e.getBlockIds().split(","),o=null,a=!1;null!==e.getObjectIds()&&0!==e.getObjectIds().length&&(o=e.getObjectIds().split(","),a=!0);for(var c=[],s=0,l=i.length;s<l;s++)if(a)for(var h=0,d=o.length;h<d;h++)(u=new ProjectLayer).setProjectId(r),u.setBlockId(i[s].trim()),u.setObjectId(o[h].trim()),c.push(u);else{var u=new ProjectLayer;u.setProjectId(r),u.setBlockId(i[s].trim()),u.setObjectId(null),c.push(u)}this.magoPolicy.setColorBuildings(c);var f=e.getColor().split(","),g=[f[0]/255,f[1]/255,f[2]/255];this.magoPolicy.setColor(g);for(var m=c.length,s=0;s<m;s++){var y=c[s].projectId+"_"+c[s].blockId;null===c[s].objectId?this.buildingColorChanged(y,g):this.objectColorChanged(y,c[s].objectId,g)}}else if("show"===t)this.magoPolicy.setHideBuildings.length=0;else if("hide"===t)this.magoPolicy.setHideBuildings(e.gethideBuilds());else if("move"===t);else if("changeOutFitting"===t)this.magoPolicy.setShowOutFitting(e.getShowOutFitting());else if("changeLabel"===t){this.magoPolicy.setShowLabelInfo(e.getShowLabelInfo());var p=document.getElementById("objectLabel").getContext("2d");p.clearRect(0,0,p.canvas.width,p.canvas.height)}else if("changeBoundingBox"===t)this.magoPolicy.setShowBoundingBox(e.getShowBoundingBox());else if("changeShadow"===t)this.magoPolicy.setShowShadow(e.getShowShadow());else if("changefrustumFarDistance"===t)this.magoPolicy.setFrustumFarSquaredDistance(e.getFrustumFarDistance()*e.getFrustumFarDistance());else if("changeLocationAndRotation"===t){var v=e.getDataKey();this.getNeoBuildingByTypeId("structure",v);this.changeLocationAndRotation(e.getDataKey(),parseFloat(e.getLatitude()),parseFloat(e.getLongitude()),parseFloat(e.getElevation()),parseFloat(e.getHeading()),parseFloat(e.getPitch()),parseFloat(e.getRoll()))}else{if("getLocationAndRotation"===t)return this.getNeoBuildingByTypeId("structure",e.getProjectId()+"_"+e.getBlockId());if("changeMouseMove"===t)this.magoPolicy.setMouseMoveMode(e.getMouseMoveMode());else if("changeInsertIssueMode"===t)this.magoPolicy.setIssueInsertEnable(e.getIssueInsertEnable());else if("changeObjectInfoViewMode"===t)this.magoPolicy.setObjectInfoViewEnable(e.getObjectInfoViewEnable());else if("changeNearGeoIssueListViewMode"===t)this.magoPolicy.setNearGeoIssueListEnable(e.getNearGeoIssueListEnable()),e.getNearGeoIssueListEnable()||(this.objMarkerManager.objectMarkerArray=[]);else if("changeOcclusionCulling"===t){this.magoPolicy.setOcclusionCullingEnable(e.getOcclusionCullingEnable());var _=this.selectionCandidates.currentBuildingSelected;_&&_.setRenderSettingApplyOcclusionCulling(this.magoPolicy.getOcclusionCullingEnable())}else if("drawInsertIssueImage"===t){void 0!==this.objMarkerSC&&0!==e.getDrawType()||(this.objMarkerSC=new ObjectMarker,this.objMarkerSC.geoLocationData.geographicCoord=new GeographicCoord,ManagerUtils.calculateGeoLocationData(parseFloat(e.getLongitude()),parseFloat(e.getLatitude()),parseFloat(e.getElevation()),void 0,void 0,void 0,this.objMarkerSC.geoLocationData,this));var x=this.objMarkerManager.newObjectMarker();this.objMarkerSC.issue_id=e.getIssueId(),this.objMarkerSC.issue_type=e.getIssueType(),this.objMarkerSC.geoLocationData.geographicCoord.setLonLatAlt(parseFloat(e.getLongitude()),parseFloat(e.getLatitude()),parseFloat(e.getElevation())),x.copyFrom(this.objMarkerSC),this.objMarkerSC=void 0}else if("changeInsertIssueState"===t)this.sceneState.insertIssueState=0;else if("changeLod"===t)this.magoPolicy.setLod0DistInMeters(e.getLod0DistInMeters()),this.magoPolicy.setLod1DistInMeters(e.getLod1DistInMeters()),this.magoPolicy.setLod2DistInMeters(e.getLod2DistInMeters()),this.magoPolicy.setLod3DistInMeters(e.getLod3DistInMeters());else if("changeLighting"===t)this.magoPolicy.setAmbientReflectionCoef(e.getAmbientReflectionCoef()),this.magoPolicy.setDiffuseReflectionCoef(e.getDiffuseReflectionCoef()),this.magoPolicy.setSpecularReflectionCoef(e.getSpecularReflectionCoef()),this.magoPolicy.setSpecularColor(e.getSpecularColor());else if("changeSsadRadius"===t)this.magoPolicy.setSsaoRadius(e.getSsaoRadius());else if("changeFPVMode"===t)if(e.getFPVMode()){if(void 0!==this.cameraFPV._camera)return;if(this.cameraFPV.init(),this.configInformation.geo_view_library===Constant.WORLDWIND);else if(this.configInformation.geo_view_library===Constant.CESIUM){var b=new Cesium.Matrix4,C=new Cesium.Cartesian4,M=this.scene._camera;this.cameraFPV._camera=M,this.cameraFPV._cameraBAK=Cesium.Camera.clone(M,this.cameraFPV._cameraBAK);var A=new Cesium.Cartesian3,R=new Cesium.Cartesian3,S=new Cesium.Cartesian3,T=this.scene.globe.ellipsoid.cartesianToCartographic(M.position);T.height=this.scene.globe.getHeight(T)+1.5,this.scene.globe.ellipsoid.cartographicToCartesian(T,A);var P=Cesium.Transforms.eastNorthUpToFixedFrame(A,Cesium.Ellipsoid.WGS84,b);Cesium.Cartesian3.fromCartesian4(Cesium.Matrix4.getColumn(P,1,C),R),Cesium.Cartesian3.fromCartesian4(Cesium.Matrix4.getColumn(P,2,C),S),M.flyTo({destination:A,orientation:{direction:R,up:S},duration:1})}}else{if(void 0===this.cameraFPV._cameraBAK)return;this.configInformation.geo_view_library===Constant.WORLDWIND||this.configInformation.geo_view_library===Constant.CESIUM&&(this.scene._camera=Cesium.Camera.clone(this.cameraFPV._cameraBAK,this.scene._camera)),this.cameraFPV.release()}}},MagoManager.prototype.checkCollision=function(e,t){var r=this.sceneState.gl;if(void 0!==r){var i=.5*this.sceneState.drawingBufferWidth,o=.5*this.sceneState.drawingBufferHeight;if(void 0!==this.getSelectedObjects(r,i,o,this.visibleObjControlerBuildings,this.arrayAuxSC)){var a=this.buildingSelected;this.buildingSelected=this.arrayAuxSC[0];var n=new Point3D,s=new Point3D;this.calculatePixelPositionWorldCoord(r,i,o,n),this.renderingFase=!this.renderingFase,this.calculatePixelPositionWorldCoord(r,i,this.sceneState.drawingBufferHeight,s),this.buildingSelected=a;var l=n.squareDistTo(e.x,e.y,e.z);if(this.renderingFase=!this.renderingFase,l>3.5){var c=this.scene.globe.ellipsoid.cartesianToCartographic(s),h=this.scene.globe.ellipsoid.cartesianToCartographic(e),d=h.height,u=c.height+1.5;u<d&&(d-=.2),(u>d||u<d&&d-u>1.5)&&(d=u);var f=Cesium.Math.toDegrees(h.latitude),g=Cesium.Math.toDegrees(h.longitude);return this.cameraFPV.camera.position=Cesium.Cartesian3.fromDegrees(g,f,d),!1}return!0}}};var ManagerFactory=function(e,t,r,i,o){function a(t){e.scene.screenSpaceCameraController.enableRotate=t,e.scene.screenSpaceCameraController.enableZoom=t,e.scene.screenSpaceCameraController.enableLook=t,e.scene.screenSpaceCameraController.enableTilt=t,e.scene.screenSpaceCameraController.enableTranslate=t}function n(){c.handler.setInputAction(function(e){c.mouseActionLeftDown(e.position.x,e.position.y)},Cesium.ScreenSpaceEventType.LEFT_DOWN),c.handler.setInputAction(function(e){c.mouseActionMiddleDown(e.position.x,e.position.y)},Cesium.ScreenSpaceEventType.MIDDLE_DOWN),c.handler.setInputAction(function(e){c.mouseActionRightDown(e.position.x,e.position.y)},Cesium.ScreenSpaceEventType.RIGHT_DOWN),c.handler.setInputAction(function(e){c.mouseLeftDown?e.startPosition.x===e.endPosition.x&&e.startPosition.y===e.endPosition.y||(c.manageMouseDragging(e.startPosition.x,e.startPosition.y),c.cameraMoved()):(c.mouseDragging=!1,a(!0),(c.mouseMiddleDown||c.mouseRightDown)&&(c.isCameraMoving=!0,c.cameraMoved()))},Cesium.ScreenSpaceEventType.MOUSE_MOVE),c.handler.setInputAction(function(e){c.mouseActionLeftUp(e.position.x,e.position.y);var t={lat:null,lon:null,alt:null},i=c.scene.camera.pickEllipsoid(e.position);if(i){var o=Cesium.Cartographic.fromCartesian(i);t.lat=Cesium.Math.toDegrees(o.latitude),t.lon=Cesium.Math.toDegrees(o.longitude),t.alt=o.height}""!==r.geo_callback_clickposition&&clickPositionCallback(r.geo_callback_clickposition,t)},Cesium.ScreenSpaceEventType.LEFT_UP),c.handler.setInputAction(function(e){c.mouseActionMiddleUp(e.position.x,e.position.y)},Cesium.ScreenSpaceEventType.MIDDLE_UP),c.handler.setInputAction(function(e){c.mouseActionRightUp(e.position.x,e.position.y)},Cesium.ScreenSpaceEventType.RIGHT_UP)}function s(){var t=e.scene.context._gl;e.scene.magoManager.shadersManager.createDefaultShader(t),e.scene.magoManager.postFxShadersManager.gl=t,e.scene.magoManager.postFxShadersManager.createDefaultShaders(t),e.scene.magoManager.createDefaultShaders(t),e.scene.magoManager.scene=e.scene,c=e.scene.magoManager,h=e.scene,e.scene.globe.depthTestAgainstTerrain=!0,e.scene.magoManager.getObjectIndexFile(),e.scene.magoManager.handler=new Cesium.ScreenSpaceEventHandler(h.canvas),n(),e.clock.onTick.addEventListener(function(e){c.cameraFPV.update(c)})}function l(){MagoConfig.getPolicy().geo_view_library===Constant.CESIUM?s():(MagoConfig.getPolicy().geo_view_library,Constant.WORLDWIND)}if(!(this instanceof ManagerFactory))throw new Error(Messages.CONSTRUCT_ERROR);var c=null,h=null;if(MagoConfig.init(r,i),null===r.geo_view_library||""===r.geo_view_library||r.geo_view_library===Constant.CESIUM)null===e&&(e=new Cesium.Viewer(t)),function(){var t=null,r=e.baseLayerPicker.viewModel.imageryProviderViewModels;for(var i in r)if(r.hasOwnProperty(i)&&"ESRI World Imagery"===(n=r[i]).name){t=n;break}t&&(e.baseLayerPicker.viewModel.selectedImagery=t);var o=null,a=e.baseLayerPicker.viewModel.terrainProviderViewModels;for(var i in a)if(a.hasOwnProperty(i)){var n=a[i];if("STK World Terrain meshes"===n.name){o=n;break}}o&&(e.baseLayerPicker.viewModel.selectedTerrain=o)}(),e.scene.magoManager=new MagoManager,e.scene.magoManager.sceneState.textureFlipYAxis=!1,e.camera.frustum.fov=1.8*Cesium.Math.PI_OVER_THREE,"true"===r.geo_server_enable&&function(){var t=new Cesium.WebMapServiceImageryProvider({url:MagoConfig.getPolicy().geo_server_url,layers:MagoConfig.getPolicy().geo_server_layers,parameters:{service:MagoConfig.getPolicy().geo_server_parameters_service,version:MagoConfig.getPolicy().geo_server_parameters_version,request:MagoConfig.getPolicy().geo_server_parameters_request,transparent:MagoConfig.getPolicy().geo_server_parameters_transparent,format:MagoConfig.getPolicy().geo_server_parameters_format}});e.imageryLayers.addImageryProvider(t)}(),l(),e.entities.add({name:"mago3D",position:Cesium.Cartesian3.fromDegrees(37.521168,126.924185,3e3),box:{dimensions:new Cesium.Cartesian3(3e8,3e8,3e8),fill:!0,material:Cesium.Color.BLUE,outline:!1}}),"true"===r.geo_init_camera_enable&&e.camera.flyTo({destination:Cesium.Cartesian3.fromDegrees(parseFloat(MagoConfig.getPolicy().geo_init_longitude),parseFloat(MagoConfig.getPolicy().geo_init_latitude),parseFloat(MagoConfig.getPolicy().geo_init_height)),duration:parseInt(MagoConfig.getPolicy().geo_init_duration)}),function(){var t=new API("renderMode");t.setRenderMode("1"),c.callAPI(t),"false"===MagoConfig.getPolicy().geo_time_line_enable&&($(e._animation.container).css("visibility","hidden"),$(e._timeline.container).css("visibility","hidden"),e.forceResize())}();else if(r.geo_view_library===Constant.WORLDWIND){WorldWind.Logger.setLoggingLevel(WorldWind.Logger.LEVEL_WARNING);for(var d=document.getElementById(t),u=new WorldWind.WorldWindow(t),f=[{layer:new WorldWind.BMNGLayer,enabled:!0},{layer:new WorldWind.BMNGLandsatLayer,enabled:!1},{layer:new WorldWind.BingAerialWithLabelsLayer(null),enabled:!0},{layer:new WorldWind.OpenStreetMapImageLayer(null),enabled:!1},{layer:new WorldWind.CompassLayer,enabled:!1},{layer:new WorldWind.CoordinatesDisplayLayer(u),enabled:!0},{layer:new WorldWind.ViewControlsLayer(u),enabled:!0}],g=0;g<f.length;g++)f[g].layer.enabled=f[g].enabled,u.addLayer(f[g].layer);(c=new MagoManager).wwd=u,c.sceneState.textureFlipYAxis=!0;var m=new WorldWind.RenderableLayer;m.displayName="F4D tiles",m.inCurrentFrame=!0,u.addLayer(m),m.addRenderable(c);var y=u.drawContext.currentGlContext;!function(e,t){e.shadersManager.createDefaultShader(t),e.postFxShadersManager.gl=t,e.postFxShadersManager.createDefaultShaders(t),e.createDefaultShaders(t),e.getObjectIndexFile()}(c,y);new WorldWind.ClickRecognizer(u,function(e){});u.addEventListener("mousedown",function(e){0===e.button?c.mouseActionLeftDown(e.layerX,e.layerY):1===e.button?c.mouseActionMiddleDown(e.layerX,e.layerY):2===e.button&&c.mouseActionRightDown(e.layerX,e.layerY)},!1);u.addEventListener("mouseup",function(e){0===e.button?c.mouseActionLeftUp(e.layerX,e.layerY):1===e.button?c.mouseActionMiddleUp(e.layerX,e.layerY):2===e.button&&c.mouseActionRightUp(e.layerX,e.layerY);var t,i={lat:null,lon:null,alt:null},o=u.canvasCoordinates(e.layerX,e.layerY);if(o[0]>=0&&o[0]<u.canvas.width&&o[1]>=0&&o[1]<u.canvas.height){var a=(t=u.pickTerrain(o).terrainObject())?t.position:null;i.lat=a.latitude,i.lon=a.longitude,i.alt=a.altitude}""!==r.geo_callback_clickposition&&clickPositionCallback(r.geo_callback_clickposition,i)},!1);u.addEventListener("mousemove",function(e){c.mouse_x=e.layerX,c.mouse_y=e.layerY,c.mouseLeftDown?(c.manageMouseDragging(e.layerX,e.layerY),c.cameraMoved()):(c.mouseMiddleDown||c.mouseRightDown)&&c.cameraMoved()},!1),u.goToAnimator.travelTime=1e3*MagoConfig.getPolicy().geo_init_duration,u.goTo(new WorldWind.Position(MagoConfig.getPolicy().geo_init_latitude,MagoConfig.getPolicy().geo_init_longitude,MagoConfig.getPolicy().geo_init_height))}return c.magoPolicy.imagePath=o,document.addEventListener("keydown",function(e){if(!c.magoPolicy.issueInsertEnable){var t=c.buildingSelected;if(void 0!==t){var r=t.geoLocDataManager.geoLocationDataArray[0];if(void 0!==r){var i=r.heading||0,o=r.pitch||0,a=r.roll||0;e.keyCode==="Q".charCodeAt(0)?i+=3:e.keyCode==="A".charCodeAt(0)&&(i-=3),e.keyCode==="W".charCodeAt(0)?o+=3:e.keyCode==="S".charCodeAt(0)&&(o-=3),e.keyCode==="E".charCodeAt(0)?a+=3:e.keyCode==="D".charCodeAt(0)&&(a-=3),c.changeLocationAndRotation(t.buildingId,r.latitude,r.longitude,r.elevation,i,o,a)}}}},!1),{callAPI:function(e){var t=c.callAPI(e);if("getLocationAndRotation"===e.getAPIName())return t},init:function(){},flyTo:function(t,r,i,o,a,n){if(MagoConfig.getPolicy().geo_view_library===Constant.CESIUM?e.camera.flyTo({destination:Cesium.Cartesian3.fromDegrees(parseFloat(i),parseFloat(o),parseFloat(a)+10),duration:parseInt(n)}):(u.goToAnimator.travelTime=1e3*n,u.goTo(new WorldWind.Position(parseFloat(o),parseFloat(i),parseFloat(a)+50))),null!==t&&void 0!==r){var s=new API("drawInsertIssueImage");s.setDrawType(0),s.setIssueId(t),s.setIssueType(r),s.setDataKey(null),s.setLatitude(o),s.setLongitude(i),s.setElevation(a),c.callAPI(s)}},search:function(e){},renderMode:function(e){},highlighting:function(e){},setColor:function(){},show:function(){l()},hide:function(){},move:function(){},mouseMove:function(t){var r=e.camera,i=h.globe.ellipsoid,o=(d.clientWidth,d.clientHeight,i.cartesianToCartographic(r.position).height/100),a=0;switch(0===(a=parseInt(o)>=300?50*parseInt(o):parseInt(o)>=20&&parseInt(o)<300?30*parseInt(o):10*parseInt(o))&&(a=5),o+=a,t){case"moveForward":r.moveForward(o);break;case"moveBackward":r.moveBackward(o);break;case"moveRight":r.moveRight(o);break;case"moveLeft":r.moveLeft(o);break;case"moveUp":r.moveUp(o);break;case"moveDown":r.moveDown(o)}}}},Matrix4=function(){if(!(this instanceof Matrix4))throw new Error(Messages.CONSTRUCT_ERROR);this._floatArrays=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]};Matrix4.prototype.Identity=function(){this._floatArrays=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},Matrix4.prototype.getRowMajorMatrix=function(){var e=new Float32Array(16);return e[0]=this.get(0,0),e[1]=this.get(1,0),e[2]=this.get(2,0),e[3]=this.get(3,0),e[4]=this.get(0,1),e[5]=this.get(1,1),e[6]=this.get(2,1),e[7]=this.get(3,1),e[8]=this.get(0,2),e[9]=this.get(1,2),e[10]=this.get(2,2),e[11]=this.get(3,2),e[12]=this.get(0,3),e[13]=this.get(1,3),e[14]=this.get(2,3),e[15]=this.get(3,3),e},Matrix4.prototype.rotationAxisAngDeg=function(e,t,r,i){var o=new Quaternion;o.rotationAngDeg(e,t,r,i),this.rotationByQuaternion(o),o=void 0},Matrix4.prototype.rotationAxisAngRad=function(e,t,r,i){var o=new Quaternion;o.rotationAngRad(e,t,r,i),this.rotationByQuaternion(o),o=void 0},Matrix4.prototype.rotationByQuaternion=function(e){var t=e.w,r=e.x,i=e.y,o=e.z;this._floatArrays[this.getIndexOfArray(0,0)]=1-2*i*i-2*o*o,this._floatArrays[this.getIndexOfArray(0,1)]=2*r*i+2*o*t,this._floatArrays[this.getIndexOfArray(0,2)]=2*r*o-2*i*t,this._floatArrays[this.getIndexOfArray(0,3)]=0,this._floatArrays[this.getIndexOfArray(1,0)]=2*r*i-2*o*t,this._floatArrays[this.getIndexOfArray(1,1)]=1-2*r*r-2*o*o,this._floatArrays[this.getIndexOfArray(1,2)]=2*i*o+2*r*t,this._floatArrays[this.getIndexOfArray(1,3)]=0,this._floatArrays[this.getIndexOfArray(2,0)]=2*r*o+2*i*t,this._floatArrays[this.getIndexOfArray(2,1)]=2*i*o-2*r*t,this._floatArrays[this.getIndexOfArray(2,2)]=1-2*r*r-2*i*i,this._floatArrays[this.getIndexOfArray(2,3)]=0,this._floatArrays[this.getIndexOfArray(3,0)]=0,this._floatArrays[this.getIndexOfArray(3,1)]=0,this._floatArrays[this.getIndexOfArray(3,2)]=0,this._floatArrays[this.getIndexOfArray(3,3)]=1},Matrix4.prototype.setByFloat32Array=function(e){for(var t=0;t<16;t++)this._floatArrays[t]=e[t]},Matrix4.prototype.getIndexOfArray=function(e,t){return 4*e+t},Matrix4.prototype.get=function(e,t){return this._floatArrays[this.getIndexOfArray(e,t)]},Matrix4.prototype.transformPoint3D=function(e,t){void 0===t&&(t=new Point3D);var r=e.x,i=e.y,o=e.z;return t.x=r*this.get(0,0)+i*this.get(1,0)+o*this.get(2,0)+this.get(3,0),t.y=r*this.get(0,1)+i*this.get(1,1)+o*this.get(2,1)+this.get(3,1),t.z=r*this.get(0,2)+i*this.get(1,2)+o*this.get(2,2)+this.get(3,2),t},Matrix4.prototype.rotatePoint3D=function(e,t){void 0===t&&(t=new Point3D);var r=e.x,i=e.y,o=e.z;return t.x=r*this.get(0,0)+i*this.get(1,0)+o*this.get(2,0),t.y=r*this.get(0,1)+i*this.get(1,1)+o*this.get(2,1),t.z=r*this.get(0,2)+i*this.get(1,2)+o*this.get(2,2),t},Matrix4.prototype.getMultipliedByMatrix=function(e,t){void 0===t&&(t=new Matrix4);for(var r=0;r<4;r++)for(var i=0;i<4;i++){var o=this.getIndexOfArray(r,i);t._floatArrays[o]=0;for(var a=0;a<4;a++)t._floatArrays[o]+=e.get(a,i)*this.get(r,a)}return t},Matrix4.prototype.copyFromMatrix4=function(e){for(var t=0;t<16;t++)this._floatArrays[t]=e._floatArrays[t]},Matrix4.prototype.copyFromFloatArray=function(e){for(var t=0;t<16;t++)this._floatArrays[t]=e[t]},Matrix4.prototype.computeMatrixType=function(){return this.isRotationIdentity()?this.aproxEqual(this._floatArrays[3],0,1e-7)&&this.aproxEqual(this._floatArrays[7],0,1e-7)&&this.aproxEqual(this._floatArrays[11],0,1e-7)&&this.aproxEqual(this._floatArrays[12],0,1e-7)&&this.aproxEqual(this._floatArrays[13],0,1e-7)&&this.aproxEqual(this._floatArrays[14],0,1e-7)&&this.aproxEqual(this._floatArrays[15],1,1e-7)?0:1:2},Matrix4.prototype.aproxEqual=function(e,t,r){return void 0===r&&(r=1e-7),e===t||e>t-r&&e<t+r},Matrix4.prototype.isIdentity=function(e){return!!this.isRotationIdentity()&&(!!this.aproxEqual(this._floatArrays[3],0,e)&&(!!this.aproxEqual(this._floatArrays[7],0,e)&&(!!this.aproxEqual(this._floatArrays[11],0,e)&&(!!this.aproxEqual(this._floatArrays[12],0,e)&&(!!this.aproxEqual(this._floatArrays[13],0,e)&&(!!this.aproxEqual(this._floatArrays[14],0,e)&&!!this.aproxEqual(this._floatArrays[15],1,e)))))))},Matrix4.prototype.isRotationIdentity=function(e){return!!this.aproxEqual(this._floatArrays[0],1,e)&&(!!this.aproxEqual(this._floatArrays[1],0,e)&&(!!this.aproxEqual(this._floatArrays[2],0,e)&&(!!this.aproxEqual(this._floatArrays[4],0,e)&&(!!this.aproxEqual(this._floatArrays[5],1,e)&&(!!this.aproxEqual(this._floatArrays[6],0,e)&&(!!this.aproxEqual(this._floatArrays[8],0,e)&&(!!this.aproxEqual(this._floatArrays[9],0,e)&&!!this.aproxEqual(this._floatArrays[10],1,e))))))))};var Messages={};Messages.CONSTRUCT_ERROR="  new   .";var ObjectMarker=function(){if(!(this instanceof ObjectMarker))throw new Error(Messages.CONSTRUCT_ERROR);this.geoLocationData=new GeoLocationData,this.issue_id=null,this.issue_type=null};ObjectMarker.prototype.copyFrom=function(e){void 0!==e&&(e.geoLocationData&&this.geoLocationData.copyFrom(e.geoLocationData),this.issue_id=e.issue_id,this.issue_type=e.issue_type)};var ObjectMarkerManager=function(){if(!(this instanceof ObjectMarkerManager))throw new Error(Messages.CONSTRUCT_ERROR);this.objectMarkerArray=[]};ObjectMarkerManager.prototype.newObjectMarker=function(){var e=new ObjectMarker;return this.objectMarkerArray.push(e),e};var OcclusionCullingOctreeCell=function(e){if(!(this instanceof OcclusionCullingOctreeCell))throw new Error(Messages.CONSTRUCT_ERROR);this._ocCulling_Cell_owner=e,this.minX=0,this.maxX=0,this.minY=0,this.maxY=0,this.minZ=0,this.maxZ=0,this._indicesArray=[],this._subBoxesArray=[],this.modelReferencedGroupsList};OcclusionCullingOctreeCell.prototype.createModelReferencedGroups=function(e){var t=this._subBoxesArray.length;if(0===t){if(0===this._indicesArray.length)return;void 0===this.modelReferencedGroupsList&&(this.modelReferencedGroupsList=new ModelReferencedGroupsList),this.modelReferencedGroupsList.createModelReferencedGroups(this._indicesArray,e)}else for(var r=0;r<t;r++)this._subBoxesArray[r].createModelReferencedGroups(e)},OcclusionCullingOctreeCell.prototype.newSubBox=function(){var e=new OcclusionCullingOctreeCell(this);return this._subBoxesArray.push(e),e},OcclusionCullingOctreeCell.prototype.create8SubBoxes=function(){this._subBoxesArray.length=0;for(var e=0;e<8;e++)this.newSubBox()},OcclusionCullingOctreeCell.prototype.setDimensions=function(e,t,r,i,o,a){this.minX=e,this.maxX=t,this.minY=r,this.maxY=i,this.minZ=o,this.maxZ=a},OcclusionCullingOctreeCell.prototype.setSizesSubBoxes=function(){if(this._subBoxesArray.length>0){var e=(this.maxX+this.minX)/2,t=(this.maxY+this.minY)/2,r=(this.maxZ+this.minZ)/2;this._subBoxesArray[0].setDimensions(this.minX,e,this.minY,t,this.minZ,r),this._subBoxesArray[1].setDimensions(e,this.maxX,this.minY,t,this.minZ,r),this._subBoxesArray[2].setDimensions(e,this.maxX,t,this.maxY,this.minZ,r),this._subBoxesArray[3].setDimensions(this.minX,e,t,this.maxY,this.minZ,r),this._subBoxesArray[4].setDimensions(this.minX,e,this.minY,t,r,this.maxZ),this._subBoxesArray[5].setDimensions(e,this.maxX,this.minY,t,r,this.maxZ),this._subBoxesArray[6].setDimensions(e,this.maxX,t,this.maxY,r,this.maxZ),this._subBoxesArray[7].setDimensions(this.minX,e,t,this.maxY,r,this.maxZ);for(var i=0;i<this._subBoxesArray.length;i++)this._subBoxesArray[i].setSizesSubBoxes()}},OcclusionCullingOctreeCell.prototype.intersectsWithPoint3D=function(e,t,r){var i=!1;return e>this.minX&&e<this.maxX&&t>this.minY&&t<this.maxY&&r>this.minZ&&r<this.maxZ&&(i=!0),i},OcclusionCullingOctreeCell.prototype.getIntersectedSubBoxByPoint3D=function(e,t,r){if(null===this._ocCulling_Cell_owner&&!this.intersectsWithPoint3D(e,t,r))return null;var i=null;if(this._subBoxesArray.length>0){var o,a=(this.minX+this.maxX)/2,n=(this.minY+this.maxY)/2,s=(this.minZ+this.maxZ)/2;o=e<a?t<n?r<s?0:4:r<s?3:7:t<n?r<s?1:5:r<s?2:6,i=this._subBoxesArray[o].getIntersectedSubBoxByPoint3D(e,t,r)}else i=this;return i},OcclusionCullingOctreeCell.prototype.getIndicesVisiblesForEye=function(e,t,r,i,o){var a=this.getIntersectedSubBoxByPoint3D(e,t,r);return null!==a&&a._indicesArray.length>0&&(i=a._indicesArray,o&&(o=this.modelReferencedGroupsList)),i},OcclusionCullingOctreeCell.prototype.expandBox=function(e){this.minX-=e,this.maxX+=e,this.minY-=e,this.maxY+=e,this.minZ-=e,this.maxZ+=e},OcclusionCullingOctreeCell.prototype.parseArrayBuffer=function(e,t,r){var i=r.readInt8(e,t,t+1);if(t+=1,i){var o=r.readFloat32(e,t,t+4);t+=4;var a=r.readFloat32(e,t,t+4);t+=4;var n=r.readFloat32(e,t,t+4);t+=4;var s=r.readFloat32(e,t,t+4);t+=4;var l=r.readFloat32(e,t,t+4);t+=4;var c=r.readFloat32(e,t,t+4);t+=4,this.setDimensions(o,a,n,s,l,c)}var h=r.readUInt32(e,t,t+4);if(t+=4,0===h){var d=r.readUInt32(e,t,t+4);t+=4;for(f=0;f<d;f++){var u=r.readUInt32(e,t,t+4);t+=4,this._indicesArray.push(u)}}else for(var f=0;f<h;f++)t=this.newSubBox().parseArrayBuffer(e,t,r);return t};var OcclusionCullingOctree=function(){if(!(this instanceof OcclusionCullingOctree))throw new Error(Messages.CONSTRUCT_ERROR);this._ocCulling_box=new OcclusionCullingOctreeCell(null),this._infinite_ocCulling_box=new OcclusionCullingOctreeCell(null)},Pin=function(){if(!(this instanceof Pin))throw new Error(Messages.CONSTRUCT_ERROR);this.texture,this.texturesArray=[],this.positionBuffer,this.texcoordBuffer};Pin.prototype.createPin=function(e){this.positionBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.positionBuffer);var t=[0,0,0,1,0,0,0,1,0,0,1,0,1,0,0,1,1,0];e.bufferData(e.ARRAY_BUFFER,new Float32Array(t),e.STATIC_DRAW),this.texcoordBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.texcoordBuffer);var r=[0,0,1,0,0,1,0,1,1,0,1,1];e.bufferData(e.ARRAY_BUFFER,new Float32Array(r),e.STATIC_DRAW)},Pin.prototype.createPinCenterBottom=function(e){this.positionBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.positionBuffer);var t=[-.5,0,0,.5,0,0,-.5,1,0,-.5,1,0,.5,0,0,.5,1,0];e.bufferData(e.ARRAY_BUFFER,new Float32Array(t),e.STATIC_DRAW),this.texcoordBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.texcoordBuffer);var r=[0,0,1,0,0,1,0,1,1,0,1,1];e.bufferData(e.ARRAY_BUFFER,new Float32Array(r),e.STATIC_DRAW)};var Plane=function(){if(!(this instanceof Plane))throw new Error(Messages.CONSTRUCT_ERROR);this.a=0,this.b=0,this.c=0,this.d=0};Plane.prototype.setPointAndNormal=function(e,t,r,i,o,a){this.a=i,this.b=o,this.c=a,this.d=-this.a*e-this.b*t-this.c*r},Plane.prototype.setPoint=function(e,t,r){this.d=-this.a*e-this.b*t-this.c*r},Plane.prototype.setNormalAndDistance=function(e,t,r,i){this.a=e,this.b=t,this.c=r,this.d=i},Plane.prototype.intersectionLine=function(e,t){var r=e.point.x,i=e.point.y,o=e.point.z,a=e.direction.x,n=e.direction.y,s=e.direction.z,l=this.a*a+this.b*n+this.c*s;if(Math.abs(l)>1e-7){var c=-(this.a*r+this.b*i+this.c*o+this.d)/l;return void 0===t&&(t=new Point3D),t.set(r+c*a,i+c*n,o+c*s),t}},Plane.prototype.intersectionSphere=function(e){if(void 0===e||void 0===e.centerPoint)return Constant.INTERSECTION_OUTSIDE;var t=e.centerPoint,r=t.x*this.a+t.y*this.b+t.z*this.c+this.d;return r<-e.r?Constant.INTERSECTION_OUTSIDE:r<e.r?Constant.INTERSECTION_INTERSECT:Constant.INTERSECTION_INSIDE};var Point3D=function(){if(!(this instanceof Point3D))throw new Error(Messages.CONSTRUCT_ERROR);this.x=0,this.y=0,this.z=0};Point3D.prototype.deleteObjects=function(){this.x=void 0,this.y=void 0,this.z=void 0},Point3D.prototype.copyFrom=function(e){this.x=e.x,this.y=e.y,this.z=e.z},Point3D.prototype.getSquaredModul=function(){return this.x*this.x+this.y*this.y+this.z*this.z},Point3D.prototype.getModul=function(){return Math.sqrt(this.getSquaredModul())},Point3D.prototype.unitary=function(){var e=this.getModul();this.x/=e,this.y/=e,this.z/=e},Point3D.prototype.crossProduct=function(e,t){return void 0===t&&(t=new Point3D),t.x=this.y*e.z-e.y*this.z,t.y=e.x*this.z-this.x*e.z,t.z=this.x*e.y-e.x*this.y,t},Point3D.prototype.squareDistToPoint=function(e){var t=this.x-e.x,r=this.y-e.y,i=this.z-e.z;return t*t+r*r+i*i},Point3D.prototype.squareDistTo=function(e,t,r){var i=this.x-e,o=this.y-t,a=this.z-r;return i*i+o*o+a*a},Point3D.prototype.distTo=function(e,t,r){return Math.sqrt(this.squareDistTo(e,t,r))},Point3D.prototype.distToPoint=function(e){return Math.sqrt(this.squareDistToPoint(e))},Point3D.prototype.distToSphere=function(e){return Math.sqrt(this.squareDistToPoint(e.centerPoint))-e.r},Point3D.prototype.aproxDistTo=function(e,t){var r,i,o,a,n,s=Math.abs(this.x-e.x),l=Math.abs(this.y-e.y),c=Math.abs(this.z-e.z);if(s>l)return s>c?(i=l/(r=s),o=c/(h=r*t[a=Math.floor(10*i)]),n=Math.floor(10*o),h*t[n]):(i=s/(r=c),o=l/(h=r*t[a=Math.floor(10*i)]),n=Math.floor(10*o),h*t[n]);if(l>c)return i=s/(r=l),o=c/(h=r*t[a=Math.floor(10*i)]),n=Math.floor(10*o),h*t[n];i=s/(r=c);var h=r*t[a=Math.floor(10*i)];return o=l/h,n=Math.floor(10*o),h*t[n]},Point3D.prototype.set=function(e,t,r){this.x=e,this.y=t,this.z=r},Point3D.prototype.add=function(e,t,r){this.x+=e,this.y+=t,this.z+=r};var Quaternion=function(){if(!(this instanceof Quaternion))throw new Error(Messages.CONSTRUCT_ERROR);this.x=0,this.y=0,this.z=0,this.w=1};Quaternion.prototype.Modul=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},Quaternion.prototype.Unitary=function(){var e=this.Modul();this.x/=e,this.y/=e,this.z/=e,this.w/=e},Quaternion.prototype.rotationAngDeg=function(e,t,r,i){var o=e*Math.PI/180;this.rotationAngRad(o,t,r,i)},Quaternion.prototype.rotationAngRad=function(e,t,r,i){var o=Math.sqrt(t*t+r*r+i*i);if(!o<1e-12){var a=1/o,n=-.5*e;o=Math.sin(n),this.x=t*a*o,this.y=r*a*o,this.z=i*a*o,this.w=Math.cos(n),this.Unitary()}else this.x=0,this.y=0,this.z=0,this.w=1};var SmartTile=function(e){if(!(this instanceof SmartTile))throw new Error(Messages.CONSTRUCT_ERROR);this.name,e&&(this.name=e),this.depth,this.minGeographicCoord,this.maxGeographicCoord,this.sphereExtent,this.subTiles,this.buildingSeedsArray,this.nodesArray,this.isVisible};SmartTile.prototype.newSubTile=function(e){void 0===this.subTiles&&(this.subTiles=[]);var t=new SmartTile;return t.depth=e.depth+1,this.subTiles.push(t),t},SmartTile.prototype.clearNodesArray=function(){if(void 0!==this.nodesArray){for(var e=0;e<this.nodesArray.length;e++)this.nodesArray[e]=void 0;this.nodesArray=void 0}},SmartTile.prototype.getNodeByBuildingId=function(e,t){var r,i,o,a=!0;if(void 0===this.subTiles&&(a=!1),this.subTiles&&0===this.subTiles.length&&(a=!1),a){for(l=0;l<this.subTiles.length;l++)if(r=this.subTiles[l].getNodeByBuildingId(e,t))return r}else if(this.nodesArray)for(var n=this.nodesArray.length,s=!1,l=0;!s&&l<n;){if(o=this.nodesArray[l],i=o.data.neoBuilding,e){if(i.buildingId===t&&i.buildingType===e)return s=!0,r=o}else if(i.buildingId===t)return s=!0,r=o;l++}return r},SmartTile.prototype.getNeoBuildingById=function(e,t){var r,i=this.getNodeByBuildingId(e,t);return void 0!==i&&(r=i.data.neoBuilding),r},SmartTile.prototype.getBuildingSeedById=function(e,t){var r,i=!0;if(void 0===this.subTiles&&(i=!1),this.subTiles&&0===this.subTiles.length&&(i=!1),i){for(n=0;n<this.subTiles.length;n++)if(r=this.subTiles[n].getBuildingSeedById(e,t))return r}else if(this.buildingSeedsArray)for(var o=this.buildingSeedsArray.length,a=!1,n=0;!a&&n<o;){if(e){if(this.buildingSeedsArray[n].buildingId===t&&this.buildingSeedsArray[n].buildingType===e)return a=!0,r=this.buildingSeedsArray[n]}else if(this.buildingSeedsArray[n].buildingId===t)return a=!0,r=this.buildingSeedsArray[n];n++}return r},SmartTile.prototype.makeSphereExtent=function(e){void 0===this.sphereExtent&&(this.sphereExtent=new Sphere);var t=(this.maxGeographicCoord.longitude+this.minGeographicCoord.longitude)/2,r=(this.maxGeographicCoord.latitude+this.minGeographicCoord.latitude)/2,i=(this.maxGeographicCoord.altitude+this.minGeographicCoord.altitude)/2;this.sphereExtent.centerPoint=ManagerUtils.geographicCoordToWorldPoint(t,r,i,this.sphereExtent.centerPoint,e);var o;o=ManagerUtils.geographicCoordToWorldPoint(this.minGeographicCoord.longitude,this.minGeographicCoord.latitude,this.minGeographicCoord.altitude,o,e),this.sphereExtent.r=1.2*this.sphereExtent.centerPoint.distTo(o.x,o.y,o.z)},SmartTile.prototype.makeTreeByDepth=function(e,t){if(void 0!==this.buildingSeedsArray&&0!==this.buildingSeedsArray.length&&(this.makeSphereExtent(t),this.depth<e)){for(r=0;r<4;r++)this.newSubTile(this);this.setSizesToSubTiles();for(r=0;r<4;r++)this.subTiles[r].takeIntersectedBuildingSeeds(this.buildingSeedsArray);for(var r=0;r<4;r++)this.subTiles[r].makeTreeByDepth(e,t)}},SmartTile.prototype.getLowestTileWithNodeInside=function(e){if(void 0!==this.subTiles){for(var t,r=this.subTiles.length,i=0;i<r;i++)if(t=this.subTiles[i].getLowestTileWithNodeInside(e))return t}else for(var o=this.nodesArray.length,i=0;i<o;){if(e==this.nodesArray[i])return this;i++}},SmartTile.prototype.takeIntersectedBuildingSeeds=function(e){for(var t,r=e.length,i=0;i<r;i++)if(t=e[i],this.intersectPoint(t.geographicCoordOfBBox.longitude,t.geographicCoordOfBBox.latitude)){e.splice(i,1),i--,r=e.length,void 0===this.buildingSeedsArray&&(this.buildingSeedsArray=[]),this.buildingSeedsArray.push(t);var o=t.geographicCoordOfBBox.altitude,a=t.bBox.getRadiusAprox();o-a<this.minGeographicCoord.altitude&&(this.minGeographicCoord.altitude=o-a),o+a>this.maxGeographicCoord.altitude&&(this.maxGeographicCoord.altitude=o+a)}},SmartTile.prototype.calculateAltitudeLimits=function(){this.minGeographicCoord.altitude=0,this.maxGeographicCoord.altitude=0;for(var e,t=this.buildingSeedsArray.length,r=0;r<t;r++){var i=(e=this.buildingSeedsArray[r]).geographicCoordOfBBox.altitude,o=e.bBox.getRadiusAprox();i-o<this.minGeographicCoord.altitude&&(this.minGeographicCoord.altitude=i-o),i+o>this.maxGeographicCoord.altitude&&(this.maxGeographicCoord.altitude=i+o)}},SmartTile.prototype.intersectPoint=function(e,t){return!(e<this.minGeographicCoord.longitude||e>this.maxGeographicCoord.longitude)&&!(t<this.minGeographicCoord.latitude||t>this.maxGeographicCoord.latitude)},SmartTile.prototype.extractLowestTiles=function(e){if(void 0!==this.subTiles)for(var t=this.subTiles.length,r=0;r<t;r++)this.subTiles[r].extractLowestTiles(e);else this.buildingSeedsArray&&this.buildingSeedsArray.length>0&&e.push(this)},SmartTile.prototype.getFrustumIntersectedLowestTiles=function(e,t,r){var i=[];this.getFrustumIntersectedTiles(e,i,r);for(var o=i.length,a=0;a<o;a++)i[a].extractLowestTiles(t)},SmartTile.prototype.getFrustumIntersectedTiles=function(e,t,r){if(void 0===this.sphereExtent)return Constant.INTERSECTION_OUTSIDE;var i=e.intersectionSphere(this.sphereExtent);if(i!==Constant.INTERSECTION_OUTSIDE)if(i!==Constant.INTERSECTION_INSIDE){if(i===Constant.INTERSECTION_INTERSECT)if(this.subTiles&&this.subTiles.length>0)for(var o=0;o<this.subTiles.length;o++)this.subTiles[o].sphereExtent&&this.subTiles[o].getFrustumIntersectedTiles(e,t,r);else this.buildingSeedsArray&&this.buildingSeedsArray.length>0&&r.push(this)}else t.push(this)},SmartTile.prototype.getSphereExtent=function(){return this.sphereExtent},SmartTile.prototype.setSize=function(e,t,r,i,o,a){void 0===this.minGeographicCoord&&(this.minGeographicCoord=new GeographicCoord),void 0===this.maxGeographicCoord&&(this.maxGeographicCoord=new GeographicCoord),this.minGeographicCoord.setLonLatAlt(e,t,r),this.maxGeographicCoord.setLonLatAlt(i,o,a)},SmartTile.prototype.setSizesToSubTiles=function(){var e=this.minGeographicCoord.longitude,t=this.maxGeographicCoord.longitude,r=this.minGeographicCoord.latitude,i=this.maxGeographicCoord.latitude,o=this.minGeographicCoord.altitude,a=this.maxGeographicCoord.altitude,n=(t+e)/2,s=(i+r)/2,l=this.subTiles[0];l.setSize(e,r,o,n,s,a),(l=this.subTiles[1]).setSize(n,r,o,t,s,a),(l=this.subTiles[2]).setSize(n,s,o,t,i,a),(l=this.subTiles[3]).setSize(e,s,o,n,i,a)},SmartTile.prototype.getLongitudeRangeDegree=function(){return this.maxGeographicCoord.longitude-this.minGeographicCoord.longitude},SmartTile.prototype.getLatitudeRangeDegree=function(){return this.maxGeographicCoord.latitude-this.minGeographicCoord.latitude},SmartTile.prototype.calculateTileRange=function(){if(void 0!==this.buildingSeedsArray){void 0===this.minGeographicCoord&&(this.minGeographicCoord=new GeographicCoord),void 0===this.maxGeographicCoord&&(this.maxGeographicCoord=new GeographicCoord);for(var e,t,r,i,o=this.buildingSeedsArray.length,a=0;a<o;a++)t=(e=this.buildingSeedsArray[a]).geographicCoord.longitude,r=e.geographicCoord.latitude,i=e.geographicCoord.altitude,0===a?(this.minGeographicCoord.setLonLatAlt(t,r,i),this.maxGeographicCoord.setLonLatAlt(t,r,i)):(t<this.minGeographicCoord.longitude&&(this.minGeographicCoord.longitude=t),r<this.minGeographicCoord.latitude&&(this.minGeographicCoord.latitude=r),i<this.minGeographicCoord.altitude&&(this.minGeographicCoord.altitude=i),t>this.maxGeographicCoord.longitude&&(this.maxGeographicCoord.longitude=t),r>this.maxGeographicCoord.latitude&&(this.maxGeographicCoord.latitude=r),i>this.maxGeographicCoord.altitude&&(this.maxGeographicCoord.altitude=i))}};var SmartTileManager=function(){if(!(this instanceof SmartTileManager))throw new Error(Messages.CONSTRUCT_ERROR);this.tilesArray=[];var e=this.newSmartTile("AmericaSide");void 0===e.minGeographicCoord&&(e.minGeographicCoord=new GeographicCoord),void 0===e.maxGeographicCoord&&(e.maxGeographicCoord=new GeographicCoord),e.depth=0,e.minGeographicCoord.setLonLatAlt(-180,-90,0),e.maxGeographicCoord.setLonLatAlt(0,90,0);var t=this.newSmartTile("AsiaSide");void 0===t.minGeographicCoord&&(t.minGeographicCoord=new GeographicCoord),void 0===t.maxGeographicCoord&&(t.maxGeographicCoord=new GeographicCoord),t.depth=0,t.minGeographicCoord.setLonLatAlt(0,-90,0),t.maxGeographicCoord.setLonLatAlt(180,90,0)};SmartTileManager.prototype.newSmartTile=function(e){var t=new SmartTile(e);return this.tilesArray.push(t),t},SmartTileManager.prototype.getNeoBuildingById=function(e,t){for(var r,i=0,o=this.tilesArray.length;void 0===r&&i<o;)r=this.tilesArray[i].getNeoBuildingById(e,t),i++;return r},SmartTileManager.prototype.getBuildingSeedById=function(e,t){for(var r,i=0,o=this.tilesArray.length;void 0===r&&i<o;)r=this.tilesArray[i].getBuildingSeedById(e,t),i++;return r};var Sphere=function(){if(!(this instanceof Sphere))throw new Error(Messages.CONSTRUCT_ERROR);this.r=0,this.centerPoint=new Point3D};Sphere.prototype.setCenterPoint=function(e,t,r){this.centerPoint.set(e,t,r)},Sphere.prototype.setRadius=function(e){this.r=e};var SplitValue=function(){this.high=void 0,this.low=void 0},TerranTile=function(){if(!(this instanceof TerranTile))throw new Error(Messages.CONSTRUCT_ERROR);this._depth=0,this._numberName=1,this._terranTile_owner,this.projectsArray=[],this._BR_buildingsArray=[],this._boundingBox,this._pCloudMesh_array=[],this.position,this.radius,this.leftDown_position,this.rightDown_position,this.rightUp_position,this.leftUp_position,this.visibilityType,this.subTiles_array=[],this.terranIndexFile_readed=!1,this.empty_tile=!1,this.fileReading_started=!1,this.fileReading_finished=!1,this.fileArrayBuffer,this.fileBytesReaded=0,this.fileParsingFinished=!1,this.projectsParsed_count=0,this.current_BRProject_parsing,this.current_BRProject_parsing_state=0,this.readWriter};TerranTile.prototype.newBRProject=function(){var e=new BRBuildingProject;return this._BR_buildingsArray.push(e),e},TerranTile.prototype.newSubTerranTile=function(){var e=this.subTiles_array.length,t=new TerranTile;return t._depth=this._depth+1,t._numberName=10*this._numberName+e+1,this.subTiles_array.push(t),t},TerranTile.prototype.make4subTiles=function(){for(var e=0;e<4;e++)this.newSubTerranTile()},TerranTile.prototype.setDimensions=function(e,t,r,i){this.longitudeMin=e,this.longitudeMax=t,this.latitudeMin=r,this.latitudeMax=i},TerranTile.prototype.makeTree=function(e){if(this._depth<e)for(var t=0;t<4;t++)this.newSubTerranTile().makeTree(e)},TerranTile.prototype.calculatePositionByLonLat=function(){var e=(this.longitudeMax+this.longitudeMin)/2,t=(this.latitudeMax+this.latitudeMin)/2;this.position=Cesium.Cartesian3.fromDegrees(e,t,0),this.leftDown_position=Cesium.Cartesian3.fromDegrees(this.longitudeMin,this.latitudeMin,0),this.rightDown_position=Cesium.Cartesian3.fromDegrees(this.longitudeMax,this.latitudeMin,0),this.rightUp_position=Cesium.Cartesian3.fromDegrees(this.longitudeMax,this.latitudeMax,0),this.leftUp_position=Cesium.Cartesian3.fromDegrees(this.longitudeMin,this.latitudeMax,0),this.radius=Cesium.Cartesian3.distance(this.leftDown_position,this.rightUp_position)/2*.9},TerranTile.prototype.calculatePositionByLonLatSubTiles=function(){this.calculatePositionByLonLat();for(var e=this.subTiles_array.length,t=0;t<e;t++)this.subTiles_array[t].calculatePositionByLonLatSubTiles()},TerranTile.prototype.parseFileHeader=function(e){var t=this.fileArrayBuffer.byteLength;if(!(this.fileBytesReaded>=t)){var r=0,i=e._header,o=this.fileArrayBuffer,a=this.fileBytesReaded;void 0===this.readWriter&&(this.readWriter=new ReaderWriter);for(n=0;n<5;n++)i._version+=String.fromCharCode(new Int8Array(o.slice(a,a+1))),a+=1;i._f4d_version=2,r=this.readWriter.readInt32(o,a,a+4),a+=4;for(var n=0;n<r;n++)i._global_unique_id+=String.fromCharCode(new Int8Array(o.slice(a,a+1))),a+=1;i._longitude=new Float64Array(o.slice(a,a+8))[0],a+=8,i._latitude=new Float64Array(o.slice(a,a+8))[0],a+=8,i._elevation=new Float32Array(o.slice(a,a+4))[0],a+=4,i._boundingBox.minX=new Float32Array(o.slice(a,a+4))[0],a+=4,i._boundingBox.minY=new Float32Array(o.slice(a,a+4))[0],a+=4,i._boundingBox.minZ=new Float32Array(o.slice(a,a+4))[0],a+=4,i._boundingBox.maxX=new Float32Array(o.slice(a,a+4))[0],a+=4,i._boundingBox.maxY=new Float32Array(o.slice(a,a+4))[0],a+=4,i._boundingBox.maxZ=new Float32Array(o.slice(a,a+4))[0],a+=4;var s=(i._boundingBox.maxZ-i._boundingBox.minZ)/2;i._elevation=45+s-.5;var l=!1;(i._boundingBox.maxX-i._boundingBox.minX>40||i._boundingBox.maxY-i._boundingBox.minY>40)&&(l=!0),!l&&i._boundingBox.maxZ-i._boundingBox.minZ<30&&(i.isSmall=!0);this.readWriter.readUInt8(o,a,a+1);a+=1;var c=Cesium.Cartesian3.fromDegrees(i._longitude,i._latitude,i._elevation),h=Cesium.Ellipsoid.WGS84.cartesianToCartographic(c).height;c=Cesium.Cartesian3.fromDegrees(i._longitude,i._latitude,h),e.buildingPosition=c;Cesium.EncodedCartesian3.encode(c);var d=Cesium.EncodedCartesian3.encode(c.x),u=Cesium.EncodedCartesian3.encode(c.y),f=Cesium.EncodedCartesian3.encode(c.z);e.buildingPositionHIGH=new Float32Array(3),e.buildingPositionHIGH[0]=d.high,e.buildingPositionHIGH[1]=u.high,e.buildingPositionHIGH[2]=f.high,e.buildingPositionLOW=new Float32Array(3),e.buildingPositionLOW[0]=d.low,e.buildingPositionLOW[1]=u.low,e.buildingPositionLOW[2]=f.low,this.fileBytesReaded=a}},TerranTile.prototype.parseFileSimpleBuilding=function(e){var t=this.fileArrayBuffer.byteLength;if(!(this.fileBytesReaded>=t)){void 0===this.readWriter&&(this.readWriter=new ReaderWriter);var r,i,o=this.fileBytesReaded,a=this.fileArrayBuffer;void 0===e._simpleBuilding_v1&&(e._simpleBuilding_v1=new SimpleBuildingV1);var n=e._simpleBuilding_v1,s=this.readWriter.readUInt32(a,o,o+4);o+=4;for(var l=0;l<s;l++){var c=n.newSimpleObject()._vtCacheKeys_container.newVertexTexcoordsArraysCacheKey(),h=this.readWriter.readUInt32(a,o,o+4);r=o+=4,i=o+20*h,c.verticesArrayBuffer=a.slice(r,i),o+=20*h,c._vertices_count=h}this.readWriter.readInt32(a,o,o+4);o+=4,this.fileBytesReaded=o}},TerranTile.prototype.parseFileNailImage=function(e,t){void 0===e._simpleBuilding_v1&&(e._simpleBuilding_v1=new SimpleBuildingV1),void 0===this.readWriter&&(this.readWriter=new ReaderWriter);var r=e._simpleBuilding_v1,i=this.fileBytesReaded,o=this.fileArrayBuffer,a=this.readWriter.readUInt32(o,i,i+4),n=i+=4,s=i+a;r.textureArrayBuffer=new Uint8Array(o.slice(n,s)),i+=a,this.fileBytesReaded=i},TerranTile.prototype.parseFileAllBuildings=function(e){var t=this.fileArrayBuffer.byteLength;if(this.fileBytesReaded>=t)this.fileParsingFinished=!0;else{void 0===this.readWriter&&(this.readWriter=new ReaderWriter);var r=this.fileArrayBuffer,i=this.readWriter.readInt32(r,0,4);this.fileBytesReaded+=4,0===i&&(this.empty_tile=!0);for(var o=0;o<i;o++){var a=this.fileBytesReaded;this.fileBytesReaded=a,this.current_BRProject_parsing=this.newBRProject(),this.parseFileHeader(this.current_BRProject_parsing),this.parseFileSimpleBuilding(this.current_BRProject_parsing),this.parseFileNailImage(this.current_BRProject_parsing,e)}this.fileParsingFinished=!0,this.fileArrayBuffer=null}},TerranTile.prototype.parseFileOneBuilding=function(e,t){var r=this.fileArrayBuffer.byteLength;if(this.fileBytesReaded>=r)this.fileParsingFinished=!0;else{void 0===this.readWriter&&(this.readWriter=new ReaderWriter);var i=this.readWriter.readInt32(this.fileArrayBuffer,0,4);if(this.projectsParsed_count>=i)return this.fileParsingFinished=!0,void(this.fileBytesReaded=null);0===this.current_BRProject_parsing_state&&(0===this.projectsParsed_count&&(this.fileBytesReaded=4),this.current_BRProject_parsing=this.newBRProject());var o=this.current_BRProject_parsing;0===this.current_BRProject_parsing_state?(this.parseFileHeader(o),this.current_BRProject_parsing_state=1):1===this.current_BRProject_parsing_state?t.backGround_imageReadings_count<1&&(this.parseFile_simpleBuilding_old(e,o),this.current_BRProject_parsing_state=2):2===this.current_BRProject_parsing_state&&t.backGround_imageReadings_count<1&&(this.parseFile_nailImage_old(e,o,t),this.current_BRProject_parsing_state=0,this.projectsParsed_count++,t.backGround_imageReadings_count++)}},TerranTile.prototype.setDimensionsSubTiles=function(){var e=this.subTiles_array.length;if(4===e){var t=(this.longitudeMax+this.longitudeMin)/2,r=(this.latitudeMax+this.latitudeMin)/2;this.subTiles_array[0].setDimensions(this.longitudeMin,t,this.latitudeMin,r),this.subTiles_array[1].setDimensions(t,this.longitudeMax,this.latitudeMin,r),this.subTiles_array[2].setDimensions(t,this.longitudeMax,r,this.latitudeMax),this.subTiles_array[3].setDimensions(this.longitudeMin,t,r,this.latitudeMax);for(var i=0;i<e;i++)this.subTiles_array[i].setDimensionsSubTiles()}},TerranTile.prototype.getSmallestTiles=function(e){if(this.subTiles_array.length>0)for(var t=0;t<this.subTiles_array.length;t++)this.subTiles_array[t].visibilityType=this.visibilityType,this.subTiles_array[t].getSmallestTiles(e);else this.empty_tile.length||e.push(this)},TerranTile.prototype.getIntersectedSmallestTiles=function(e,t,r){var i=[];this.getIntersectedTiles(e,i,r);for(var o=i.length,a=0;a<o;a++)i[a].getSmallestTiles(t);i.length=0},TerranTile.prototype.getIntersectedTiles=function(e,t,r){if(void 0!==this.position)if(void 0===r&&(r=new Cesium.BoundingSphere),r.radius=this.radius,r.center.x=this.position.x,r.center.y=this.position.y,r.center.z=this.position.z,this.visibilityType=e.computeVisibility(r),this.visibilityType===Cesium.Intersect.OUTSIDE);else if(this.visibilityType===Cesium.Intersect.INSIDE)t.push(this);else if(this.subTiles_array.length>0)for(var i=0;i<this.subTiles_array.length;i++)this.subTiles_array[i].getIntersectedTiles(e,t);else t.push(this)};var Texture=function(){if(!(this instanceof Texture))throw new Error(Messages.CONSTRUCT_ERROR);this.textureTypeName="",this.textureImageFileName="",this.texId,this.fileLoadState=CODE.fileLoadState.READY};Texture.prototype.deleteObjects=function(){this.textureTypeName=void 0,this.textureImageFileName=void 0,this.texId=void 0,this.fileLoadState=void 0};var Triangle=function(){if(!(this instanceof Triangle))throw new Error(Messages.CONSTRUCT_ERROR);this.vertex0,this.vertex1,this.vertex2,this.normal};Triangle.prototype.destroy=function(){this.vertex0=void 0,this.vertex1=void 0,this.vertex2=void 0,this.normal=void 0},Triangle.prototype.setVertices=function(e,t,r){this.vertex0=e,this.vertex1=t,this.vertex2=r},Triangle.prototype.calculatePlaneNormal=function(){void 0===this.normal&&(this.normal=new Point3D),this.getCrossProduct(0,this.normal),this.normal.unitary()},Triangle.prototype.getCrossProduct=function(e,t){void 0===t&&(t=new Point3D);var r,i,o;0===e?(r=this.vertex0.point3d,i=this.vertex2.point3d,o=this.vertex1.point3d):1===e?(r=this.vertex1.point3d,i=this.vertex0.point3d,o=this.vertex2.point3d):2===e&&(r=this.vertex2.point3d,i=this.vertex1.point3d,o=this.vertex0.point3d);var a=new Point3D,n=new Point3D;return a.set(r.x-i.x,r.y-i.y,r.z-i.z),n.set(o.x-r.x,o.y-r.y,o.z-r.z),a.unitary(),n.unitary(),t=a.crossProduct(n,t)};var TriPolyhedron=function(){if(!(this instanceof TriPolyhedron))throw new Error(Messages.CONSTRUCT_ERROR);this.vertexMatrix=new VertexMatrix,this.vertexList=this.vertexMatrix.newVertexList(),this.triSurfacesArray=[]};TriPolyhedron.prototype.newTriSurface=function(){var e=new TriSurface;return this.triSurfacesArray.push(e),e},TriPolyhedron.prototype.getVBOArrayModePosNorCol=function(e){void 0===e&&(e=new VBOVertexIdxCacheKey),void 0===e.posVboDataArray&&(e.posVboDataArray=[]),void 0===e.norVboDataArray&&(e.norVboDataArray=[]),void 0===e.colVboDataArray&&(e.colVboDataArray=[]);var t=[],r=[],i=[];e.vertexCount=0;for(var o,a,n,s,l,c,h=this.triSurfacesArray.length,d=0;d<h;d++){l=(c=this.triSurfacesArray[d]).trianglesArray.length;for(var u=0;u<l;u++)void 0===(s=c.trianglesArray[u]).normal&&s.calculatePlaneNormal(),o=s.vertex0,a=s.vertex1,n=s.vertex2,t.push(o.point3d.x),t.push(o.point3d.y),t.push(o.point3d.z),t.push(a.point3d.x),t.push(a.point3d.y),t.push(a.point3d.z),t.push(n.point3d.x),t.push(n.point3d.y),t.push(n.point3d.z),r.push(s.normal.x),r.push(s.normal.y),r.push(s.normal.z),r.push(s.normal.x),r.push(s.normal.y),r.push(s.normal.z),r.push(s.normal.x),r.push(s.normal.y),r.push(s.normal.z),void 0===o.color4?(i.push(255),i.push(255),i.push(255),i.push(255),i.push(255),i.push(255),i.push(255),i.push(255),i.push(255),i.push(255),i.push(255),i.push(255)):(i.push(o.color4.r),i.push(o.color4.g),i.push(o.color4.b),i.push(o.color4.a),i.push(a.color4.r),i.push(a.color4.g),i.push(a.color4.b),i.push(a.color4.a),i.push(n.color4.r),i.push(n.color4.g),i.push(n.color4.b),i.push(n.color4.a)),e.vertexCount+=3}var f=e.vertexCount;e.norVboDataArray=new Int8Array(3*f),e.colVboDataArray=new Uint8Array(4*f),e.posVboDataArray=new Float32Array(3*f);for(d=0;d<3*f;d++)e.posVboDataArray[d]=t[d],e.norVboDataArray[d]=r[d];for(d=0;d<4*f;d++)e.colVboDataArray[d]=i[d];return t=void 0,r=void 0,i=void 0,e};var TriSurface=function(){if(!(this instanceof TriSurface))throw new Error(Messages.CONSTRUCT_ERROR);this.trianglesArray=[]};TriSurface.prototype.newTriangle=function(){var e=new Triangle;return this.trianglesArray.push(e),e};var VBOManager=function(){if(!(this instanceof VBOManager))throw new Error(Messages.CONSTRUCT_ERROR)},Buffer=function(){if(!(this instanceof Buffer))throw new Error(Messages.CONSTRUCT_ERROR);this.dataArray,this.dataArrayByteLength=0},VBOVertexIdxCacheKey=function(){if(!(this instanceof VBOVertexIdxCacheKey))throw new Error(Messages.CONSTRUCT_ERROR);this.indicesCount=-1,this.vertexCount=-1,this.bigTrianglesIndicesCount=-1,this.meshVertexCacheKey,this.meshFacesCacheKey,this.meshNormalCacheKey,this.meshColorCacheKey,this.meshTexcoordsCacheKey,this.posVboDataArray,this.norVboDataArray,this.idxVboDataArray,this.colVboDataArray,this.tcoordVboDataArray,this.posArrayByteSize,this.norArrayByteSize,this.idxArrayByteSize,this.colArrayByteSize,this.tcoordArrayByteSize,this.buffer};VBOVertexIdxCacheKey.prototype.deleteGlObjects=function(e,t){this.meshVertexCacheKey&&(t.storeClassifiedBufferKey(e,this.meshVertexCacheKey,this.posArrayByteSize),this.meshVertexCacheKey=void 0),this.posVboDataArray=void 0,this.meshNormalCacheKey&&(t.storeClassifiedBufferKey(e,this.meshNormalCacheKey,this.norArrayByteSize),this.meshNormalCacheKey=void 0),this.norVboDataArray=void 0,this.meshColorCacheKey&&(t.storeClassifiedBufferKey(e,this.meshColorCacheKey,this.colArrayByteSize),this.meshColorCacheKey=void 0),this.colVboDataArray=void 0,this.meshTexcoordsCacheKey&&(t.storeClassifiedBufferKey(e,this.meshTexcoordsCacheKey,this.tcoordArrayByteSize),this.meshTexcoordsCacheKey=void 0),this.tcoordVboDataArray=void 0,this.meshFacesCacheKey&&(t.storeClassifiedElementKey(e,this.meshFacesCacheKey,this.idxArrayByteSize),this.meshFacesCacheKey=void 0),this.idxVboDataArray=void 0,this.posArrayByteSize=void 0,this.norArrayByteSize=void 0,this.idxArrayByteSize=void 0,this.colArrayByteSize=void 0,this.tcoordArrayByteSize=void 0,this.buffer=void 0},VBOVertexIdxCacheKey.prototype.isReadyPositions=function(e,t){return void 0!==this.meshVertexCacheKey||void 0!==this.posVboDataArray&&(this.meshVertexCacheKey=t.getClassifiedBufferKey(e,this.posArrayByteSize),void 0!==this.meshVertexCacheKey&&(e.bindBuffer(e.ARRAY_BUFFER,this.meshVertexCacheKey),e.bufferData(e.ARRAY_BUFFER,this.posVboDataArray,e.STATIC_DRAW),this.posVboDataArray=void 0,!0))},VBOVertexIdxCacheKey.prototype.isReadyNormals=function(e,t){return void 0!==this.meshNormalCacheKey||void 0!==this.norVboDataArray&&(this.meshNormalCacheKey=t.getClassifiedBufferKey(e,this.norArrayByteSize),void 0!==this.meshNormalCacheKey&&(e.bindBuffer(e.ARRAY_BUFFER,this.meshNormalCacheKey),e.bufferData(e.ARRAY_BUFFER,this.norVboDataArray,e.STATIC_DRAW),this.norVboDataArray=void 0,!0))},VBOVertexIdxCacheKey.prototype.isReadyFaces=function(e,t){return void 0!==this.meshFacesCacheKey||void 0!==this.idxVboDataArray&&(this.meshFacesCacheKey=t.getClassifiedElementKey(e,this.idxArrayByteSize),void 0!==this.meshFacesCacheKey&&(e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.meshFacesCacheKey),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.idxVboDataArray,e.STATIC_DRAW),this.idxVboDataArray=void 0,!0))},VBOVertexIdxCacheKey.prototype.isReadyTexCoords=function(e,t){return void 0!==this.meshTexcoordsCacheKey||void 0!==this.tcoordVboDataArray&&(this.meshTexcoordsCacheKey=t.getClassifiedBufferKey(e,this.tcoordArrayByteSize),void 0!==this.meshTexcoordsCacheKey&&(e.bindBuffer(e.ARRAY_BUFFER,this.meshTexcoordsCacheKey),e.bufferData(e.ARRAY_BUFFER,this.tcoordVboDataArray,e.STATIC_DRAW),this.tcoordVboDataArray=void 0,!0))},VBOVertexIdxCacheKey.prototype.isReadyColors=function(e,t){return void 0!==this.meshColorCacheKey||void 0!==this.colVboDataArray&&(this.meshColorCacheKey=t.getClassifiedBufferKey(e,this.colArrayByteSize),void 0!==this.meshColorCacheKey&&(e.bindBuffer(e.ARRAY_BUFFER,this.meshColorCacheKey),e.bufferData(e.ARRAY_BUFFER,this.colVboDataArray,e.STATIC_DRAW),this.colVboDataArray=void 0,!0))};var VBOVertexIdxCacheKeysContainer=function(){if(!(this instanceof VBOVertexIdxCacheKeysContainer))throw new Error(Messages.CONSTRUCT_ERROR);this.vboCacheKeysArray=[]};VBOVertexIdxCacheKeysContainer.prototype.newVBOVertexIdxCacheKey=function(){var e=new VBOVertexIdxCacheKey;return this.vboCacheKeysArray.push(e),e},VBOVertexIdxCacheKeysContainer.prototype.deleteGlObjects=function(e,t){for(var r=this.vboCacheKeysArray.length,i=0;i<r;i++)this.vboCacheKeysArray[i].deleteGlObjects(e,t),this.vboCacheKeysArray[i]=void 0;this.vboCacheKeysArray.length=0,this.vboCacheKeysArray=void 0};var VBOByteColorCacheKey=function(){if(!(this instanceof VBOByteColorCacheKey))throw new Error(Messages.CONSTRUCT_ERROR);this.meshColorsCacheKey=null,this.meshTexcoordsCacheKey=null},VBOByteColorCacheKeysContainer=function(){if(!(this instanceof VBOByteColorCacheKeysContainer))throw new Error(Messages.CONSTRUCT_ERROR);this.vboByteColorsCacheKeysArray=[]};VBOByteColorCacheKeysContainer.prototype.newVBOByteColorsCacheKey=function(){var e=new VBOByteColorCacheKey;return this.vboByteColorsCacheKeysArray.push(e),e};var VBOKeysStore=function(e){if(!(this instanceof VBOKeysStore))throw new Error(Messages.CONSTRUCT_ERROR);this.classifiedSize=e,this.vboKeysArray=[],this.keysCreated=0};VBOKeysStore.prototype.getBufferKey=function(e,t,r,i){if(this.vboKeysArray.length>0)return o=this.vboKeysArray.pop();if(!i){var o=e.createBuffer();return this.keysCreated+=1,t.totalBytesUsed+=this.classifiedSize,r.totalBytesUsed+=this.classifiedSize,o}},VBOKeysStore.prototype.storeBufferKey=function(e){this.vboKeysArray.push(e)};var VBOKeysNation=function(e,t){if(!(this instanceof VBOKeysNation))throw new Error(Messages.CONSTRUCT_ERROR);this.vboKeysStoreMap=new Map,this.bufferSizes=e,this.minSize=t,this.maxSize=e[e.length-1],this.totalBytesUsed=0;for(var r,i=e.length,o=0;o<i;o++)r=new VBOKeysStore(e[o]),this.vboKeysStoreMap.set(e[o],r),e[o]>this.maxSize&&(this.maxSize=e[o])};VBOKeysNation.prototype.getClassifiedBufferKey=function(e,t,r,i){var o=this.vboKeysStoreMap.get(t);return o?o.getBufferKey(e,this,r,i):-1},VBOKeysNation.prototype.storeClassifiedBufferKey=function(e,t){var r=this.vboKeysStoreMap.get(t);r&&r.storeBufferKey(e)},VBOKeysNation.prototype.getClosestBufferSize=function(e){if(!this.isInsideRange(e))return-1;for(var t=this.bufferSizes.length,r=0;r<t;r++)if(e<=this.bufferSizes[r])return this.bufferSizes[r];return-1},VBOKeysNation.prototype.isInsideRange=function(e){return!(e>this.maxSize||e<this.minSize)};var VBOKeysWorld=function(){if(!(this instanceof VBOKeysWorld))throw new Error(Messages.CONSTRUCT_ERROR);this.totalBytesUsed=0,this.bytesLimit=1e3,this.vboKeysNationsArray=[],this.vboKeyNation12to128=new VBOKeysNation(new Uint32Array([12,16,32,48,64,76,92,128]),0),this.vboKeysNationsArray.push(this.vboKeyNation12to128),this.vboKeyNation200to1000=new VBOKeysNation(new Uint32Array([200,300,400,500,600,700,800,900,1e3]),129),this.vboKeysNationsArray.push(this.vboKeyNation200to1000),this.vboKeyNation1500to6000=new VBOKeysNation(new Uint32Array([1500,2e3,2500,3e3,3500,4e3,4500,5e3,5500,6e3]),1001),this.vboKeysNationsArray.push(this.vboKeyNation1500to6000),this.vboKeyNation7000to16000=new VBOKeysNation(new Uint32Array([7e3,8e3,9e3,1e4,11e3,12e3,13e3,14e3,15e3,16e3]),6001),this.vboKeysNationsArray.push(this.vboKeyNation7000to16000),this.vboKeyNation20000to56000=new VBOKeysNation(new Uint32Array([2e4,24e3,28e3,32e3,36e3,4e4,44e3,48e3,52e3,56e3]),16001),this.vboKeysNationsArray.push(this.vboKeyNation20000to56000),this.vboKeyNation60000to150000=new VBOKeysNation(new Uint32Array([6e4,7e4,8e4,9e4,1e5,11e4,12e4,13e4,14e4,15e4]),56001),this.vboKeysNationsArray.push(this.vboKeyNation60000to150000),this.vboKeyNation200000to1100000=new VBOKeysNation(new Uint32Array([2e5,3e5,4e5,5e5,6e5,7e5,8e5,9e5,1e6,11e5]),150001),this.vboKeysNationsArray.push(this.vboKeyNation200000to1100000),this.vboKeyNation1500000to3000000=new VBOKeysNation(new Uint32Array([15e5,2e6,25e5,3e6]),1100001),this.vboKeysNationsArray.push(this.vboKeyNation1500000to3000000)};VBOKeysWorld.prototype.getClassifiedBufferKey=function(e,t){var r=!1;this.totalBytesUsed>this.bytesLimit&&(r=!0);var i=this.getKeyNationBySize(t),o=void 0;return i&&(o=i.getClassifiedBufferKey(e,t,this,r)),o},VBOKeysWorld.prototype.storeClassifiedBufferKey=function(e,t){var r=this.getKeyNationBySize(t);r&&r.storeClassifiedBufferKey(e,t)},VBOKeysWorld.prototype.getKeyNationBySize=function(e){for(var t=this.vboKeysNationsArray.length,r=0;r<t;){if(this.vboKeysNationsArray[r].isInsideRange(e))return this.vboKeysNationsArray[r];r++}return-1},VBOKeysWorld.prototype.getClassifiedBufferSize=function(e){var t=this.getKeyNationBySize(e),r=-1;return-1!==t&&(r=t.getClosestBufferSize(e)),r};var VBOMemoryManager=function(){if(!(this instanceof VBOMemoryManager))throw new Error(Messages.CONSTRUCT_ERROR);this.enableMemoryManagement=!1,this.buffersKeyWorld=new VBOKeysWorld,this.elementKeyWorld=new VBOKeysWorld,this.buffersKeyWorld.bytesLimit=8e8,this.elementKeyWorld.bytesLimit=3e8};VBOMemoryManager.prototype.isGpuMemFull=function(){return this.buffersKeyWorld.totalBytesUsed>this.buffersKeyWorld.bytesLimit||this.elementKeyWorld.totalBytesUsed>this.elementKeyWorld.bytesLimit},VBOMemoryManager.prototype.getClassifiedBufferKey=function(e,t){return this.enableMemoryManagement?this.buffersKeyWorld.getClassifiedBufferKey(e,t):e.createBuffer()},VBOMemoryManager.prototype.storeClassifiedBufferKey=function(e,t,r){this.enableMemoryManagement?this.buffersKeyWorld.storeClassifiedBufferKey(t,r):e.deleteBuffer(t)},VBOMemoryManager.prototype.getClassifiedElementKey=function(e,t){return this.enableMemoryManagement?this.elementKeyWorld.getClassifiedBufferKey(e,t):e.createBuffer()},VBOMemoryManager.prototype.storeClassifiedElementKey=function(e,t,r){this.enableMemoryManagement?this.elementKeyWorld.storeClassifiedBufferKey(t,r):e.deleteBuffer(t)},VBOMemoryManager.prototype.getClassifiedBufferSize=function(e){return this.enableMemoryManagement?this.buffersKeyWorld.getClassifiedBufferSize(e):e};var Vertex=function(){if(!(this instanceof Vertex))throw new Error(Messages.CONSTRUCT_ERROR);this.point3d=new Point3D,this.normal,this.texCoord,this.color4};Vertex.prototype.setPosition=function(e,t,r){this.point3d.set(e,t,r)},Vertex.prototype.setColorRGB=function(e,t,r){void 0===this.color4&&(this.color4=new Color),this.color4.setRGB(e,t,r)},Vertex.prototype.setColorRGBA=function(e,t,r,i){void 0===this.color4&&(this.color4=new Color),this.color4.setRGBA(e,t,r,i)},Vertex.prototype.translate=function(e,t,r,i){this.point3d.add(e*i,t*i,r*i)};var VertexList=function(){if(!(this instanceof VertexList))throw new Error(Messages.CONSTRUCT_ERROR);this.vertexArray=[]};VertexList.prototype.newVertex=function(){var e=new Vertex;return this.vertexArray.push(e),e},VertexList.prototype.getVertex=function(e){return this.vertexArray[e]},VertexList.prototype.getVertexCount=function(){return this.vertexArray.length},VertexList.prototype.translateVertices=function(e,t,r,i){for(var o=0,a=this.vertexArray.length;o<a;o++)this.vertexArray[o].translate(e,t,r,i)},VertexList.prototype.getBoundingBox=function(e){void 0===e&&(e=new BoundingBox);for(var t=0,r=this.vertexArray.length;t<r;t++)0===t?e.init(this.vertexArray[t].point3d):e.addPoint(this.vertexArray[t].point3d);return e},VertexList.prototype.transformPointsByMatrix4=function(e){for(var t=0,r=this.vertexArray.length;t<r;t++){var i=this.vertexArray[t];e.transformPoint3D(i.point3d,i.point3d)}};var VertexMatrix=function(){if(!(this instanceof VertexMatrix))throw new Error(Messages.CONSTRUCT_ERROR);this.vertexListsArray=[],this.totalVertexArraySC=[]};VertexMatrix.prototype.newVertexList=function(){var e=new VertexList;return this.vertexListsArray.push(e),e},VertexMatrix.prototype.getVertexList=function(e){return e>=0&&e<this.vertexListsArray.length?this.vertexListsArray[e]:void 0},VertexMatrix.prototype.getBoundingBox=function(e){void 0===e&&(e=new BoundingBox),this.totalVertexArraySC.length=0,this.totalVertexArraySC=this.getTotalVertexArray(this.totalVertexArraySC);for(var t=0,r=this.totalVertexArraySC.length;t<r;t++)0===t?e.init(this.totalVertexArraySC[t].point3d):e.addPoint(this.totalVertexArraySC[t].point3d);return e},VertexMatrix.prototype.setVertexIdxInList=function(){for(var e=0,t=0,r=this.vertexListsArray.length;t<r;t++)for(var i=this.vertexListsArray[t],o=0,a=i.vertexArray.length;o<a;o++)i.getVertex(o).mIdxInList=e,e++},VertexMatrix.prototype.getVertexCount=function(){for(var e=0,t=0,r=this.vertexListsArray.length;t<r;t++)e+=this.vertexListsArray[t].getVertexCount();return e},VertexMatrix.prototype.getTotalVertexArray=function(e){for(var t=0,r=this.vertexListsArray.length;t<r;t++)for(var i=this.vertexListsArray[t],o=0,a=i.vertexArray.length;o<a;o++){var n=i.getVertex(o);e.push(n)}return e},VertexMatrix.prototype.getVBOVertexColorFloatArray=function(e){this.totalVertexArraySC.length=0,this.totalVertexArraySC=this.getTotalVertexArray(this.totalVertexArraySC);var t=this.totalVertexArraySC.length;void 0===e&&(e=new Float32Array(6*t));for(var r=0;r<t;r++){var i=this.totalVertexArraySC[r];e[6*r]=i.point3d.x,e[6*r+1]=i.point3d.y,e[6*r+2]=i.point3d.z,e[6*r+3]=i.color4.r,e[6*r+4]=i.color4.g,e[6*r+5]=i.color4.b}return e},VertexMatrix.prototype.getVBOVertexColorRGBAFloatArray=function(e){this.totalVertexArraySC.length=0,this.totalVertexArraySC=this.getTotalVertexArray(this.totalVertexArraySC);var t=this.totalVertexArraySC.length;void 0===e&&(e=new Float32Array(7*t));for(var r=0;r<t;r++){var i=this.totalVertexArraySC[r];e[7*r]=i.point3d.x,e[7*r+1]=i.point3d.y,e[7*r+2]=i.point3d.z,e[7*r+3]=i.color4.r,e[7*r+4]=i.color4.g,e[7*r+5]=i.color4.b,e[7*r+6]=i.color4.a}return e},VertexMatrix.prototype.getVBOVertexFloatArray=function(e){this.totalVertexArraySC.length=0,this.totalVertexArraySC=this.getTotalVertexArray(this.totalVertexArraySC);var t=this.totalVertexArraySC.length;void 0===e&&(e=new Float32Array(3*t));for(var r=0;r<t;r++){var i=this.totalVertexArraySC[r];e[3*r]=i.point3d.x,e[3*r+1]=i.point3d.y,e[3*r+2]=i.point3d.z}return e},VertexMatrix.prototype.translateVertices=function(e,t,r,i){for(var o=0,a=this.vertexListsArray.length;o<a;o++)this.vertexListsArray[o].translateVertices(e,t,r,i)},VertexMatrix.prototype.makeTTrianglesLateralSidesLOOP=function(e){for(var t,r,i,o,a,n=0,s=0,l=this.vertexListsArray.length;s<l-1;s++){t=this.vertexListsArray[s],r=this.vertexListsArray[s+1],i=e.newTTrianglesList(),n=t.vertexArray.length;for(var c=0;c<n;c++)o=i.newTTriangle(),a=i.newTTriangle(),c===n-1?(o.setVertices(t.getVertex(c),r.getVertex(c),r.getVertex(0)),a.setVertices(t.getVertex(c),r.getVertex(0),t.getVertex(0))):(o.setVertices(t.getVertex(c),r.getVertex(c),r.getVertex(c+1)),a.setVertices(t.getVertex(c),r.getVertex(c+1),t.getVertex(c+1)))}},VertexMatrix.prototype.transformPointsByMatrix4=function(e){for(var t=0,r=this.vertexListsArray.length;t<r;t++)this.vertexListsArray[t].transformPointsByMatrix4(e)};var VisibleObjectsController=function(){if(!(this instanceof VisibleObjectsController))throw new Error(Messages.CONSTRUCT_ERROR);this.currentVisibles0=[],this.currentVisibles1=[],this.currentVisibles2=[],this.currentVisibles3=[]};VisibleObjectsController.prototype.initArrays=function(){this.currentVisibles0=[],this.currentVisibles1=[],this.currentVisibles2=[],this.currentVisibles3=[]},VisibleObjectsController.prototype.clear=function(){this.currentVisibles0.length=0,this.currentVisibles1.length=0,this.currentVisibles2.length=0,this.currentVisibles3.length=0};var DataStream=function(e,t,r){this._byteOffset=t||0,e instanceof ArrayBuffer?this.buffer=e:"object"==typeof e?(this.dataView=e,t&&(this._byteOffset+=t)):this.buffer=new ArrayBuffer(e||1),this.position=0,this.endianness=null==r?DataStream.LITTLE_ENDIAN:r};DataStream.prototype={},void 0===Uint8Array.prototype.BYTES_PER_ELEMENT&&(Uint8Array.prototype.BYTES_PER_ELEMENT=Uint8Array.BYTES_PER_ELEMENT,Int8Array.prototype.BYTES_PER_ELEMENT=Int8Array.BYTES_PER_ELEMENT,Uint8ClampedArray.prototype.BYTES_PER_ELEMENT=Uint8ClampedArray.BYTES_PER_ELEMENT,Uint16Array.prototype.BYTES_PER_ELEMENT=Uint16Array.BYTES_PER_ELEMENT,Int16Array.prototype.BYTES_PER_ELEMENT=Int16Array.BYTES_PER_ELEMENT,Uint32Array.prototype.BYTES_PER_ELEMENT=Uint32Array.BYTES_PER_ELEMENT,Int32Array.prototype.BYTES_PER_ELEMENT=Int32Array.BYTES_PER_ELEMENT,Float64Array.prototype.BYTES_PER_ELEMENT=Float64Array.BYTES_PER_ELEMENT),DataStream.prototype.save=function(e){var t=new Blob(this.buffer),r=window.webkitURL||window.URL;if(!r||!r.createObjectURL)throw"DataStream.save: Can't create object URL.";var i=r.createObjectURL(t),o=document.createElement("a");o.setAttribute("href",i),o.setAttribute("download",e),o.click(),r.revokeObjectURL(i)},DataStream.BIG_ENDIAN=!1,DataStream.LITTLE_ENDIAN=!0,DataStream.prototype._dynamicSize=!0,Object.defineProperty(DataStream.prototype,"dynamicSize",{get:function(){return this._dynamicSize},set:function(e){e||this._trimAlloc(),this._dynamicSize=e}}),DataStream.prototype._byteLength=0,Object.defineProperty(DataStream.prototype,"byteLength",{get:function(){return this._byteLength-this._byteOffset}}),Object.defineProperty(DataStream.prototype,"buffer",{get:function(){return this._trimAlloc(),this._buffer},set:function(e){this._buffer=e,this._dataView=new DataView(this._buffer,this._byteOffset),this._byteLength=this._buffer.byteLength}}),Object.defineProperty(DataStream.prototype,"byteOffset",{get:function(){return this._byteOffset},set:function(e){this._byteOffset=e,this._dataView=new DataView(this._buffer,this._byteOffset),this._byteLength=this._buffer.byteLength}}),Object.defineProperty(DataStream.prototype,"dataView",{get:function(){return this._dataView},set:function(e){this._byteOffset=e.byteOffset,this._buffer=e.buffer,this._dataView=new DataView(this._buffer,this._byteOffset),this._byteLength=this._byteOffset+e.byteLength}}),DataStream.prototype._realloc=function(e){if(this._dynamicSize){var t=this._byteOffset+this.position+e,r=this._buffer.byteLength;if(t<=r)t>this._byteLength&&(this._byteLength=t);else{for(r<1&&(r=1);t>r;)r*=2;var i=new ArrayBuffer(r),o=new Uint8Array(this._buffer);new Uint8Array(i,0,o.length).set(o),this.buffer=i,this._byteLength=t}}},DataStream.prototype._trimAlloc=function(){if(this._byteLength!=this._buffer.byteLength){var e=new ArrayBuffer(this._byteLength),t=new Uint8Array(e),r=new Uint8Array(this._buffer,0,t.length);t.set(r),this.buffer=e}},DataStream.prototype.seek=function(e){var t=Math.max(0,Math.min(this.byteLength,e));this.position=isNaN(t)||!isFinite(t)?0:t},DataStream.prototype.isEof=function(){return this.position>=this.byteLength},DataStream.prototype.mapInt32Array=function(e,t){this._realloc(4*e);var r=new Int32Array(this._buffer,this.byteOffset+this.position,e);return DataStream.arrayToNative(r,null==t?this.endianness:t),this.position+=4*e,r},DataStream.prototype.mapInt16Array=function(e,t){this._realloc(2*e);var r=new Int16Array(this._buffer,this.byteOffset+this.position,e);return DataStream.arrayToNative(r,null==t?this.endianness:t),this.position+=2*e,r},DataStream.prototype.mapInt8Array=function(e){this._realloc(1*e);var t=new Int8Array(this._buffer,this.byteOffset+this.position,e);return this.position+=1*e,t},DataStream.prototype.mapUint32Array=function(e,t){this._realloc(4*e);var r=new Uint32Array(this._buffer,this.byteOffset+this.position,e);return DataStream.arrayToNative(r,null==t?this.endianness:t),this.position+=4*e,r},DataStream.prototype.mapUint16Array=function(e,t){this._realloc(2*e);var r=new Uint16Array(this._buffer,this.byteOffset+this.position,e);return DataStream.arrayToNative(r,null==t?this.endianness:t),this.position+=2*e,r},DataStream.prototype.mapUint8Array=function(e){this._realloc(1*e);var t=new Uint8Array(this._buffer,this.byteOffset+this.position,e);return this.position+=1*e,t},DataStream.prototype.mapFloat64Array=function(e,t){this._realloc(8*e);var r=new Float64Array(this._buffer,this.byteOffset+this.position,e);return DataStream.arrayToNative(r,null==t?this.endianness:t),this.position+=8*e,r},DataStream.prototype.mapFloat32Array=function(e,t){this._realloc(4*e);var r=new Float32Array(this._buffer,this.byteOffset+this.position,e);return DataStream.arrayToNative(r,null==t?this.endianness:t),this.position+=4*e,r},DataStream.prototype.readInt32Array=function(e,t){e=null==e?this.byteLength-this.position/4:e;var r=new Int32Array(e);return DataStream.memcpy(r.buffer,0,this.buffer,this.byteOffset+this.position,e*r.BYTES_PER_ELEMENT),DataStream.arrayToNative(r,null==t?this.endianness:t),this.position+=r.byteLength,r},DataStream.prototype.readInt16Array=function(e,t){e=null==e?this.byteLength-this.position/2:e;var r=new Int16Array(e);return DataStream.memcpy(r.buffer,0,this.buffer,this.byteOffset+this.position,e*r.BYTES_PER_ELEMENT),DataStream.arrayToNative(r,null==t?this.endianness:t),this.position+=r.byteLength,r},DataStream.prototype.readInt8Array=function(e){e=null==e?this.byteLength-this.position:e;var t=new Int8Array(e);return DataStream.memcpy(t.buffer,0,this.buffer,this.byteOffset+this.position,e*t.BYTES_PER_ELEMENT),this.position+=t.byteLength,t},DataStream.prototype.readUint32Array=function(e,t){e=null==e?this.byteLength-this.position/4:e;var r=new Uint32Array(e);return DataStream.memcpy(r.buffer,0,this.buffer,this.byteOffset+this.position,e*r.BYTES_PER_ELEMENT),DataStream.arrayToNative(r,null==t?this.endianness:t),this.position+=r.byteLength,r},DataStream.prototype.readUint16Array=function(e,t){e=null==e?this.byteLength-this.position/2:e;var r=new Uint16Array(e);return DataStream.memcpy(r.buffer,0,this.buffer,this.byteOffset+this.position,e*r.BYTES_PER_ELEMENT),DataStream.arrayToNative(r,null==t?this.endianness:t),this.position+=r.byteLength,r},DataStream.prototype.readUint8Array=function(e){e=null==e?this.byteLength-this.position:e;var t=new Uint8Array(e);return DataStream.memcpy(t.buffer,0,this.buffer,this.byteOffset+this.position,e*t.BYTES_PER_ELEMENT),this.position+=t.byteLength,t},DataStream.prototype.readFloat64Array=function(e,t){e=null==e?this.byteLength-this.position/8:e;var r=new Float64Array(e);return DataStream.memcpy(r.buffer,0,this.buffer,this.byteOffset+this.position,e*r.BYTES_PER_ELEMENT),DataStream.arrayToNative(r,null==t?this.endianness:t),this.position+=r.byteLength,r},DataStream.prototype.readFloat32Array=function(e,t){e=null==e?this.byteLength-this.position/4:e;var r=new Float32Array(e);return DataStream.memcpy(r.buffer,0,this.buffer,this.byteOffset+this.position,e*r.BYTES_PER_ELEMENT),DataStream.arrayToNative(r,null==t?this.endianness:t),this.position+=r.byteLength,r},DataStream.prototype.writeInt32Array=function(e,t){if(this._realloc(4*e.length),e instanceof Int32Array&&(this.byteOffset+this.position)%e.BYTES_PER_ELEMENT==0)DataStream.memcpy(this._buffer,this.byteOffset+this.position,e.buffer,e.byteOffset,e.byteLength),this.mapInt32Array(e.length,t);else for(var r=0;r<e.length;r++)this.writeInt32(e[r],t)},DataStream.prototype.writeInt16Array=function(e,t){if(this._realloc(2*e.length),e instanceof Int16Array&&(this.byteOffset+this.position)%e.BYTES_PER_ELEMENT==0)DataStream.memcpy(this._buffer,this.byteOffset+this.position,e.buffer,e.byteOffset,e.byteLength),this.mapInt16Array(e.length,t);else for(var r=0;r<e.length;r++)this.writeInt16(e[r],t)},DataStream.prototype.writeInt8Array=function(e){if(this._realloc(1*e.length),e instanceof Int8Array&&(this.byteOffset+this.position)%e.BYTES_PER_ELEMENT==0)DataStream.memcpy(this._buffer,this.byteOffset+this.position,e.buffer,e.byteOffset,e.byteLength),this.mapInt8Array(e.length);else for(var t=0;t<e.length;t++)this.writeInt8(e[t])},DataStream.prototype.writeUint32Array=function(e,t){if(this._realloc(4*e.length),e instanceof Uint32Array&&(this.byteOffset+this.position)%e.BYTES_PER_ELEMENT==0)DataStream.memcpy(this._buffer,this.byteOffset+this.position,e.buffer,e.byteOffset,e.byteLength),this.mapUint32Array(e.length,t);else for(var r=0;r<e.length;r++)this.writeUint32(e[r],t)},DataStream.prototype.writeUint16Array=function(e,t){if(this._realloc(2*e.length),e instanceof Uint16Array&&(this.byteOffset+this.position)%e.BYTES_PER_ELEMENT==0)DataStream.memcpy(this._buffer,this.byteOffset+this.position,e.buffer,e.byteOffset,e.byteLength),this.mapUint16Array(e.length,t);else for(var r=0;r<e.length;r++)this.writeUint16(e[r],t)},DataStream.prototype.writeUint8Array=function(e){if(this._realloc(1*e.length),e instanceof Uint8Array&&(this.byteOffset+this.position)%e.BYTES_PER_ELEMENT==0)DataStream.memcpy(this._buffer,this.byteOffset+this.position,e.buffer,e.byteOffset,e.byteLength),this.mapUint8Array(e.length);else for(var t=0;t<e.length;t++)this.writeUint8(e[t])},DataStream.prototype.writeFloat64Array=function(e,t){if(this._realloc(8*e.length),e instanceof Float64Array&&(this.byteOffset+this.position)%e.BYTES_PER_ELEMENT==0)DataStream.memcpy(this._buffer,this.byteOffset+this.position,e.buffer,e.byteOffset,e.byteLength),this.mapFloat64Array(e.length,t);else for(var r=0;r<e.length;r++)this.writeFloat64(e[r],t)},DataStream.prototype.writeFloat32Array=function(e,t){if(this._realloc(4*e.length),e instanceof Float32Array&&(this.byteOffset+this.position)%e.BYTES_PER_ELEMENT==0)DataStream.memcpy(this._buffer,this.byteOffset+this.position,e.buffer,e.byteOffset,e.byteLength),this.mapFloat32Array(e.length,t);else for(var r=0;r<e.length;r++)this.writeFloat32(e[r],t)},DataStream.prototype.readInt32=function(e){var t=this._dataView.getInt32(this.position,null==e?this.endianness:e);return this.position+=4,t},DataStream.prototype.readInt16=function(e){var t=this._dataView.getInt16(this.position,null==e?this.endianness:e);return this.position+=2,t},DataStream.prototype.readInt8=function(){var e=this._dataView.getInt8(this.position);return this.position+=1,e},DataStream.prototype.readUint32=function(e){var t=this._dataView.getUint32(this.position,null==e?this.endianness:e);return this.position+=4,t},DataStream.prototype.readUint16=function(e){var t=this._dataView.getUint16(this.position,null==e?this.endianness:e);return this.position+=2,t},DataStream.prototype.readUint8=function(){var e=this._dataView.getUint8(this.position);return this.position+=1,e},DataStream.prototype.readFloat32=function(e){var t=this._dataView.getFloat32(this.position,null==e?this.endianness:e);return this.position+=4,t},DataStream.prototype.readFloat64=function(e){var t=this._dataView.getFloat64(this.position,null==e?this.endianness:e);return this.position+=8,t},DataStream.prototype.writeInt32=function(e,t){this._realloc(4),this._dataView.setInt32(this.position,e,null==t?this.endianness:t),this.position+=4},DataStream.prototype.writeInt16=function(e,t){this._realloc(2),this._dataView.setInt16(this.position,e,null==t?this.endianness:t),this.position+=2},DataStream.prototype.writeInt8=function(e){this._realloc(1),this._dataView.setInt8(this.position,e),this.position+=1},DataStream.prototype.writeUint32=function(e,t){this._realloc(4),this._dataView.setUint32(this.position,e,null==t?this.endianness:t),this.position+=4},DataStream.prototype.writeUint16=function(e,t){this._realloc(2),this._dataView.setUint16(this.position,e,null==t?this.endianness:t),this.position+=2},DataStream.prototype.writeUint8=function(e){this._realloc(1),this._dataView.setUint8(this.position,e),this.position+=1},DataStream.prototype.writeFloat32=function(e,t){this._realloc(4),this._dataView.setFloat32(this.position,e,null==t?this.endianness:t),this.position+=4},DataStream.prototype.writeFloat64=function(e,t){this._realloc(8),this._dataView.setFloat64(this.position,e,null==t?this.endianness:t),this.position+=8},DataStream.endianness=new Int8Array(new Int16Array([1]).buffer)[0]>0,DataStream.memcpy=function(e,t,r,i,o){var a=new Uint8Array(e,t,o),n=new Uint8Array(r,i,o);a.set(n)},DataStream.arrayToNative=function(e,t){return t==this.endianness?e:this.flipArrayEndianness(e)},DataStream.nativeToEndian=function(e,t){return this.endianness==t?e:this.flipArrayEndianness(e)},DataStream.flipArrayEndianness=function(e){for(var t=new Uint8Array(e.buffer,e.byteOffset,e.byteLength),r=0;r<e.byteLength;r+=e.BYTES_PER_ELEMENT)for(var i=r+e.BYTES_PER_ELEMENT-1,o=r;i>o;i--,o++){var a=t[o];t[o]=t[i],t[i]=a}return e},DataStream.createStringFromArray=function(e){for(var t=[],r=0;r<e.length;r+=32768)t.push(String.fromCharCode.apply(null,e.subarray(r,r+32768)));return t.join("")},DataStream.prototype.failurePosition=0,DataStream.prototype.readStruct=function(e){for(var t,r,i={},o=this.position,a=0;a<e.length;a+=2){if(t=e[a+1],null==(r=this.readType(t,i)))return 0==this.failurePosition&&(this.failurePosition=this.position),this.position=o,null;i[e[a]]=r}return i},DataStream.prototype.readUCS2String=function(e,t){return DataStream.createStringFromArray(this.readUint16Array(e,t))},DataStream.prototype.writeUCS2String=function(e,t,r){null==r&&(r=e.length);for(var i=0;i<e.length&&i<r;i++)this.writeUint16(e.charCodeAt(i),t);for(;i<r;i++)this.writeUint16(0)},DataStream.prototype.readString=function(e,t){return null==t||"ASCII"==t?DataStream.createStringFromArray(this.mapUint8Array(null==e?this.byteLength-this.position:e)):new TextDecoder(t).decode(this.mapUint8Array(e))},DataStream.prototype.writeString=function(e,t,r){if(null==t||"ASCII"==t)if(null!=r){var i=0,o=Math.min(e.length,r);for(i=0;i<o;i++)this.writeUint8(e.charCodeAt(i));for(;i<r;i++)this.writeUint8(0)}else for(i=0;i<e.length;i++)this.writeUint8(e.charCodeAt(i));else this.writeUint8Array(new TextEncoder(t).encode(e.substring(0,r)))},DataStream.prototype.readCString=function(e){var t=this.byteLength-this.position,r=new Uint8Array(this._buffer,this._byteOffset+this.position),i=t;null!=e&&(i=Math.min(e,t));for(var o=0;o<i&&0!=r[o];o++);var a=DataStream.createStringFromArray(this.mapUint8Array(o));return null!=e?this.position+=i-o:o!=t&&(this.position+=1),a},DataStream.prototype.writeCString=function(e,t){if(null!=t){var r=0,i=Math.min(e.length,t);for(r=0;r<i;r++)this.writeUint8(e.charCodeAt(r));for(;r<t;r++)this.writeUint8(0)}else{for(r=0;r<e.length;r++)this.writeUint8(e.charCodeAt(r));this.writeUint8(0)}},DataStream.prototype.readType=function(e,t){if("function"==typeof e)return e(this,t);if(!("object"!=typeof e||e instanceof Array))return e.get(this,t);if(e instanceof Array&&3!=e.length)return this.readStruct(e,t);var r,i=null,o=null,a="ASCII",n=this.position;if("string"==typeof e&&/:/.test(e)&&(e=(s=e.split(":"))[0],o=null!=t[r=s[1]]?parseInt(t[r]):parseInt(s[1])),"string"==typeof e&&/,/.test(e)){var s=e.split(",");e=s[0],a=parseInt(s[1])}switch(e){case"uint8":i=this.readUint8();break;case"int8":i=this.readInt8();break;case"uint16":i=this.readUint16(this.endianness);break;case"int16":i=this.readInt16(this.endianness);break;case"uint32":i=this.readUint32(this.endianness);break;case"int32":i=this.readInt32(this.endianness);break;case"float32":i=this.readFloat32(this.endianness);break;case"float64":i=this.readFloat64(this.endianness);break;case"uint16be":i=this.readUint16(DataStream.BIG_ENDIAN);break;case"int16be":i=this.readInt16(DataStream.BIG_ENDIAN);break;case"uint32be":i=this.readUint32(DataStream.BIG_ENDIAN);break;case"int32be":i=this.readInt32(DataStream.BIG_ENDIAN);break;case"float32be":i=this.readFloat32(DataStream.BIG_ENDIAN);break;case"float64be":i=this.readFloat64(DataStream.BIG_ENDIAN);break;case"uint16le":i=this.readUint16(DataStream.LITTLE_ENDIAN);break;case"int16le":i=this.readInt16(DataStream.LITTLE_ENDIAN);break;case"uint32le":i=this.readUint32(DataStream.LITTLE_ENDIAN);break;case"int32le":i=this.readInt32(DataStream.LITTLE_ENDIAN);break;case"float32le":i=this.readFloat32(DataStream.LITTLE_ENDIAN);break;case"float64le":i=this.readFloat64(DataStream.LITTLE_ENDIAN);break;case"cstring":i=this.readCString(o);break;case"string":i=this.readString(o,a);break;case"u16string":i=this.readUCS2String(o,this.endianness);break;case"u16stringle":i=this.readUCS2String(o,DataStream.LITTLE_ENDIAN);break;case"u16stringbe":i=this.readUCS2String(o,DataStream.BIG_ENDIAN);break;default:if(3==e.length){var l=e[1],c=0;if(c="function"==typeof(r=e[2])?r(t,this,e):"string"==typeof r&&null!=t[r]?parseInt(t[r]):parseInt(r),"string"==typeof l){var h=l.replace(/(le|be)$/,""),d=null;switch(/le$/.test(l)?d=DataStream.LITTLE_ENDIAN:/be$/.test(l)&&(d=DataStream.BIG_ENDIAN),"*"==r&&(c=null),h){case"uint8":i=this.readUint8Array(c);break;case"uint16":i=this.readUint16Array(c,d);break;case"uint32":i=this.readUint32Array(c,d);break;case"int8":i=this.readInt8Array(c);break;case"int16":i=this.readInt16Array(c,d);break;case"int32":i=this.readInt32Array(c,d);break;case"float32":i=this.readFloat32Array(c,d);break;case"float64":i=this.readFloat64Array(c,d);break;case"cstring":case"utf16string":case"string":if(null==c)for(i=[];!this.isEof()&&null!=(m=this.readType(l,t));)i.push(m);else{i=new Array(c);for(g=0;g<c;g++)i[g]=this.readType(l,t)}}}else if("*"==r)for(i=[],this.buffer;;){var u=this.position;try{var f=this.readType(l,t);if(null==f){this.position=u;break}i.push(f)}catch(e){this.position=u;break}}else{i=new Array(c);for(var g=0;g<c;g++){var m=this.readType(l,t);if(null==m)return null;i[g]=m}}break}}return null!=o&&(this.position=n+o),i},DataStream.prototype.writeStruct=function(e,t){for(var r=0;r<e.length;r+=2){var i=e[r+1];this.writeType(i,t[e[r]],t)}},DataStream.prototype.writeType=function(e,t,r){if("function"==typeof e)return e(this,t);if("object"==typeof e&&!(e instanceof Array))return e.set(this,t,r);var i=null,o="ASCII",a=this.position;if("string"==typeof e&&/:/.test(e)&&(e=(n=e.split(":"))[0],i=parseInt(n[1])),"string"==typeof e&&/,/.test(e)){var n=e.split(",");e=n[0],o=parseInt(n[1])}switch(e){case"uint8":this.writeUint8(t);break;case"int8":this.writeInt8(t);break;case"uint16":this.writeUint16(t,this.endianness);break;case"int16":this.writeInt16(t,this.endianness);break;case"uint32":this.writeUint32(t,this.endianness);break;case"int32":this.writeInt32(t,this.endianness);break;case"float32":this.writeFloat32(t,this.endianness);break;case"float64":this.writeFloat64(t,this.endianness);break;case"uint16be":this.writeUint16(t,DataStream.BIG_ENDIAN);break;case"int16be":this.writeInt16(t,DataStream.BIG_ENDIAN);break;case"uint32be":this.writeUint32(t,DataStream.BIG_ENDIAN);break;case"int32be":this.writeInt32(t,DataStream.BIG_ENDIAN);break;case"float32be":this.writeFloat32(t,DataStream.BIG_ENDIAN);break;case"float64be":this.writeFloat64(t,DataStream.BIG_ENDIAN);break;case"uint16le":this.writeUint16(t,DataStream.LITTLE_ENDIAN);break;case"int16le":this.writeInt16(t,DataStream.LITTLE_ENDIAN);break;case"uint32le":this.writeUint32(t,DataStream.LITTLE_ENDIAN);break;case"int32le":this.writeInt32(t,DataStream.LITTLE_ENDIAN);break;case"float32le":this.writeFloat32(t,DataStream.LITTLE_ENDIAN);break;case"float64le":this.writeFloat64(t,DataStream.LITTLE_ENDIAN);break;case"cstring":this.writeCString(t,i);break;case"string":this.writeString(t,o,i);break;case"u16string":this.writeUCS2String(t,this.endianness,i);break;case"u16stringle":this.writeUCS2String(t,DataStream.LITTLE_ENDIAN,i);break;case"u16stringbe":this.writeUCS2String(t,DataStream.BIG_ENDIAN,i);break;default:if(3==e.length){for(var s=e[1],l=0;l<t.length;l++)this.writeType(s,t[l]);break}this.writeStruct(e,t)}null!=i&&(this.position=a,this._realloc(i),this.position=a+i)},"function"==typeof define&&define.amd&&define("DataStream",[],function(){return DataStream}),"object"==typeof module&&module&&module.exports&&(module.exports=DataStream),function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var r=t();for(var i in r)("object"==typeof exports?exports:e)[i]=r[i]}}(this,function(){return function(e){function t(i){if(r[i])return r[i].exports;var o=r[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var r={};return t.m=e,t.c=r,t.d=function(e,r,i){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=4)}([function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.setMatrixArrayType=function(e){t.ARRAY_TYPE=o=e},t.toRadian=function(e){return e*a},t.equals=function(e,t){return Math.abs(e-t)<=i*Math.max(1,Math.abs(e),Math.abs(t))};var i=t.EPSILON=1e-6,o=t.ARRAY_TYPE="undefined"!=typeof Float32Array?Float32Array:Array,a=(t.RANDOM=Math.random,Math.PI/180)},function(e,t,r){function i(e,t,r){var i=t[0],o=t[1],a=t[2],n=t[3],s=t[4],l=t[5],c=t[6],h=t[7],d=t[8],u=r[0],f=r[1],g=r[2],m=r[3],y=r[4],p=r[5],v=r[6],_=r[7],x=r[8];return e[0]=u*i+f*n+g*c,e[1]=u*o+f*s+g*h,e[2]=u*a+f*l+g*d,e[3]=m*i+y*n+p*c,e[4]=m*o+y*s+p*h,e[5]=m*a+y*l+p*d,e[6]=v*i+_*n+x*c,e[7]=v*o+_*s+x*h,e[8]=v*a+_*l+x*d,e}function o(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e}Object.defineProperty(t,"__esModule",{value:!0}),t.sub=t.mul=void 0,t.create=function(){var e=new a.ARRAY_TYPE(9);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},t.fromMat4=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},t.clone=function(e){var t=new a.ARRAY_TYPE(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},t.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},t.fromValues=function(e,t,r,i,o,n,s,l,c){var h=new a.ARRAY_TYPE(9);return h[0]=e,h[1]=t,h[2]=r,h[3]=i,h[4]=o,h[5]=n,h[6]=s,h[7]=l,h[8]=c,h},t.set=function(e,t,r,i,o,a,n,s,l,c){return e[0]=t,e[1]=r,e[2]=i,e[3]=o,e[4]=a,e[5]=n,e[6]=s,e[7]=l,e[8]=c,e},t.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},t.transpose=function(e,t){if(e===t){var r=t[1],i=t[2],o=t[5];e[1]=t[3],e[2]=t[6],e[3]=r,e[5]=t[7],e[6]=i,e[7]=o}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e},t.invert=function(e,t){var r=t[0],i=t[1],o=t[2],a=t[3],n=t[4],s=t[5],l=t[6],c=t[7],h=t[8],d=h*n-s*c,u=-h*a+s*l,f=c*a-n*l,g=r*d+i*u+o*f;return g?(g=1/g,e[0]=d*g,e[1]=(-h*i+o*c)*g,e[2]=(s*i-o*n)*g,e[3]=u*g,e[4]=(h*r-o*l)*g,e[5]=(-s*r+o*a)*g,e[6]=f*g,e[7]=(-c*r+i*l)*g,e[8]=(n*r-i*a)*g,e):null},t.adjoint=function(e,t){var r=t[0],i=t[1],o=t[2],a=t[3],n=t[4],s=t[5],l=t[6],c=t[7],h=t[8];return e[0]=n*h-s*c,e[1]=o*c-i*h,e[2]=i*s-o*n,e[3]=s*l-a*h,e[4]=r*h-o*l,e[5]=o*a-r*s,e[6]=a*c-n*l,e[7]=i*l-r*c,e[8]=r*n-i*a,e},t.determinant=function(e){var t=e[0],r=e[1],i=e[2],o=e[3],a=e[4],n=e[5],s=e[6],l=e[7],c=e[8];return t*(c*a-n*l)+r*(-c*o+n*s)+i*(l*o-a*s)},t.multiply=i,t.translate=function(e,t,r){var i=t[0],o=t[1],a=t[2],n=t[3],s=t[4],l=t[5],c=t[6],h=t[7],d=t[8],u=r[0],f=r[1];return e[0]=i,e[1]=o,e[2]=a,e[3]=n,e[4]=s,e[5]=l,e[6]=u*i+f*n+c,e[7]=u*o+f*s+h,e[8]=u*a+f*l+d,e},t.rotate=function(e,t,r){var i=t[0],o=t[1],a=t[2],n=t[3],s=t[4],l=t[5],c=t[6],h=t[7],d=t[8],u=Math.sin(r),f=Math.cos(r);return e[0]=f*i+u*n,e[1]=f*o+u*s,e[2]=f*a+u*l,e[3]=f*n-u*i,e[4]=f*s-u*o,e[5]=f*l-u*a,e[6]=c,e[7]=h,e[8]=d,e},t.scale=function(e,t,r){var i=r[0],o=r[1];return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=o*t[3],e[4]=o*t[4],e[5]=o*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},t.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e},t.fromRotation=function(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=0,e[3]=-r,e[4]=i,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},t.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},t.fromMat2d=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e},t.fromQuat=function(e,t){var r=t[0],i=t[1],o=t[2],a=t[3],n=r+r,s=i+i,l=o+o,c=r*n,h=i*n,d=i*s,u=o*n,f=o*s,g=o*l,m=a*n,y=a*s,p=a*l;return e[0]=1-d-g,e[3]=h-p,e[6]=u+y,e[1]=h+p,e[4]=1-c-g,e[7]=f-m,e[2]=u-y,e[5]=f+m,e[8]=1-c-d,e},t.normalFromMat4=function(e,t){var r=t[0],i=t[1],o=t[2],a=t[3],n=t[4],s=t[5],l=t[6],c=t[7],h=t[8],d=t[9],u=t[10],f=t[11],g=t[12],m=t[13],y=t[14],p=t[15],v=r*s-i*n,_=r*l-o*n,x=r*c-a*n,b=i*l-o*s,C=i*c-a*s,M=o*c-a*l,A=h*m-d*g,R=h*y-u*g,S=h*p-f*g,T=d*y-u*m,P=d*p-f*m,L=u*p-f*y,w=v*L-_*P+x*T+b*S-C*R+M*A;return w?(w=1/w,e[0]=(s*L-l*P+c*T)*w,e[1]=(l*S-n*L-c*R)*w,e[2]=(n*P-s*S+c*A)*w,e[3]=(o*P-i*L-a*T)*w,e[4]=(r*L-o*S+a*R)*w,e[5]=(i*S-r*P-a*A)*w,e[6]=(m*M-y*C+p*b)*w,e[7]=(y*x-g*M-p*_)*w,e[8]=(g*C-m*x+p*v)*w,e):null},t.projection=function(e,t,r){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/r,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e},t.str=function(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"},t.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+Math.pow(e[6],2)+Math.pow(e[7],2)+Math.pow(e[8],2))},t.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e},t.subtract=o,t.multiplyScalar=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e},t.multiplyScalarAndAdd=function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e[4]=t[4]+r[4]*i,e[5]=t[5]+r[5]*i,e[6]=t[6]+r[6]*i,e[7]=t[7]+r[7]*i,e[8]=t[8]+r[8]*i,e},t.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]},t.equals=function(e,t){var r=e[0],i=e[1],o=e[2],n=e[3],s=e[4],l=e[5],c=e[6],h=e[7],d=e[8],u=t[0],f=t[1],g=t[2],m=t[3],y=t[4],p=t[5],v=t[6],_=t[7],x=t[8];return Math.abs(r-u)<=a.EPSILON*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(i-f)<=a.EPSILON*Math.max(1,Math.abs(i),Math.abs(f))&&Math.abs(o-g)<=a.EPSILON*Math.max(1,Math.abs(o),Math.abs(g))&&Math.abs(n-m)<=a.EPSILON*Math.max(1,Math.abs(n),Math.abs(m))&&Math.abs(s-y)<=a.EPSILON*Math.max(1,Math.abs(s),Math.abs(y))&&Math.abs(l-p)<=a.EPSILON*Math.max(1,Math.abs(l),Math.abs(p))&&Math.abs(c-v)<=a.EPSILON*Math.max(1,Math.abs(c),Math.abs(v))&&Math.abs(h-_)<=a.EPSILON*Math.max(1,Math.abs(h),Math.abs(_))&&Math.abs(d-x)<=a.EPSILON*Math.max(1,Math.abs(d),Math.abs(x))};var a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(0));t.mul=i,t.sub=o},function(e,t,r){function i(){var e=new g.ARRAY_TYPE(3);return e[0]=0,e[1]=0,e[2]=0,e}function o(e){var t=e[0],r=e[1],i=e[2];return Math.sqrt(t*t+r*r+i*i)}function a(e,t,r){var i=new g.ARRAY_TYPE(3);return i[0]=e,i[1]=t,i[2]=r,i}function n(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}function s(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e}function l(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e}function c(e,t){var r=t[0]-e[0],i=t[1]-e[1],o=t[2]-e[2];return Math.sqrt(r*r+i*i+o*o)}function h(e,t){var r=t[0]-e[0],i=t[1]-e[1],o=t[2]-e[2];return r*r+i*i+o*o}function d(e){var t=e[0],r=e[1],i=e[2];return t*t+r*r+i*i}function u(e,t){var r=t[0],i=t[1],o=t[2],a=r*r+i*i+o*o;return a>0&&(a=1/Math.sqrt(a),e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a),e}function f(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}Object.defineProperty(t,"__esModule",{value:!0}),t.forEach=t.sqrLen=t.len=t.sqrDist=t.dist=t.div=t.mul=t.sub=void 0,t.create=i,t.clone=function(e){var t=new g.ARRAY_TYPE(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},t.length=o,t.fromValues=a,t.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},t.set=function(e,t,r,i){return e[0]=t,e[1]=r,e[2]=i,e},t.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e},t.subtract=n,t.multiply=s,t.divide=l,t.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e},t.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e},t.min=function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e},t.max=function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e},t.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e},t.scale=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e},t.scaleAndAdd=function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e},t.distance=c,t.squaredDistance=h,t.squaredLength=d,t.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},t.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e},t.normalize=u,t.dot=f,t.cross=function(e,t,r){var i=t[0],o=t[1],a=t[2],n=r[0],s=r[1],l=r[2];return e[0]=o*l-a*s,e[1]=a*n-i*l,e[2]=i*s-o*n,e},t.lerp=function(e,t,r,i){var o=t[0],a=t[1],n=t[2];return e[0]=o+i*(r[0]-o),e[1]=a+i*(r[1]-a),e[2]=n+i*(r[2]-n),e},t.hermite=function(e,t,r,i,o,a){var n=a*a,s=n*(2*a-3)+1,l=n*(a-2)+a,c=n*(a-1),h=n*(3-2*a);return e[0]=t[0]*s+r[0]*l+i[0]*c+o[0]*h,e[1]=t[1]*s+r[1]*l+i[1]*c+o[1]*h,e[2]=t[2]*s+r[2]*l+i[2]*c+o[2]*h,e},t.bezier=function(e,t,r,i,o,a){var n=1-a,s=n*n,l=a*a,c=s*n,h=3*a*s,d=3*l*n,u=l*a;return e[0]=t[0]*c+r[0]*h+i[0]*d+o[0]*u,e[1]=t[1]*c+r[1]*h+i[1]*d+o[1]*u,e[2]=t[2]*c+r[2]*h+i[2]*d+o[2]*u,e},t.random=function(e,t){t=t||1;var r=2*g.RANDOM()*Math.PI,i=2*g.RANDOM()-1,o=Math.sqrt(1-i*i)*t;return e[0]=Math.cos(r)*o,e[1]=Math.sin(r)*o,e[2]=i*t,e},t.transformMat4=function(e,t,r){var i=t[0],o=t[1],a=t[2],n=r[3]*i+r[7]*o+r[11]*a+r[15];return n=n||1,e[0]=(r[0]*i+r[4]*o+r[8]*a+r[12])/n,e[1]=(r[1]*i+r[5]*o+r[9]*a+r[13])/n,e[2]=(r[2]*i+r[6]*o+r[10]*a+r[14])/n,e},t.transformMat3=function(e,t,r){var i=t[0],o=t[1],a=t[2];return e[0]=i*r[0]+o*r[3]+a*r[6],e[1]=i*r[1]+o*r[4]+a*r[7],e[2]=i*r[2]+o*r[5]+a*r[8],e},t.transformQuat=function(e,t,r){var i=t[0],o=t[1],a=t[2],n=r[0],s=r[1],l=r[2],c=r[3],h=c*i+s*a-l*o,d=c*o+l*i-n*a,u=c*a+n*o-s*i,f=-n*i-s*o-l*a;return e[0]=h*c+f*-n+d*-l-u*-s,e[1]=d*c+f*-s+u*-n-h*-l,e[2]=u*c+f*-l+h*-s-d*-n,e},t.rotateX=function(e,t,r,i){var o=[],a=[];return o[0]=t[0]-r[0],o[1]=t[1]-r[1],o[2]=t[2]-r[2],a[0]=o[0],a[1]=o[1]*Math.cos(i)-o[2]*Math.sin(i),a[2]=o[1]*Math.sin(i)+o[2]*Math.cos(i),e[0]=a[0]+r[0],e[1]=a[1]+r[1],e[2]=a[2]+r[2],e},t.rotateY=function(e,t,r,i){var o=[],a=[];return o[0]=t[0]-r[0],o[1]=t[1]-r[1],o[2]=t[2]-r[2],a[0]=o[2]*Math.sin(i)+o[0]*Math.cos(i),a[1]=o[1],a[2]=o[2]*Math.cos(i)-o[0]*Math.sin(i),e[0]=a[0]+r[0],e[1]=a[1]+r[1],e[2]=a[2]+r[2],e},t.rotateZ=function(e,t,r,i){var o=[],a=[];return o[0]=t[0]-r[0],o[1]=t[1]-r[1],o[2]=t[2]-r[2],a[0]=o[0]*Math.cos(i)-o[1]*Math.sin(i),a[1]=o[0]*Math.sin(i)+o[1]*Math.cos(i),a[2]=o[2],e[0]=a[0]+r[0],e[1]=a[1]+r[1],e[2]=a[2]+r[2],e},t.angle=function(e,t){var r=a(e[0],e[1],e[2]),i=a(t[0],t[1],t[2]);u(r,r),u(i,i);var o=f(r,i);return o>1?0:o<-1?Math.PI:Math.acos(o)},t.str=function(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"},t.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},t.equals=function(e,t){var r=e[0],i=e[1],o=e[2],a=t[0],n=t[1],s=t[2];return Math.abs(r-a)<=g.EPSILON*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(i-n)<=g.EPSILON*Math.max(1,Math.abs(i),Math.abs(n))&&Math.abs(o-s)<=g.EPSILON*Math.max(1,Math.abs(o),Math.abs(s))};var g=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(0));t.sub=n,t.mul=s,t.div=l,t.dist=c,t.sqrDist=h,t.len=o,t.sqrLen=d,t.forEach=function(){var e=i();return function(t,r,i,o,a,n){var s=void 0,l=void 0;for(r||(r=3),i||(i=0),l=o?Math.min(o*r+i,t.length):t.length,s=i;s<l;s+=r)e[0]=t[s],e[1]=t[s+1],e[2]=t[s+2],a(e,e,n),t[s]=e[0],t[s+1]=e[1],t[s+2]=e[2];return t}}()},function(e,t,r){function i(){var e=new f.ARRAY_TYPE(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function o(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}function a(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e[3]=t[3]*r[3],e}function n(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e[3]=t[3]/r[3],e}function s(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e}function l(e,t){var r=t[0]-e[0],i=t[1]-e[1],o=t[2]-e[2],a=t[3]-e[3];return Math.sqrt(r*r+i*i+o*o+a*a)}function c(e,t){var r=t[0]-e[0],i=t[1]-e[1],o=t[2]-e[2],a=t[3]-e[3];return r*r+i*i+o*o+a*a}function h(e){var t=e[0],r=e[1],i=e[2],o=e[3];return Math.sqrt(t*t+r*r+i*i+o*o)}function d(e){var t=e[0],r=e[1],i=e[2],o=e[3];return t*t+r*r+i*i+o*o}function u(e,t){var r=t[0],i=t[1],o=t[2],a=t[3],n=r*r+i*i+o*o+a*a;return n>0&&(n=1/Math.sqrt(n),e[0]=r*n,e[1]=i*n,e[2]=o*n,e[3]=a*n),e}Object.defineProperty(t,"__esModule",{value:!0}),t.forEach=t.sqrLen=t.len=t.sqrDist=t.dist=t.div=t.mul=t.sub=void 0,t.create=i,t.clone=function(e){var t=new f.ARRAY_TYPE(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},t.fromValues=function(e,t,r,i){var o=new f.ARRAY_TYPE(4);return o[0]=e,o[1]=t,o[2]=r,o[3]=i,o},t.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},t.set=function(e,t,r,i,o){return e[0]=t,e[1]=r,e[2]=i,e[3]=o,e},t.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e},t.subtract=o,t.multiply=a,t.divide=n,t.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e},t.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e},t.min=function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e[3]=Math.min(t[3],r[3]),e},t.max=function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e[3]=Math.max(t[3],r[3]),e},t.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e},t.scale=s,t.scaleAndAdd=function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e},t.distance=l,t.squaredDistance=c,t.length=h,t.squaredLength=d,t.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e},t.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e},t.normalize=u,t.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},t.lerp=function(e,t,r,i){var o=t[0],a=t[1],n=t[2],s=t[3];return e[0]=o+i*(r[0]-o),e[1]=a+i*(r[1]-a),e[2]=n+i*(r[2]-n),e[3]=s+i*(r[3]-s),e},t.random=function(e,t){return t=t||1,e[0]=f.RANDOM(),e[1]=f.RANDOM(),e[2]=f.RANDOM(),e[3]=f.RANDOM(),u(e,e),s(e,e,t),e},t.transformMat4=function(e,t,r){var i=t[0],o=t[1],a=t[2],n=t[3];return e[0]=r[0]*i+r[4]*o+r[8]*a+r[12]*n,e[1]=r[1]*i+r[5]*o+r[9]*a+r[13]*n,e[2]=r[2]*i+r[6]*o+r[10]*a+r[14]*n,e[3]=r[3]*i+r[7]*o+r[11]*a+r[15]*n,e},t.transformQuat=function(e,t,r){var i=t[0],o=t[1],a=t[2],n=r[0],s=r[1],l=r[2],c=r[3],h=c*i+s*a-l*o,d=c*o+l*i-n*a,u=c*a+n*o-s*i,f=-n*i-s*o-l*a;return e[0]=h*c+f*-n+d*-l-u*-s,e[1]=d*c+f*-s+u*-n-h*-l,e[2]=u*c+f*-l+h*-s-d*-n,e[3]=t[3],e},t.str=function(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},t.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},t.equals=function(e,t){var r=e[0],i=e[1],o=e[2],a=e[3],n=t[0],s=t[1],l=t[2],c=t[3];return Math.abs(r-n)<=f.EPSILON*Math.max(1,Math.abs(r),Math.abs(n))&&Math.abs(i-s)<=f.EPSILON*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(o-l)<=f.EPSILON*Math.max(1,Math.abs(o),Math.abs(l))&&Math.abs(a-c)<=f.EPSILON*Math.max(1,Math.abs(a),Math.abs(c))};var f=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(0));t.sub=o,t.mul=a,t.div=n,t.dist=l,t.sqrDist=c,t.len=h,t.sqrLen=d,t.forEach=function(){var e=i();return function(t,r,i,o,a,n){var s=void 0,l=void 0;for(r||(r=4),i||(i=0),l=o?Math.min(o*r+i,t.length):t.length,s=i;s<l;s+=r)e[0]=t[s],e[1]=t[s+1],e[2]=t[s+2],e[3]=t[s+3],a(e,e,n),t[s]=e[0],t[s+1]=e[1],t[s+2]=e[2],t[s+3]=e[3];return t}}()},function(e,t,r){function i(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}Object.defineProperty(t,"__esModule",{value:!0}),t.vec4=t.vec3=t.vec2=t.quat=t.mat4=t.mat3=t.mat2d=t.mat2=t.glMatrix=void 0;var o=i(r(0)),a=i(r(5)),n=i(r(6)),s=i(r(1)),l=i(r(7)),c=i(r(8)),h=i(r(9)),d=i(r(2)),u=i(r(3));t.glMatrix=o,t.mat2=a,t.mat2d=n,t.mat3=s,t.mat4=l,t.quat=c,t.vec2=h,t.vec3=d,t.vec4=u},function(e,t,r){function i(e,t,r){var i=t[0],o=t[1],a=t[2],n=t[3],s=r[0],l=r[1],c=r[2],h=r[3];return e[0]=i*s+a*l,e[1]=o*s+n*l,e[2]=i*c+a*h,e[3]=o*c+n*h,e}function o(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}Object.defineProperty(t,"__esModule",{value:!0}),t.sub=t.mul=void 0,t.create=function(){var e=new a.ARRAY_TYPE(4);return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},t.clone=function(e){var t=new a.ARRAY_TYPE(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},t.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},t.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},t.fromValues=function(e,t,r,i){var o=new a.ARRAY_TYPE(4);return o[0]=e,o[1]=t,o[2]=r,o[3]=i,o},t.set=function(e,t,r,i,o){return e[0]=t,e[1]=r,e[2]=i,e[3]=o,e},t.transpose=function(e,t){if(e===t){var r=t[1];e[1]=t[2],e[2]=r}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e},t.invert=function(e,t){var r=t[0],i=t[1],o=t[2],a=t[3],n=r*a-o*i;return n?(n=1/n,e[0]=a*n,e[1]=-i*n,e[2]=-o*n,e[3]=r*n,e):null},t.adjoint=function(e,t){var r=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=r,e},t.determinant=function(e){return e[0]*e[3]-e[2]*e[1]},t.multiply=i,t.rotate=function(e,t,r){var i=t[0],o=t[1],a=t[2],n=t[3],s=Math.sin(r),l=Math.cos(r);return e[0]=i*l+a*s,e[1]=o*l+n*s,e[2]=i*-s+a*l,e[3]=o*-s+n*l,e},t.scale=function(e,t,r){var i=t[0],o=t[1],a=t[2],n=t[3],s=r[0],l=r[1];return e[0]=i*s,e[1]=o*s,e[2]=a*l,e[3]=n*l,e},t.fromRotation=function(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=-r,e[3]=i,e},t.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e},t.str=function(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},t.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2))},t.LDU=function(e,t,r,i){return e[2]=i[2]/i[0],r[0]=i[0],r[1]=i[1],r[3]=i[3]-e[2]*r[1],[e,t,r]},t.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e},t.subtract=o,t.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},t.equals=function(e,t){var r=e[0],i=e[1],o=e[2],n=e[3],s=t[0],l=t[1],c=t[2],h=t[3];return Math.abs(r-s)<=a.EPSILON*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-l)<=a.EPSILON*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(o-c)<=a.EPSILON*Math.max(1,Math.abs(o),Math.abs(c))&&Math.abs(n-h)<=a.EPSILON*Math.max(1,Math.abs(n),Math.abs(h))},t.multiplyScalar=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e},t.multiplyScalarAndAdd=function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e};var a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(0));t.mul=i,t.sub=o},function(e,t,r){function i(e,t,r){var i=t[0],o=t[1],a=t[2],n=t[3],s=t[4],l=t[5],c=r[0],h=r[1],d=r[2],u=r[3],f=r[4],g=r[5];return e[0]=i*c+a*h,e[1]=o*c+n*h,e[2]=i*d+a*u,e[3]=o*d+n*u,e[4]=i*f+a*g+s,e[5]=o*f+n*g+l,e}function o(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e}Object.defineProperty(t,"__esModule",{value:!0}),t.sub=t.mul=void 0,t.create=function(){var e=new a.ARRAY_TYPE(6);return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},t.clone=function(e){var t=new a.ARRAY_TYPE(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},t.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},t.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},t.fromValues=function(e,t,r,i,o,n){var s=new a.ARRAY_TYPE(6);return s[0]=e,s[1]=t,s[2]=r,s[3]=i,s[4]=o,s[5]=n,s},t.set=function(e,t,r,i,o,a,n){return e[0]=t,e[1]=r,e[2]=i,e[3]=o,e[4]=a,e[5]=n,e},t.invert=function(e,t){var r=t[0],i=t[1],o=t[2],a=t[3],n=t[4],s=t[5],l=r*a-i*o;return l?(l=1/l,e[0]=a*l,e[1]=-i*l,e[2]=-o*l,e[3]=r*l,e[4]=(o*s-a*n)*l,e[5]=(i*n-r*s)*l,e):null},t.determinant=function(e){return e[0]*e[3]-e[1]*e[2]},t.multiply=i,t.rotate=function(e,t,r){var i=t[0],o=t[1],a=t[2],n=t[3],s=t[4],l=t[5],c=Math.sin(r),h=Math.cos(r);return e[0]=i*h+a*c,e[1]=o*h+n*c,e[2]=i*-c+a*h,e[3]=o*-c+n*h,e[4]=s,e[5]=l,e},t.scale=function(e,t,r){var i=t[0],o=t[1],a=t[2],n=t[3],s=t[4],l=t[5],c=r[0],h=r[1];return e[0]=i*c,e[1]=o*c,e[2]=a*h,e[3]=n*h,e[4]=s,e[5]=l,e},t.translate=function(e,t,r){var i=t[0],o=t[1],a=t[2],n=t[3],s=t[4],l=t[5],c=r[0],h=r[1];return e[0]=i,e[1]=o,e[2]=a,e[3]=n,e[4]=i*c+a*h+s,e[5]=o*c+n*h+l,e},t.fromRotation=function(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=-r,e[3]=i,e[4]=0,e[5]=0,e},t.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e},t.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e},t.str=function(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"},t.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+1)},t.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e},t.subtract=o,t.multiplyScalar=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e},t.multiplyScalarAndAdd=function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e[4]=t[4]+r[4]*i,e[5]=t[5]+r[5]*i,e},t.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]},t.equals=function(e,t){var r=e[0],i=e[1],o=e[2],n=e[3],s=e[4],l=e[5],c=t[0],h=t[1],d=t[2],u=t[3],f=t[4],g=t[5];return Math.abs(r-c)<=a.EPSILON*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(i-h)<=a.EPSILON*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(o-d)<=a.EPSILON*Math.max(1,Math.abs(o),Math.abs(d))&&Math.abs(n-u)<=a.EPSILON*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(s-f)<=a.EPSILON*Math.max(1,Math.abs(s),Math.abs(f))&&Math.abs(l-g)<=a.EPSILON*Math.max(1,Math.abs(l),Math.abs(g))};var a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(0));t.mul=i,t.sub=o},function(e,t,r){function i(e,t,r){var i=t[0],o=t[1],a=t[2],n=t[3],s=t[4],l=t[5],c=t[6],h=t[7],d=t[8],u=t[9],f=t[10],g=t[11],m=t[12],y=t[13],p=t[14],v=t[15],_=r[0],x=r[1],b=r[2],C=r[3];return e[0]=_*i+x*s+b*d+C*m,e[1]=_*o+x*l+b*u+C*y,e[2]=_*a+x*c+b*f+C*p,e[3]=_*n+x*h+b*g+C*v,_=r[4],x=r[5],b=r[6],C=r[7],e[4]=_*i+x*s+b*d+C*m,e[5]=_*o+x*l+b*u+C*y,e[6]=_*a+x*c+b*f+C*p,e[7]=_*n+x*h+b*g+C*v,_=r[8],x=r[9],b=r[10],C=r[11],e[8]=_*i+x*s+b*d+C*m,e[9]=_*o+x*l+b*u+C*y,e[10]=_*a+x*c+b*f+C*p,e[11]=_*n+x*h+b*g+C*v,_=r[12],x=r[13],b=r[14],C=r[15],e[12]=_*i+x*s+b*d+C*m,e[13]=_*o+x*l+b*u+C*y,e[14]=_*a+x*c+b*f+C*p,e[15]=_*n+x*h+b*g+C*v,e}function o(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e[9]=t[9]-r[9],e[10]=t[10]-r[10],e[11]=t[11]-r[11],e[12]=t[12]-r[12],e[13]=t[13]-r[13],e[14]=t[14]-r[14],e[15]=t[15]-r[15],e}Object.defineProperty(t,"__esModule",{value:!0}),t.sub=t.mul=void 0,t.create=function(){var e=new a.ARRAY_TYPE(16);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},t.clone=function(e){var t=new a.ARRAY_TYPE(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},t.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},t.fromValues=function(e,t,r,i,o,n,s,l,c,h,d,u,f,g,m,y){var p=new a.ARRAY_TYPE(16);return p[0]=e,p[1]=t,p[2]=r,p[3]=i,p[4]=o,p[5]=n,p[6]=s,p[7]=l,p[8]=c,p[9]=h,p[10]=d,p[11]=u,p[12]=f,p[13]=g,p[14]=m,p[15]=y,p},t.set=function(e,t,r,i,o,a,n,s,l,c,h,d,u,f,g,m,y){return e[0]=t,e[1]=r,e[2]=i,e[3]=o,e[4]=a,e[5]=n,e[6]=s,e[7]=l,e[8]=c,e[9]=h,e[10]=d,e[11]=u,e[12]=f,e[13]=g,e[14]=m,e[15]=y,e},t.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},t.transpose=function(e,t){if(e===t){var r=t[1],i=t[2],o=t[3],a=t[6],n=t[7],s=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=i,e[9]=a,e[11]=t[14],e[12]=o,e[13]=n,e[14]=s}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e},t.invert=function(e,t){var r=t[0],i=t[1],o=t[2],a=t[3],n=t[4],s=t[5],l=t[6],c=t[7],h=t[8],d=t[9],u=t[10],f=t[11],g=t[12],m=t[13],y=t[14],p=t[15],v=r*s-i*n,_=r*l-o*n,x=r*c-a*n,b=i*l-o*s,C=i*c-a*s,M=o*c-a*l,A=h*m-d*g,R=h*y-u*g,S=h*p-f*g,T=d*y-u*m,P=d*p-f*m,L=u*p-f*y,w=v*L-_*P+x*T+b*S-C*R+M*A;return w?(w=1/w,e[0]=(s*L-l*P+c*T)*w,e[1]=(o*P-i*L-a*T)*w,e[2]=(m*M-y*C+p*b)*w,e[3]=(u*C-d*M-f*b)*w,e[4]=(l*S-n*L-c*R)*w,e[5]=(r*L-o*S+a*R)*w,e[6]=(y*x-g*M-p*_)*w,e[7]=(h*M-u*x+f*_)*w,e[8]=(n*P-s*S+c*A)*w,e[9]=(i*S-r*P-a*A)*w,e[10]=(g*C-m*x+p*v)*w,e[11]=(d*x-h*C-f*v)*w,e[12]=(s*R-n*T-l*A)*w,e[13]=(r*T-i*R+o*A)*w,e[14]=(m*_-g*b-y*v)*w,e[15]=(h*b-d*_+u*v)*w,e):null},t.adjoint=function(e,t){var r=t[0],i=t[1],o=t[2],a=t[3],n=t[4],s=t[5],l=t[6],c=t[7],h=t[8],d=t[9],u=t[10],f=t[11],g=t[12],m=t[13],y=t[14],p=t[15];return e[0]=s*(u*p-f*y)-d*(l*p-c*y)+m*(l*f-c*u),e[1]=-(i*(u*p-f*y)-d*(o*p-a*y)+m*(o*f-a*u)),e[2]=i*(l*p-c*y)-s*(o*p-a*y)+m*(o*c-a*l),e[3]=-(i*(l*f-c*u)-s*(o*f-a*u)+d*(o*c-a*l)),e[4]=-(n*(u*p-f*y)-h*(l*p-c*y)+g*(l*f-c*u)),e[5]=r*(u*p-f*y)-h*(o*p-a*y)+g*(o*f-a*u),e[6]=-(r*(l*p-c*y)-n*(o*p-a*y)+g*(o*c-a*l)),e[7]=r*(l*f-c*u)-n*(o*f-a*u)+h*(o*c-a*l),e[8]=n*(d*p-f*m)-h*(s*p-c*m)+g*(s*f-c*d),e[9]=-(r*(d*p-f*m)-h*(i*p-a*m)+g*(i*f-a*d)),e[10]=r*(s*p-c*m)-n*(i*p-a*m)+g*(i*c-a*s),e[11]=-(r*(s*f-c*d)-n*(i*f-a*d)+h*(i*c-a*s)),e[12]=-(n*(d*y-u*m)-h*(s*y-l*m)+g*(s*u-l*d)),e[13]=r*(d*y-u*m)-h*(i*y-o*m)+g*(i*u-o*d),e[14]=-(r*(s*y-l*m)-n*(i*y-o*m)+g*(i*l-o*s)),e[15]=r*(s*u-l*d)-n*(i*u-o*d)+h*(i*l-o*s),e},t.determinant=function(e){var t=e[0],r=e[1],i=e[2],o=e[3],a=e[4],n=e[5],s=e[6],l=e[7],c=e[8],h=e[9],d=e[10],u=e[11],f=e[12],g=e[13],m=e[14],y=e[15];return(t*n-r*a)*(d*y-u*m)-(t*s-i*a)*(h*y-u*g)+(t*l-o*a)*(h*m-d*g)+(r*s-i*n)*(c*y-u*f)-(r*l-o*n)*(c*m-d*f)+(i*l-o*s)*(c*g-h*f)},t.multiply=i,t.translate=function(e,t,r){var i=r[0],o=r[1],a=r[2],n=void 0,s=void 0,l=void 0,c=void 0,h=void 0,d=void 0,u=void 0,f=void 0,g=void 0,m=void 0,y=void 0,p=void 0;return t===e?(e[12]=t[0]*i+t[4]*o+t[8]*a+t[12],e[13]=t[1]*i+t[5]*o+t[9]*a+t[13],e[14]=t[2]*i+t[6]*o+t[10]*a+t[14],e[15]=t[3]*i+t[7]*o+t[11]*a+t[15]):(n=t[0],s=t[1],l=t[2],c=t[3],h=t[4],d=t[5],u=t[6],f=t[7],g=t[8],m=t[9],y=t[10],p=t[11],e[0]=n,e[1]=s,e[2]=l,e[3]=c,e[4]=h,e[5]=d,e[6]=u,e[7]=f,e[8]=g,e[9]=m,e[10]=y,e[11]=p,e[12]=n*i+h*o+g*a+t[12],e[13]=s*i+d*o+m*a+t[13],e[14]=l*i+u*o+y*a+t[14],e[15]=c*i+f*o+p*a+t[15]),e},t.scale=function(e,t,r){var i=r[0],o=r[1],a=r[2];return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*o,e[5]=t[5]*o,e[6]=t[6]*o,e[7]=t[7]*o,e[8]=t[8]*a,e[9]=t[9]*a,e[10]=t[10]*a,e[11]=t[11]*a,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},t.rotate=function(e,t,r,i){var o=i[0],n=i[1],s=i[2],l=Math.sqrt(o*o+n*n+s*s),c=void 0,h=void 0,d=void 0,u=void 0,f=void 0,g=void 0,m=void 0,y=void 0,p=void 0,v=void 0,_=void 0,x=void 0,b=void 0,C=void 0,M=void 0,A=void 0,R=void 0,S=void 0,T=void 0,P=void 0,L=void 0,w=void 0,E=void 0,I=void 0;return Math.abs(l)<a.EPSILON?null:(l=1/l,o*=l,n*=l,s*=l,c=Math.sin(r),h=Math.cos(r),d=1-h,u=t[0],f=t[1],g=t[2],m=t[3],y=t[4],p=t[5],v=t[6],_=t[7],x=t[8],b=t[9],C=t[10],M=t[11],A=o*o*d+h,R=n*o*d+s*c,S=s*o*d-n*c,T=o*n*d-s*c,P=n*n*d+h,L=s*n*d+o*c,w=o*s*d+n*c,E=n*s*d-o*c,I=s*s*d+h,e[0]=u*A+y*R+x*S,e[1]=f*A+p*R+b*S,e[2]=g*A+v*R+C*S,e[3]=m*A+_*R+M*S,e[4]=u*T+y*P+x*L,e[5]=f*T+p*P+b*L,e[6]=g*T+v*P+C*L,e[7]=m*T+_*P+M*L,e[8]=u*w+y*E+x*I,e[9]=f*w+p*E+b*I,e[10]=g*w+v*E+C*I,e[11]=m*w+_*E+M*I,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)},t.rotateX=function(e,t,r){var i=Math.sin(r),o=Math.cos(r),a=t[4],n=t[5],s=t[6],l=t[7],c=t[8],h=t[9],d=t[10],u=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=a*o+c*i,e[5]=n*o+h*i,e[6]=s*o+d*i,e[7]=l*o+u*i,e[8]=c*o-a*i,e[9]=h*o-n*i,e[10]=d*o-s*i,e[11]=u*o-l*i,e},t.rotateY=function(e,t,r){var i=Math.sin(r),o=Math.cos(r),a=t[0],n=t[1],s=t[2],l=t[3],c=t[8],h=t[9],d=t[10],u=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*o-c*i,e[1]=n*o-h*i,e[2]=s*o-d*i,e[3]=l*o-u*i,e[8]=a*i+c*o,e[9]=n*i+h*o,e[10]=s*i+d*o,e[11]=l*i+u*o,e},t.rotateZ=function(e,t,r){var i=Math.sin(r),o=Math.cos(r),a=t[0],n=t[1],s=t[2],l=t[3],c=t[4],h=t[5],d=t[6],u=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*o+c*i,e[1]=n*o+h*i,e[2]=s*o+d*i,e[3]=l*o+u*i,e[4]=c*o-a*i,e[5]=h*o-n*i,e[6]=d*o-s*i,e[7]=u*o-l*i,e},t.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e},t.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},t.fromRotation=function(e,t,r){var i=r[0],o=r[1],n=r[2],s=Math.sqrt(i*i+o*o+n*n),l=void 0,c=void 0,h=void 0;return Math.abs(s)<a.EPSILON?null:(s=1/s,i*=s,o*=s,n*=s,l=Math.sin(t),c=Math.cos(t),h=1-c,e[0]=i*i*h+c,e[1]=o*i*h+n*l,e[2]=n*i*h-o*l,e[3]=0,e[4]=i*o*h-n*l,e[5]=o*o*h+c,e[6]=n*o*h+i*l,e[7]=0,e[8]=i*n*h+o*l,e[9]=o*n*h-i*l,e[10]=n*n*h+c,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)},t.fromXRotation=function(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},t.fromYRotation=function(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},t.fromZRotation=function(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},t.fromRotationTranslation=function(e,t,r){var i=t[0],o=t[1],a=t[2],n=t[3],s=i+i,l=o+o,c=a+a,h=i*s,d=i*l,u=i*c,f=o*l,g=o*c,m=a*c,y=n*s,p=n*l,v=n*c;return e[0]=1-(f+m),e[1]=d+v,e[2]=u-p,e[3]=0,e[4]=d-v,e[5]=1-(h+m),e[6]=g+y,e[7]=0,e[8]=u+p,e[9]=g-y,e[10]=1-(h+f),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e},t.getTranslation=function(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e},t.getScaling=function(e,t){var r=t[0],i=t[1],o=t[2],a=t[4],n=t[5],s=t[6],l=t[8],c=t[9],h=t[10];return e[0]=Math.sqrt(r*r+i*i+o*o),e[1]=Math.sqrt(a*a+n*n+s*s),e[2]=Math.sqrt(l*l+c*c+h*h),e},t.getRotation=function(e,t){var r=t[0]+t[5]+t[10],i=0;return r>0?(i=2*Math.sqrt(r+1),e[3]=.25*i,e[0]=(t[6]-t[9])/i,e[1]=(t[8]-t[2])/i,e[2]=(t[1]-t[4])/i):t[0]>t[5]&t[0]>t[10]?(i=2*Math.sqrt(1+t[0]-t[5]-t[10]),e[3]=(t[6]-t[9])/i,e[0]=.25*i,e[1]=(t[1]+t[4])/i,e[2]=(t[8]+t[2])/i):t[5]>t[10]?(i=2*Math.sqrt(1+t[5]-t[0]-t[10]),e[3]=(t[8]-t[2])/i,e[0]=(t[1]+t[4])/i,e[1]=.25*i,e[2]=(t[6]+t[9])/i):(i=2*Math.sqrt(1+t[10]-t[0]-t[5]),e[3]=(t[1]-t[4])/i,e[0]=(t[8]+t[2])/i,e[1]=(t[6]+t[9])/i,e[2]=.25*i),e},t.fromRotationTranslationScale=function(e,t,r,i){var o=t[0],a=t[1],n=t[2],s=t[3],l=o+o,c=a+a,h=n+n,d=o*l,u=o*c,f=o*h,g=a*c,m=a*h,y=n*h,p=s*l,v=s*c,_=s*h,x=i[0],b=i[1],C=i[2];return e[0]=(1-(g+y))*x,e[1]=(u+_)*x,e[2]=(f-v)*x,e[3]=0,e[4]=(u-_)*b,e[5]=(1-(d+y))*b,e[6]=(m+p)*b,e[7]=0,e[8]=(f+v)*C,e[9]=(m-p)*C,e[10]=(1-(d+g))*C,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e},t.fromRotationTranslationScaleOrigin=function(e,t,r,i,o){var a=t[0],n=t[1],s=t[2],l=t[3],c=a+a,h=n+n,d=s+s,u=a*c,f=a*h,g=a*d,m=n*h,y=n*d,p=s*d,v=l*c,_=l*h,x=l*d,b=i[0],C=i[1],M=i[2],A=o[0],R=o[1],S=o[2];return e[0]=(1-(m+p))*b,e[1]=(f+x)*b,e[2]=(g-_)*b,e[3]=0,e[4]=(f-x)*C,e[5]=(1-(u+p))*C,e[6]=(y+v)*C,e[7]=0,e[8]=(g+_)*M,e[9]=(y-v)*M,e[10]=(1-(u+m))*M,e[11]=0,e[12]=r[0]+A-(e[0]*A+e[4]*R+e[8]*S),e[13]=r[1]+R-(e[1]*A+e[5]*R+e[9]*S),e[14]=r[2]+S-(e[2]*A+e[6]*R+e[10]*S),e[15]=1,e},t.fromQuat=function(e,t){var r=t[0],i=t[1],o=t[2],a=t[3],n=r+r,s=i+i,l=o+o,c=r*n,h=i*n,d=i*s,u=o*n,f=o*s,g=o*l,m=a*n,y=a*s,p=a*l;return e[0]=1-d-g,e[1]=h+p,e[2]=u-y,e[3]=0,e[4]=h-p,e[5]=1-c-g,e[6]=f+m,e[7]=0,e[8]=u+y,e[9]=f-m,e[10]=1-c-d,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},t.frustum=function(e,t,r,i,o,a,n){var s=1/(r-t),l=1/(o-i),c=1/(a-n);return e[0]=2*a*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*a*l,e[6]=0,e[7]=0,e[8]=(r+t)*s,e[9]=(o+i)*l,e[10]=(n+a)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=n*a*2*c,e[15]=0,e},t.perspective=function(e,t,r,i,o){var a=1/Math.tan(t/2),n=1/(i-o);return e[0]=a/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=(o+i)*n,e[11]=-1,e[12]=0,e[13]=0,e[14]=2*o*i*n,e[15]=0,e},t.perspectiveFromFieldOfView=function(e,t,r,i){var o=Math.tan(t.upDegrees*Math.PI/180),a=Math.tan(t.downDegrees*Math.PI/180),n=Math.tan(t.leftDegrees*Math.PI/180),s=Math.tan(t.rightDegrees*Math.PI/180),l=2/(n+s),c=2/(o+a);return e[0]=l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=c,e[6]=0,e[7]=0,e[8]=-(n-s)*l*.5,e[9]=(o-a)*c*.5,e[10]=i/(r-i),e[11]=-1,e[12]=0,e[13]=0,e[14]=i*r/(r-i),e[15]=0,e},t.ortho=function(e,t,r,i,o,a,n){var s=1/(t-r),l=1/(i-o),c=1/(a-n);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+r)*s,e[13]=(o+i)*l,e[14]=(n+a)*c,e[15]=1,e},t.lookAt=function(e,t,r,i){var o=void 0,n=void 0,s=void 0,l=void 0,c=void 0,h=void 0,d=void 0,u=void 0,f=void 0,g=void 0,m=t[0],y=t[1],p=t[2],v=i[0],_=i[1],x=i[2],b=r[0],C=r[1],M=r[2];return Math.abs(m-b)<a.EPSILON&&Math.abs(y-C)<a.EPSILON&&Math.abs(p-M)<a.EPSILON?mat4.identity(e):(d=m-b,u=y-C,f=p-M,g=1/Math.sqrt(d*d+u*u+f*f),d*=g,u*=g,f*=g,o=_*f-x*u,n=x*d-v*f,s=v*u-_*d,(g=Math.sqrt(o*o+n*n+s*s))?(o*=g=1/g,n*=g,s*=g):(o=0,n=0,s=0),l=u*s-f*n,c=f*o-d*s,h=d*n-u*o,(g=Math.sqrt(l*l+c*c+h*h))?(l*=g=1/g,c*=g,h*=g):(l=0,c=0,h=0),e[0]=o,e[1]=l,e[2]=d,e[3]=0,e[4]=n,e[5]=c,e[6]=u,e[7]=0,e[8]=s,e[9]=h,e[10]=f,e[11]=0,e[12]=-(o*m+n*y+s*p),e[13]=-(l*m+c*y+h*p),e[14]=-(d*m+u*y+f*p),e[15]=1,e)},t.targetTo=function(e,t,r,i){var o=t[0],a=t[1],n=t[2],s=i[0],l=i[1],c=i[2],h=o-r[0],d=a-r[1],u=n-r[2],f=h*h+d*d+u*u;f>0&&(h*=f=1/Math.sqrt(f),d*=f,u*=f);var g=l*u-c*d,m=c*h-s*u,y=s*d-l*h;return e[0]=g,e[1]=m,e[2]=y,e[3]=0,e[4]=d*y-u*m,e[5]=u*g-h*y,e[6]=h*m-d*g,e[7]=0,e[8]=h,e[9]=d,e[10]=u,e[11]=0,e[12]=o,e[13]=a,e[14]=n,e[15]=1,e},t.str=function(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"},t.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+Math.pow(e[6],2)+Math.pow(e[7],2)+Math.pow(e[8],2)+Math.pow(e[9],2)+Math.pow(e[10],2)+Math.pow(e[11],2)+Math.pow(e[12],2)+Math.pow(e[13],2)+Math.pow(e[14],2)+Math.pow(e[15],2))},t.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e[9]=t[9]+r[9],e[10]=t[10]+r[10],e[11]=t[11]+r[11],e[12]=t[12]+r[12],e[13]=t[13]+r[13],e[14]=t[14]+r[14],e[15]=t[15]+r[15],e},t.subtract=o,t.multiplyScalar=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12]*r,e[13]=t[13]*r,e[14]=t[14]*r,e[15]=t[15]*r,e},t.multiplyScalarAndAdd=function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e[4]=t[4]+r[4]*i,e[5]=t[5]+r[5]*i,e[6]=t[6]+r[6]*i,e[7]=t[7]+r[7]*i,e[8]=t[8]+r[8]*i,e[9]=t[9]+r[9]*i,e[10]=t[10]+r[10]*i,e[11]=t[11]+r[11]*i,e[12]=t[12]+r[12]*i,e[13]=t[13]+r[13]*i,e[14]=t[14]+r[14]*i,e[15]=t[15]+r[15]*i,e},t.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]},t.equals=function(e,t){var r=e[0],i=e[1],o=e[2],n=e[3],s=e[4],l=e[5],c=e[6],h=e[7],d=e[8],u=e[9],f=e[10],g=e[11],m=e[12],y=e[13],p=e[14],v=e[15],_=t[0],x=t[1],b=t[2],C=t[3],M=t[4],A=t[5],R=t[6],S=t[7],T=t[8],P=t[9],L=t[10],w=t[11],E=t[12],I=t[13],D=t[14],B=t[15];return Math.abs(r-_)<=a.EPSILON*Math.max(1,Math.abs(r),Math.abs(_))&&Math.abs(i-x)<=a.EPSILON*Math.max(1,Math.abs(i),Math.abs(x))&&Math.abs(o-b)<=a.EPSILON*Math.max(1,Math.abs(o),Math.abs(b))&&Math.abs(n-C)<=a.EPSILON*Math.max(1,Math.abs(n),Math.abs(C))&&Math.abs(s-M)<=a.EPSILON*Math.max(1,Math.abs(s),Math.abs(M))&&Math.abs(l-A)<=a.EPSILON*Math.max(1,Math.abs(l),Math.abs(A))&&Math.abs(c-R)<=a.EPSILON*Math.max(1,Math.abs(c),Math.abs(R))&&Math.abs(h-S)<=a.EPSILON*Math.max(1,Math.abs(h),Math.abs(S))&&Math.abs(d-T)<=a.EPSILON*Math.max(1,Math.abs(d),Math.abs(T))&&Math.abs(u-P)<=a.EPSILON*Math.max(1,Math.abs(u),Math.abs(P))&&Math.abs(f-L)<=a.EPSILON*Math.max(1,Math.abs(f),Math.abs(L))&&Math.abs(g-w)<=a.EPSILON*Math.max(1,Math.abs(g),Math.abs(w))&&Math.abs(m-E)<=a.EPSILON*Math.max(1,Math.abs(m),Math.abs(E))&&Math.abs(y-I)<=a.EPSILON*Math.max(1,Math.abs(y),Math.abs(I))&&Math.abs(p-D)<=a.EPSILON*Math.max(1,Math.abs(p),Math.abs(D))&&Math.abs(v-B)<=a.EPSILON*Math.max(1,Math.abs(v),Math.abs(B))};var a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(0));t.mul=i,t.sub=o},function(e,t,r){function i(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function o(){var e=new c.ARRAY_TYPE(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function a(e,t,r){r*=.5;var i=Math.sin(r);return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=Math.cos(r),e}function n(e,t,r){var i=t[0],o=t[1],a=t[2],n=t[3],s=r[0],l=r[1],c=r[2],h=r[3];return e[0]=i*h+n*s+o*c-a*l,e[1]=o*h+n*l+a*s-i*c,e[2]=a*h+n*c+i*l-o*s,e[3]=n*h-i*s-o*l-a*c,e}function s(e,t,r,i){var o=t[0],a=t[1],n=t[2],s=t[3],l=r[0],c=r[1],h=r[2],d=r[3],u=void 0,f=void 0,g=void 0,m=void 0,y=void 0;return(f=o*l+a*c+n*h+s*d)<0&&(f=-f,l=-l,c=-c,h=-h,d=-d),1-f>1e-6?(u=Math.acos(f),g=Math.sin(u),m=Math.sin((1-i)*u)/g,y=Math.sin(i*u)/g):(m=1-i,y=i),e[0]=m*o+y*l,e[1]=m*a+y*c,e[2]=m*n+y*h,e[3]=m*s+y*d,e}function l(e,t){var r=t[0]+t[4]+t[8],i=void 0;if(r>0)i=Math.sqrt(r+1),e[3]=.5*i,i=.5/i,e[0]=(t[5]-t[7])*i,e[1]=(t[6]-t[2])*i,e[2]=(t[1]-t[3])*i;else{var o=0;t[4]>t[0]&&(o=1),t[8]>t[3*o+o]&&(o=2);var a=(o+1)%3,n=(o+2)%3;i=Math.sqrt(t[3*o+o]-t[3*a+a]-t[3*n+n]+1),e[o]=.5*i,i=.5/i,e[3]=(t[3*a+n]-t[3*n+a])*i,e[a]=(t[3*a+o]+t[3*o+a])*i,e[n]=(t[3*n+o]+t[3*o+n])*i}return e}Object.defineProperty(t,"__esModule",{value:!0}),t.setAxes=t.sqlerp=t.rotationTo=t.equals=t.exactEquals=t.normalize=t.sqrLen=t.squaredLength=t.len=t.length=t.lerp=t.dot=t.scale=t.mul=t.add=t.set=t.copy=t.fromValues=t.clone=void 0,t.create=o,t.identity=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},t.setAxisAngle=a,t.getAxisAngle=function(e,t){var r=2*Math.acos(t[3]),i=Math.sin(r/2);return 0!=i?(e[0]=t[0]/i,e[1]=t[1]/i,e[2]=t[2]/i):(e[0]=1,e[1]=0,e[2]=0),r},t.multiply=n,t.rotateX=function(e,t,r){r*=.5;var i=t[0],o=t[1],a=t[2],n=t[3],s=Math.sin(r),l=Math.cos(r);return e[0]=i*l+n*s,e[1]=o*l+a*s,e[2]=a*l-o*s,e[3]=n*l-i*s,e},t.rotateY=function(e,t,r){r*=.5;var i=t[0],o=t[1],a=t[2],n=t[3],s=Math.sin(r),l=Math.cos(r);return e[0]=i*l-a*s,e[1]=o*l+n*s,e[2]=a*l+i*s,e[3]=n*l-o*s,e},t.rotateZ=function(e,t,r){r*=.5;var i=t[0],o=t[1],a=t[2],n=t[3],s=Math.sin(r),l=Math.cos(r);return e[0]=i*l+o*s,e[1]=o*l-i*s,e[2]=a*l+n*s,e[3]=n*l-a*s,e},t.calculateW=function(e,t){var r=t[0],i=t[1],o=t[2];return e[0]=r,e[1]=i,e[2]=o,e[3]=Math.sqrt(Math.abs(1-r*r-i*i-o*o)),e},t.slerp=s,t.invert=function(e,t){var r=t[0],i=t[1],o=t[2],a=t[3],n=r*r+i*i+o*o+a*a,s=n?1/n:0;return e[0]=-r*s,e[1]=-i*s,e[2]=-o*s,e[3]=a*s,e},t.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},t.fromMat3=l,t.fromEuler=function(e,t,r,i){var o=.5*Math.PI/180;t*=o,r*=o,i*=o;var a=Math.sin(t),n=Math.cos(t),s=Math.sin(r),l=Math.cos(r),c=Math.sin(i),h=Math.cos(i);return e[0]=a*l*h-n*s*c,e[1]=n*s*h+a*l*c,e[2]=n*l*c-a*s*h,e[3]=n*l*h+a*s*c,e},t.str=function(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"};var c=i(r(0)),h=i(r(1)),d=i(r(2)),u=i(r(3)),f=(t.clone=u.clone,t.fromValues=u.fromValues,t.copy=u.copy,t.set=u.set,t.add=u.add,t.mul=n,t.scale=u.scale,t.dot=u.dot,t.lerp=u.lerp,t.length=u.length),g=(t.len=f,t.squaredLength=u.squaredLength),m=(t.sqrLen=g,t.normalize=u.normalize);t.exactEquals=u.exactEquals,t.equals=u.equals,t.rotationTo=function(){var e=d.create(),t=d.fromValues(1,0,0),r=d.fromValues(0,1,0);return function(i,o,n){var s=d.dot(o,n);return s<-.999999?(d.cross(e,t,o),d.len(e)<1e-6&&d.cross(e,r,o),d.normalize(e,e),a(i,e,Math.PI),i):s>.999999?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(d.cross(e,o,n),i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=1+s,m(i,i))}}(),t.sqlerp=function(){var e=o(),t=o();return function(r,i,o,a,n,l){return s(e,i,n,l),s(t,o,a,l),s(r,e,t,2*l*(1-l)),r}}(),t.setAxes=function(){var e=h.create();return function(t,r,i,o){return e[0]=i[0],e[3]=i[1],e[6]=i[2],e[1]=o[0],e[4]=o[1],e[7]=o[2],e[2]=-r[0],e[5]=-r[1],e[8]=-r[2],m(t,l(t,e))}}()},function(e,t,r){function i(){var e=new d.ARRAY_TYPE(2);return e[0]=0,e[1]=0,e}function o(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e}function a(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e}function n(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e}function s(e,t){var r=t[0]-e[0],i=t[1]-e[1];return Math.sqrt(r*r+i*i)}function l(e,t){var r=t[0]-e[0],i=t[1]-e[1];return r*r+i*i}function c(e){var t=e[0],r=e[1];return Math.sqrt(t*t+r*r)}function h(e){var t=e[0],r=e[1];return t*t+r*r}Object.defineProperty(t,"__esModule",{value:!0}),t.forEach=t.sqrLen=t.sqrDist=t.dist=t.div=t.mul=t.sub=t.len=void 0,t.create=i,t.clone=function(e){var t=new d.ARRAY_TYPE(2);return t[0]=e[0],t[1]=e[1],t},t.fromValues=function(e,t){var r=new d.ARRAY_TYPE(2);return r[0]=e,r[1]=t,r},t.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e},t.set=function(e,t,r){return e[0]=t,e[1]=r,e},t.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e},t.subtract=o,t.multiply=a,t.divide=n,t.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e},t.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e},t.min=function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e},t.max=function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e},t.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e},t.scale=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e},t.scaleAndAdd=function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e},t.distance=s,t.squaredDistance=l,t.length=c,t.squaredLength=h,t.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e},t.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e},t.normalize=function(e,t){var r=t[0],i=t[1],o=r*r+i*i;return o>0&&(o=1/Math.sqrt(o),e[0]=t[0]*o,e[1]=t[1]*o),e},t.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]},t.cross=function(e,t,r){var i=t[0]*r[1]-t[1]*r[0];return e[0]=e[1]=0,e[2]=i,e},t.lerp=function(e,t,r,i){var o=t[0],a=t[1];return e[0]=o+i*(r[0]-o),e[1]=a+i*(r[1]-a),e},t.random=function(e,t){t=t||1;var r=2*d.RANDOM()*Math.PI;return e[0]=Math.cos(r)*t,e[1]=Math.sin(r)*t,e},t.transformMat2=function(e,t,r){var i=t[0],o=t[1];return e[0]=r[0]*i+r[2]*o,e[1]=r[1]*i+r[3]*o,e},t.transformMat2d=function(e,t,r){var i=t[0],o=t[1];return e[0]=r[0]*i+r[2]*o+r[4],e[1]=r[1]*i+r[3]*o+r[5],e},t.transformMat3=function(e,t,r){var i=t[0],o=t[1];return e[0]=r[0]*i+r[3]*o+r[6],e[1]=r[1]*i+r[4]*o+r[7],e},t.transformMat4=function(e,t,r){var i=t[0],o=t[1];return e[0]=r[0]*i+r[4]*o+r[12],e[1]=r[1]*i+r[5]*o+r[13],e},t.str=function(e){return"vec2("+e[0]+", "+e[1]+")"},t.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]},t.equals=function(e,t){var r=e[0],i=e[1],o=t[0],a=t[1];return Math.abs(r-o)<=d.EPSILON*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-a)<=d.EPSILON*Math.max(1,Math.abs(i),Math.abs(a))};var d=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(0));t.len=c,t.sub=o,t.mul=a,t.div=n,t.dist=s,t.sqrDist=l,t.sqrLen=h,t.forEach=function(){var e=i();return function(t,r,i,o,a,n){var s=void 0,l=void 0;for(r||(r=2),i||(i=0),l=o?Math.min(o*r+i,t.length):t.length,s=i;s<l;s+=r)e[0]=t[s],e[1]=t[s+1],a(e,e,n),t[s]=e[0],t[s+1]=e[1];return t}}()}])}),function(e){function t(){if(1==arguments.length){var e=arguments[0];this.header=r(e),s(this.header),l(this.header)}}function r(e){return{idLength:i(e.idLength,0),colorMapType:i(e.colorMapType,0),imageType:i(e.imageType,t.Type.RGB),colorMapIndex:i(e.colorMapIndex,0),colorMapLength:i(e.colorMapLength,0),colorMapDepth:i(e.colorMapDepth,0),offsetX:i(e.offsetX,0),offsetY:i(e.offsetY,0),width:i(e.width,0),height:i(e.height,0),pixelDepth:i(e.pixelDepth,32),flags:i(e.flags,8)}}function i(e,t){return void 0!==e?e:t}function o(e){for(var r=t.SIGNATURE,i=e.byteLength-r.length,o=0;o<r.length;o++)e[i+o]=r.charCodeAt(o)}function a(e,r){var i=t.LITTLE_ENDIAN;r.setUint8(0,e.idLength),r.setUint8(1,e.colorMapType),r.setUint8(2,e.imageType),r.setUint16(3,e.colorMapIndex,i),r.setUint16(5,e.colorMapLength,i),r.setUint8(7,e.colorMapDepth),r.setUint16(8,e.offsetX,i),r.setUint16(10,e.offsetY,i),r.setUint16(12,e.width,i),r.setUint16(14,e.height,i),r.setUint8(16,e.pixelDepth),r.setUint8(17,e.flags)}function n(e){var r=t.LITTLE_ENDIAN;if(e.byteLength<18)throw new Error("Targa::load() - Not enough data to contain header");var i={};return i.idLength=e.getUint8(0),i.colorMapType=e.getUint8(1),i.imageType=e.getUint8(2),i.colorMapIndex=e.getUint16(3,r),i.colorMapLength=e.getUint16(5,r),i.colorMapDepth=e.getUint8(7),i.offsetX=e.getUint16(8,r),i.offsetY=e.getUint16(10,r),i.width=e.getUint16(12,r),i.height=e.getUint16(14,r),i.pixelDepth=e.getUint8(16),i.flags=e.getUint8(17),i}function s(e){e.hasEncoding=e.imageType===t.Type.RLE_INDEXED||e.imageType===t.Type.RLE_RGB||e.imageType===t.Type.RLE_GREY,e.hasColorMap=e.imageType===t.Type.RLE_INDEXED||e.imageType===t.Type.INDEXED,e.isGreyColor=e.imageType===t.Type.RLE_GREY||e.imageType===t.Type.GREY,e.bytePerPixel=e.pixelDepth>>3,e.origin=(e.flags&t.Origin.MASK)>>t.Origin.SHIFT,e.alphaBits=e.flags&t.Origin.ALPHA}function l(e){if(e.imageType===t.Type.NO_DATA)throw new Error("Targa::checkHeader() - No data");if(e.hasColorMap){if(e.colorMapLength>256||1!==e.colorMapType)throw new Error("Targa::checkHeader() - Unsupported colormap for indexed type");if(16!==e.colorMapDepth&&24!==e.colorMapDepth&&32!==e.colorMapDepth)throw new Error("Targa::checkHeader() - Unsupported colormap depth")}else if(e.colorMapType)throw new Error("Targa::checkHeader() - Why does the image contain a palette ?");if(e.width<=0||e.height<=0)throw new Error("Targa::checkHeader() - Invalid image size");if(8!==e.pixelDepth&&16!==e.pixelDepth&&24!==e.pixelDepth&&32!==e.pixelDepth)throw new Error('Targa::checkHeader() - Invalid pixel size "'+e.pixelDepth+'"');if(0!==e.alphaBits&&1!==e.alphaBits&&8!==e.alphaBits)throw new Error("Targa::checkHeader() - Unsuppported alpha size")}function c(e,r,i){var o,a,n,s,l,c,h;for(h=new Uint8Array(i),c=new Uint8Array(r),l=0,o=0;o<i;)if(a=e[l++],n=1+(a&t.RLE_MASK),a&t.RLE_BIT){for(s=0;s<r;++s)c[s]=e[l++];for(s=0;s<n;++s)h.set(c,o),o+=r}else for(n*=r,s=0;s<n;++s)h[o++]=e[l++];if(o>i)throw new Error("Targa::decodeRLE() - Read bytes: "+o+" Expected bytes: "+i);return h}function h(e,r){for(var i,o,a,n,s=r,l=[],c=0,h=e.pixelDepth>>3,d=0,u=e.width*e.height*h,f=function(e,t){for(var r=0;r<h;r++)if(s[e*h+r]!==s[t*h+r])return!1;return!0},g=function(e){return f(e,e+1)?t.RLE_PACKET:t.RAW_PACKET};c*h<s.length&&c*h<u;){if(o=g(c),a=0,o===t.RLE_PACKET)for(;c+a<s.length&&a<128&&f(c,c+a);)a++;else for(;c+a<s.length&&a<128&&g(c+a)===t.RAW_PACKET;)a++;if(n=a-1,o===t.RLE_PACKET&&(n|=t.RLE_BIT),l[d++]=n,o===t.RLE_PACKET){for(i=0;i<h;i++)l[i+d]=s[i+c*h];d+=h}else{for(i=0;i<h*a;i++)l[i+d]=s[i+c*h];d+=h*a}c+=a}return new Uint8Array(l)}function d(e,t,r,i,o,a,n,s,l,c){var h,d,u,f,g,m,y=this.header.colorMapDepth>>3;for(f=0,m=o;m!==n;m+=a)for(g=s;g!==c;g+=l,f++)u=4*(g+i*m),d=t[f]*y,4===y?(e[u]=r[d+2],e[u+1]=r[d+1],e[u+2]=r[d],e[u+3]=r[d+3]):3===y?(e[u]=r[d+2],e[u+1]=r[d+1],e[u+2]=r[d],e[u+3]=255):2===y&&(h=r[d]|r[d+1]<<8,e[u]=(31744&h)>>7,e[u+1]=(992&h)>>2,e[u+2]=(31&h)<<3,e[u+3]=32768&h?0:255);return e}function u(e,t,r,i,o,a,n,s,l,c){var h,d,u,f,g;for(u=0,g=o;g!==n;g+=a)for(f=s;f!==c;f+=l,u+=2)h=t[u]|t[u+1]<<8,e[d=4*(f+i*g)]=(31744&h)>>7,e[d+1]=(992&h)>>2,e[d+2]=(31&h)<<3,e[d+3]=32768&h?0:255;return e}function f(e,t,r,i,o,a,n,s,l,c){var h,d,u,f,g=this.header.pixelDepth>>3;for(d=0,f=o;f!==n;f+=a)for(u=s;u!==c;u+=l,d+=g)e[(h=4*(u+i*f))+3]=255,e[h+2]=t[d],e[h+1]=t[d+1],e[h]=t[d+2];return e}function g(e,t,r,i,o,a,n,s,l,c){var h,d,u,f;for(h=0,u=o;u!==n;u+=a)for(d=s;d!==c;d+=l,h+=4)e[(f=4*(d+i*u))+2]=t[h],e[f+1]=t[h+1],e[f]=t[h+2],e[f+3]=t[h+3];return e}function m(e,t,r,i,o,a,n,s,l,c){var h,d,u,f,g;for(h=0,u=o;u!==n;u+=a)for(d=s;d!==c;d+=l,h+=4)f=4*(d+i*u),g=255*t[h+3],e[f+2]=t[h]/g,e[f+1]=t[h+1]/g,e[f]=t[h+2]/g,e[f+3]=t[h+3];return e}function y(e,t,r,i,o,a,n,s,l,c){var h,d,u,f,g;for(u=0,g=o;g!==n;g+=a)for(f=s;f!==c;f+=l,u++)h=t[u],e[d=4*(f+i*g)]=h,e[d+1]=h,e[d+2]=h,e[d+3]=255;return e}function p(e,t,r,i,o,a,n,s,l,c){var h,d,u,f,g;for(u=0,g=o;g!==n;g+=a)for(f=s;f!==c;f+=l,u+=2)h=t[u],e[d=4*(f+i*g)]=h,e[d+1]=h,e[d+2]=h,e[d+3]=t[u+1];return e}function v(e){var r=e.byteLength-t.FOOTER_SIZE,i=t.SIGNATURE,o={},a=new Uint8Array(e.buffer,r+8,i.length);return _(String.fromCharCode.apply(null,a))?(o.hasFooter=!0,o.extensionOffset=e.getUint32(r,t.LITTLE_ENDIAN),o.developerOffset=e.getUint32(r+4,t.LITTLE_ENDIAN),o.hasExtensionArea=0!==o.extensionOffset,o.hasDeveloperArea=0!==o.developerOffset,o.extensionOffset&&(o.attributeType=e.getUint8(o.extensionOffset+494)),o):(o.hasFooter=!1,o)}function _(e){for(var r=t.SIGNATURE,i=0;i<r.length;i++)if(e.charCodeAt(i)!==r.charCodeAt(i))return!1;return!0}t.Type={NO_DATA:0,INDEXED:1,RGB:2,GREY:3,RLE_INDEXED:9,RLE_RGB:10,RLE_GREY:11},t.Origin={BOTTOM_LEFT:0,BOTTOM_RIGHT:1,TOP_LEFT:2,TOP_RIGHT:3,SHIFT:4,MASK:48,ALPHA:8},t.HEADER_SIZE=18,t.FOOTER_SIZE=26,t.LITTLE_ENDIAN=!0,t.RLE_BIT=128,t.RLE_MASK=127,t.RLE_PACKET=1,t.RAW_PACKET=2,t.SIGNATURE="TRUEVISION-XFILE.\0",t.prototype.open=function(e,t){var r,i=this;(r=new XMLHttpRequest).open("GET",e,!0),r.responseType="arraybuffer",r.onload=function(){200===this.status&&(i.arrayBuffer=r.response,i.load(i.arrayBuffer),t&&t.call(i))},r.send(null)},t.prototype.load=function(e){var r=new DataView(e);this.headerData=new Uint8Array(e,0,t.HEADER_SIZE),this.header=n(r),s(this.header),l(this.header);var i=t.HEADER_SIZE;if((i+=this.header.idLength)>=e.byteLength)throw new Error("Targa::load() - No data");if(this.header.hasColorMap){var o=this.header.colorMapLength*(this.header.colorMapDepth>>3);this.palette=new Uint8Array(e,i,o),i+=o}var a=this.header.pixelDepth>>3,h=this.header.width*this.header.height,d=h*a;if(this.header.hasEncoding){var u=e.byteLength-i-t.FOOTER_SIZE,f=new Uint8Array(e,i,u);this.imageData=c(f,a,d)}else this.imageData=new Uint8Array(e,i,this.header.hasColorMap?h:d);this.footer=v(r),(0!==this.header.alphaBits||this.footer.hasExtensionArea&&(3===this.footer.attributeType||4===this.footer.attributeType))&&(this.footer.usesAlpha=!0)},t.prototype.getImageData=function(e){var r,i,o,a,n,s,l,c=this.header.width,h=this.header.height,v=(this.header.flags&t.Origin.MASK)>>t.Origin.SHIFT;switch(e||(e=document?document.createElement("canvas").getContext("2d").createImageData(c,h):{width:c,height:h,data:new Uint8ClampedArray(c*h*4)}),v===t.Origin.TOP_LEFT||v===t.Origin.TOP_RIGHT?(a=0,n=1,s=h):(a=h-1,n=-1,s=-1),v===t.Origin.TOP_LEFT||v===t.Origin.BOTTOM_LEFT?(r=0,i=1,o=c):(r=c-1,i=-1,o=-1),this.header.pixelDepth){case 8:l=this.header.isGreyColor?y:d;break;case 16:l=this.header.isGreyColor?p:u;break;case 24:l=f;break;case 32:l=this.footer.hasExtensionArea?3===this.footer.attributeType?g:4===this.footer.attributeType?m:f:0!==this.header.alphaBits?g:f}return l.call(this,e.data,this.imageData,this.palette,c,a,n,s,r,i,o),e},t.prototype.setImageData=function(e){if(!e)throw new Error("Targa::setImageData() - imageData argument missing");var r,i,n,s,l,c,d=this.header.width,u=this.header.height,f=d*u*(this.header.pixelDepth>>3),m=(this.header.flags&t.Origin.MASK)>>t.Origin.SHIFT;m===t.Origin.TOP_LEFT||m===t.Origin.TOP_RIGHT?(s=0,l=1,c=u):(s=u-1,l=-1,c=-1),m===t.Origin.TOP_LEFT||m===t.Origin.BOTTOM_LEFT?(r=0,i=1,n=d):(r=d-1,i=-1,n=-1),this.imageData||(this.imageData=new Uint8Array(f)),g(this.imageData,e.data,this.palette,d,s,l,c,r,i,n);var y=this.imageData;this.header.hasEncoding&&(y=h(this.header,y));var p=t.HEADER_SIZE+y.length+t.FOOTER_SIZE,v=new ArrayBuffer(p);this.arrayBuffer=v,this.headerData=new Uint8Array(v,0,t.HEADER_SIZE),this.RLEData=new Uint8Array(v,t.HEADER_SIZE,y.length),this.footerData=new Uint8Array(v,t.HEADER_SIZE+y.length,t.FOOTER_SIZE);var _=new DataView(this.headerData.buffer);a(this.header,_),this.RLEData.set(y),o(this.footerData)},t.prototype.getCanvas=function(){var e,t,r;return e=document.createElement("canvas"),t=e.getContext("2d"),r=t.createImageData(this.header.width,this.header.height),e.width=this.header.width,e.height=this.header.height,t.putImageData(this.getImageData(r),0,0),e},t.prototype.getDataURL=function(e){return this.getCanvas().toDataURL(e||"image/png")},t.prototype.getBlobURL=function(){if(!this.arrayBuffer)throw new Error("Targa::getBlobURL() - No data available for blob");var e=new Blob([this.arrayBuffer],{type:"image/x-tga"});return URL.createObjectURL(e)};var x={};"undefined"==typeof exports?"function"==typeof define&&"object"==typeof define.amd&&define.amd?define(function(){return t}):x.exports="undefined"!=typeof window?window:e:x.exports=exports,x.exports&&(x.exports.TGA=t)}(this),API.prototype.getMagoEnable=function(){return this.magoEnable},API.prototype.setMagoEnable=function(e){this.magoEnable=e},API.prototype.getAPIName=function(){return this.apiName},API.prototype.getProjectId=function(){return this.projectId},API.prototype.setProjectId=function(e){this.projectId=e},API.prototype.getBlockId=function(){return this.blockId},API.prototype.setBlockId=function(e){this.blockId=e},API.prototype.getBlockIds=function(){return this.blockIds},API.prototype.setBlockIds=function(e){this.blockIds=e},API.prototype.getObjectIds=function(){return this.objectIds},API.prototype.setObjectIds=function(e){this.objectIds=e},API.prototype.getIssueId=function(){return this.issueId},API.prototype.setIssueId=function(e){this.issueId=e},API.prototype.getIssueType=function(){return this.issueType},API.prototype.setIssueType=function(e){this.issueId=e},API.prototype.getDataKey=function(){return this.dataKey},API.prototype.setDataKey=function(e){this.dataKey=e},API.prototype.getRenderMode=function(){return this.renderMode},API.prototype.setRenderMode=function(e){this.renderMode=e},API.prototype.getLatitude=function(){return this.latitude},API.prototype.setLatitude=function(e){this.latitude=e},API.prototype.getLongitude=function(){return this.longitude},API.prototype.setLongitude=function(e){this.longitude=e},API.prototype.getElevation=function(){return this.elevation},API.prototype.setElevation=function(e){this.elevation=e},API.prototype.getHeading=function(){return this.heading},API.prototype.setHeading=function(e){this.heading=e},API.prototype.getPitch=function(){return this.pitch},API.prototype.setPitch=function(e){this.pitch=e},API.prototype.getRoll=function(){return this.roll},API.prototype.setRoll=function(e){this.roll=e},API.prototype.getColor=function(){return this.color},API.prototype.setColor=function(e){this.color=e},API.prototype.getBlockType=function(){return this.blockType},API.prototype.setBlockType=function(e){this.blockType=e},API.prototype.getShowOutFitting=function(){return this.showOutFitting},API.prototype.setShowOutFitting=function(e){this.showOutFitting=e},API.prototype.getShowLabelInfo=function(){return this.showLabelInfo},API.prototype.setShowLabelInfo=function(e){this.showLabelInfo=e},API.prototype.getShowBoundingBox=function(){return this.showBoundingBox},API.prototype.setShowBoundingBox=function(e){this.showBoundingBox=e},API.prototype.getShowShadow=function(){return this.showShadow},API.prototype.setShowShadow=function(e){this.showShadow=e},API.prototype.getFrustumFarDistance=function(){return this.frustumFarDistance},API.prototype.setFrustumFarDistance=function(e){this.frustumFarDistance=e},API.prototype.getMouseMoveMode=function(){return this.mouseMoveMode},API.prototype.setMouseMoveMode=function(e){this.mouseMoveMode=e},API.prototype.getIssueInsertEnable=function(){return this.issueInsertEnable},API.prototype.setIssueInsertEnable=function(e){this.issueInsertEnable=e},API.prototype.getObjectInfoViewEnable=function(){return this.objectInfoViewEnable},API.prototype.setObjectInfoViewEnable=function(e){this.objectInfoViewEnable=e},API.prototype.getOcclusionCullingEnable=function(){return this.occlusionCullingEnable},API.prototype.setOcclusionCullingEnable=function(e){this.occlusionCullingEnable=e},API.prototype.getNearGeoIssueListEnable=function(){return this.nearGeoIssueListEnable},API.prototype.setNearGeoIssueListEnable=function(e){this.nearGeoIssueListEnable=e},API.prototype.getInsertIssueState=function(){return this.insertIssueState},API.prototype.setInsertIssueState=function(e){this.insertIssueState=e},API.prototype.getDrawType=function(){return this.drawType},API.prototype.setDrawType=function(e){this.drawType=e},API.prototype.getLod0DistInMeters=function(){return this.lod0DistInMeters},API.prototype.setLod0DistInMeters=function(e){this.lod0DistInMeters=e},API.prototype.getLod1DistInMeters=function(){return this.lod1DistInMeters},API.prototype.setLod1DistInMeters=function(e){this.lod1DistInMeters=e},API.prototype.getLod2DistInMeters=function(){return this.lod2DistInMeters},API.prototype.setLod2DistInMeters=function(e){this.lod2DistInMeters=e},API.prototype.getLod3DistInMeters=function(){return this.lod3DistInMeters},API.prototype.setLod3DistInMeters=function(e){this.lod3DistInMeters=e},API.prototype.getAmbientReflectionCoef=function(){return this.ambientReflectionCoef},API.prototype.setAmbientReflectionCoef=function(e){this.ambientReflectionCoef=e},API.prototype.getDiffuseReflectionCoef=function(){return this.diffuseReflectionCoef},API.prototype.setDiffuseReflectionCoef=function(e){this.diffuseReflectionCoef=e},API.prototype.getSpecularReflectionCoef=function(){return this.specularReflectionCoef},API.prototype.setSpecularReflectionCoef=function(e){this.specularReflectionCoef=e},API.prototype.getAmbientColor=function(){return this.ambientColor},API.prototype.setAmbientColor=function(e){this.ambientColor=e},API.prototype.getSpecularColor=function(){return this.specularColor},API.prototype.setSpecularColor=function(e){this.specularColor=e},API.prototype.getSsaoRadius=function(){return this.ssaoRadius},API.prototype.setSsaoRadius=function(e){this.ssaoRadius=e},API.prototype.getFPVMode=function(){return this.FPVMode},API.prototype.setFPVMode=function(e){this.FPVMode=e};var MagoConfig={};MagoConfig.getPolicy=function(){return this.serverPolicy},MagoConfig.getData=function(){return this.serverData},MagoConfig.init=function(e,t){this.serverPolicy=e,this.serverData=t};var Policy=function(){if(!(this instanceof Policy))throw new Error(Messages.CONSTRUCT_ERROR);this.magoEnable=!0,this.showOutFitting=!1,this.showLabelInfo=!1,this.showBoundingBox=!1,this.showShadow=!1,this.frustumFarSquaredDistance=5e6,this.frustumFarDistance=2300,this.highLightedBuildings=[],this.colorBuildings=[],this.color=[],this.hideBuildings=[],this.mouseMoveMode=CODE.moveMode.NONE,this.issueInsertEnable=!1,this.objectInfoViewEnable=!1,this.nearGeoIssueListEnable=!1,this.occlusionCullingEnable=!1,this.imagePath="",this.colorChangedObjectId,this.lod0DistInMeters=22,this.lod1DistInMeters=70,this.lod2DistInMeters=22360,this.lod3DistInMeters=6e4,this.ambientReflectionCoef=.2,this.diffuseReflectionCoef=1,this.specularReflectionCoef=.7,this.ambientColor=null,this.specularColor=new Float32Array([.7,.7,.7]),this.ssaoRadius=.15};Policy.prototype.getMagoEnable=function(){return this.magoEnable},Policy.prototype.setMagoEnable=function(e){this.magoEnable=e},Policy.prototype.getShowOutFitting=function(){return this.showOutFitting},Policy.prototype.setShowOutFitting=function(e){this.showOutFitting=e},Policy.prototype.getShowLabelInfo=function(){return this.showLabelInfo},Policy.prototype.setShowLabelInfo=function(e){this.showLabelInfo=e},Policy.prototype.getShowBoundingBox=function(){return this.showBoundingBox},Policy.prototype.setShowBoundingBox=function(e){this.showBoundingBox=e},Policy.prototype.getShowShadow=function(){return this.showShadow},Policy.prototype.setShowShadow=function(e){this.showShadow=e},Policy.prototype.getFrustumFarSquaredDistance=function(){return this.frustumFarSquaredDistance},Policy.prototype.setFrustumFarSquaredDistance=function(e){this.frustumFarSquaredDistance=e},Policy.prototype.getFrustumFarDistance=function(){return this.frustumFarDistance},Policy.prototype.setFrustumFarDistance=function(e){this.frustumFarDistance=e},Policy.prototype.getHighLightedBuildings=function(){return this.highLightedBuildings},Policy.prototype.setHighLightedBuildings=function(e){this.highLightedBuildings=e},Policy.prototype.getColorBuildings=function(){return this.colorBuildings},Policy.prototype.setColorBuildings=function(e){this.colorBuildings=e},Policy.prototype.getColor=function(){return this.color},Policy.prototype.setColor=function(e){this.color=e},Policy.prototype.getHideBuildings=function(){return this.hideBuildings},Policy.prototype.setHideBuildings=function(e){this.hideBuildings=e},Policy.prototype.getMouseMoveMode=function(){return this.mouseMoveMode},Policy.prototype.setMouseMoveMode=function(e){this.mouseMoveMode=e},Policy.prototype.getIssueInsertEnable=function(){return this.issueInsertEnable},Policy.prototype.setIssueInsertEnable=function(e){this.issueInsertEnable=e},Policy.prototype.getObjectInfoViewEnable=function(){return this.objectInfoViewEnable},Policy.prototype.setObjectInfoViewEnable=function(e){this.objectInfoViewEnable=e},Policy.prototype.getOcclusionCullingEnable=function(){return this.occlusionCullingEnable},Policy.prototype.setOcclusionCullingEnable=function(e){this.occlusionCullingEnable=e},Policy.prototype.getNearGeoIssueListEnable=function(){return this.nearGeoIssueListEnable},Policy.prototype.setNearGeoIssueListEnable=function(e){this.nearGeoIssueListEnable=e},Policy.prototype.getImagePath=function(){return this.imagePath},Policy.prototype.setImagePath=function(e){this.imagePath=e},Policy.prototype.getLod0DistInMeters=function(){return this.lod0DistInMeters},Policy.prototype.setLod0DistInMeters=function(e){this.lod0DistInMeters=e},Policy.prototype.getLod1DistInMeters=function(){return this.lod1DistInMeters},Policy.prototype.setLod1DistInMeters=function(e){this.lod1DistInMeters=e},Policy.prototype.getLod2DistInMeters=function(){return this.lod2DistInMeters},Policy.prototype.setLod2DistInMeters=function(e){this.lod2DistInMeters=e},Policy.prototype.getLod3DistInMeters=function(){return this.lod3DistInMeters},Policy.prototype.setLod3DistInMeters=function(e){this.lod3DistInMeters=e},Policy.prototype.getAmbientReflectionCoef=function(){return this.ambientReflectionCoef},Policy.prototype.setAmbientReflectionCoef=function(e){this.ambientReflectionCoef=e},Policy.prototype.getDiffuseReflectionCoef=function(){return this.diffuseReflectionCoef},Policy.prototype.setDiffuseReflectionCoef=function(e){this.diffuseReflectionCoef=e},Policy.prototype.getSpecularReflectionCoef=function(){return this.specularReflectionCoef},Policy.prototype.setSpecularReflectionCoef=function(e){this.specularReflectionCoef=e},Policy.prototype.getAmbientColor=function(){return this.ambientColor},Policy.prototype.setAmbientColor=function(e){this.ambientColor=e},Policy.prototype.getSpecularColor=function(){return this.specularColor},Policy.prototype.setSpecularColor=function(e){this.specularColor=e},Policy.prototype.getSsaoRadius=function(){return this.ssaoRadius},Policy.prototype.setSsaoRadius=function(e){this.ssaoRadius=e};var ProjectLayer=function(){if(!(this instanceof ProjectLayer))throw new Error(Messages.CONSTRUCT_ERROR);this.projectId=null,this.blockId=null,this.objectId=null};ProjectLayer.prototype.getProjectId=function(){return this.projectId},ProjectLayer.prototype.setProjectId=function(e){this.projectId=e},ProjectLayer.prototype.getBlockId=function(){return this.blockId},ProjectLayer.prototype.setBlockId=function(e){this.blockId=e},ProjectLayer.prototype.getObjectId=function(){return this.objectId},ProjectLayer.prototype.setObjectId=function(e){this.objectId=e};var Accessor=function(){if(!(this instanceof Accessor))throw new Error(Messages.CONSTRUCT_ERROR);this.bufferId,this.accesorType,this.bufferStart,this.stride,this.dataType,this.dimension,this.minX=0,this.minY=0,this.minZ=0,this.maxX=0,this.maxY=0,this.maxZ=0},Block=function(){if(!(this instanceof Block))throw new Error(Messages.CONSTRUCT_ERROR);this.vBOVertexIdxCacheKeysContainer=new VBOVertexIdxCacheKeysContainer,this.mIFCEntityType=-1,this.isSmallObj=!1,this.radius=10,this.vertexCount=0,this.lego};Block.prototype.deleteObjects=function(e,t){this.vBOVertexIdxCacheKeysContainer.deleteGlObjects(e,t),this.vBOVertexIdxCacheKeysContainer=void 0,this.mIFCEntityType=void 0,this.isSmallObj=void 0,this.radius=void 0,this.vertexCount=void 0,this.lego&&this.lego.deleteGlObjects(e),this.lego=void 0};var BlocksList=function(){if(!(this instanceof BlocksList))throw new Error(Messages.CONSTRUCT_ERROR);this.name="",this.blocksArray,this.fileLoadState=CODE.fileLoadState.READY,this.dataArraybuffer};BlocksList.prototype.newBlock=function(){void 0===this.blocksArray&&(this.blocksArray=[]);var e=new Block;return this.blocksArray.push(e),e},BlocksList.prototype.getBlock=function(e){return void 0===this.blocksArray?null:e>=0&&e<this.blocksArray.length?this.blocksArray[e]:null},BlocksList.prototype.deleteGlObjects=function(e,t){if(void 0!==this.blocksArray){for(var r=0,i=this.blocksArray.length;r<i;r++){var o=this.blocksArray[r];o.vBOVertexIdxCacheKeysContainer.deleteGlObjects(e,t),o.vBOVertexIdxCacheKeysContainer=void 0,o.mIFCEntityType=void 0,o.isSmallObj=void 0,o.radius=void 0,o.vertexCount=void 0,o.lego&&(o.lego.vbo_vicks_container.deleteGlObjects(e,t),o.lego.vbo_vicks_container=void 0),o.lego=void 0,this.blocksArray[r]=void 0}this.blocksArray=void 0,this.name=void 0,this.fileLoadState=void 0,this.dataArraybuffer=void 0}},BlocksList.prototype.stepOverBlockVersioned=function(e,t,r){var i,o,a,n,s=r.readInt32(e,t,t+4);t+=4;for(var l=0;l<s;l++)i=r.readUInt32(e,t,t+4),t+=4,t+4*(o=3*i),t+=4*o,i=r.readUInt32(e,t,t+4),t+=4,t+=1*(3*i),a=r.readUInt32(e,t,t+4),t+=4,n=r.readUInt8(e,t,t+1),t+=1,t+=4*n,t+=4*n,t+=2*a;return t},BlocksList.prototype.parseBlockVersioned=function(e,t,r,i,o){var a,n,s,l,c,h,d,u,f=o.vboMemoryManager,g=i.readInt32(e,t,t+4);t+=4;for(var m=0;m<g;m++){var y=i.readUInt32(e,t,t+4);t+=4;var p=3*y;a=4*p,l=f.getClassifiedBufferSize(a),r.vertexCount=y,d=t,u=t+4*p;var v=r.vBOVertexIdxCacheKeysContainer.newVBOVertexIdxCacheKey();v.posVboDataArray=new Float32Array(l),v.posVboDataArray.set(new Float32Array(e.slice(d,u))),v.posArrayByteSize=l,t+=4*p,y=i.readUInt32(e,t,t+4),t+=4;var _=3*y;n=1*_,c=f.getClassifiedBufferSize(n),d=t,u=t+1*_,v.norVboDataArray=new Int8Array(c),v.norVboDataArray.set(new Int8Array(e.slice(d,u))),v.norArrayByteSize=c,t+=1*_;var x=i.readUInt32(e,t,t+4);t+=4,s=2*x,h=f.getClassifiedBufferSize(s);var b=i.readUInt8(e,t,t+1);t+=1;for(var C=[],M=0;M<b;M++)C.push(new Float32Array(e.slice(t,t+4))),t+=4;for(var A=[],M=0;M<b;M++)A.push(i.readUInt32(e,t,t+4)),t+=4;var R=A[b-1];v.bigTrianglesIndicesCount=R,d=t,u=t+2*x,v.idxVboDataArray=new Int16Array(h),v.idxVboDataArray.set(new Int16Array(e.slice(d,u))),v.idxArrayByteSize=h,t+=2*x,v.indicesCount=x}return t},BlocksList.prototype.parseBlocksListVersioned=function(e,t,r,i){this.fileLoadState=CODE.fileLoadState.PARSE_STARTED;var o=0,a=(i.vboMemoryManager,i.sceneState.gl),n=!0;String.fromCharCode.apply(null,new Int8Array(e.slice(o,o+5)));o+=5;var s=t.readUInt32(e,o,o+4);o+=4;for(var l=0;l<s;l++){var c=t.readInt32(e,o,o+4);if(o+=4,r[c]){o+=24,o=this.stepOverBlockVersioned(e,o,t);y=t.readUInt8(e,o,o+1);o+=1,y&&(o=this.stepOverBlockVersioned(e,o,t))}else{var h=new Block;h.idx=c,r[c]=h;var d=new BoundingBox;d.minX=new Float32Array(e.slice(o,o+4)),o+=4,d.minY=new Float32Array(e.slice(o,o+4)),o+=4,d.minZ=new Float32Array(e.slice(o,o+4)),o+=4,d.maxX=new Float32Array(e.slice(o,o+4)),o+=4,d.maxY=new Float32Array(e.slice(o,o+4)),o+=4,d.maxZ=new Float32Array(e.slice(o,o+4)),o+=4;var u=d.getMaxLength();h.isSmallObj=u<.5,h.radius=u/2,d.deleteObjects(),d=void 0,o=this.parseBlockVersioned(e,o,h,t,i);for(var f=h.vBOVertexIdxCacheKeysContainer.vboCacheKeysArray.length,g=0;g<f;g++){var m=h.vBOVertexIdxCacheKeysContainer.vboCacheKeysArray[g];m.isReadyPositions(a,i.vboMemoryManager)||(n=!1),m.isReadyNormals(a,i.vboMemoryManager)||(n=!1),m.isReadyFaces(a,i.vboMemoryManager)||(n=!1)}var y=t.readUInt8(e,o,o+1);o+=1,y&&(void 0===h.lego&&(h.lego=new Lego),o=this.parseBlockVersioned(e,o,h.lego,t,i))}}return this.fileLoadState=CODE.fileLoadState.PARSE_FINISHED,n},BlocksList.prototype.parseBlocksList=function(e,t,r,i){this.fileLoadState=CODE.fileLoadState.PARSE_STARTED;var o=0,a=t.readUInt32(e,o,o+4);o+=4;for(var n,s,l,c,h,d=i.vboMemoryManager,u=0,f=0,g=0,m=i.sceneState.gl,y=!0,p=0;p<a;p++){var v=t.readInt32(e,o,o+4);if(o+=4,r[v]){o+=24;M=t.readInt32(e,o,o+4);o+=4;for(A=0;A<M;A++){R=t.readUInt32(e,o,o+4);n=o+=4,s=o+4*(S=3*R),o+=4*S,R=t.readUInt32(e,o,o+4),o+=4,o+=1*(P=3*R);var _=t.readUInt32(e,o,o+4);o+=4;L=t.readUInt8(e,o,o+1);o+=1,o+=4*L,o+=4*L,o+=2*_}}else{var x=new Block;if(x.idx=v,r[v]=x,1202==v);var b=new BoundingBox;b.minX=new Float32Array(e.slice(o,o+4)),o+=4,b.minY=new Float32Array(e.slice(o,o+4)),o+=4,b.minZ=new Float32Array(e.slice(o,o+4)),o+=4,b.maxX=new Float32Array(e.slice(o,o+4)),o+=4,b.maxY=new Float32Array(e.slice(o,o+4)),o+=4,b.maxZ=new Float32Array(e.slice(o,o+4)),o+=4;var C=b.getMaxLength();x.isSmallObj=C<.5,x.radius=C/2,b.deleteObjects(),b=void 0;var M=t.readInt32(e,o,o+4);o+=4;for(var A=0;A<M;A++){var R=t.readUInt32(e,o,o+4);o+=4;var S=3*R;l=4*S,u=d.getClassifiedBufferSize(l),x.vertexCount=R,n=o,s=o+4*S;var T=x.vBOVertexIdxCacheKeysContainer.newVBOVertexIdxCacheKey();T.posVboDataArray=new Float32Array(u),T.posVboDataArray.set(new Float32Array(e.slice(n,s))),T.posArrayByteSize=u,o+=4*S,R=t.readUInt32(e,o,o+4),o+=4;var P=3*R;c=1*P,f=d.getClassifiedBufferSize(c),n=o,s=o+1*P,T.norVboDataArray=new Int8Array(f),T.norVboDataArray.set(new Int8Array(e.slice(n,s))),T.norArrayByteSize=f,o+=1*P,h=2*(_=t.readUInt32(e,o,o+4)),g=d.getClassifiedBufferSize(h),o+=4;var L=t.readUInt8(e,o,o+1);o+=1;for(var w=[],E=0;E<L;E++)w.push(new Float32Array(e.slice(o,o+4))),o+=4;for(var I=[],E=0;E<L;E++)I.push(t.readUInt32(e,o,o+4)),o+=4;var D=I[L-1];T.bigTrianglesIndicesCount=D,n=o,s=o+2*_,T.idxVboDataArray=new Int16Array(g),T.idxVboDataArray.set(new Int16Array(e.slice(n,s))),T.idxArrayByteSize=g,o+=2*_,T.indicesCount=_,T.isReadyPositions(m,i.vboMemoryManager)||(y=!1),T.isReadyNormals(m,i.vboMemoryManager)||(y=!1),T.isReadyFaces(m,i.vboMemoryManager)||(y=!1)}}}return this.fileLoadState=CODE.fileLoadState.PARSE_FINISHED,y};var BlocksListsContainer=function(){if(!(this instanceof BlocksListsContainer))throw new Error(Messages.CONSTRUCT_ERROR);this.blocksListsArray=[]};BlocksListsContainer.prototype.newBlocksList=function(e){var t=new BlocksList;return t.name=e,this.blocksListsArray.push(t),t},BlocksListsContainer.prototype.getBlockList=function(e){for(var t=this.blocksListsArray.length,r=!1,i=0,o=null;!r&&i<t;){var a=this.blocksListsArray[i];a.name===e&&(r=!0,o=a),i++}return o};var HierarchyManager=function(){if(!(this instanceof HierarchyManager))throw new Error(Messages.CONSTRUCT_ERROR);this.motherProjectTreesArray=[]};HierarchyManager.prototype.newProjectTree=function(){var e=new ProjectTree;return this.motherProjectTreesArray.push(e),e};var Lego=function(){if(!(this instanceof Lego))throw new Error(Messages.CONSTRUCT_ERROR);this.vbo_vicks_container=new VBOVertexIdxCacheKeysContainer,this.fileLoadState=CODE.fileLoadState.READY,this.dataArrayBuffer,this.selColor4};Lego.prototype.parseArrayBuffer=function(e,t,r){this.parseLegoData(t,e,r)},Lego.prototype.deleteObjects=function(e,t){this.vbo_vicks_container.deleteGlObjects(e,t),this.vbo_vicks_container=void 0,this.fileLoadState=void 0,this.dataArrayBuffer=void 0,void 0!==this.selColor4&&(this.selColor4.deleteObjects(),this.selColor4=void 0)},Lego.prototype.parseLegoData=function(e,t,r){if(this.fileLoadState===CODE.fileLoadState.LOADING_FINISHED){var i=r.vboMemoryManager,o=new DataStream(e,0,DataStream.LITTLE_ENDIAN);this.fileLoadState=CODE.fileLoadState.PARSE_STARTED;var a=new BoundingBox,n=this.vbo_vicks_container.newVBOVertexIdxCacheKey();a.minX=o.readFloat32(),a.minY=o.readFloat32(),a.minZ=o.readFloat32(),a.maxX=o.readFloat32(),a.maxY=o.readFloat32(),a.maxZ=o.readFloat32();var s=o.readUint32(),l=4*s*3,c=i.getClassifiedBufferSize(l),h=new Float32Array(c);if(h.set(o.readFloat32Array(3*s)),n.vertexCount=s,n.posVboDataArray=h,n.posArrayByteSize=c,o.readUint8()){var d=o.readUint32(),u=1*d*3,f=i.getClassifiedBufferSize(u),g=new Int8Array(f);g.set(o.readInt8Array(3*d)),n.norVboDataArray=g,n.norArrayByteSize=f}if(o.readUint8()){var m=o.readUint32(),y=1*m*4,p=i.getClassifiedBufferSize(y),v=new Uint8Array(p);v.set(o.readUint8Array(4*m)),n.colVboDataArray=v,n.colArrayByteSize=p}var _=o.readUint8();if(_){o.readUint16();var x=o.readUint32(),b=2*x*4,C=i.getClassifiedBufferSize(b),M=new Float32Array(C);M.set(o.readFloat32Array(2*x)),n.tcoordVboDataArray=M,n.tcoordArrayByteSize=C}this.fileLoadState=CODE.fileLoadState.PARSE_FINISHED;var A=!0;return n.isReadyPositions(t,r.vboMemoryManager)||(A=!1),n.isReadyNormals(t,r.vboMemoryManager)||(A=!1),n.isReadyColors(t,r.vboMemoryManager)||(A=!1),_&&(n.isReadyTexCoords(t,r.vboMemoryManager)||(A=!1)),A}};var LodBuilding=function(){if(!(this instanceof LodBuilding))throw new Error(Messages.CONSTRUCT_ERROR);this.dataArraybuffer,this.vbo_vicks_container=new VBOVertexIdxCacheKeysContainer,this.fileLoadState=CODE.fileLoadState.READY};LodBuilding.prototype.parseArrayBuffer=function(e,t){if(this.fileLoadState===CODE.fileLoadState.LOADING_FINISHED){this.fileLoadState=CODE.fileLoadState.PARSE_STARTED;var r=0,i=new BoundingBox;i.minX=new Float32Array(this.dataArraybuffer.slice(r,r+4)),r+=4,i.minY=new Float32Array(this.dataArraybuffer.slice(r,r+4)),r+=4,i.minZ=new Float32Array(this.dataArraybuffer.slice(r,r+4)),r+=4,i.maxX=new Float32Array(this.dataArraybuffer.slice(r,r+4)),r+=4,i.maxY=new Float32Array(this.dataArraybuffer.slice(r,r+4)),r+=4,i.maxZ=new Float32Array(this.dataArraybuffer.slice(r,r+4)),r+=4;var o=this.vbo_vicks_container.newVBOVertexIdxCacheKey(),a=t.readUInt32(this.dataArraybuffer,r,r+4),n=3*a,s=r+=4,l=r+4*n;o.posVboDataArray=new Float32Array(this.dataArraybuffer.slice(s,l)),r+=4*n,o.vertexCount=a;var c=t.readUInt8(this.dataArraybuffer,r,r+1);if(r+=1,c){var h=3*(a=t.readUInt32(this.dataArraybuffer,r,r+4)),s=r+=4,l=r+1*h;o.norVboDataArray=new Int8Array(this.dataArraybuffer.slice(s,l)),r+=1*h}var d=t.readUInt8(this.dataArraybuffer,r,r+1);if(r+=1,d){var u=4*(a=t.readUInt32(this.dataArraybuffer,r,r+4)),s=r+=4,l=r+1*u;o.colVboDataArray=new Uint8Array(this.dataArraybuffer.slice(s,l)),r+=1*u}t.readUInt8(this.dataArraybuffer,r,r+1);r+=1,this.fileLoadState=CODE.fileLoadState.PARSE_FINISHED}};var MetaData=function(){if(!(this instanceof MetaData))throw new Error(Messages.CONSTRUCT_ERROR);this.guid,this.version="",this.geographicCoord,this.heading,this.pitch,this.roll,this.bbox,this.imageLodCount,this.oct_min_x=0,this.oct_max_x=0,this.oct_min_y=0,this.oct_max_y=0,this.oct_min_z=0,this.oct_max_z=0,this.isSmall=!1,this.fileLoadState=CODE.fileLoadState.READY};MetaData.prototype.deleteObjects=function(){this.guid=void 0,this.version=void 0,this.geographicCoord&&this.geographicCoord.deleteObjects(),this.geographicCoord=void 0,this.heading=void 0,this.pitch=void 0,this.roll=void 0,this.bbox&&this.bbox.deleteObjects(),this.bbox=void 0,this.imageLodCount=void 0,this.oct_min_x=void 0,this.oct_max_x=void 0,this.oct_min_y=void 0,this.oct_max_y=void 0,this.oct_min_z=void 0,this.oct_max_z=void 0,this.isSmall=void 0,this.fileLoadState=void 0},MetaData.prototype.parseFileHeaderAsimetricVersion=function(e,t){var r=0,i=0;void 0===t&&(t=new ReaderWriter),this.version="";for(o=0;o<5;o++)this.version+=String.fromCharCode(new Int8Array(e.slice(i,i+1))),i+=1;void 0===this.guid&&(this.guid=""),r=t.readInt32(e,i,i+4),i+=4;for(var o=0;o<r;o++)this.guid+=String.fromCharCode(new Int8Array(e.slice(i,i+1))),i+=1;void 0===this.longitude?(this.longitude=new Float64Array(e.slice(i,i+8))[0],i+=8):i+=8,void 0===this.latitude?(this.latitude=new Float64Array(e.slice(i,i+8))[0],i+=8):i+=8,void 0===this.altitude?(this.altitude=new Float32Array(e.slice(i,i+4))[0],i+=4):i+=4,void 0===this.bbox&&(this.bbox=new BoundingBox),this.bbox.minX=new Float32Array(e.slice(i,i+4))[0],i+=4,this.bbox.minY=new Float32Array(e.slice(i,i+4))[0],i+=4,this.bbox.minZ=new Float32Array(e.slice(i,i+4))[0],i+=4,this.bbox.maxX=new Float32Array(e.slice(i,i+4))[0],i+=4,this.bbox.maxY=new Float32Array(e.slice(i,i+4))[0],i+=4,this.bbox.maxZ=new Float32Array(e.slice(i,i+4))[0],i+=4;var a=!1;return(this.bbox.maxX-this.bbox.minX>40||this.bbox.maxY-this.bbox.minY>40)&&(a=!0),!a&&this.bbox.maxZ-this.bbox.minZ<30&&(this.isSmall=!0),i};var ModelReferencedGroup=function(){if(!(this instanceof ModelReferencedGroup))throw new Error(Messages.CONSTRUCT_ERROR);this.modelIdx,this.referencesIdxArray=[]},ModelReferencedGroupsList=function(){if(!(this instanceof ModelReferencedGroupsList))throw new Error(Messages.CONSTRUCT_ERROR);this.modelReferencedGroupsMap=[],this.modelReferencedGroupsArray=[]};ModelReferencedGroupsList.prototype.getModelReferencedGroup=function(e){var t=this.modelReferencedGroupsMap[e];return void 0===t&&((t=new ModelReferencedGroup).modelIdx=e,this.modelReferencedGroupsMap[e]=t),t},ModelReferencedGroupsList.prototype.makeModelReferencedGroupsArray=function(){this.modelReferencedGroupsArray.length=0;for(var e=this.modelReferencedGroupsMap.length,t=0;t<e;t++)void 0!==this.modelReferencedGroupsMap[t]&&this.modelReferencedGroupsArray.push(this.modelReferencedGroupsMap[t]);this.modelReferencedGroupsMap.length=0},ModelReferencedGroupsList.prototype.createModelReferencedGroups=function(e,t){if(void 0!==e&&void 0!==t){for(var r,i,o=e.length,a=0;a<o;a++)i=t[r=e[a]]._block_idx,this.getModelReferencedGroup(i).referencesIdxArray.push(r);this.makeModelReferencedGroupsArray()}};var NeoBuilding=function(){if(!(this instanceof NeoBuilding))throw new Error(Messages.CONSTRUCT_ERROR);this.name="",this.metaData,this.buildingId,this.buildingType,this.buildingFileName="",this.bbox,this.bboxAbsoluteCenterPos,this.geoLocDataManager=new GeoLocationDataManager,this.motherNeoReferencesArray=[],this.motherBlocksArray=[],this.currentVisibleOctreesControler,this.aditionalColor,this.texturesLoaded,this.octree,this.distToCam,this.simpleBuilding3x3Texture,this.applyOcclusionCulling};NeoBuilding.prototype.getGeoLocationData=function(){return this.geoLocDataManager.geoLocationDataArray[0]},NeoBuilding.prototype.getRenderSettingApplyOcclusionCulling=function(){return this.applyOcclusionCulling},NeoBuilding.prototype.setRenderSettingApplyOcclusionCulling=function(e){this.applyOcclusionCulling=e},NeoBuilding.prototype.deleteObjectsModelReferences=function(e,t){for(var r=this.motherBlocksArray.length,i=0;i<r;i++)this.motherBlocksArray[i]&&this.motherBlocksArray[i].deleteObjects(e,t),this.motherBlocksArray[i]=void 0;this.motherBlocksArray=[];for(var o=this.motherNeoReferencesArray.length,i=0;i<o;i++)this.motherNeoReferencesArray[i]&&this.motherNeoReferencesArray[i].deleteObjects(e,t),this.motherNeoReferencesArray[i]=void 0;this.motherNeoReferencesArray=[]},NeoBuilding.prototype.deleteObjects=function(e,t){if(this.metaData.deleteObjects(),this.metaData.fileLoadState=CODE.fileLoadState.READY,this.deleteObjectsModelReferences(e,t),void 0!==this.octree&&this.octree.deleteObjects(e,t),this.octree=void 0,this.allFilesLoaded=!1,this.isReadyToRender=!1,this.texturesLoaded)for(var r=this.texturesLoaded.length,i=0;i<r;i++)this.texturesLoaded[i]&&(e.deleteTexture(this.texturesLoaded[i].texId),this.texturesLoaded[i].deleteObjects()),this.texturesLoaded[i]=void 0;this.texturesLoaded=void 0},NeoBuilding.prototype.getBBoxCenterPositionWorldCoord=function(){return void 0===this.bboxAbsoluteCenterPos&&this.calculateBBoxCenterPositionWorldCoord(),this.bboxAbsoluteCenterPos},NeoBuilding.prototype.calculateBBoxCenterPositionWorldCoord=function(){var e,t=this.getGeoLocationData();if(e=this.bbox.getCenterPoint(e),this.bboxAbsoluteCenterPos=t.tMatrix.transformPoint3D(e,this.bboxAbsoluteCenterPos),t.pivotPointTraslation){var r;r=t.tMatrix.rotatePoint3D(t.pivotPointTraslation,r),this.bboxAbsoluteCenterPos.add(r.x,r.y,r.z)}},NeoBuilding.prototype.getTextureId=function(e){for(var t,r=this.texturesLoaded.length,i=!1,o=0;!i&&o<r;)this.texturesLoaded[o].textureImageFileName===e.textureImageFileName&&(i=!0,t=this.texturesLoaded[o].texId),o++;return t},NeoBuilding.prototype.getSameTexture=function(e){for(var t,r=this.texturesLoaded.length,i=!1,o=0;!i&&o<r;)this.texturesLoaded[o].textureImageFileName===e.textureImageFileName&&(i=!0,t=this.texturesLoaded[o]),o++;return t},NeoBuilding.prototype.updateCurrentVisibleIndicesExterior=function(e,t,r){this._neoRefLists_Container.updateCurrentVisibleIndicesOfLists(e,t,r)},NeoBuilding.prototype.updateCurrentAllIndicesExterior=function(){this._neoRefLists_Container.updateCurrentAllIndicesOfLists()},NeoBuilding.prototype.isCameraInsideOfBuilding=function(e,t,r){return this.metaData.bbox.isPoint3dInside(e,t,r)},NeoBuilding.prototype.getTransformedRelativeEyePositionToBuilding=function(e,t,r,i){var o=this.buildingPosition,a=e-o.x,n=t-o.y,s=r-o.z;void 0===this.buildingPosMatInv&&(this.buildingPosMatInv=new Matrix4,this.buildingPosMatInv.setByFloat32Array(this.moveMatrixInv));var l=new Point3D;return void 0===i&&(i=new Point3D),l.set(a,n,s),i=this.buildingPosMatInv.transformPoint3D(l,i)},NeoBuilding.prototype.getHeaderVersion=function(){return this.metaData.version},NeoBuilding.prototype.manageNeoReferenceTexture=function(e,t){if("v"===this.metaData.version[0]){if(void 0===e.texture)return;if(void 0===e.texture.texId&&""!==e.texture.textureImageFileName){void 0===this.texturesLoaded&&(this.texturesLoaded=[]);var r=this.getSameTexture(e.texture);if(void 0===r){if(t.backGround_fileReadings_count>10)return;if(e.texture.fileLoadState===CODE.fileLoadState.READY){a=t.sceneState.gl;e.texture.texId=a.createTexture();s=(n=t.readerWriter.geometryDataPath)+"/"+this.buildingFileName+"/Images_Resized/"+e.texture.textureImageFileName;this.texturesLoaded.push(e.texture),t.readerWriter.readNeoReferenceTexture(a,s,e.texture,this,t),t.backGround_fileReadings_count++}}else r.fileLoadState===CODE.fileLoadState.LOADING_FINISHED&&(e.texture=r)}}else if(0===this.metaData.version[0]&&0===this.metaData.version[2]&&1===this.metaData.version[4]){if(t.backGround_fileReadings_count>10)return;var i=e.materialId,o=this.texturesLoaded[i];if(o.fileLoadState===CODE.fileLoadState.READY){var a=t.sceneState.gl;e.texture.texId=a.createTexture();var n=t.readerWriter.geometryDataPath,s=n+"/"+this.buildingFileName+"/Images_Resized/"+e.texture.textureImageFileName;this.texturesLoaded.push(e.texture),t.readerWriter.readNeoReferenceTexture(a,s,e.texture,this,t),t.backGround_fileReadings_count++}else o.fileLoadState===CODE.fileLoadState.LOADING_FINISHED&&(e.texture=o)}return e.texture.fileLoadState};var NeoBuildingsList=function(){if(!(this instanceof NeoBuildingsList))throw new Error(Messages.CONSTRUCT_ERROR);this.neoBuildingsArray=[]};NeoBuildingsList.prototype.newNeoBuilding=function(){var e=new NeoBuilding;return this.neoBuildingsArray.push(e),e},NeoBuildingsList.prototype.getNeoBuildingByTypeId=function(e,t){for(var r,i=this.neoBuildingsArray.length,o=!1,a=0;!o&&a<i;)this.neoBuildingsArray[a].buildingType===e&&this.neoBuildingsArray[a].buildingId===t&&(o=!0,r=this.neoBuildingsArray[a]),a++;return r},NeoBuildingsList.prototype.get=function(e){return this.neoBuildingsArray[e]},NeoBuildingsList.prototype.add=function(e){void 0!==e&&this.neoBuildingsArray.push(e)};var NeoReference=function(){if(!(this instanceof NeoReference))throw new Error(Messages.CONSTRUCT_ERROR);this._id=0,this.objectId="",this._block_idx=-1,this._matrix4=new Matrix4,this._originalMatrix4=new Matrix4,this.tMatrixAuxArray,this.refMatrixType=2,this.refTranslationVec,this.vBOVertexIdxCacheKeysContainer,this.materialId,this.hasTexture=!1,this.texture,this.color4,this.aditionalColor,this.vertexCount=0,this.moveVectorRelToBuilding,this.moveVector,this.bRendered=!1};NeoReference.prototype.multiplyTransformMatrix=function(e){this._matrix4=this._originalMatrix4.getMultipliedByMatrix(e)},NeoReference.prototype.multiplyKeyTransformMatrix=function(e,t){void 0===this.tMatrixAuxArray&&(this.tMatrixAuxArray=[]),this.tMatrixAuxArray[e]=this._originalMatrix4.getMultipliedByMatrix(t,this.tMatrixAuxArray[e]),this.moveVectorRelToBuilding&&(this.moveVector=t.rotatePoint3D(this.moveVectorRelToBuilding,this.moveVector))},NeoReference.prototype.hasKeyMatrix=function(e){return void 0!==this.tMatrixAuxArray&&void 0!==this.tMatrixAuxArray[e]},NeoReference.prototype.deleteObjects=function(e,t){this._id=void 0,this._block_idx=void 0,this._matrix4._floatArrays=void 0,this._matrix4=void 0,this._originalMatrix4._floatArrays=void 0,this._originalMatrix4=void 0,this.hasTexture=void 0,this.texture=void 0,this.color4&&this.color4.deleteObjects(),this.color4=void 0,this.selColor4&&this.selColor4.deleteObjects(),this.selColor4=void 0,this.vertexCount=void 0,this.moveVector&&this.moveVector.deleteObjects(),this.moveVector=void 0,this.bRendered=void 0};var NeoReferencesMotherAndIndices=function(){if(!(this instanceof NeoReferencesMotherAndIndices))throw new Error(Messages.CONSTRUCT_ERROR);this.motherNeoRefsList,this.neoRefsIndices=[],this.modelReferencedGroupsList,this.blocksList,this.fileLoadState=0,this.dataArraybuffer,this.succesfullyGpuDataBinded,this.exterior_ocCullOctree,this.interior_ocCullOctree,this.currentVisibleIndices=[],this.currentVisibleMRG};NeoReferencesMotherAndIndices.prototype.multiplyKeyTransformMatrix=function(e,t){for(var r=this.neoRefsIndices.length,i=0;i<r;i++)this.motherNeoRefsList[this.neoRefsIndices[i]].multiplyKeyTransformMatrix(e,t)},NeoReferencesMotherAndIndices.prototype.updateCurrentVisibleIndices=function(e,t,r,i,o){if(void 0===o&&(o=!0),e){if(void 0!==this.exterior_ocCullOctree){a=!1;this.exterior_ocCullOctree._subBoxesArray&&this.exterior_ocCullOctree._subBoxesArray.length>0&&(a=!0),a&&o?(void 0===this.currentVisibleMRG&&(this.currentVisibleMRG=new ModelReferencedGroupsList),this.currentVisibleIndices=this.exterior_ocCullOctree.getIndicesVisiblesForEye(t,r,i,this.currentVisibleIndices,this.currentVisibleMRG)):(this.currentVisibleIndices=this.neoRefsIndices,this.currentVisibleMRG=this.modelReferencedGroupsList)}}else if(void 0!==this.interior_ocCullOctree){var a=!1;this.interior_ocCullOctree._subBoxesArray&&this.interior_ocCullOctree._subBoxesArray.length>0&&(a=!0),a&&o?(void 0===this.currentVisibleMRG&&(this.currentVisibleMRG=new ModelReferencedGroupsList),this.currentVisibleIndices=this.interior_ocCullOctree.getIndicesVisiblesForEye(t,r,i,this.currentVisibleIndices,this.currentVisibleMRG)):(this.currentVisibleIndices=this.neoRefsIndices,this.currentVisibleMRG=this.modelReferencedGroupsList)}},NeoReferencesMotherAndIndices.prototype.getNeoReference=function(e){return this.motherNeoRefsList[this.neoRefsIndices[e]]},NeoReferencesMotherAndIndices.prototype.deleteObjects=function(e,t){this.motherNeoRefsList=void 0,this.neoRefsIndices=void 0,this.blocksList=void 0,this.fileLoadState=void 0,this.dataArraybuffer=void 0,this.exterior_ocCullOctree=void 0,this.interior_ocCullOctree=void 0},NeoReferencesMotherAndIndices.prototype.setRenderedFalseToAllReferences=function(){for(var e=this.neoRefsIndices.length,t=0;t<e;t++)this.motherNeoRefsList[this.neoRefsIndices[t]].bRendered=!1},NeoReferencesMotherAndIndices.prototype.createModelReferencedGroups=function(){void 0!==this.neoRefsIndices&&(void 0===this.modelReferencedGroupsList&&(this.modelReferencedGroupsList=new ModelReferencedGroupsList),this.modelReferencedGroupsList.createModelReferencedGroups(this.neoRefsIndices,this.motherNeoRefsList))},NeoReferencesMotherAndIndices.prototype.parseArrayBufferReferencesVersioned=function(e,t,r,i,o,a){this.fileLoadState=CODE.fileLoadState.PARSE_STARTED;var n,s,l,c,h=0,d=a.vboMemoryManager,u=0,f=0;this.succesfullyGpuDataBinded=!0;var g,m,y;String.fromCharCode.apply(null,new Int8Array(t.slice(h,h+5)));h+=5;var p=r.readUInt32(t,h,h+4);h+=4;for(var v=0;v<p;v++){var _=new NeoReference,x=r.readUInt32(t,h,h+4);if(h+=4,_._id=x,this.motherNeoRefsList=i,void 0!==i[_._id]){_=i[_._id],void 0===this.neoRefsIndices&&(this.neoRefsIndices=[]),this.neoRefsIndices.push(_._id);M=r.readUInt8(t,h,h+1);h+=1;var b=String.fromCharCode.apply(null,new Int8Array(t.slice(h,h+M)));_.objectId=b,h+=M;A=r.readUInt32(t,h,h+4);h+=4,_._block_idx=A;var C=r.readUInt8(t,h,h+1);h+=1,0===C||(1===C?(r.readFloat32(t,h,h+4),h+=4,r.readFloat32(t,h,h+4),h+=4,r.readFloat32(t,h,h+4),h+=4):2===C&&(r.readFloat32(t,h,h+4),h+=4,r.readFloat32(t,h,h+4),h+=4,r.readFloat32(t,h,h+4),h+=4,r.readFloat32(t,h,h+4),h+=4,r.readFloat32(t,h,h+4),h+=4,r.readFloat32(t,h,h+4),h+=4,r.readFloat32(t,h,h+4),h+=4,r.readFloat32(t,h,h+4),h+=4,r.readFloat32(t,h,h+4),h+=4,r.readFloat32(t,h,h+4),h+=4,r.readFloat32(t,h,h+4),h+=4,r.readFloat32(t,h,h+4),h+=4,r.readFloat32(t,h,h+4),h+=4,r.readFloat32(t,h,h+4),h+=4,r.readFloat32(t,h,h+4),h+=4,r.readFloat32(t,h,h+4),h+=4));R=r.readUInt8(t,h,h+1);if(h+=1,R){V=r.readUInt16(t,h,h+2);h+=2;O=r.readUInt8(t,h,h+1);h+=1;5121===V&&(F=1);S=r.readUInt8(t,h,h+F);h+=F;T=r.readUInt8(t,h,h+F);h+=F;P=r.readUInt8(t,h,h+F);h+=F;L=255;4===O&&(L=r.readUInt8(t,h,h+F),h+=F)}w=r.readUInt8(t,h,h+1);h+=1;E=r.readUInt8(t,h,h+1);if(h+=1,w||E){I=r.readInt32(t,h,h+4);h+=4;for(D=0;D<I;D++){if(w){V=r.readUInt16(t,h,h+2);h+=2;O=r.readUInt8(t,h,h+1);h+=1;5120===V||5121===V?F=1:5122===V||5123===V?F=2:5126===V&&(F=4);N=r.readUInt32(t,h,h+4);n=h+=4,s=h+F*(U=N*O),h+=F*U}if(E){V=r.readUInt16(t,h,h+2);h+=2;5120===V||5121===V?F=1:5122===V||5123===V?F=2:5126===V&&(F=4);N=r.readUInt32(t,h,h+4);n=h+=4,s=h+F*(U=2*N),h+=F*U}}}r.readInt32(t,h,h+4);h+=4,0===_.refMatrixType&&1,1===_.refMatrixType&&1,2===_.refMatrixType&&1}else{i[_._id]=_,void 0===this.neoRefsIndices&&(this.neoRefsIndices=[]),this.neoRefsIndices.push(_._id);var M=r.readUInt8(t,h,h+1);h+=1,"noObjectId"===(b=String.fromCharCode.apply(null,new Int8Array(t.slice(h,h+M))))&&(b=_._id),_.objectId=b,h+=M;var A=r.readUInt32(t,h,h+4);h+=4,_._block_idx=A,_.refMatrixType=r.readUInt8(t,h,h+1),h+=1,0===_.refMatrixType?1:1===_.refMatrixType?(g=r.readFloat32(t,h,h+4),h+=4,m=r.readFloat32(t,h,h+4),h+=4,y=r.readFloat32(t,h,h+4),h+=4,_.refTranslationVec=new Float32Array([g,m,y]),1):2===_.refMatrixType&&(_._originalMatrix4._floatArrays[0]=r.readFloat32(t,h,h+4),h+=4,_._originalMatrix4._floatArrays[1]=r.readFloat32(t,h,h+4),h+=4,_._originalMatrix4._floatArrays[2]=r.readFloat32(t,h,h+4),h+=4,_._originalMatrix4._floatArrays[3]=r.readFloat32(t,h,h+4),h+=4,_._originalMatrix4._floatArrays[4]=r.readFloat32(t,h,h+4),h+=4,_._originalMatrix4._floatArrays[5]=r.readFloat32(t,h,h+4),h+=4,_._originalMatrix4._floatArrays[6]=r.readFloat32(t,h,h+4),h+=4,_._originalMatrix4._floatArrays[7]=r.readFloat32(t,h,h+4),h+=4,_._originalMatrix4._floatArrays[8]=r.readFloat32(t,h,h+4),h+=4,_._originalMatrix4._floatArrays[9]=r.readFloat32(t,h,h+4),h+=4,_._originalMatrix4._floatArrays[10]=r.readFloat32(t,h,h+4),h+=4,_._originalMatrix4._floatArrays[11]=r.readFloat32(t,h,h+4),h+=4,_._originalMatrix4._floatArrays[12]=r.readFloat32(t,h,h+4),h+=4,_._originalMatrix4._floatArrays[13]=r.readFloat32(t,h,h+4),h+=4,_._originalMatrix4._floatArrays[14]=r.readFloat32(t,h,h+4),h+=4,_._originalMatrix4._floatArrays[15]=r.readFloat32(t,h,h+4),h+=4,1);var R=r.readUInt8(t,h,h+1);if(h+=1,R){V=r.readUInt16(t,h,h+2);h+=2;O=r.readUInt8(t,h,h+1);h+=1;5121===V&&(F=1);var S=r.readUInt8(t,h,h+F);h+=F;var T=r.readUInt8(t,h,h+F);h+=F;var P=r.readUInt8(t,h,h+F);h+=F;var L=255;4===O&&(L=r.readUInt8(t,h,h+F),h+=F),_.color4=new Color,_.color4.set(S,T,P,L)}var w=r.readUInt8(t,h,h+1);h+=1;var E=r.readUInt8(t,h,h+1);if(h+=1,w||E){var I=r.readInt32(t,h,h+4);h+=4,I>0&&void 0===_.vBOVertexIdxCacheKeysContainer&&(_.vBOVertexIdxCacheKeysContainer=new VBOVertexIdxCacheKeysContainer);for(var D=0;D<I;D++){var B=_.vBOVertexIdxCacheKeysContainer.newVBOVertexIdxCacheKey();if(w){V=r.readUInt16(t,h,h+2);h+=2;var O=r.readUInt8(t,h,h+1);h+=1;5120===V||5121===V?F=1:5122===V||5123===V?F=2:5126===V&&(F=4);N=r.readUInt32(t,h,h+4);h+=4,l=F*(U=N*O),f=d.getClassifiedBufferSize(l),_.vertexCount=N,n=h,s=h+F*U,B.colVboDataArray=new Float32Array(f),B.colVboDataArray.set(new Float32Array(t.slice(n,s))),B.colArrayByteSize=f,h+=F*U,B.isReadyColors(e,a.vboMemoryManager)||(this.succesfullyGpuDataBinded=!1)}if(E){var V=r.readUInt16(t,h,h+2);h+=2;var F;5120===V||5121===V?F=1:5122===V||5123===V?F=2:5126===V&&(F=4);var N=r.readUInt32(t,h,h+4);h+=4;var U=2*N;c=F*U,u=d.getClassifiedBufferSize(c),_.vertexCount=N,n=h,s=h+F*U,B.tcoordVboDataArray=new Float32Array(u),B.tcoordVboDataArray.set(new Float32Array(t.slice(n,s))),B.tcoordArrayByteSize=u,h+=F*U,B.isReadyTexCoords(e,a.vboMemoryManager)||(this.succesfullyGpuDataBinded=!1)}}}_.materialId=r.readInt32(t,h,h+4),h+=4,-1===_.materialId?_.hasTexture=!1:_.hasTexture=!0,o&&_.multiplyTransformMatrix(o)}}r.readUInt32(t,h,h+4);h+=4,void 0===this.exterior_ocCullOctree&&(this.exterior_ocCullOctree=new OcclusionCullingOctreeCell);var G=this.exterior_ocCullOctree;h=this.exterior_ocCullOctree.parseArrayBuffer(t,h,r),G.expandBox(1e3),G.setSizesSubBoxes(),G.createModelReferencedGroups(this.motherNeoRefsList),void 0===this.interior_ocCullOctree&&(this.interior_ocCullOctree=new OcclusionCullingOctreeCell);var H=this.interior_ocCullOctree;return h=this.interior_ocCullOctree.parseArrayBuffer(t,h,r),H.setSizesSubBoxes(),H.createModelReferencedGroups(this.motherNeoRefsList),this.fileLoadState=CODE.fileLoadState.PARSE_FINISHED,this.succesfullyGpuDataBinded},NeoReferencesMotherAndIndices.prototype.parseArrayBufferReferences=function(e,t,r,i,o,a){this.fileLoadState=CODE.fileLoadState.PARSE_STARTED;var n,s,l=0,c=r.readUInt32(t,l,l+4);l+=4;var h,d,u=a.vboMemoryManager,f=0,g=0;this.succesfullyGpuDataBinded=!0;for(var m=0;m<c;m++){var y=new NeoReference,p=r.readUInt32(t,l,l+4);if(l+=4,y._id=p,this.motherNeoRefsList=i,void 0!==i[y._id]){y=i[y._id],void 0===this.neoRefsIndices&&(this.neoRefsIndices=[]),this.neoRefsIndices.push(y._id);_=r.readUInt8(t,l,l+1);l+=1;var v=String.fromCharCode.apply(null,new Int8Array(t.slice(l,l+_)));l+=_;x=r.readUInt32(t,l,l+4);l+=4,y._block_idx=x,r.readFloat32(t,l,l+4),l+=4,r.readFloat32(t,l,l+4),l+=4,r.readFloat32(t,l,l+4),l+=4,r.readFloat32(t,l,l+4),l+=4,r.readFloat32(t,l,l+4),l+=4,r.readFloat32(t,l,l+4),l+=4,r.readFloat32(t,l,l+4),l+=4,r.readFloat32(t,l,l+4),l+=4,r.readFloat32(t,l,l+4),l+=4,r.readFloat32(t,l,l+4),l+=4,r.readFloat32(t,l,l+4),l+=4,r.readFloat32(t,l,l+4),l+=4,r.readFloat32(t,l,l+4),l+=4,r.readFloat32(t,l,l+4),l+=4,r.readFloat32(t,l,l+4),l+=4,r.readFloat32(t,l,l+4),l+=4;b=r.readUInt8(t,l,l+1);if(l+=1,b){E=r.readUInt16(t,l,l+2);l+=2;w=r.readUInt8(t,l,l+1);l+=1;5121===E&&(I=1);C=r.readUInt8(t,l,l+I);l+=I;M=r.readUInt8(t,l,l+I);l+=I;A=r.readUInt8(t,l,l+I);l+=I;R=255;4===w&&(R=r.readUInt8(t,l,l+I),l+=I)}S=r.readUInt8(t,l,l+1);l+=1;T=r.readUInt8(t,l,l+1);if(l+=1,S||T){P=r.readInt32(t,l,l+4);l+=4;for(G=0;G<P;G++){if(S){E=r.readUInt16(t,l,l+2);l+=2;w=r.readUInt8(t,l,l+1);l+=1;5120===E||5121===E?I=1:5122===E||5123===E?I=2:5126===E&&(I=4);D=r.readUInt32(t,l,l+4);n=l+=4,s=l+I*(B=D*w),l+=I*B}if(T){E=r.readUInt16(t,l,l+2);l+=2;5120===E||5121===E?I=1:5122===E||5123===E?I=2:5126===E&&(I=4);D=r.readUInt32(t,l,l+4);n=l+=4,s=l+I*(B=2*D),l+=I*B}}}O=r.readUInt32(t,l,l+4);if(l+=4,O>0){N=r.readUInt32(t,l,l+4);l+=4;for(G=0;G<N;G++)l+=1;U=r.readUInt32(t,l,l+4);l+=4;for(G=0;G<U;G++)l+=1}0===y.refMatrixType&&1,1===y.refMatrixType&&1,2===y.refMatrixType&&1}else{i[y._id]=y,void 0===this.neoRefsIndices&&(this.neoRefsIndices=[]),this.neoRefsIndices.push(y._id);var _=r.readUInt8(t,l,l+1);l+=1,"noObjectId"!==(v=String.fromCharCode.apply(null,new Int8Array(t.slice(l,l+_))))&&""!==v||(v=y._id),y.objectId=v,l+=_;var x=r.readUInt32(t,l,l+4);l+=4,y._block_idx=x,y._originalMatrix4._floatArrays[0]=r.readFloat32(t,l,l+4),l+=4,y._originalMatrix4._floatArrays[1]=r.readFloat32(t,l,l+4),l+=4,y._originalMatrix4._floatArrays[2]=r.readFloat32(t,l,l+4),l+=4,y._originalMatrix4._floatArrays[3]=r.readFloat32(t,l,l+4),l+=4,y._originalMatrix4._floatArrays[4]=r.readFloat32(t,l,l+4),l+=4,y._originalMatrix4._floatArrays[5]=r.readFloat32(t,l,l+4),l+=4,y._originalMatrix4._floatArrays[6]=r.readFloat32(t,l,l+4),l+=4,y._originalMatrix4._floatArrays[7]=r.readFloat32(t,l,l+4),l+=4,y._originalMatrix4._floatArrays[8]=r.readFloat32(t,l,l+4),l+=4,y._originalMatrix4._floatArrays[9]=r.readFloat32(t,l,l+4),l+=4,y._originalMatrix4._floatArrays[10]=r.readFloat32(t,l,l+4),l+=4,y._originalMatrix4._floatArrays[11]=r.readFloat32(t,l,l+4),l+=4,y._originalMatrix4._floatArrays[12]=r.readFloat32(t,l,l+4),l+=4,y._originalMatrix4._floatArrays[13]=r.readFloat32(t,l,l+4),l+=4,y._originalMatrix4._floatArrays[14]=r.readFloat32(t,l,l+4),l+=4,y._originalMatrix4._floatArrays[15]=r.readFloat32(t,l,l+4),l+=4,y.refMatrixType=y._originalMatrix4.computeMatrixType(),0===y.refMatrixType&&1,1===y.refMatrixType&&(y.refTranslationVec=new Float32Array([y._originalMatrix4._floatArrays[12],y._originalMatrix4._floatArrays[13],y._originalMatrix4._floatArrays[14]]),1),2===y.refMatrixType&&1;var b=r.readUInt8(t,l,l+1);if(l+=1,b){E=r.readUInt16(t,l,l+2);l+=2;w=r.readUInt8(t,l,l+1);l+=1;5121===E&&(I=1);var C=r.readUInt8(t,l,l+I);l+=I;var M=r.readUInt8(t,l,l+I);l+=I;var A=r.readUInt8(t,l,l+I);l+=I;var R=255;4===w&&(R=r.readUInt8(t,l,l+I),l+=I),y.color4=new Color,y.color4.set(C,M,A,R)}var S=r.readUInt8(t,l,l+1);l+=1;var T=r.readUInt8(t,l,l+1);if(l+=1,S||T){var P=r.readInt32(t,l,l+4);l+=4,P>0&&void 0===y.vBOVertexIdxCacheKeysContainer&&(y.vBOVertexIdxCacheKeysContainer=new VBOVertexIdxCacheKeysContainer);for(G=0;G<P;G++){var L=y.vBOVertexIdxCacheKeysContainer.newVBOVertexIdxCacheKey();if(S){E=r.readUInt16(t,l,l+2);l+=2;var w=r.readUInt8(t,l,l+1);l+=1;5120===E||5121===E?I=1:5122===E||5123===E?I=2:5126===E&&(I=4);D=r.readUInt32(t,l,l+4);l+=4,h=I*(B=D*w),g=u.getClassifiedBufferSize(h),y.vertexCount=D,n=l,s=l+I*B,L.colVboDataArray=new Float32Array(g),L.colVboDataArray.set(new Float32Array(t.slice(n,s))),L.colArrayByteSize=g,l+=I*B,L.isReadyColors(e,a.vboMemoryManager)||(this.succesfullyGpuDataBinded=!1)}if(T){var E=r.readUInt16(t,l,l+2);l+=2;var I;5120===E||5121===E?I=1:5122===E||5123===E?I=2:5126===E&&(I=4);var D=r.readUInt32(t,l,l+4);l+=4;var B=2*D;d=I*B,f=u.getClassifiedBufferSize(d),y.vertexCount=D,n=l,s=l+I*B,L.tcoordVboDataArray=new Float32Array(f),L.tcoordVboDataArray.set(new Float32Array(t.slice(n,s))),L.tcoordArrayByteSize=f,l+=I*B,L.isReadyTexCoords(e,a.vboMemoryManager)||(this.succesfullyGpuDataBinded=!1)}}}var O=r.readUInt32(t,l,l+4);if(l+=4,O>0){var V="",F="",N=r.readUInt32(t,l,l+4);l+=4;for(G=0;G<N;G++)V+=String.fromCharCode(new Int8Array(t.slice(l,l+1))),l+=1;var U=r.readUInt32(t,l,l+4);l+=4;for(var G=0;G<U;G++)F+=String.fromCharCode(new Int8Array(t.slice(l,l+1))),l+=1;U>0&&(y.texture=new Texture,y.hasTexture=!0,y.texture.textureTypeName=V,y.texture.textureImageFileName=F)}else y.hasTexture=!1;o&&y.multiplyTransformMatrix(o)}}void 0===this.exterior_ocCullOctree&&(this.exterior_ocCullOctree=new OcclusionCullingOctreeCell);var H=this.exterior_ocCullOctree;l=this.exterior_ocCullOctree.parseArrayBuffer(t,l,r),H.expandBox(1e3),H.setSizesSubBoxes(),H.createModelReferencedGroups(this.motherNeoRefsList),void 0===this.interior_ocCullOctree&&(this.interior_ocCullOctree=new OcclusionCullingOctreeCell);var j=this.interior_ocCullOctree;return l=this.interior_ocCullOctree.parseArrayBuffer(t,l,r),j.setSizesSubBoxes(),j.createModelReferencedGroups(this.motherNeoRefsList),this.fileLoadState=CODE.fileLoadState.PARSE_FINISHED,this.succesfullyGpuDataBinded};var NeoSimpleBuilding=function(){if(!(this instanceof NeoSimpleBuilding))throw new Error(Messages.CONSTRUCT_ERROR);this.accesorsArray=[],this.vbo_vicks_container=new VBOVertexIdxCacheKeysContainer,this.texturesArray=[]};NeoSimpleBuilding.prototype.newAccesor=function(){var e=new Accessor;return this.accesorsArray.push(e),e},NeoSimpleBuilding.prototype.newTexture=function(){var e=new NeoTexture;return this.texturesArray.push(e),e};var NeoTexture=function(){if(!(this instanceof NeoTexture))throw new Error(Messages.CONSTRUCT_ERROR);this.lod,this.textureId,this.texImage,this.loadStarted=!1,this.loadFinished=!1},Node=function(){if(!(this instanceof Node))throw new Error(Messages.CONSTRUCT_ERROR);this.parent,this.children=[],this.data},Octree=function(e){if(!(this instanceof Octree))throw new Error(Messages.CONSTRUCT_ERROR);this.centerPos=new Point3D,this.half_dx=0,this.half_dy=0,this.half_dz=0,this.octree_owner,this.octree_level=0,this.octree_number_name=0,this.distToCamera,this.triPolyhedronsCount=0,this.fileLoadState=CODE.fileLoadState.READY,e&&(this.octree_owner=e,this.octree_level=e.octree_level+1),this.subOctrees_array=[],this.neoReferencesMotherAndIndices,this.lego};Octree.prototype.new_subOctree=function(){var e=new Octree(this);return e.octree_level=this.octree_level+1,this.subOctrees_array.push(e),e},Octree.prototype.deleteObjectsModelReferences=function(e,t){if(this.neoReferencesMotherAndIndices&&this.neoReferencesMotherAndIndices.deleteObjects(e,t),this.neoReferencesMotherAndIndices=void 0,void 0!==this.neoRefsList_Array){for(var r=0,i=this.neoRefsList_Array.length;r<i;r++)this.neoRefsList_Array[r]&&this.neoRefsList_Array[r].deleteObjects(e,t),this.neoRefsList_Array[r]=void 0;this.neoRefsList_Array=void 0}if(void 0!==this.subOctrees_array)for(var r=0,o=this.subOctrees_array.length;r<o;r++)this.subOctrees_array[r].deleteObjectsModelReferences(e,t)},Octree.prototype.deleteObjects=function(e,t){if(void 0!==this.lego&&(this.lego.deleteObjects(e,t),this.lego=void 0),this.legoDataArrayBuffer=void 0,this.centerPos.deleteObjects(),this.centerPos=void 0,this.half_dx=void 0,this.half_dy=void 0,this.half_dz=void 0,this.octree_owner=void 0,this.octree_level=void 0,this.octree_number_name=void 0,this.distToCamera=void 0,this.triPolyhedronsCount=void 0,this.fileLoadState=void 0,this.neoBuildingOwner=void 0,this.neoReferencesMotherAndIndices&&this.neoReferencesMotherAndIndices.deleteObjects(e,t),this.neoReferencesMotherAndIndices=void 0,void 0!==this.neoRefsList_Array){for(var r=0,i=this.neoRefsList_Array.length;r<i;r++)this.neoRefsList_Array[r]&&this.neoRefsList_Array[r].deleteObjects(e,t),this.neoRefsList_Array[r]=void 0;this.neoRefsList_Array=void 0}if(void 0!==this.subOctrees_array){for(var r=0,o=this.subOctrees_array.length;r<o;r++)this.subOctrees_array[r].deleteObjects(e,t),this.subOctrees_array[r]=void 0;this.subOctrees_array=void 0}},Octree.prototype.deleteLod0GlObjects=function(e,t){if(this.neoReferencesMotherAndIndices&&this.neoReferencesMotherAndIndices.deleteObjects(e,t),void 0!==this.subOctrees_array)for(var r=0,i=this.subOctrees_array.length;r<i;r++)this.subOctrees_array[r].deleteLod0GlObjects(e,t)},Octree.prototype.setRenderedFalseToAllReferences=function(){if(this.neoReferencesMotherAndIndices){this.neoReferencesMotherAndIndices.setRenderedFalseToAllReferences();for(var e=this.subOctrees_array.length,t=0;t<e;t++)this.subOctrees_array[t].setRenderedFalseToAllReferences()}},Octree.prototype.makeTree=function(e){if(this.octree_level<e){for(t=0;t<8;t++)this.new_subOctree().octree_number_name=10*this.octree_number_name+(t+1);this.setSizesSubBoxes();for(var t=0;t<8;t++)this.subOctrees_array[t].makeTree(e)}},Octree.prototype.getNumberOfDigits=function(e){return e>0?Math.floor(Math.log10(e)+1):1},Octree.prototype.getMotherOctree=function(){return void 0===this.octree_owner?this:this.octree_owner.getMotherOctree()},Octree.prototype.getOctree=function(e,t){if(1===t)return 0===e?this.getMotherOctree():this.subOctrees_array[e-1];var r=t-1,i=Math.pow(10,r),o=Math.floor(e/i)%10,a=e-o*i;return this.subOctrees_array[o-1].getOctree(a,t-1)},Octree.prototype.getOctreeByNumberName=function(e){var t=this.getMotherOctree(),r=this.getNumberOfDigits(e);if(1===r)return 0===e?t:t.subOctrees_array[e-1];if(0!==t.subOctrees_array.length){var i=r-1,o=Math.pow(10,i),a=Math.floor(e/o)%10,n=e-a*o;return t.subOctrees_array[a-1].getOctree(n,r-1)}},Octree.prototype.setSizesSubBoxes=function(){if(this.subOctrees_array.length>0){var e=this.centerPos.x,t=this.centerPos.y,r=this.centerPos.z,i=this.centerPos.x-this.half_dx,o=this.centerPos.y-this.half_dy,a=this.centerPos.z-this.half_dz,n=this.centerPos.x+this.half_dx,s=this.centerPos.y+this.half_dy,l=this.centerPos.z+this.half_dz;this.subOctrees_array[0].setBoxSize(i,e,o,t,a,r),this.subOctrees_array[1].setBoxSize(e,n,o,t,a,r),this.subOctrees_array[2].setBoxSize(e,n,t,s,a,r),this.subOctrees_array[3].setBoxSize(i,e,t,s,a,r),this.subOctrees_array[4].setBoxSize(i,e,o,t,r,l),this.subOctrees_array[5].setBoxSize(e,n,o,t,r,l),this.subOctrees_array[6].setBoxSize(e,n,t,s,r,l),this.subOctrees_array[7].setBoxSize(i,e,t,s,r,l);for(var c=0;c<8;c++)this.subOctrees_array[c].setSizesSubBoxes()}},Octree.prototype.setBoxSize=function(e,t,r,i,o,a){this.centerPos.x=(t+e)/2,this.centerPos.y=(i+r)/2,this.centerPos.z=(a+o)/2,this.half_dx=(t-e)/2,this.half_dy=(i-r)/2,this.half_dz=(a-o)/2},Octree.prototype.getCenterPos=function(){return this.centerPos},Octree.prototype.getRadiusAprox=function(){return 1.5*this.half_dx},Octree.prototype.getCRefListArray=function(e){if(void 0===e&&(e=[]),this.subOctrees_array.length>0)for(var t=0,r=this.subOctrees_array.length;t<r;t++)this.subOctrees_array[t].getCRefListArray(e);else this.compRefsListArray.length>0&&e.push(this.compRefsListArray[0])},Octree.prototype.getNeoRefListArray=function(e){void 0===e&&(e=[]);var t=this.subOctrees_array.length;if(t>0)for(var r=0;r<t;r++)this.subOctrees_array[r].getNeoRefListArray(e);else this.neoRefsList_Array.length>0&&e.push(this.neoRefsList_Array[0])},Octree.prototype.getFrustumVisibleNeoRefListArray=function(e,t,r,i,o,a){var n=[],s=[];this.getFrustumVisibleOctreesNeoBuilding(e,n,r);for(var l=n.length,c=0;c<l;c++)n[c].setDistToCamera(cameraPosition),this.putOctreeInEyeDistanceSortedArray(s,n[c]);for(c=0;c<l;c++)s[c].getNeoRefListArray(t);n=null,s=null},Octree.prototype.getBBoxIntersectedLowestOctreesByLOD=function(e,t,r,i,o,a,n,s){var l=[],c=!1;this.getBBoxIntersectedOctreesNeoBuildingAsimetricVersion(e,l,i);for(var h=l.length,d=0;d<h;d++)l[d].setDistToCamera(o);for(d=0;d<h;d++)l[d].distToCamera<a?l[d].triPolyhedronsCount>0&&(r&&this.putOctreeInEyeDistanceSortedArray(r.currentVisibles0,l[d]),t.currentVisibles0.push(l[d]),c=!0):l[d].distToCamera<n?l[d].triPolyhedronsCount>0&&(r&&this.putOctreeInEyeDistanceSortedArray(r.currentVisibles1,l[d]),t.currentVisibles1.push(l[d]),c=!0):l[d].distToCamera<s?l[d].triPolyhedronsCount>0&&(r&&this.putOctreeInEyeDistanceSortedArray(r.currentVisibles2,l[d]),t.currentVisibles2.push(l[d]),c=!0):l[d].triPolyhedronsCount>0&&(r&&this.putOctreeInEyeDistanceSortedArray(r.currentVisibles3,l[d]),t.currentVisibles3.push(l[d]),c=!0);return l=null,c},Octree.prototype.getFrustumVisibleLowestOctreesByLOD=function(e,t,r,i,o,a,n,s){var l=[],c=!1;this.getFrustumVisibleOctreesNeoBuildingAsimetricVersion(e,l,i);for(var h=l.length,d=0;d<h;d++)l[d].setDistToCamera(o);for(d=0;d<h;d++)l[d].distToCamera<a?l[d].triPolyhedronsCount>0&&(r&&this.putOctreeInEyeDistanceSortedArray(r.currentVisibles0,l[d]),t.currentVisibles0.push(l[d]),c=!0):l[d].distToCamera<n?l[d].triPolyhedronsCount>0&&(r&&this.putOctreeInEyeDistanceSortedArray(r.currentVisibles1,l[d]),t.currentVisibles1.push(l[d]),c=!0):l[d].distToCamera<s?l[d].triPolyhedronsCount>0&&(r&&this.putOctreeInEyeDistanceSortedArray(r.currentVisibles2,l[d]),t.currentVisibles2.push(l[d]),c=!0):l[d].triPolyhedronsCount>0&&(r&&r.currentVisibles3.push(l[d]),t.currentVisibles3.push(l[d]),c=!0);return l=void 0,c},Octree.prototype.extractLowestOctreesByLOD=function(e,t,r,i,o,a,n){var s=[],l=!1;i.x,i.y,i.z;this.extractLowestOctreesIfHasTriPolyhedrons(s);for(var c=s.length,h=0;h<c;h++)s[h].setDistToCamera(i);for(h=0;h<c;h++)s[h].distToCamera<o?s[h].triPolyhedronsCount>0&&(t&&this.putOctreeInEyeDistanceSortedArray(t.currentVisibles0,s[h]),e.currentVisibles0.push(s[h]),l=!0):s[h].distToCamera<a?s[h].triPolyhedronsCount>0&&(t&&this.putOctreeInEyeDistanceSortedArray(t.currentVisibles1,s[h]),e.currentVisibles1.push(s[h]),l=!0):s[h].distToCamera<n?s[h].triPolyhedronsCount>0&&(t&&this.putOctreeInEyeDistanceSortedArray(t.currentVisibles2,s[h]),e.currentVisibles2.push(s[h]),l=!0):s[h].triPolyhedronsCount>0&&(t&&t.currentVisibles3.push(s[h]),e.currentVisibles3.push(s[h]),l=!0);return l},Octree.prototype.getFrustumVisibleOctreesNeoBuilding=function(e,t,r){if(0!==this.subOctrees_array.length||0!==this.neoRefsList_Array.length){void 0===t&&(t=[]),void 0===r&&(r=new Cesium.BoundingSphere),r.center.x=this.centerPos.x,r.center.y=this.centerPos.y,r.center.z=this.centerPos.z,this.subOctrees_array.length,r.radius=this.getRadiusAprox();var i=e.computeVisibility(r);if(i===Cesium.Intersect.INSIDE)this.getAllSubOctreesIfHasRefLists(t);else if(i===Cesium.Intersect.INTERSECTING)if(0===this.subOctrees_array.length)t.push(this);else for(var o=0,a=this.subOctrees_array.length;o<a;o++)this.subOctrees_array[o].getFrustumVisibleOctreesNeoBuilding(e,t,r)}},Octree.prototype.getFrustumVisibleOctreesNeoBuildingAsimetricVersion=function(e,t,r){if(void 0!==this.subOctrees_array&&(0!==this.subOctrees_array.length||0!==this.triPolyhedronsCount)){void 0===t&&(t=[]),void 0===r&&(r=new Sphere),r.centerPoint.x=this.centerPos.x,r.centerPoint.y=this.centerPos.y,r.centerPoint.z=this.centerPos.z,r.r=this.getRadiusAprox();var i=e.intersectionSphere(r);if(i===Constant.INTERSECTION_INSIDE)this.getAllSubOctreesIfHasRefLists(t);else if(i===Constant.INTERSECTION_INTERSECT)if(0===this.subOctrees_array.length)t.push(this);else for(var o=0,a=this.subOctrees_array.length;o<a;o++)this.subOctrees_array[o].getFrustumVisibleOctreesNeoBuildingAsimetricVersion(e,t,r)}},Octree.prototype.getBBoxIntersectedOctreesNeoBuildingAsimetricVersion=function(e,t,r){void 0!==this.subOctrees_array&&(0===this.subOctrees_array.length&&0===this.triPolyhedronsCount||(void 0===t&&(t=[]),void 0===r&&(r=new BoundingBox),r.minX=this.centerPos.x-this.half_dx,r.maxX=this.centerPos.x+this.half_dx,r.minY=this.centerPos.y-this.half_dy,r.maxY=this.centerPos.y+this.half_dy,r.minZ=this.centerPos.z-this.half_dz,r.maxZ=this.centerPos.z+this.half_dz,e.intersectsWithBBox(r)&&this.getAllSubOctreesIfHasRefLists(t)))},Octree.prototype.getFrustumVisibleOctrees=function(e,t,r){if(0!==this.subOctrees_array.length||0!==this.compRefsListArray.length){void 0===t&&(t=[]),void 0===r&&(r=new Cesium.BoundingSphere),r.center.x=this.centerPos.x,r.center.y=this.centerPos.y,r.center.z=this.centerPos.z,this.subOctrees_array.length,r.radius=this.getRadiusAprox();var i=e.computeVisibility(r);if(i===Cesium.Intersect.INSIDE)this.getAllSubOctrees(t);else if(i===Cesium.Intersect.INTERSECTING)if(0===this.subOctrees_array.length&&this.neoRefsList_Array.length>0)t.push(this);else for(var o=0,a=this.subOctrees_array.length;o<a;o++)this.subOctrees_array[o].getFrustumVisibleOctrees(e,t,r)}},Octree.prototype.setDistToCamera=function(e){this.distToCamera=this.centerPos.distToPoint(e)-this.getRadiusAprox()},Octree.prototype.getIndexToInsertBySquaredDistToEye=function(e,t,r,i){var o=i-r;if(o<6){var a,n=!1,s=r;for(e.length;!n&&s<=i;)t.distToCamera<e[s].distToCamera&&(a=s,n=!0),s++;return n?a:i+1}var l,c,h=r+Math.floor(o/2);return e[h].distToCamera>t.distToCamera?(l=r,c=h):(l=h,c=i),this.getIndexToInsertBySquaredDistToEye(e,t,l,c)},Octree.prototype.putOctreeInEyeDistanceSortedArray=function(e,t){if(e.length>0){var r=e.length-1,i=this.getIndexToInsertBySquaredDistToEye(e,t,0,r);e.splice(i,0,t)}else e.push(t)},Octree.prototype.getAllSubOctreesIfHasRefLists=function(e){if(void 0!==this.subOctrees_array)if(void 0===e&&(e=[]),this.subOctrees_array.length>0)for(var t=0,r=this.subOctrees_array.length;t<r;t++)this.subOctrees_array[t].getAllSubOctreesIfHasRefLists(e);else this.triPolyhedronsCount>0&&e.push(this)},Octree.prototype.getAllSubOctrees=function(e){if(void 0===e&&(e=[]),this.subOctrees_array.length>0)for(var t=0,r=this.subOctrees_array.length;t<r;t++)this.subOctrees_array[t].getAllSubOctrees(e);else e.push(this)},Octree.prototype.extractLowestOctreesIfHasTriPolyhedrons=function(e){if(void 0!==this.subOctrees_array){var t=this.subOctrees_array.length;if(0===t&&this.triPolyhedronsCount>0)e.push(this);else for(var r=0;r<t;r++)this.subOctrees_array[r].extractLowestOctreesIfHasTriPolyhedrons(e)}},Octree.prototype.multiplyKeyTransformMatrix=function(e,t){var r=this.subOctrees_array.length;if(0===r&&this.triPolyhedronsCount>0)this.neoReferencesMotherAndIndices&&this.neoReferencesMotherAndIndices.multiplyKeyTransformMatrix(e,t);else for(var i=0;i<r;i++)this.subOctrees_array[i].multiplyKeyTransformMatrix(e,t)},Octree.prototype.parseAsimetricVersion=function(e,t,r,i){var o=t.readInt32(e,r,r+4);if(r+=4,0===o){var a=t.readFloat32(e,r,r+4);r+=4;var n=t.readFloat32(e,r,r+4);r+=4;var s=t.readFloat32(e,r,r+4);r+=4;var l=t.readFloat32(e,r,r+4);r+=4;var c=t.readFloat32(e,r,r+4);r+=4;var h=t.readFloat32(e,r,r+4);r+=4,this.setBoxSize(a,n,s,l,c,h),this.octree_number_name=0}var d=t.readUInt8(e,r,r+1);r+=1,this.triPolyhedronsCount=t.readInt32(e,r,r+4),r+=4,this.triPolyhedronsCount>0&&(this.neoBuildingOwner=i);for(u=0;u<d;u++)(f=this.new_subOctree()).octree_number_name=10*this.octree_number_name+(u+1);this.setSizesSubBoxes();for(var u=0;u<d;u++){var f=this.subOctrees_array[u];r=f.parseAsimetricVersion(e,t,r,i)}return r};var ParseQueue=function(){if(!(this instanceof ParseQueue))throw new Error(Messages.CONSTRUCT_ERROR);this.octreesLod0ReferencesToParseMap=new Map,this.octreesLod0ModelsToParseMap=new Map,this.octreesLod2LegosToParseMap=new Map};ParseQueue.prototype.parseOctreesLod0References=function(e,t,r,i){var o,a,n;void 0===this.matrix4SC&&(this.matrix4SC=new Matrix4);var s=0;if(void 0===i&&(i=20),this.octreesLod0ReferencesToParseMap.size>0){for(var l=t.currentVisibles0.length,c=0;c<l;c++){if(a=t.currentVisibles0[c],this.octreesLod0ReferencesToParseMap.delete(a)){if(void 0===a.neoReferencesMotherAndIndices)continue;if(void 0===a.neoReferencesMotherAndIndices.dataArraybuffer)continue;if(a.neoReferencesMotherAndIndices.fileLoadState!==CODE.fileLoadState.LOADING_FINISHED)continue;d=(o=a.neoBuildingOwner).geoLocDataManager.getGeoLocationData(0);n=o.getHeaderVersion(),this.matrix4SC.setByFloat32Array(d.rotMatrix._floatArrays),"v"===n[0]?a.neoReferencesMotherAndIndices.parseArrayBufferReferences(e,a.neoReferencesMotherAndIndices.dataArraybuffer,r.readerWriter,o.motherNeoReferencesArray,this.matrix4SC,r):a.neoReferencesMotherAndIndices.parseArrayBufferReferencesVersioned(e,a.neoReferencesMotherAndIndices.dataArraybuffer,r.readerWriter,o.motherNeoReferencesArray,this.matrix4SC,r),a.neoReferencesMotherAndIndices.multiplyKeyTransformMatrix(0,d.rotMatrix),a.neoReferencesMotherAndIndices.dataArraybuffer=void 0,s++}else if(a.neoReferencesMotherAndIndices&&a.neoReferencesMotherAndIndices.fileLoadState===CODE.fileLoadState.LOADING_FINISHED);if(s>i)break}if(0===s)for(var h=Array.from(this.octreesLod0ReferencesToParseMap.keys()),c=0;c<h.length;c++)if(a=h[c],this.octreesLod0ReferencesToParseMap.delete(a),void 0!==a.neoReferencesMotherAndIndices&&void 0!==a.neoReferencesMotherAndIndices.dataArraybuffer&&a.neoReferencesMotherAndIndices.fileLoadState===CODE.fileLoadState.LOADING_FINISHED){var d=(o=a.neoBuildingOwner).geoLocDataManager.getGeoLocationData(0);if(n=o.getHeaderVersion(),this.matrix4SC.setByFloat32Array(d.rotMatrix._floatArrays),"v"===n[0]?a.neoReferencesMotherAndIndices.parseArrayBufferReferences(e,a.neoReferencesMotherAndIndices.dataArraybuffer,r.readerWriter,o.motherNeoReferencesArray,this.matrix4SC,r):a.neoReferencesMotherAndIndices.parseArrayBufferReferencesVersioned(e,a.neoReferencesMotherAndIndices.dataArraybuffer,r.readerWriter,o.motherNeoReferencesArray,this.matrix4SC,r),a.neoReferencesMotherAndIndices.multiplyKeyTransformMatrix(0,d.rotMatrix),a.neoReferencesMotherAndIndices.dataArraybuffer=void 0,++s>i)break}}return s>0},ParseQueue.prototype.putOctreeLod0ReferencesToParse=function(e,t){void 0===t&&(t=0),this.octreesLod0ReferencesToParseMap.set(e,t)},ParseQueue.prototype.eraseOctreeLod0ReferencesToParse=function(e){this.octreesLod0ReferencesToParseMap.delete(e)},ParseQueue.prototype.putOctreeLod0ModelsToParse=function(e,t){void 0===t&&(t=0),this.octreesLod0ModelsToParseMap.set(e,t)},ParseQueue.prototype.eraseOctreeLod0ModelsToParse=function(e){this.octreesLod0ModelsToParseMap.delete(e)},ParseQueue.prototype.putOctreeLod2LegosToParse=function(e,t){void 0===t&&(t=0),this.octreesLod2LegosToParseMap.set(e,t)},ParseQueue.prototype.eraseOctreeLod2LegosToParse=function(e){this.octreesLod2LegosToParseMap.delete(e)};var ProcessQueue=function(){if(!(this instanceof ProcessQueue))throw new Error(Messages.CONSTRUCT_ERROR);this.nodesToDeleteMap=new Map,this.nodesToDeleteModelReferencesMap=new Map};ProcessQueue.prototype.putNodeToDeleteModelReferences=function(e,t){void 0===t&&(t=0),this.nodesToDeleteModelReferencesMap.set(e,t)},ProcessQueue.prototype.eraseNodeToDeleteModelReferences=function(e){this.nodesToDeleteModelReferencesMap.delete(e)},ProcessQueue.prototype.putNodeToDelete=function(e,t){void 0===t&&(t=0),this.nodesToDeleteMap.set(e,t)},ProcessQueue.prototype.putNodesArrayToDelete=function(e,t){if(void 0!==e){void 0===t&&(t=0);for(var r=e.length,i=0;i<r;i++)this.putNodeToDelete(e[i],t)}},ProcessQueue.prototype.eraseNodeToDelete=function(e){this.nodesToDeleteMap.delete(e)};var ProjectTree=function(){if(!(this instanceof ProjectTree))throw new Error(Messages.CONSTRUCT_ERROR);this.root},ReaderWriter=function(){if(!(this instanceof ReaderWriter))throw new Error(Messages.CONSTRUCT_ERROR);this.geometryDataPath=MagoConfig.getPolicy().geo_data_path,this.viArraysContainer=new VertexIdxVBOArraysContainer,this.byteColorsVBOArraysContainer=new ByteColorsVBOArraysContainer,this.j_counter,this.k_counter,this.gl,this.incre_latAng=.001,this.incre_longAng=.001,this.GAIA3D__offset_latitude=-.001,this.GAIA3D__offset_longitude=-.001,this.GAIA3D__counter=0,this.uint32,this.uint16,this.int16,this.float32,this.float16,this.int8,this.int8_value,this.max_color_value=126,this.startBuff,this.endBuff,this.filesReadings_count=0,this.temp_var_to_waste,this.countSC,this.xSC,this.ySC,this.zSC,this.point3dSC=new Point3D,this.bboxSC=new BoundingBox};ReaderWriter.prototype.readUInt32=function(e,t,r){return new Uint32Array(e.slice(t,r))[0]},ReaderWriter.prototype.readInt32=function(e,t,r){return new Int32Array(e.slice(t,r))[0]},ReaderWriter.prototype.readUInt16=function(e,t,r){return new Uint16Array(e.slice(t,r))[0]},ReaderWriter.prototype.readInt16=function(e,t,r){return new Int16Array(e.slice(t,r))[0]},ReaderWriter.prototype.readFloat64=function(e,t,r){return new Float64Array(e.slice(t,r))[0]},ReaderWriter.prototype.readFloat32=function(e,t,r){return new Float32Array(e.slice(t,r))[0]},ReaderWriter.prototype.readFloat16=function(e,t,r){return new Float32Array(e.slice(t,r))[0]},ReaderWriter.prototype.readInt8=function(e,t,r){return new Int8Array(e.slice(t,r))[0]},ReaderWriter.prototype.readUInt8=function(e,t,r){return new Uint8Array(e.slice(t,r))[0]},ReaderWriter.prototype.readInt8ByteColor=function(e,t,r){var i=new Int8Array(e.slice(t,r))[0];return i>max_color_value&&(i=max_color_value),i<0&&(i+=256),i},ReaderWriter.prototype.getBoundingBoxFromFloat32Array=function(e,t){void 0===t&&(t=new BoundingBox);for(var r=e.length,i=0;i<r;i+=3)this.point3dSC.x=e[i],this.point3dSC.y=e[i+1],this.point3dSC.z=e[i+2],0===i?t.init(this.point3dSC):t.addPoint(this.point3dSC);return t},ReaderWriter.prototype.getNeoBlocksArraybuffer=function(e,t,r){r.fileRequestControler.modelRefFilesRequestedCount+=1;var i=t.neoReferencesMotherAndIndices.blocksList;i.fileLoadState=CODE.fileLoadState.LOADING_STARTED,loadWithXhr(e).done(function(e){var o=e;o?(i.dataArraybuffer=o,i.fileLoadState=CODE.fileLoadState.LOADING_FINISHED,o=null,r.parseQueue.putOctreeLod0ModelsToParse(t)):i.fileLoadState=500}).fail(function(e){i.fileLoadState=0===e?500:e}).always(function(){r.fileRequestControler.modelRefFilesRequestedCount-=1,r.fileRequestControler.modelRefFilesRequestedCount<0&&(r.fileRequestControler.modelRefFilesRequestedCount=0)})},ReaderWriter.prototype.getNeoBlocks=function(e,t,r,i,o){r.fileLoadState=CODE.fileLoadState.LOADING_STARTED,loadWithXhr(t).done(function(t){var o=t;o?(i.readNeoBlocks(e,o,r),r.fileLoadState=CODE.fileLoadState.LOADING_FINISHED,o=null):r.fileLoadState=500}).fail(function(e){r.fileLoadState=0===e?500:e}).always(function(){})},ReaderWriter.prototype.getNeoReferencesArraybuffer=function(e,t,r){r.fileRequestControler.modelRefFilesRequestedCount+=1,t.neoReferencesMotherAndIndices.fileLoadState=CODE.fileLoadState.LOADING_STARTED,loadWithXhr(e).done(function(e){var i=e;if(i){var o=t.neoReferencesMotherAndIndices;o&&(o.dataArraybuffer=i,o.fileLoadState=CODE.fileLoadState.LOADING_FINISHED,r.parseQueue.putOctreeLod0ReferencesToParse(t)),i=null}else t.neoReferencesMotherAndIndices.fileLoadState=500}).fail(function(e){t.neoReferencesMotherAndIndices.fileLoadState=0===e?500:e}).always(function(){r.fileRequestControler.modelRefFilesRequestedCount-=1,r.fileRequestControler.modelRefFilesRequestedCount<0&&(r.fileRequestControler.modelRefFilesRequestedCount=0)})},ReaderWriter.prototype.getOctreeLegoArraybuffer=function(e,t,r){r.fileRequestControler.filesRequestedCount+=1,t.lego.fileLoadState=CODE.fileLoadState.LOADING_STARTED,loadWithXhr(e).done(function(e){var i=e;i?(t.lego?(t.lego.dataArrayBuffer=i,t.lego.fileLoadState=CODE.fileLoadState.LOADING_FINISHED,r.parseQueue.putOctreeLod2LegosToParse(t)):t=void 0,i=null):t.lego.fileLoadState=500}).fail(function(e){t.lego.fileLoadState=0===e?500:e}).always(function(){r.fileRequestControler.filesRequestedCount-=1,r.fileRequestControler.filesRequestedCount<0&&(r.fileRequestControler.filesRequestedCount=0)})},ReaderWriter.prototype.getLodBuildingArraybuffer=function(e,t,r){r.fileRequestControler.filesRequestedCount+=1,t.fileLoadState=CODE.fileLoadState.LOADING_STARTED,loadWithXhr(e).done(function(e){var r=e;r?(t.dataArraybuffer=r,t.fileLoadState=CODE.fileLoadState.LOADING_FINISHED,r=null):t.fileLoadState=500}).fail(function(e){t.fileLoadState=0===e?500:e}).always(function(){r.fileRequestControler.filesRequestedCount-=1,r.fileRequestControler.filesRequestedCount<0&&(r.fileRequestControler.filesRequestedCount=0)})},ReaderWriter.prototype.readTerranTileFile=function(e,t,r,i,o,a){i._depth=this.readInt32(t,a,a+4),a+=4,0===i._depth&&(i.longitudeMin=this.readFloat64(t,a,a+8),a+=8,i.longitudeMax=this.readFloat64(t,a,a+8),a+=8,i.latitudeMin=this.readFloat64(t,a,a+8),a+=8,i.latitudeMax=this.readFloat64(t,a,a+8),a+=8);var n=this.readInt32(t,a,a+4);return a+=4,i.makeTree(n),a},ReaderWriter.prototype.getTerranTileFile=function(e,t,r,i){loadWithXhr(t).done(function(o){var a=o;if(a){i.readTerranTileFile(e,a,t,r,i,0),r.setDimensionsSubTiles(),r.calculatePositionByLonLatSubTiles(),r.terranIndexFile_readed=!0,a=null}}).fail(function(e){}).always(function(){})},ReaderWriter.prototype.getPCloudIndexFile=function(e,t,r,i){loadWithXhr(t).done(function(e){var t=e;if(t){var o,a=0,n=0,s=i.readInt32(t,a,a+4);a+=4;for(var l=0;l<s;l++){o=new PCloudMesh,r._pCloudMesh_array.push(o),o._header._f4d_version=2,n=i.readInt32(t,a,a+4),a+=4;for(var c=0;c<n;c++)o._f4d_rawPathName+=String.fromCharCode(new Int8Array(t.slice(a,a+1))),a+=1;o._f4d_headerPathName=o._f4d_rawPathName+"/pCloud_Header.hed",o._f4d_geometryPathName=o._f4d_rawPathName+"/pCloud_Geo.f4d"}t=null}}).fail(function(e){}).always(function(){})},ReaderWriter.prototype.getPCloudHeader=function(e,t,r,i,o){r._f4d_header_readed=!0,loadWithXhr(t).done(function(e){var t=e;if(t){for(var a=0,n=0,s=r._header,l=0;l<5;l++)s._version+=String.fromCharCode(new Int8Array(t.slice(a,a+1))),a+=1;s._type=String.fromCharCode(new Int8Array(t.slice(a,a+1))),a+=1,n=i.readInt32(t,a,a+4),a+=4;for(l=0;l<n;l++)s._global_unique_id+=String.fromCharCode(new Int8Array(t.slice(a,a+1))),a+=1;s._latitude=new Float64Array(t.slice(a,a+8))[0],a+=8,s._longitude=new Float64Array(t.slice(a,a+8))[0],a+=8,s._elevation=new Float32Array(t.slice(a,a+4))[0],a+=4,s._elevation+=60,new Float32Array(t.slice(a,a+4)),a+=4,new Float32Array(t.slice(a,a+4)),a+=4,new Float32Array(t.slice(a,a+4)),a+=4,s._boundingBox.minX=new Float32Array(t.slice(a,a+4))[0],a+=4,s._boundingBox.minY=new Float32Array(t.slice(a,a+4))[0],a+=4,s._boundingBox.minZ=new Float32Array(t.slice(a,a+4))[0],a+=4,s._boundingBox.maxX=new Float32Array(t.slice(a,a+4))[0],a+=4,s._boundingBox.maxY=new Float32Array(t.slice(a,a+4))[0],a+=4,s._boundingBox.maxZ=new Float32Array(t.slice(a,a+4))[0],a+=4;var c=!1;(s._boundingBox.maxX-s._boundingBox.minX>40||s._boundingBox.maxY-s._boundingBox.minY>40)&&(c=!0),!c&&s._boundingBox.maxZ-s._boundingBox.minZ<30&&(s.isSmall=!0),s._octZerothBox.minX=new Float32Array(t.slice(a,a+4))[0],a+=4,s._octZerothBox.minY=new Float32Array(t.slice(a,a+4))[0],a+=4,s._octZerothBox.minZ=new Float32Array(t.slice(a,a+4))[0],a+=4,s._octZerothBox.maxX=new Float32Array(t.slice(a,a+4))[0],a+=4,s._octZerothBox.maxY=new Float32Array(t.slice(a,a+4))[0],a+=4,s._octZerothBox.maxZ=new Float32Array(t.slice(a,a+4))[0],a+=4,n=i.readInt32(t,a,a+4),a+=4;for(l=0;l<n;l++)s._dataFileName+=String.fromCharCode(new Int8Array(t.slice(a,a+1))),a+=1;var h=Cesium.Cartesian3.fromDegrees(s._longitude,s._latitude,s._elevation);r._pCloudPosition=h;Cesium.EncodedCartesian3.encode(h);var d=Cesium.EncodedCartesian3.encode(h.x),u=Cesium.EncodedCartesian3.encode(h.y),f=Cesium.EncodedCartesian3.encode(h.z);r._pCloudPositionHIGH=new Float32Array(3),r._pCloudPositionHIGH[0]=d.high,r._pCloudPositionHIGH[1]=u.high,r._pCloudPositionHIGH[2]=f.high,r._pCloudPositionLOW=new Float32Array(3),r._pCloudPositionLOW[0]=d.low,r._pCloudPositionLOW[1]=u.low,r._pCloudPositionLOW[2]=f.low,o.backGround_fileReadings_count>0&&(o.backGround_fileReadings_count-=1),r._f4d_header_readed_finished=!0,t=null}}).fail(function(e){}).always(function(){})},ReaderWriter.prototype.getObjectIndexFileForSmartTile=function(e,t,r){loadWithXhr(e).done(function(e){var i=e;i&&(r.dataArrayBuffer=i,r.parseBuildingSeedArrayBuffer(),t.makeSmartTile(r),i=null)}).fail(function(e){}).always(function(){})},ReaderWriter.prototype.getObjectIndexFile=function(e,t,r,i){loadWithXhr(e).done(function(e){var o=e;o&&(t.parseObjectIndexFile(o,r),o=null,i.createDeploymentGeoLocationsForHeavyIndustries())}).fail(function(e){}).always(function(){})},ReaderWriter.prototype.parseObjectIndexFile=function(e,t){var r,i,o,a,n=0,s=this.readInt32(e,n,n+4);n+=4;for(var l=0;l<s;l++){var c=t.newNeoBuilding();void 0===c.metaData&&(c.metaData=new MetaData),void 0===c.metaData.geographicCoord&&(c.metaData.geographicCoord=new GeographicCoord),void 0===c.metaData.bbox&&(c.metaData.bbox=new BoundingBox),r=this.readInt32(e,n,n+4),n+=4;var h=String.fromCharCode.apply(null,new Int8Array(e.slice(n,n+r)));n+=r,i=this.readFloat64(e,n,n+8),n+=8,o=this.readFloat64(e,n,n+8),n+=8,a=this.readFloat32(e,n,n+4),n+=4,c.bbox=new BoundingBox,c.bbox.minX=this.readFloat32(e,n,n+4),n+=4,c.bbox.minY=this.readFloat32(e,n,n+4),n+=4,c.bbox.minZ=this.readFloat32(e,n,n+4),n+=4,c.bbox.maxX=this.readFloat32(e,n,n+4),n+=4,c.bbox.maxY=this.readFloat32(e,n,n+4),n+=4,c.bbox.maxZ=this.readFloat32(e,n,n+4),n+=4,c.buildingId=h.substr(4,r-4),c.buildingType="basicBuilding",c.buildingFileName=h,c.metaData.geographicCoord.setLonLatAlt(i,o,a)}t.neoBuildingsArray.reverse()},ReaderWriter.prototype.getNeoHeader=function(e,t,r,i,o){o.fileRequestControler.filesRequestedCount+=1,r.metaData.fileLoadState=CODE.fileLoadState.LOADING_STARTED,loadWithXhr(t).done(function(e){var t=e;t?(void 0===r.metaData&&(r.metaData=new MetaData),r.metaData.parseFileHeader(t,i),void 0===r.octree&&(r.octree=new Octree(void 0)),r.octree.setBoxSize(r.metaData.oct_min_x,r.metaData.oct_max_x,r.metaData.oct_min_y,r.metaData.oct_max_y,r.metaData.oct_min_z,r.metaData.oct_max_z),r.octree.makeTree(3),r.octree.setSizesSubBoxes(),r.metaData.fileLoadState=CODE.fileLoadState.LOADING_FINISHED,t=null):r.metaData.fileLoadState=500}).fail(function(e){r.metaData.fileLoadState=0===e?500:e}).always(function(){o.fileRequestControler.filesRequestedCount-=1,o.fileRequestControler.filesRequestedCount<0&&(o.fileRequestControler.filesRequestedCount=0)})},ReaderWriter.prototype.getNeoHeaderAsimetricVersion=function(e,t,r,i,o){o.fileRequestControler.headerFilesRequestedCount+=1,r.metaData.fileLoadState=CODE.fileLoadState.LOADING_STARTED,loadWithXhr(t).done(function(e){var t=e;if(t){void 0===r.metaData&&(r.metaData=new MetaData);var o=r.metaData.parseFileHeaderAsimetricVersion(t,i);void 0===r.octree&&(r.octree=new Octree(void 0)),o=r.octree.parseAsimetricVersion(t,i,o,r),r.metaData.oct_min_x=r.octree.centerPos.x-r.octree.half_dx,r.metaData.oct_max_x=r.octree.centerPos.x+r.octree.half_dx,r.metaData.oct_min_y=r.octree.centerPos.y-r.octree.half_dy,r.metaData.oct_max_y=r.octree.centerPos.y+r.octree.half_dy,r.metaData.oct_min_z=r.octree.centerPos.z-r.octree.half_dz,r.metaData.oct_max_z=r.octree.centerPos.z+r.octree.half_dz;var a=r.metaData.version[0],n=r.metaData.version[2],s=r.metaData.version[4];if(0===a&&0===n&&1===s){var l=i.readInt32(t,o,o+4);o+=4;for(var c=0;c<l;c++){var h="",d="",u=i.readUInt32(t,o,o+4);o+=4;for(g=0;g<u;g++)h+=String.fromCharCode(new Int8Array(t.slice(o,o+1))),o+=1;var f=i.readUInt32(t,o,o+4);o+=4;for(var g=0;g<f;g++)d+=String.fromCharCode(new Int8Array(t.slice(o,o+1))),o+=1;if(f>0){var m=new Texture;m.textureTypeName=h,m.textureImageFileName=d,r.texturesLoaded.push(m)}}}r.metaData.fileLoadState=CODE.fileLoadState.LOADING_FINISHED,t=void 0}else r.metaData.fileLoadState=500,t=void 0}).fail(function(e){r.metaData.fileLoadState=0===e?500:e}).always(function(){o.fileRequestControler.headerFilesRequestedCount-=1,o.fileRequestControler.headerFilesRequestedCount<0&&(o.fileRequestControler.headerFilesRequestedCount=0)})},ReaderWriter.prototype.readNailImageOfArrayBuffer=function(e,t,r,i,o,a){var n=r._simpleBuilding_v1,s=new Blob([t],{type:"image/jpeg"}),l=(window.URL||window.webkitURL).createObjectURL(s),c=new Image;c.onload=function(){void 0===n._simpleBuildingTexture&&(n._simpleBuildingTexture=e.createTexture()),handleTextureLoaded(e,c,n._simpleBuildingTexture),r._f4d_nailImage_readed_finished=!0,t=null,r._simpleBuilding_v1.textureArrayBuffer=null,o.backGround_imageReadings_count>0&&o.backGround_imageReadings_count--},c.onerror=function(){},c.src=l},ReaderWriter.prototype.readNailImage=function(e,t,r,i,o,a){void 0===a&&(a=3),3===a?r._f4d_nailImage_readed=!0:0===a&&(r._f4d_lod0Image_readed=!0),void 0===r._simpleBuilding_v1&&(r._simpleBuilding_v1=new SimpleBuildingV1);var n=r._simpleBuilding_v1,s=new Image;s.onload=function(){3===a?(handleTextureLoaded(e,s,n._simpleBuildingTexture),r._f4d_nailImage_readed_finished=!0):0===a&&(void 0===n._texture_0&&(n._texture_0=e.createTexture()),handleTextureLoaded(e,s,n._texture_0),r._f4d_lod0Image_readed_finished=!0),o.backGround_fileReadings_count>0&&(o.backGround_fileReadings_count-=1)},s.onerror=function(){r._f4d_lod0Image_readed_finished=!1,r._f4d_lod0Image_exists=!1,o.backGround_fileReadings_count>0&&(o.backGround_fileReadings_count-=1)};var l=t;s.src=l},ReaderWriter.prototype.readTexture=function(e,t,r,i){r.loadStarted=!0,r.texImage=new Image,r.texImage.onload=function(){r.loadFinished=!0,i.backGround_fileReadings_count>0&&(i.backGround_fileReadings_count-=1)},r.texImage.onerror=function(){r.loadStarted=!1,i.backGround_fileReadings_count>0&&(i.backGround_fileReadings_count-=1)},r.texImage.src=t},ReaderWriter.prototype.decodeTGA=function(e){var t,r,i,o,a,n=new Uint8Array(e),s=18+n[0],l=n[2],c=n[12]+(n[13]<<8),h=n[14]+(n[15]<<8),d=n[16],u=d/8,f=4*c;if(!c||!h)return null;if(2!==l)return null;for(t=new Uint8Array(c*h*4),r=s,a=h-1;a>=0;--a)for(o=0;o<c;++o,r+=u)t[i=4*o+a*f]=n[r+2],t[i+1]=n[r+1],t[i+2]=n[r+0],t[i+3]=32===d?n[r+3]:255;return{width:c,height:h,data:t}},ReaderWriter.prototype.readNeoReferenceTexture=function(e,t,r,i,o){var a=t.split(".").pop();if("tga"===a||"TGA"===a||"Tga"===a)loadWithXhr(t).done(function(t){var i=t;if(i){var o=new TGA;if(o.load(i),o){var a;if(3===o.header.bytePerPixel)a=e.RGB;else if(4===o.header.bytePerPixel){a=e.RGBA;for(var n,s,l,c,h=o.imageData.length/4,d=0;d<h;d++)n=o.imageData[4*d],s=o.imageData[4*d+1],l=o.imageData[4*d+2],c=o.imageData[4*d+3],o.imageData[4*d]=l,o.imageData[4*d+1]=s,o.imageData[4*d+2]=n,o.imageData[4*d+3]=c}e.bindTexture(e.TEXTURE_2D,r.texId),e.texImage2D(e.TEXTURE_2D,0,a,o.header.width,o.header.height,0,a,e.UNSIGNED_BYTE,o.imageData),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.generateMipmap(e.TEXTURE_2D),r.fileLoadState=CODE.fileLoadState.LOADING_FINISHED}}}).fail(function(e){i&&(i.metaData.fileLoadState=0===e?500:e)}).always(function(){o.backGround_fileReadings_count-=1,o.backGround_fileReadings_count<0&&(o.backGround_fileReadings_count=0)});else{var n=new Image;r.fileLoadState=CODE.fileLoadState.LOADING_STARTED,n.onload=function(){void 0!==r.texId&&(handleTextureLoaded(e,n,r.texId),r.fileLoadState=CODE.fileLoadState.LOADING_FINISHED,o.backGround_fileReadings_count>0&&(o.backGround_fileReadings_count-=1))},n.onerror=function(){},n.src=t}},ReaderWriter.prototype.readLegoSimpleBuildingTexture=function(e,t,r,i){var o=new Image;o.onload=function(){void 0===r.texId&&(r.texId=e.createTexture()),handleTextureLoaded(e,o,r.texId),i.backGround_fileReadings_count>0&&(i.backGround_fileReadings_count-=1)},o.onerror=function(){},o.src=t},ReaderWriter.prototype.openTerranTile=function(e,t,r){var i=this.geometryDataPath+Constant.RESULT_XDO2F4D_TERRAINTILEFILE_TXT;r.getTerranTileFile(e,i,t,r)},ReaderWriter.prototype.getTileArrayBuffer=function(e,t,r,i,o){r.fileReading_started=!0,loadWithXhr(t).done(function(e){var t=e;t&&(r.fileArrayBuffer=t,r.fileReading_finished=!0,o.backGround_fileReadings_count>0&&(o.backGround_fileReadings_count-=1),t=null)}).fail(function(e){}).always(function(){})},ReaderWriter.prototype.getPCloudGeometry=function(e,t,r,i,o){r._f4d_geometry_readed=!0,loadWithXhr(t).done(function(t){var a=t;if(a){var n,s,l=0,c=i.readUInt32(a,l,l+4);l+=4;for(var h=0;h<c;h++){var d=i.readUInt32(a,l,l+4);l+=4;for(var u=0;u<d;u++){var f=r.vbo_datas.newVBOVertexIdxCacheKey(),g=i.readUInt32(a,l,l+4);n=l+=4,s=l+28*g,f.meshVertexCacheKey=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,f.meshVertexCacheKey),e.bufferData(e.ARRAY_BUFFER,a.slice(n,s),e.STATIC_DRAW),l+=28*g;var m=i.readUInt32(a,l,l+4);l+=4,f.indicesCount=m,n=l,s=l+2*m,f.meshFacesCacheKey=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,f.meshFacesCacheKey),e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Uint16Array(a.slice(n,s)),e.STATIC_DRAW),l+=2*m}}o.backGround_fileReadings_count>0&&(o.backGround_fileReadings_count-=1),r._f4d_geometry_readed_finished=!0,a=null}}).fail(function(e){}).always(function(){})},ReaderWriter.prototype.handleTextureLoaded=function(e,t,r){e.bindTexture(e.TEXTURE_2D,r),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT),e.generateMipmap(e.TEXTURE_2D),e.bindTexture(e.TEXTURE_2D,null)};var Renderer=function(){if(!(this instanceof Renderer))throw new Error(Messages.CONSTRUCT_ERROR);this.vbo_vi_cacheKey_aux,this.byteColorAux=new ByteColor,this.currentTimeSC,this.dateSC,this.startTimeSC,this.simpObj_scratch};Renderer.prototype.renderNeoBuildingsAsimetricVersion=function(e,t,r,i,o,a,n,s,l){var c,h,d,u,f=0;e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL),e.depthRange(0,1),"true"===MagoConfig.getPolicy().geo_cull_face_enable?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),e.enable(e.CULL_FACE),e.frontFace(e.CCW);for(var g=t.length,m=0;m<g;m++)if(c=t[m],void 0!==(h=c.data.neoBuilding).currentVisibleOctreesControler){var y=h.getGeoLocationData();e.uniformMatrix4fv(i.buildingRotMatrix_loc,!1,y.rotMatrix._floatArrays),e.uniform3fv(i.buildingPosHIGH_loc,y.positionHIGH),e.uniform3fv(i.buildingPosLOW_loc,y.positionLOW),0===a?o=!1:1===a&&(o=!!(h.texturesLoaded&&h.texturesLoaded.length>0)),f=0,d=h.currentVisibleOctreesControler.currentVisibles0.length;for(p=0;p<d;p++)void 0!==(u=h.currentVisibleOctreesControler.currentVisibles0[p]).neoReferencesMotherAndIndices&&this.renderNeoRefListsAsimetricVersion(e,u.neoReferencesMotherAndIndices,h,r,!1,i,o,a,f,0,l);f=1,d=h.currentVisibleOctreesControler.currentVisibles1.length;for(var p=0;p<d;p++)void 0!==(u=h.currentVisibleOctreesControler.currentVisibles1[p]).neoReferencesMotherAndIndices&&this.renderNeoRefListsAsimetricVersion(e,u.neoReferencesMotherAndIndices,h,r,!1,i,o,a,f,1,l)}},Renderer.prototype.renderNeoBuildingsLOD2AsimetricVersion=function(e,t,r,i,o,a){for(var n,s,l,c,h,d=t.length,u=0;u<d;u++)if(n=t[u],void 0!==(s=n.data.neoBuilding).currentVisibleOctreesControler&&0!=(l=s.currentVisibleOctreesControler.currentVisibles2.length)){var f=s.getGeoLocationData();e.uniformMatrix4fv(i.buildingRotMatrix_loc,!1,f.rotMatrix._floatArrays),e.uniform3fv(i.buildingPosHIGH_loc,f.positionHIGH),e.uniform3fv(i.buildingPosLOW_loc,f.positionLOW);for(var g=0;g<l;g++)void 0===(c=s.currentVisibleOctreesControler.currentVisibles2[g]).lego&&(c.lego=new Lego,c.lego.fileLoadState=CODE.fileLoadState.READY),void 0===c.lego&&void 0===c.lego.dataArrayBuffer||void 0!==s&&"outfitting"!==s.buildingType&&(1===a&&(s.isHighLighted?(e.uniform1i(i.bUse1Color_loc,!0),e.uniform4fv(i.oneColor4_loc,this.highLightColor4)):s.isColorChanged?(e.uniform1i(i.bUse1Color_loc,!0),e.uniform4fv(i.oneColor4_loc,[s.aditionalColor.r,s.aditionalColor.g,s.aditionalColor.b,s.aditionalColor.a])):e.uniform1i(i.bUse1Color_loc,!1),o=!0,void 0!==s.simpleBuilding3x3Texture&&s.simpleBuilding3x3Texture.texId?(e.enableVertexAttribArray(i.texCoord2_loc),e.uniform1i(i.hasTexture_loc,!0),h!==s.simpleBuilding3x3Texture.texId&&(e.bindTexture(e.TEXTURE_2D,s.simpleBuilding3x3Texture.texId),h=s.simpleBuilding3x3Texture.texId)):(e.uniform1i(i.hasTexture_loc,!1),e.disableVertexAttribArray(i.texCoord2_loc),o=!1)),this.renderLodBuilding(e,c.lego,r,i,a,o))}},Renderer.prototype.renderNeoRefListsAsimetricVersion=function(e,t,r,i,o,a,n,s,l,c,h){if(void 0!==t.neoRefsIndices&&0!==t.neoRefsIndices.length)if(0!==s){var d,u,f,g;e.activeTexture(e.TEXTURE2),n?1===s&&e.uniform1i(a.hasTexture_loc,!0):e.bindTexture(e.TEXTURE_2D,i.textureAux_1x1),e.bindTexture(e.TEXTURE_2D,i.textureAux_1x1);var m=t.blocksList;if(void 0!==m&&m.fileLoadState===CODE.fileLoadState.PARSE_FINISHED){for(var y=t.currentVisibleIndices.length,p=0;p<y;p++){var v=t.motherNeoRefsList[t.currentVisibleIndices[p]];if(void 0!==v){if(i.isCameraMoving&&"2EyH307pn0$u_3EQJQ48gV"==v.objectId);if(v.bRendered!==i.renderingFase&&void 0!==v.tMatrixAuxArray){if(i.isCameraMoving&&"2EyH307pn0$u_3EQJQ48gV"==v.objectId);if(u=v._block_idx,void 0!==(f=r.motherBlocksArray[u])&&!(l&&f.radius<l||i.isCameraMoving&&f.radius<i.smallObjectSize&&i.objectSelected!==v)){if(void 0!==v.texture){if(r.manageNeoReferenceTexture(v,i)!==CODE.fileLoadState.LOADING_FINISHED)continue;if(void 0===v.texture.texId)continue}r.isHighLighted?(e.uniform1i(a.hasTexture_loc,!1),e.uniform4fv(a.color4Aux_loc,i.highLightColor4)):r.isColorChanged?(e.uniform1i(a.hasTexture_loc,!1),i.objectSelected===v?e.uniform4fv(a.color4Aux_loc,[1,0,0,1]):e.uniform4fv(a.color4Aux_loc,[r.aditionalColor.r,r.aditionalColor.g,r.aditionalColor.b,r.aditionalColor.a])):v.aditionalColor?(e.uniform1i(a.hasTexture_loc,!1),i.objectSelected===v?e.uniform4fv(a.color4Aux_loc,[1,0,0,1]):e.uniform4fv(a.color4Aux_loc,[v.aditionalColor.r,v.aditionalColor.g,v.aditionalColor.b,v.aditionalColor.a])):i.objectSelected===v?(e.uniform1i(a.hasTexture_loc,!1),e.uniform4fv(a.color4Aux_loc,[1,0,0,1]),e.enable(e.STENCIL_TEST),e.clearStencil(0),e.clear(e.STENCIL_BUFFER_BIT),e.stencilFunc(e.ALWAYS,1,1),e.stencilOp(e.REPLACE,e.REPLACE,e.REPLACE),e.disable(e.CULL_FACE)):i.magoPolicy.colorChangedObjectId===v.objectId?(e.uniform1i(a.hasTexture_loc,!1),e.uniform4fv(a.color4Aux_loc,[i.magoPolicy.color[0],i.magoPolicy.color[1],i.magoPolicy.color[2],1])):n&&v.hasTexture?void 0!==v.texture&&void 0!==v.texture.texId?(e.uniform1i(a.hasTexture_loc,!0),g!==v.texture.texId&&(e.bindTexture(e.TEXTURE_2D,v.texture.texId),g=v.texture.texId)):(e.uniform1i(a.hasTexture_loc,!1),e.uniform4fv(a.color4Aux_loc,[.8,.8,.8,1])):v.color4?(e.uniform1i(a.hasTexture_loc,!1),e.uniform4fv(a.color4Aux_loc,[v.color4.r/255,v.color4.g/255,v.color4.b/255,v.color4.a/255])):(e.uniform1i(a.hasTexture_loc,!1),e.uniform4fv(a.color4Aux_loc,[.8,.8,.8,1])),d=f.vBOVertexIdxCacheKeysContainer.vboCacheKeysArray.length,e.uniform1i(a.refMatrixType_loc,v.refMatrixType),void 0===h||-1===h?1===v.refMatrixType?e.uniform3fv(a.refTranslationVec_loc,v.refTranslationVec):2===v.refMatrixType&&e.uniformMatrix4fv(a.RefTransfMatrix,!1,v._matrix4._floatArrays):1===v.refMatrixType?e.uniform3fv(a.refTranslationVec_loc,v.refTranslationVec):2===v.refMatrixType&&e.uniformMatrix4fv(a.RefTransfMatrix,!1,v.tMatrixAuxArray[h]._floatArrays),void 0!==v.moveVector?(e.uniform1i(a.hasAditionalMov_loc,!0),e.uniform3fv(a.aditionalMov_loc,[v.moveVector.x,v.moveVector.y,v.moveVector.z])):(e.uniform1i(a.hasAditionalMov_loc,!1),e.uniform3fv(a.aditionalMov_loc,[0,0,0]));for(var _=0;_<d;_++)if(this.vbo_vi_cacheKey_aux=f.vBOVertexIdxCacheKeysContainer.vboCacheKeysArray[_],this.vbo_vi_cacheKey_aux.isReadyPositions(e,i.vboMemoryManager)&&this.vbo_vi_cacheKey_aux.isReadyNormals(e,i.vboMemoryManager)&&this.vbo_vi_cacheKey_aux.isReadyFaces(e,i.vboMemoryManager)){if(e.bindBuffer(e.ARRAY_BUFFER,this.vbo_vi_cacheKey_aux.meshVertexCacheKey),e.vertexAttribPointer(a.position3_loc,3,e.FLOAT,!1,0,0),-1!==a.normal3_loc&&(e.bindBuffer(e.ARRAY_BUFFER,this.vbo_vi_cacheKey_aux.meshNormalCacheKey),e.vertexAttribPointer(a.normal3_loc,3,e.BYTE,!0,0,0)),n&&v.hasTexture)if(f.vertexCount<=v.vertexCount){var x=v.vBOVertexIdxCacheKeysContainer.vboCacheKeysArray[_];if(!x.isReadyTexCoords(e,i.vboMemoryManager))continue;e.enableVertexAttribArray(a.texCoord2_loc),e.bindBuffer(e.ARRAY_BUFFER,x.meshTexcoordsCacheKey),e.vertexAttribPointer(a.texCoord2_loc,2,e.FLOAT,!1,0,0)}else-1!==a.texCoord2_loc&&e.disableVertexAttribArray(a.texCoord2_loc);else-1!==a.texCoord2_loc&&e.disableVertexAttribArray(a.texCoord2_loc);var b;i.isCameraMoving?i.objectSelected===v?b=this.vbo_vi_cacheKey_aux.indicesCount:(b=this.vbo_vi_cacheKey_aux.bigTrianglesIndicesCount)>this.vbo_vi_cacheKey_aux.indicesCount&&(b=this.vbo_vi_cacheKey_aux.indicesCount):i.thereAreUrgentOctrees?(b=this.vbo_vi_cacheKey_aux.bigTrianglesIndicesCount)>this.vbo_vi_cacheKey_aux.indicesCount&&(b=this.vbo_vi_cacheKey_aux.indicesCount):b=this.vbo_vi_cacheKey_aux.indicesCount,e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.vbo_vi_cacheKey_aux.meshFacesCacheKey),e.drawElements(e.TRIANGLES,b,e.UNSIGNED_SHORT,0)}v.bRendered=!v.bRendered,i.objectSelected===v&&(e.disable(e.STENCIL_TEST),e.disable(e.POLYGON_OFFSET_FILL),e.enable(e.CULL_FACE))}}}}e.enable(e.DEPTH_TEST),e.disable(e.STENCIL_TEST),e.enable(e.CULL_FACE)}}else this.depthRenderNeoRefListsAsimetricVersion(e,t,r,i,o,a,n,s,l,c,h)},Renderer.prototype.depthRenderNeoRefListsAsimetricVersion=function(e,t,r,i,o,a,n,s,l,c,h){if(0!==t.neoRefsIndices.length)for(var d,u,f,g=0;g<1;g++){var m=t.blocksList;if(void 0!==m&&m.fileLoadState===CODE.fileLoadState.PARSE_FINISHED)for(var y=t.currentVisibleIndices.length,p=0;p<y;p++){var v=t.motherNeoRefsList[t.currentVisibleIndices[p]];if(void 0!==v&&(v.bRendered!==i.renderingFase&&void 0!==v.tMatrixAuxArray&&(u=v._block_idx,void 0!==(f=r.motherBlocksArray[u])&&!(l&&f.radius<l||i.isCameraMoving&&f.radius<i.smallObjectSize&&i.objectSelected!==v)))){e.uniform1i(a.hasTexture_loc,!1),e.uniform4fv(a.color4Aux_loc,[0,0,0,1]),d=f.vBOVertexIdxCacheKeysContainer.vboCacheKeysArray.length,e.uniform1i(a.refMatrixType_loc,v.refMatrixType),void 0===h||-1===h?1===v.refMatrixType?e.uniform3fv(a.refTranslationVec_loc,v.refTranslationVec):2===v.refMatrixType&&e.uniformMatrix4fv(a.RefTransfMatrix,!1,v._matrix4._floatArrays):1===v.refMatrixType?e.uniform3fv(a.refTranslationVec_loc,v.refTranslationVec):2===v.refMatrixType&&e.uniformMatrix4fv(a.RefTransfMatrix,!1,v.tMatrixAuxArray[h]._floatArrays),void 0!==v.moveVector?(e.uniform1i(a.hasAditionalMov_loc,!0),e.uniform3fv(a.aditionalMov_loc,[v.moveVector.x,v.moveVector.y,v.moveVector.z])):(e.uniform1i(a.hasAditionalMov_loc,!1),e.uniform3fv(a.aditionalMov_loc,[0,0,0]));for(var _=0;_<d;_++)if(this.vbo_vi_cacheKey_aux=f.vBOVertexIdxCacheKeysContainer.vboCacheKeysArray[_],this.vbo_vi_cacheKey_aux.isReadyPositions(e,i.vboMemoryManager)&&this.vbo_vi_cacheKey_aux.isReadyFaces(e,i.vboMemoryManager)){e.bindBuffer(e.ARRAY_BUFFER,this.vbo_vi_cacheKey_aux.meshVertexCacheKey),e.vertexAttribPointer(a.position3_loc,3,e.FLOAT,!1,0,0);var x;i.isCameraMoving?i.objectSelected===v?x=this.vbo_vi_cacheKey_aux.indicesCount:(x=this.vbo_vi_cacheKey_aux.bigTrianglesIndicesCount)>this.vbo_vi_cacheKey_aux.indicesCount&&(x=this.vbo_vi_cacheKey_aux.indicesCount):x=this.vbo_vi_cacheKey_aux.indicesCount,e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.vbo_vi_cacheKey_aux.meshFacesCacheKey),e.drawElements(e.TRIANGLES,x,e.UNSIGNED_SHORT,0)}v.bRendered=!v.bRendered}}}},Renderer.prototype.renderNeoRefListsAsimetricVersionColorSelection=function(e,t,r,i,o,a,n,s,l){var c=t.neoReferencesMotherAndIndices;if(void 0!==c&&0!==c.neoRefsIndices.length){var h=c.blocksList;if(void 0!==h&&(h.fileLoadState!==CODE.fileLoadState.LOADING_FINISHED||i.isCameraMoving)&&h.fileLoadState===CODE.fileLoadState.PARSE_FINISHED)for(var d,u=c.currentVisibleIndices.length,f=i.selectionCandidates,g=0;g<u;g++){var m=c.motherNeoRefsList[c.currentVisibleIndices[g]];if(m.selColor4=i.selectionColor.getAvailableColor(m.selColor4),d=i.selectionColor.decodeColor3(m.selColor4.r,m.selColor4.g,m.selColor4.b),f.setCandidates(d,m,t,r),"20417"==m.objectId);m.selColor4&&e.uniform4fv(a.color4Aux_loc,[m.selColor4.r/255,m.selColor4.g/255,m.selColor4.b/255,1]),this.renderNeoReferenceAsimetricVersionColorSelection(e,m,c,r,i,a,n,s,l)}}},Renderer.prototype.renderNeoReferenceAsimetricVersionColorSelection=function(e,t,r,i,o,a,n,s,l){if(void 0!==r){var c,h,d,u=r.blocksList;if(void 0!==u&&(u.fileLoadState!==CODE.fileLoadState.LOADING_FINISHED||o.isCameraMoving)&&u.fileLoadState===CODE.fileLoadState.PARSE_FINISHED&&void 0!==t&&(h=t._block_idx,void 0!==(d=i.motherBlocksArray[h])&&!(n&&d.radius<n||o.isCameraMoving&&d.isSmallObj&&o.objectSelected!==t))){if(c=d.vBOVertexIdxCacheKeysContainer.vboCacheKeysArray.length,e.uniform1i(a.refMatrixType_loc,t.refMatrixType),void 0===s||-1===s)1===t.refMatrixType?e.uniform3fv(a.refTranslationVec_loc,t.refTranslationVec):2===t.refMatrixType&&e.uniformMatrix4fv(a.RefTransfMatrix,!1,t._matrix4._floatArrays);else{if(void 0===t.tMatrixAuxArray)return;1===t.refMatrixType?e.uniform3fv(a.refTranslationVec_loc,t.refTranslationVec):2===t.refMatrixType&&e.uniformMatrix4fv(a.RefTransfMatrix,!1,t.tMatrixAuxArray[s]._floatArrays)}void 0!==t.moveVector?(e.uniform1i(a.hasAditionalMov_loc,!0),e.uniform3fv(a.aditionalMov_loc,[t.moveVector.x,t.moveVector.y,t.moveVector.z])):(e.uniform1i(a.hasAditionalMov_loc,!1),e.uniform3fv(a.aditionalMov_loc,[0,0,0]));for(var f=0;f<c;f++)this.vbo_vi_cacheKey_aux=d.vBOVertexIdxCacheKeysContainer.vboCacheKeysArray[f],this.vbo_vi_cacheKey_aux.isReadyPositions(e,o.vboMemoryManager)&&this.vbo_vi_cacheKey_aux.isReadyFaces(e,o.vboMemoryManager)&&(e.bindBuffer(e.ARRAY_BUFFER,this.vbo_vi_cacheKey_aux.meshVertexCacheKey),e.vertexAttribPointer(a.position3_loc,3,e.FLOAT,!1,0,0),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.vbo_vi_cacheKey_aux.meshFacesCacheKey),e.drawElements(l,this.vbo_vi_cacheKey_aux.indicesCount,e.UNSIGNED_SHORT,0))}}},Renderer.prototype.renderNeoRefListsColorSelection=function(e,t,r,i,o,a){var n=t.length;if(0!==n){this.dateSC=new Date,this.startTimeSC=this.dateSC.getTime(),this.currentTimeSC;var s=0;e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL),e.depthRange(0,1),e.enable(e.CULL_FACE);for(var l,c,h,d=0;d<n;d++)for(var u=t[d],f=t[d].blocksList,g=u._currentVisibleIndices.length,m=0;m<g;m++){var y=u.neoRefs_Array[u._currentVisibleIndices[m]];if(y&&void 0!==y&&(!((c=y._block_idx)>=f.blocksArray.length)&&(h=f.getBlock(c),y.selColor4))){if(e.uniform4fv(a.color4Aux_loc,[y.selColor4.r/255,y.selColor4.g/255,y.selColor4.b/255,y.selColor4.a/255]),void 0!==h){l=h.vBOVertexIdxCacheKeysContainer.vboCacheKeysArray.length,e.uniformMatrix4fv(a.RefTransfMatrix,!1,y._matrix4._floatArrays),void 0!==y.moveVector?(e.uniform1i(a.hasAditionalMov_loc,!0),e.uniform3fv(a.aditionalMov_loc,[y.moveVector.x,y.moveVector.y,y.moveVector.z])):(e.uniform1i(a.hasAditionalMov_loc,!1),e.uniform3fv(a.aditionalMov_loc,[0,0,0]));for(var p=0;p<l;p++)this.vbo_vi_cacheKey_aux=h.vBOVertexIdxCacheKeysContainer.vboCacheKeysArray[p],this.vbo_vi_cacheKey_aux.isReadyPositions(e,i.vboMemoryManager)&&this.vbo_vi_cacheKey_aux.isReadyFaces(e,i.vboMemoryManager)&&(e.bindBuffer(e.ARRAY_BUFFER,this.vbo_vi_cacheKey_aux.meshVertexCacheKey),e.vertexAttribPointer(a.position3_loc,3,e.FLOAT,!1,0,0),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.vbo_vi_cacheKey_aux.meshFacesCacheKey),e.drawElements(e.TRIANGLES,this.vbo_vi_cacheKey_aux.indicesCount,e.UNSIGNED_SHORT,0))}++s>20&&(s=0)}}e.enable(e.DEPTH_TEST)}},Renderer.prototype.renderLodBuilding=function(e,t,r,i,o,a){if(0!==t.vbo_vicks_container.vboCacheKeysArray.length)if(e.frontFace(e.CCW),0===o){if(!(n=t.vbo_vicks_container.vboCacheKeysArray[0]).isReadyPositions(e,r.vboMemoryManager))return;if(0===(s=n.vertexCount))return;e.bindBuffer(e.ARRAY_BUFFER,n.meshVertexCacheKey),e.vertexAttribPointer(i.position3_loc,3,e.FLOAT,!1,0,0),e.drawArrays(e.TRIANGLES,0,s)}else if(1===o){var n=t.vbo_vicks_container.vboCacheKeysArray[0],s=n.vertexCount;if(0===s)return;if(!n.isReadyPositions(e,r.vboMemoryManager))return;if(!n.isReadyNormals(e,r.vboMemoryManager))return;if(!n.isReadyColors(e,r.vboMemoryManager))return;if(a&&!n.isReadyTexCoords(e,r.vboMemoryManager))return;e.disableVertexAttribArray(i.color4_loc),e.bindBuffer(e.ARRAY_BUFFER,n.meshVertexCacheKey),e.vertexAttribPointer(i.position3_loc,3,e.FLOAT,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,n.meshNormalCacheKey),e.vertexAttribPointer(i.normal3_loc,3,e.BYTE,!0,0,0),void 0!==n.meshColorCacheKey&&(e.enableVertexAttribArray(i.color4_loc),e.bindBuffer(e.ARRAY_BUFFER,n.meshColorCacheKey),e.vertexAttribPointer(i.color4_loc,4,e.UNSIGNED_BYTE,!0,0,0)),a&&n.meshTexcoordsCacheKey&&(e.bindBuffer(e.ARRAY_BUFFER,n.meshTexcoordsCacheKey),e.vertexAttribPointer(i.texCoord2_loc,2,e.FLOAT,!1,0,0)),e.drawArrays(e.TRIANGLES,0,s)}},Renderer.prototype.renderLodBuildingColorSelection=function(e,t,r,i){if(0!==t.vbo_vicks_container.vboCacheKeysArray.length){e.frontFace(e.CCW);var o=t.vbo_vicks_container.vboCacheKeysArray[0];if(o.isReadyPositions(e,r.vboMemoryManager)){var a=o.vertexCount;0!==a&&(e.bindBuffer(e.ARRAY_BUFFER,o.meshVertexCacheKey),e.vertexAttribPointer(i.position3_loc,3,e.FLOAT,!1,0,0),e.drawArrays(e.TRIANGLES,0,a))}}},Renderer.prototype.renderTriPolyhedron=function(e,t,r,i,o){if(0!==t.vbo_vicks_container.vboCacheKeysArray.length)if(e.frontFace(e.CCW),0===o){if(!(a=t.vbo_vicks_container.vboCacheKeysArray[0]).isReadyPositions(e,r.vboMemoryManager))return;if(0===(n=a.vertexCount))return;e.bindBuffer(e.ARRAY_BUFFER,a.meshVertexCacheKey),e.vertexAttribPointer(i.position3_loc,3,e.FLOAT,!1,0,0),e.drawArrays(e.TRIANGLES,0,n)}else if(1===o){var a=t.vbo_vicks_container.vboCacheKeysArray[0],n=a.vertexCount;if(0===n)return;if(!a.isReadyPositions(e,r.vboMemoryManager))return;if(!a.isReadyNormals(e,r.vboMemoryManager))return;if(!a.isReadyColors(e,r.vboMemoryManager))return;e.bindBuffer(e.ARRAY_BUFFER,a.meshVertexCacheKey),e.vertexAttribPointer(i.position3_loc,3,e.FLOAT,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,a.meshNormalCacheKey),e.vertexAttribPointer(i.normal3_loc,3,e.BYTE,!0,0,0),e.drawArrays(e.LINE_STRIP,0,n)}},Renderer.prototype.renderLego=function(e,t,r,i,o){if(0!==t.vbo_vicks_container.vboCacheKeysArray.length){var a;if(0===o){if(!a.isReadyPositions(e,r.vboMemoryManager))return;if(0===(n=a.vertexCount))return;e.bindBuffer(e.ARRAY_BUFFER,a.meshVertexCacheKey),e.vertexAttribPointer(i.position3_loc,3,e.FLOAT,!1,0,0),e.drawArrays(e.TRIANGLES,0,n)}else if(1===o){var n=(a=t.vbo_vicks_container.vboCacheKeysArray[0]).vertexCount;if(0===n)return;if(!a.isReadyPositions(e,r.vboMemoryManager))return;if(!a.isReadyNormals(e,r.vboMemoryManager))return;if(!a.isReadyColors(e,r.vboMemoryManager))return;e.bindBuffer(e.ARRAY_BUFFER,a.meshVertexCacheKey),e.vertexAttribPointer(i.position3_loc,3,e.FLOAT,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,a.meshNormalCacheKey),e.vertexAttribPointer(i.normal3_loc,3,e.BYTE,!0,0,0),e.bindBuffer(e.ARRAY_BUFFER,a.meshColorCacheKey),e.vertexAttribPointer(i.color4_loc,4,e.UNSIGNED_BYTE,!0,0,0),e.drawArrays(e.TRIANGLES,0,n)}}},Renderer.prototype.renderNeoSimpleBuildingPostFxShader=function(e,t,r,i,o){var a=t.neoSimpleBuilding;if(0!==a.vbo_vicks_container.vboCacheKeysArray.length){void 0===i&&(i=3),e.uniform3fv(o.buildingPosHIGH_loc,t.buildingPositionHIGH),e.uniform3fv(o.buildingPosLOW_loc,t.buildingPositionLOW);var n=a.texturesArray[0];e.activeTexture(e.TEXTURE2),3===i?e.bindTexture(e.TEXTURE_2D,n.textureId):0===i&&e.bindTexture(e.TEXTURE_2D,n.textureId);for(var s=a.accesorsArray.length,l=0,c=0;c<s;c++){var h=a.accesorsArray[c],d=!1;5120===h.data_ytpe?d=!0:5121===h.data_ytpe?d=!0:5122===h.data_ytpe?d=!0:5123===h.data_ytpe?d=!0:5126===h.data_ytpe&&(d=!1),0===h.accesor_type?(e.enableVertexAttribArray(o.position3_loc),e.vertexAttribPointer(o.position3_loc,h.dimension,h.data_ytpe,d,h.stride,h.buffer_start),l=h.stride):1===h.accesor_type?(e.enableVertexAttribArray(o.normal3_loc),e.vertexAttribPointer(o.normal3_loc,h.dimension,h.data_ytpe,d,h.stride,h.buffer_start)):3===h.accesor_type&&-1!==i&&(e.enableVertexAttribArray(o.texCoord2_loc),e.vertexAttribPointer(o.texCoord2_loc,h.dimension,h.data_ytpe,d,h.stride,h.buffer_start))}var u=a.vbo_vicks_container.vboCacheKeysArray[0];void 0===u.meshVertexCacheKey&&void 0!==u.buffer.dataArray&&(u.meshVertexCacheKey=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,u.meshVertexCacheKey),e.bufferData(e.ARRAY_BUFFER,u.buffer.dataArray,e.STATIC_DRAW),u.buffer.dataArray=void 0);var f=u.buffer.dataArrayByteLength/l;e.bindBuffer(e.ARRAY_BUFFER,u.meshVertexCacheKey),e.drawArrays(e.TRIANGLES,0,f)}},Renderer.prototype.renderNeoSimpleBuildingDepthShader=function(e,t,r,i){var o=t.neoSimpleBuilding;if(0!==o.vbo_vicks_container.vboCacheKeysArray.length){e.uniform3fv(i.buildingPosHIGH_loc,t.buildingPositionHIGH),e.uniform3fv(i.buildingPosLOW_loc,t.buildingPositionLOW);for(var a=o.accesorsArray.length,n=0,s=0;s<a;s++){var l=o.accesorsArray[s],c=!1;5120===l.data_ytpe?c=!0:5121===l.data_ytpe?c=!0:5122===l.data_ytpe?c=!0:5123===l.data_ytpe?c=!0:5126===l.data_ytpe&&(c=!1),0===l.accesor_type&&(e.enableVertexAttribArray(i.position3_loc),e.vertexAttribPointer(i.position3_loc,l.dimension,l.data_ytpe,c,l.stride,l.buffer_start),n=l.stride)}var h=o.vbo_vicks_container.vboCacheKeysArray[0];void 0===h.meshVertexCacheKey&&void 0!==h.buffer.dataArray&&(h.meshVertexCacheKey=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,h.meshVertexCacheKey),e.bufferData(e.ARRAY_BUFFER,h.buffer.dataArray,e.STATIC_DRAW),h.buffer.dataArray=void 0);var d=h.buffer.dataArrayByteLength/n;e.bindBuffer(e.ARRAY_BUFFER,h.meshVertexCacheKey),e.drawArrays(e.TRIANGLES,0,d)}},Renderer.prototype.renderSimpleBuildingV1PostFxShader=function(e,t,r,i,o){var a=t._simpleBuilding_v1;if(0!==a._simpleObjects_array.length){void 0===i&&(i=3),e.uniform3fv(o.buildingPosHIGH_loc,t.buildingPositionHIGH),e.uniform3fv(o.buildingPosLOW_loc,t.buildingPositionLOW),e.activeTexture(e.TEXTURE2),3===i?e.bindTexture(e.TEXTURE_2D,a._simpleBuildingTexture):0===i&&e.bindTexture(e.TEXTURE_2D,a._texture_0),this.simpObj_scratch=a._simpleObjects_array[0];var n=this.simpObj_scratch._vtCacheKeys_container._vtArrays_cacheKeys_array[0]._vertices_count;e.bindBuffer(e.ARRAY_BUFFER,this.simpObj_scratch._vtCacheKeys_container._vtArrays_cacheKeys_array[0]._verticesArray_cacheKey),e.vertexAttribPointer(o.position3_loc,3,e.FLOAT,!1,20,0),-1!==i&&e.vertexAttribPointer(o.texCoord2_loc,2,e.UNSIGNED_SHORT,!0,20,12),e.vertexAttribPointer(o.normal3_loc,3,e.BYTE,!0,20,16),e.drawArrays(e.TRIANGLES,0,n)}},Renderer.prototype.renderPCloudProject=function(e,t,r,i,o,a){var n=a.shadersManager.getMagoShader(6),s=n.SHADER_PROGRAM;e.uniform1i(s.samplerUniform,0),e.uniform3fv(n._BuildingPosHIGH,t._pCloudPositionHIGH),e.uniform3fv(n._BuildingPosLOW,t._pCloudPositionLOW);for(var l=t.vbo_datas.vboCacheKeysArray.length,c=0;c<l;c++){var h=t.vbo_datas.vboCacheKeysArray[c];e.bindBuffer(e.ARRAY_BUFFER,h.meshVertexCacheKey),e.vertexAttribPointer(n._position,3,e.FLOAT,!1,28,0),e.vertexAttribPointer(n._color,3,e.UNSIGNED_BYTE,!0,28,24),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,h.meshFacesCacheKey),e.drawElements(e.TRIANGLES,h.indicesCount,e.UNSIGNED_SHORT,0)}};var SceneState=function(){if(!(this instanceof SceneState))throw new Error(Messages.CONSTRUCT_ERROR);this.gl,this.modelViewProjRelToEyeMatrix=new Matrix4,this.modelViewRelToEyeMatrix=new Matrix4,this.modelViewRelToEyeMatrixInv=new Matrix4,this.modelViewMatrix=new Matrix4,this.modelViewMatrixInv=new Matrix4,this.projectionMatrix=new Matrix4,this.modelViewProjMatrix=new Matrix4,this.normalMatrix4=new Matrix4,this.identityMatrix4=new Matrix4,this.encodedCamPosHigh=new Float32Array([0,0,0]),this.encodedCamPosLow=new Float32Array([0,0,0]),this.camera=new Camera,this.drawingBufferWidth=new Int32Array([1e3]),this.drawingBufferHeight=new Int32Array([1e3]),this.bMust=!1,this.dc,this.insertIssueState=0,this.textureFlipYAxis=!1},Selection=function(){if(!(this instanceof Selection))throw new Error(Messages.CONSTRUCT_ERROR);this.drawing_height,this.drawing_width,this.GAIA_selectFrameBuffer,this.GAIA_selectRenderBuffer,this.GAIA_selectRttTexture,this.currentByteColorPicked=new Uint8Array(4),this.currentSelectedObj_idx=-1};Selection.prototype.init=function(e,t,r){this.drawing_height=r,this.drawing_width=t,this.GAIA_selectFrameBuffer=e.createFramebuffer(),e.bindFramebuffer(e.FRAMEBUFFER,this.GAIA_selectFrameBuffer),this.GAIA_selectRenderBuffer=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,this.GAIA_selectRenderBuffer),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,this.drawing_width,this.drawing_height),this.GAIA_selectRttTexture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.GAIA_selectRttTexture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.drawing_width,this.drawing_height,0,e.RGBA,e.UNSIGNED_BYTE,null),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.GAIA_selectRttTexture,0),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,this.GAIA_selectRenderBuffer),e.bindTexture(e.TEXTURE_2D,null),e.bindRenderbuffer(e.RENDERBUFFER,null),e.bindFramebuffer(e.FRAMEBUFFER,null)};var SelectionCandidates=function(){if(!(this instanceof SelectionCandidates))throw new Error(Messages.CONSTRUCT_ERROR);this.referencesMap=new Map,this.octreesMap=new Map,this.buildingsMap=new Map,this.currentReferenceSelected,this.currentOctreeSelected,this.currentBuildingSelected};SelectionCandidates.prototype.setCandidates=function(e,t,r,i){t&&this.referencesMap.set(e,t),r&&this.octreesMap.set(e,r),i&&this.buildingsMap.set(e,i)},SelectionCandidates.prototype.clearCandidates=function(){this.referencesMap.clear(),this.octreesMap.clear(),this.buildingsMap.clear()},SelectionCandidates.prototype.selectObjects=function(e){this.currentReferenceSelected=this.referencesMap.get(e),this.currentOctreeSelected=this.octreesMap.get(e),this.currentBuildingSelected=this.buildingsMap.get(e)},SelectionCandidates.prototype.clearCurrents=function(e){this.currentReferenceSelected=void 0,this.currentOctreeSelected=void 0,this.currentBuildingSelected=void 0};var UniformMatrix4fvDataPair=function(e,t){if(!(this instanceof UniformMatrix4fvDataPair))throw new Error(Messages.CONSTRUCT_ERROR);this.gl=e,this.name=t,this.uniformLocation,this.matrix4fv};UniformMatrix4fvDataPair.prototype.bindUniform=function(){this.gl.uniformMatrix4fv(this.uniformLocation,!1,this.matrix4fv)};var UniformVec2fvDataPair=function(e,t){if(!(this instanceof UniformVec2fvDataPair))throw new Error(Messages.CONSTRUCT_ERROR);this.gl=e,this.name=t,this.uniformLocation,this.vec2fv};UniformVec2fvDataPair.prototype.bindUniform=function(){this.gl.uniform2fv(this.uniformLocation,!1,this.vec2fv)};var UniformVec3fvDataPair=function(e,t){if(!(this instanceof UniformVec3fvDataPair))throw new Error(Messages.CONSTRUCT_ERROR);this.gl=e,this.name=t,this.uniformLocation,this.vec3fv};UniformVec3fvDataPair.prototype.bindUniform=function(){this.gl.uniform3fv(this.uniformLocation,!1,this.vec3fv)};var UniformVec4fvDataPair=function(e,t){if(!(this instanceof UniformVec4fvDataPair))throw new Error(Messages.CONSTRUCT_ERROR);this.gl=e,this.name=t,this.uniformLocation,this.vec4fv};UniformVec4fvDataPair.prototype.bindUniform=function(){this.gl.uniform4fv(this.uniformLocation,!1,this.vec4fv)};var Uniform1fDataPair=function(e,t){if(!(this instanceof Uniform1fDataPair))throw new Error(Messages.CONSTRUCT_ERROR);this.gl=e,this.name=t,this.uniformLocation,this.floatValue};Uniform1fDataPair.prototype.bindUniform=function(){this.gl.uniform1f(this.uniformLocation,!1,this.floatValue)};var Uniform1iDataPair=function(e,t){if(!(this instanceof Uniform1iDataPair))throw new Error(Messages.CONSTRUCT_ERROR);this.gl=e,this.name=t,this.uniformLocation,this.intValue};Uniform1iDataPair.prototype.bindUniform=function(){this.gl.uniform1i(this.uniformLocation,!1,this.intValue)};var PostFxShader=function(e){if(!(this instanceof PostFxShader))throw new Error(Messages.CONSTRUCT_ERROR);this.gl=e,this.name,this.attribLocationCacheObj={},this.uniformsArray=[],this.uniformsCacheObj={},this.program,this.shader_vertex,this.shader_fragment,this.position3_loc,this.color3_loc,this.normal3_loc,this.texCoord2_loc,this.projectionMatrix4_loc,this.modelViewMatrix4_loc,this.modelViewProjectionMatrix4_loc,this.modelViewMatrix4RelToEye_loc,this.modelViewProjectionMatrix4RelToEye_loc,this.normalMatrix4_loc,this.normalMatrix3_loc,this.RefTransfMatrix,this.buildingPosHIGH_loc,this.buildingPosLOW_loc,this.cameraPosHIGH_loc,this.cameraPosLOW_loc,this.noiseScale2_loc,this.kernel16_loc,this.near_loc,this.far_loc,this.fov_loc,this.aspectRatio_loc,this.screenWidth_loc,this.screenHeight_loc,this.diffuseTex_loc,this.depthTex_loc,this.noiseTex_loc,this.texelSize_loc,this.colorTex_loc,this.useRefTransfMatrix_loc,this.useTexture_loc,this.invertNormals_loc};PostFxShader.prototype.bindUniforms=function(){for(var e=this.uniformsArray.length,t=0;t<e;t++)this.uniformsArray[t].bindUniform()},PostFxShader.prototype.newUniformDataPair=function(e,t){var r;return"Matrix4fv"===e?(r=new UniformMatrix4fvDataPair(this.gl,t),this.uniformsArray.push(r),this.uniformsCacheObj[t]=r):"Vec4fv"===e?(r=new UniformVec4fvDataPair(this.gl,t),this.uniformsArray.push(r),this.uniformsCacheObj[t]=r):"Vec3fv"===e?(r=new UniformVec3fvDataPair(this.gl,t),this.uniformsArray.push(r),this.uniformsCacheObj[t]=r):"Vec2fv"===e?(r=new UniformVec2fvDataPair(this.gl,t),this.uniformsArray.push(r),this.uniformsCacheObj[t]=r):"1f"===e?(r=new Uniform1fDataPair(this.gl,t),this.uniformsArray.push(r),this.uniformsCacheObj[t]=r):"1i"===e&&(r=new Uniform1iDataPair(this.gl,t),this.uniformsArray.push(r),this.uniformsCacheObj[t]=r),r};var PostFxShadersManager=function(){if(!(this instanceof PostFxShadersManager))throw new Error(Messages.CONSTRUCT_ERROR);this.gl,this.pFx_shaders_array=[],this.shadersCache={}};PostFxShadersManager.prototype.newShader=function(e){var t=new PostFxShader(this.gl);return t.name=e,this.shadersCache[e]=t,t},PostFxShadersManager.prototype.getShader=function(e,t,r,i){var o=e.createShader(r);return e.shaderSource(o,t),e.compileShader(o),!!e.getShaderParameter(o,e.COMPILE_STATUS)&&o},PostFxShadersManager.prototype.createDefaultShaders=function(e){this.createRenderDepthShader(e),this.createSsaoShader(e),this.createBlurShader(e),this.createRenderDepthShaderModelRef(e),this.createSsaoShaderModelRef(e),this.createColorSelectionShaderModelRef(e),this.createSimpleDepthShaderModelRef(e),this.createRenderDepthShaderLODBuilding(e),this.createSsaoShaderLODBuilding(e),this.createRenderDepthShaderLego(e),this.createSsaoShaderLego(e),this.createDepthShaderBox(e),this.createSsaoShaderBox(e),this.createPngImageShader(e),this.createSilhouetteShaderModelRef(e)},PostFxShadersManager.prototype.createBlurShader=function(e){var t=new PostFxShader(this.gl);this.pFx_shaders_array.push(t);var r=ShaderSource.BlurVS,i=ShaderSource.BlurFS;t.program=e.createProgram(),t.shader_vertex=this.getShader(e,r,e.VERTEX_SHADER,"VERTEX"),t.shader_fragment=this.getShader(e,i,e.FRAGMENT_SHADER,"FRAGMENT"),e.attachShader(t.program,t.shader_vertex),e.attachShader(t.program,t.shader_fragment),e.linkProgram(t.program),t.projectionMatrix4_loc=e.getUniformLocation(t.program,"projectionMatrix"),t.modelViewMatrix4_loc=e.getUniformLocation(t.program,"modelViewMatrix"),t.position3_loc=e.getAttribLocation(t.program,"position"),t.texCoord2_loc=e.getAttribLocation(t.program,"texCoord"),t.attribLocationCacheObj.position=e.getAttribLocation(t.program,"position"),t.attribLocationCacheObj.texCoord=e.getAttribLocation(t.program,"texCoord"),t.texelSize_loc=e.getUniformLocation(t.program,"texelSize"),t.colorTex_loc=e.getUniformLocation(t.program,"colorTex")},PostFxShadersManager.prototype.createSsaoShader=function(e){var t=new PostFxShader(this.gl);this.pFx_shaders_array.push(t);var r=ShaderSource.SsaoVS,i=ShaderSource.SsaoFS;t.program=e.createProgram(),t.shader_vertex=this.getShader(e,r,e.VERTEX_SHADER,"VERTEX"),t.shader_fragment=this.getShader(e,i,e.FRAGMENT_SHADER,"FRAGMENT"),e.attachShader(t.program,t.shader_vertex),e.attachShader(t.program,t.shader_fragment),e.linkProgram(t.program),t.cameraPosHIGH_loc=e.getUniformLocation(t.program,"encodedCameraPositionMCHigh"),t.cameraPosLOW_loc=e.getUniformLocation(t.program,"encodedCameraPositionMCLow"),t.buildingPosHIGH_loc=e.getUniformLocation(t.program,"buildingPosHIGH"),t.buildingPosLOW_loc=e.getUniformLocation(t.program,"buildingPosLOW"),t.modelViewMatrix4RelToEye_loc=e.getUniformLocation(t.program,"modelViewMatrixRelToEye"),t.modelViewProjectionMatrix4RelToEye_loc=e.getUniformLocation(t.program,"ModelViewProjectionMatrixRelToEye"),t.normalMatrix4_loc=e.getUniformLocation(t.program,"normalMatrix4"),t.projectionMatrix4_loc=e.getUniformLocation(t.program,"projectionMatrix"),t.modelViewMatrix4_loc=e.getUniformLocation(t.program,"modelViewMatrix"),t.position3_loc=e.getAttribLocation(t.program,"position"),t.texCoord2_loc=e.getAttribLocation(t.program,"texCoord"),t.normal3_loc=e.getAttribLocation(t.program,"normal"),t.attribLocationCacheObj.position=e.getAttribLocation(t.program,"position"),t.attribLocationCacheObj.normal=e.getAttribLocation(t.program,"normal"),t.attribLocationCacheObj.texCoord=e.getAttribLocation(t.program,"texCoord"),t.noiseScale2_loc=e.getUniformLocation(t.program,"noiseScale"),t.kernel16_loc=e.getUniformLocation(t.program,"kernel"),t.near_loc=e.getUniformLocation(t.program,"near"),t.far_loc=e.getUniformLocation(t.program,"far"),t.fov_loc=e.getUniformLocation(t.program,"fov"),t.aspectRatio_loc=e.getUniformLocation(t.program,"aspectRatio"),t.screenWidth_loc=e.getUniformLocation(t.program,"screenWidth"),t.screenHeight_loc=e.getUniformLocation(t.program,"screenHeight"),t.depthTex_loc=e.getUniformLocation(t.program,"depthTex"),t.noiseTex_loc=e.getUniformLocation(t.program,"noiseTex"),t.diffuseTex_loc=e.getUniformLocation(t.program,"diffuseTex")},PostFxShadersManager.prototype.createRenderDepthShader=function(e){var t=new PostFxShader(this.gl);this.pFx_shaders_array.push(t);var r=ShaderSource.ShowDepthVS,i=ShaderSource.ShowDepthFS;t.program=e.createProgram(),t.shader_vertex=this.getShader(e,r,e.VERTEX_SHADER,"VERTEX"),t.shader_fragment=this.getShader(e,i,e.FRAGMENT_SHADER,"FRAGMENT"),e.attachShader(t.program,t.shader_vertex),e.attachShader(t.program,t.shader_fragment),e.linkProgram(t.program),t.cameraPosHIGH_loc=e.getUniformLocation(t.program,"encodedCameraPositionMCHigh"),t.cameraPosLOW_loc=e.getUniformLocation(t.program,"encodedCameraPositionMCLow"),t.buildingPosHIGH_loc=e.getUniformLocation(t.program,"buildingPosHIGH"),t.buildingPosLOW_loc=e.getUniformLocation(t.program,"buildingPosLOW"),t.modelViewMatrix4RelToEye_loc=e.getUniformLocation(t.program,"modelViewMatrixRelToEye"),t.modelViewProjectionMatrix4RelToEye_loc=e.getUniformLocation(t.program,"ModelViewProjectionMatrixRelToEye"),t.normalMatrix4_loc=e.getUniformLocation(t.program,"normalMatrix4"),t.position3_loc=e.getAttribLocation(t.program,"position"),t.normal3_loc=e.getAttribLocation(t.program,"normal"),t.attribLocationCacheObj.position=e.getAttribLocation(t.program,"position"),t.attribLocationCacheObj.normal=e.getAttribLocation(t.program,"normal"),t.near_loc=e.getUniformLocation(t.program,"near"),t.far_loc=e.getUniformLocation(t.program,"far")},PostFxShadersManager.prototype.createSsaoShaderModelRef=function(e){var t=new PostFxShader(this.gl);this.pFx_shaders_array.push(t);var r=ShaderSource.ModelRefSsaoVS,i=ShaderSource.ModelRefSsaoFS;t.program=e.createProgram(),t.shader_vertex=this.getShader(e,r,e.VERTEX_SHADER,"VERTEX"),t.shader_fragment=this.getShader(e,i,e.FRAGMENT_SHADER,"FRAGMENT"),e.attachShader(t.program,t.shader_vertex),e.attachShader(t.program,t.shader_fragment),e.linkProgram(t.program),t.cameraPosHIGH_loc=e.getUniformLocation(t.program,"encodedCameraPositionMCHigh"),t.cameraPosLOW_loc=e.getUniformLocation(t.program,"encodedCameraPositionMCLow"),t.buildingPosHIGH_loc=e.getUniformLocation(t.program,"buildingPosHIGH"),t.buildingPosLOW_loc=e.getUniformLocation(t.program,"buildingPosLOW"),t.modelViewMatrix4RelToEye_loc=e.getUniformLocation(t.program,"modelViewMatrixRelToEye"),t.modelViewProjectionMatrix4RelToEye_loc=e.getUniformLocation(t.program,"ModelViewProjectionMatrixRelToEye"),t.normalMatrix4_loc=e.getUniformLocation(t.program,"normalMatrix4"),t.projectionMatrix4_loc=e.getUniformLocation(t.program,"projectionMatrix"),t.RefTransfMatrix=e.getUniformLocation(t.program,"RefTransfMatrix"),t.buildingRotMatrix_loc=e.getUniformLocation(t.program,"buildingRotMatrix"),t.refMatrixType_loc=e.getUniformLocation(t.program,"refMatrixType"),t.refTranslationVec_loc=e.getUniformLocation(t.program,"refTranslationVec"),t.position3_loc=e.getAttribLocation(t.program,"position"),t.texCoord2_loc=e.getAttribLocation(t.program,"texCoord"),t.normal3_loc=e.getAttribLocation(t.program,"normal"),t.attribLocationCacheObj.position=e.getAttribLocation(t.program,"position"),t.attribLocationCacheObj.texCoord=e.getAttribLocation(t.program,"texCoord"),t.attribLocationCacheObj.normal=e.getAttribLocation(t.program,"normal"),t.aditionalMov_loc=e.getUniformLocation(t.program,"aditionalPosition"),t.noiseScale2_loc=e.getUniformLocation(t.program,"noiseScale"),t.kernel16_loc=e.getUniformLocation(t.program,"kernel"),t.near_loc=e.getUniformLocation(t.program,"near"),t.far_loc=e.getUniformLocation(t.program,"far"),t.fov_loc=e.getUniformLocation(t.program,"fov"),t.aspectRatio_loc=e.getUniformLocation(t.program,"aspectRatio"),t.screenWidth_loc=e.getUniformLocation(t.program,"screenWidth"),t.screenHeight_loc=e.getUniformLocation(t.program,"screenHeight"),t.shininessValue_loc=e.getUniformLocation(t.program,"shininessValue"),t.hasTexture_loc=e.getUniformLocation(t.program,"hasTexture"),t.color4Aux_loc=e.getUniformLocation(t.program,"vColor4Aux"),t.textureFlipYAxis_loc=e.getUniformLocation(t.program,"textureFlipYAxis"),t.depthTex_loc=e.getUniformLocation(t.program,"depthTex"),t.noiseTex_loc=e.getUniformLocation(t.program,"noiseTex"),t.diffuseTex_loc=e.getUniformLocation(t.program,"diffuseTex"),t.specularColor_loc=e.getUniformLocation(t.program,"specularColor"),t.ssaoRadius_loc=e.getUniformLocation(t.program,"radius"),t.ambientReflectionCoef_loc=e.getUniformLocation(t.program,"ambientReflectionCoef"),t.diffuseReflectionCoef_loc=e.getUniformLocation(t.program,"diffuseReflectionCoef"),t.specularReflectionCoef_loc=e.getUniformLocation(t.program,"specularReflectionCoef")},PostFxShadersManager.prototype.createRenderDepthShaderModelRef=function(e,t){var r=new PostFxShader(this.gl);this.pFx_shaders_array.push(r);var i=ShaderSource.RenderShowDepthVS,o=ShaderSource.RenderShowDepthFS;r.program=e.createProgram(),r.shader_vertex=this.getShader(e,i,e.VERTEX_SHADER,"VERTEX"),r.shader_fragment=this.getShader(e,o,e.FRAGMENT_SHADER,"FRAGMENT"),e.attachShader(r.program,r.shader_vertex),e.attachShader(r.program,r.shader_fragment),e.linkProgram(r.program),r.cameraPosHIGH_loc=e.getUniformLocation(r.program,"encodedCameraPositionMCHigh"),r.cameraPosLOW_loc=e.getUniformLocation(r.program,"encodedCameraPositionMCLow"),r.buildingPosHIGH_loc=e.getUniformLocation(r.program,"buildingPosHIGH"),r.buildingPosLOW_loc=e.getUniformLocation(r.program,"buildingPosLOW"),r.modelViewMatrix4RelToEye_loc=e.getUniformLocation(r.program,"modelViewMatrixRelToEye"),r.modelViewProjectionMatrix4RelToEye_loc=e.getUniformLocation(r.program,"ModelViewProjectionMatrixRelToEye"),r.modelViewMatrix4_loc=e.getUniformLocation(r.program,"modelViewMatrix"),r.RefTransfMatrix=e.getUniformLocation(r.program,"RefTransfMatrix"),r.buildingRotMatrix_loc=e.getUniformLocation(r.program,"buildingRotMatrix"),r.refMatrixType_loc=e.getUniformLocation(r.program,"refMatrixType"),r.refTranslationVec_loc=e.getUniformLocation(r.program,"refTranslationVec"),r.position3_loc=e.getAttribLocation(r.program,"position"),r.attribLocationCacheObj.position=e.getAttribLocation(r.program,"position"),r.aditionalMov_loc=e.getUniformLocation(r.program,"aditionalPosition"),r.near_loc=e.getUniformLocation(r.program,"near"),r.far_loc=e.getUniformLocation(r.program,"far")},PostFxShadersManager.prototype.createColorSelectionShaderModelRef=function(e){var t=new PostFxShader(this.gl);this.pFx_shaders_array.push(t);var r=ShaderSource.ColorSelectionSsaoVS,i=ShaderSource.ColorSelectionSsaoFS;t.program=e.createProgram(),t.shader_vertex=this.getShader(e,r,e.VERTEX_SHADER,"VERTEX"),t.shader_fragment=this.getShader(e,i,e.FRAGMENT_SHADER,"FRAGMENT"),e.attachShader(t.program,t.shader_vertex),e.attachShader(t.program,t.shader_fragment),e.linkProgram(t.program),t.cameraPosHIGH_loc=e.getUniformLocation(t.program,"encodedCameraPositionMCHigh"),t.cameraPosLOW_loc=e.getUniformLocation(t.program,"encodedCameraPositionMCLow"),t.buildingPosHIGH_loc=e.getUniformLocation(t.program,"buildingPosHIGH"),t.buildingPosLOW_loc=e.getUniformLocation(t.program,"buildingPosLOW"),t.modelViewProjectionMatrix4RelToEye_loc=e.getUniformLocation(t.program,"ModelViewProjectionMatrixRelToEye"),t.RefTransfMatrix=e.getUniformLocation(t.program,"RefTransfMatrix"),t.buildingRotMatrix_loc=e.getUniformLocation(t.program,"buildingRotMatrix"),t.refMatrixType_loc=e.getUniformLocation(t.program,"refMatrixType"),t.refTranslationVec_loc=e.getUniformLocation(t.program,"refTranslationVec"),t.position3_loc=e.getAttribLocation(t.program,"position"),t.attribLocationCacheObj.position=e.getAttribLocation(t.program,"position"),t.aditionalMov_loc=e.getUniformLocation(t.program,"aditionalPosition"),t.color4Aux_loc=e.getUniformLocation(t.program,"vColor4Aux")},PostFxShadersManager.prototype.createSimpleDepthShaderModelRef=function(e){var t=new PostFxShader(this.gl);this.pFx_shaders_array.push(t);var r=ShaderSource.SimpleDepthSsaoVS,i=ShaderSource.SimpleDepthSsaoFS;t.program=e.createProgram(),t.shader_vertex=this.getShader(e,r,e.VERTEX_SHADER,"VERTEX"),t.shader_fragment=this.getShader(e,i,e.FRAGMENT_SHADER,"FRAGMENT"),e.attachShader(t.program,t.shader_vertex),e.attachShader(t.program,t.shader_fragment),e.linkProgram(t.program),t.cameraPosHIGH_loc=e.getUniformLocation(t.program,"encodedCameraPositionMCHigh"),t.cameraPosLOW_loc=e.getUniformLocation(t.program,"encodedCameraPositionMCLow"),t.buildingPosHIGH_loc=e.getUniformLocation(t.program,"buildingPosHIGH"),t.buildingPosLOW_loc=e.getUniformLocation(t.program,"buildingPosLOW"),t.modelViewProjectionMatrix4RelToEye_loc=e.getUniformLocation(t.program,"ModelViewProjectionMatrixRelToEye"),t.RefTransfMatrix=e.getUniformLocation(t.program,"RefTransfMatrix"),t.modelViewMatrix4RelToEye_loc=e.getUniformLocation(t.program,"modelViewMatrixRelToEye"),t.position3_loc=e.getAttribLocation(t.program,"position"),t.attribLocationCacheObj.position=e.getAttribLocation(t.program,"position"),t.far_loc=e.getUniformLocation(t.program,"far")},PostFxShadersManager.prototype.createSsaoShaderLODBuilding=function(e){var t=new PostFxShader(this.gl);this.pFx_shaders_array.push(t);var r=ShaderSource.LodBuildingSsaoVS,i=ShaderSource.LodBuildingSsaoFS;t.program=e.createProgram(),t.shader_vertex=this.getShader(e,r,e.VERTEX_SHADER,"VERTEX"),t.shader_fragment=this.getShader(e,i,e.FRAGMENT_SHADER,"FRAGMENT"),e.attachShader(t.program,t.shader_vertex),e.attachShader(t.program,t.shader_fragment),e.linkProgram(t.program),t.cameraPosHIGH_loc=e.getUniformLocation(t.program,"encodedCameraPositionMCHigh"),t.cameraPosLOW_loc=e.getUniformLocation(t.program,"encodedCameraPositionMCLow"),t.buildingPosHIGH_loc=e.getUniformLocation(t.program,"buildingPosHIGH"),t.buildingPosLOW_loc=e.getUniformLocation(t.program,"buildingPosLOW"),t.modelViewMatrix4RelToEye_loc=e.getUniformLocation(t.program,"modelViewMatrixRelToEye"),t.modelViewProjectionMatrix4RelToEye_loc=e.getUniformLocation(t.program,"ModelViewProjectionMatrixRelToEye"),t.normalMatrix4_loc=e.getUniformLocation(t.program,"normalMatrix4"),t.projectionMatrix4_loc=e.getUniformLocation(t.program,"projectionMatrix"),t.modelViewMatrix4_loc=e.getUniformLocation(t.program,"modelViewMatrix"),t.RefTransfMatrix=e.getUniformLocation(t.program,"RefTransfMatrix"),t.buildingRotMatrix_loc=e.getUniformLocation(t.program,"buildingRotMatrix"),t.bUse1Color_loc=e.getUniformLocation(t.program,"bUse1Color"),t.oneColor4_loc=e.getUniformLocation(t.program,"oneColor4"),t.hasTexture_loc=e.getUniformLocation(t.program,"hasTexture"),t.textureFlipYAxis_loc=e.getUniformLocation(t.program,"textureFlipYAxis"),t.position3_loc=e.getAttribLocation(t.program,"position"),t.texCoord2_loc=e.getAttribLocation(t.program,"texCoord"),t.normal3_loc=e.getAttribLocation(t.program,"normal"),t.color4_loc=e.getAttribLocation(t.program,"color4"),t.attribLocationCacheObj.position=e.getAttribLocation(t.program,"position"),t.attribLocationCacheObj.normal=e.getAttribLocation(t.program,"normal"),t.attribLocationCacheObj.color4=e.getAttribLocation(t.program,"color4"),t.aditionalMov_loc=e.getUniformLocation(t.program,"aditionalPosition"),t.noiseScale2_loc=e.getUniformLocation(t.program,"noiseScale"),t.kernel16_loc=e.getUniformLocation(t.program,"kernel"),t.near_loc=e.getUniformLocation(t.program,"near"),t.far_loc=e.getUniformLocation(t.program,"far"),t.fov_loc=e.getUniformLocation(t.program,"fov"),t.aspectRatio_loc=e.getUniformLocation(t.program,"aspectRatio"),t.screenWidth_loc=e.getUniformLocation(t.program,"screenWidth"),t.screenHeight_loc=e.getUniformLocation(t.program,"screenHeight"),t.color4Aux_loc=e.getUniformLocation(t.program,"vColor4Aux"),t.depthTex_loc=e.getUniformLocation(t.program,"depthTex"),t.noiseTex_loc=e.getUniformLocation(t.program,"noiseTex"),t.diffuseTex_loc=e.getUniformLocation(t.program,"diffuseTex"),t.useRefTransfMatrix_loc=e.getUniformLocation(t.program,"useRefTransfMatrix"),t.useTexture_loc=e.getUniformLocation(t.program,"useTexture"),t.invertNormals_loc=e.getUniformLocation(t.program,"invertNormals")},PostFxShadersManager.prototype.createRenderDepthShaderLODBuilding=function(e){var t=new PostFxShader(this.gl);this.pFx_shaders_array.push(t);var r=ShaderSource.LodBuildingDepthVS,i=ShaderSource.LodBuildingDepthFS;t.program=e.createProgram(),t.shader_vertex=this.getShader(e,r,e.VERTEX_SHADER,"VERTEX"),t.shader_fragment=this.getShader(e,i,e.FRAGMENT_SHADER,"FRAGMENT"),e.attachShader(t.program,t.shader_vertex),e.attachShader(t.program,t.shader_fragment),e.linkProgram(t.program),t.cameraPosHIGH_loc=e.getUniformLocation(t.program,"encodedCameraPositionMCHigh"),t.cameraPosLOW_loc=e.getUniformLocation(t.program,"encodedCameraPositionMCLow"),t.buildingPosHIGH_loc=e.getUniformLocation(t.program,"buildingPosHIGH"),t.buildingPosLOW_loc=e.getUniformLocation(t.program,"buildingPosLOW"),t.modelViewMatrix4RelToEye_loc=e.getUniformLocation(t.program,"modelViewMatrixRelToEye"),t.modelViewProjectionMatrix4RelToEye_loc=e.getUniformLocation(t.program,"ModelViewProjectionMatrixRelToEye"),t.modelViewMatrix4_loc=e.getUniformLocation(t.program,"modelViewMatrix"),t.RefTransfMatrix=e.getUniformLocation(t.program,"RefTransfMatrix"),t.buildingRotMatrix_loc=e.getUniformLocation(t.program,"buildingRotMatrix"),t.position3_loc=e.getAttribLocation(t.program,"position"),t.attribLocationCacheObj.position=e.getAttribLocation(t.program,"position"),t.aditionalMov_loc=e.getUniformLocation(t.program,"aditionalPosition"),t.near_loc=e.getUniformLocation(t.program,"near"),t.far_loc=e.getUniformLocation(t.program,"far")},PostFxShadersManager.prototype.createSsaoShaderLego=function(e){var t=new PostFxShader(this.gl);this.pFx_shaders_array.push(t);var r=ShaderSource.LegoSsaoVS,i=ShaderSource.LegoSsaoFS;t.program=e.createProgram(),t.shader_vertex=this.getShader(e,r,e.VERTEX_SHADER,"VERTEX"),t.shader_fragment=this.getShader(e,i,e.FRAGMENT_SHADER,"FRAGMENT"),e.attachShader(t.program,t.shader_vertex),e.attachShader(t.program,t.shader_fragment),e.linkProgram(t.program),t.cameraPosHIGH_loc=e.getUniformLocation(t.program,"encodedCameraPositionMCHigh"),t.cameraPosLOW_loc=e.getUniformLocation(t.program,"encodedCameraPositionMCLow"),t.buildingPosHIGH_loc=e.getUniformLocation(t.program,"buildingPosHIGH"),t.buildingPosLOW_loc=e.getUniformLocation(t.program,"buildingPosLOW"),t.modelViewMatrix4RelToEye_loc=e.getUniformLocation(t.program,"modelViewMatrixRelToEye"),t.modelViewProjectionMatrix4RelToEye_loc=e.getUniformLocation(t.program,"ModelViewProjectionMatrixRelToEye"),t.normalMatrix4_loc=e.getUniformLocation(t.program,"normalMatrix4"),t.projectionMatrix4_loc=e.getUniformLocation(t.program,"projectionMatrix"),t.modelViewMatrix4_loc=e.getUniformLocation(t.program,"modelViewMatrix"),t.RefTransfMatrix=e.getUniformLocation(t.program,"RefTransfMatrix"),t.buildingRotMatrix_loc=e.getUniformLocation(t.program,"buildingRotMatrix"),t.position3_loc=e.getAttribLocation(t.program,"position"),t.normal3_loc=e.getAttribLocation(t.program,"normal"),t.color4_loc=e.getAttribLocation(t.program,"color4"),t.attribLocationCacheObj.position=e.getAttribLocation(t.program,"position"),t.attribLocationCacheObj.normal=e.getAttribLocation(t.program,"normal"),t.attribLocationCacheObj.color4=e.getAttribLocation(t.program,"color4"),t.aditionalMov_loc=e.getUniformLocation(t.program,"aditionalPosition"),t.noiseScale2_loc=e.getUniformLocation(t.program,"noiseScale"),t.kernel16_loc=e.getUniformLocation(t.program,"kernel"),t.near_loc=e.getUniformLocation(t.program,"near"),t.far_loc=e.getUniformLocation(t.program,"far"),t.fov_loc=e.getUniformLocation(t.program,"fov"),t.aspectRatio_loc=e.getUniformLocation(t.program,"aspectRatio"),t.screenWidth_loc=e.getUniformLocation(t.program,"screenWidth"),t.screenHeight_loc=e.getUniformLocation(t.program,"screenHeight"),t.hasTexture_loc=e.getUniformLocation(t.program,"hasTexture"),t.color4Aux_loc=e.getUniformLocation(t.program,"vColor4Aux"),t.depthTex_loc=e.getUniformLocation(t.program,"depthTex"),t.noiseTex_loc=e.getUniformLocation(t.program,"noiseTex"),t.diffuseTex_loc=e.getUniformLocation(t.program,"diffuseTex"),t.useRefTransfMatrix_loc=e.getUniformLocation(t.program,"useRefTransfMatrix"),t.useTexture_loc=e.getUniformLocation(t.program,"useTexture"),t.invertNormals_loc=e.getUniformLocation(t.program,"invertNormals")},PostFxShadersManager.prototype.createRenderDepthShaderLego=function(e){var t=new PostFxShader(this.gl);this.pFx_shaders_array.push(t);var r=ShaderSource.LegoDepthVS,i=ShaderSource.LegoDepthFS;t.program=e.createProgram(),t.shader_vertex=this.getShader(e,r,e.VERTEX_SHADER,"VERTEX"),t.shader_fragment=this.getShader(e,i,e.FRAGMENT_SHADER,"FRAGMENT"),e.attachShader(t.program,t.shader_vertex),e.attachShader(t.program,t.shader_fragment),e.linkProgram(t.program),t.cameraPosHIGH_loc=e.getUniformLocation(t.program,"encodedCameraPositionMCHigh"),t.cameraPosLOW_loc=e.getUniformLocation(t.program,"encodedCameraPositionMCLow"),t.buildingPosHIGH_loc=e.getUniformLocation(t.program,"buildingPosHIGH"),t.buildingPosLOW_loc=e.getUniformLocation(t.program,"buildingPosLOW"),t.modelViewMatrix4RelToEye_loc=e.getUniformLocation(t.program,"modelViewMatrixRelToEye"),t.modelViewProjectionMatrix4RelToEye_loc=e.getUniformLocation(t.program,"ModelViewProjectionMatrixRelToEye"),t.modelViewMatrix4_loc=e.getUniformLocation(t.program,"modelViewMatrix"),t.RefTransfMatrix=e.getUniformLocation(t.program,"RefTransfMatrix"),t.buildingRotMatrix_loc=e.getUniformLocation(t.program,"buildingRotMatrix"),t.position3_loc=e.getAttribLocation(t.program,"position"),t.attribLocationCacheObj.position=e.getAttribLocation(t.program,"position"),t.aditionalMov_loc=e.getUniformLocation(t.program,"aditionalPosition"),t.near_loc=e.getUniformLocation(t.program,"near"),t.far_loc=e.getUniformLocation(t.program,"far")},PostFxShadersManager.prototype.createRenderDepthShaderLODBuilding=function(e){var t=new PostFxShader(this.gl);this.pFx_shaders_array.push(t);var r=ShaderSource.LodBuildingDepthVS,i=ShaderSource.LodBuildingDepthFS;t.program=e.createProgram(),t.shader_vertex=this.getShader(e,r,e.VERTEX_SHADER,"VERTEX"),t.shader_fragment=this.getShader(e,i,e.FRAGMENT_SHADER,"FRAGMENT"),e.attachShader(t.program,t.shader_vertex),e.attachShader(t.program,t.shader_fragment),e.linkProgram(t.program),t.cameraPosHIGH_loc=e.getUniformLocation(t.program,"encodedCameraPositionMCHigh"),t.cameraPosLOW_loc=e.getUniformLocation(t.program,"encodedCameraPositionMCLow"),t.buildingPosHIGH_loc=e.getUniformLocation(t.program,"buildingPosHIGH"),t.buildingPosLOW_loc=e.getUniformLocation(t.program,"buildingPosLOW"),t.modelViewMatrix4RelToEye_loc=e.getUniformLocation(t.program,"modelViewMatrixRelToEye"),t.modelViewProjectionMatrix4RelToEye_loc=e.getUniformLocation(t.program,"ModelViewProjectionMatrixRelToEye"),t.modelViewMatrix4_loc=e.getUniformLocation(t.program,"modelViewMatrix"),t.RefTransfMatrix=e.getUniformLocation(t.program,"RefTransfMatrix"),t.buildingRotMatrix_loc=e.getUniformLocation(t.program,"buildingRotMatrix"),t.position3_loc=e.getAttribLocation(t.program,"position"),t.attribLocationCacheObj.position=e.getAttribLocation(t.program,"position"),t.aditionalMov_loc=e.getUniformLocation(t.program,"aditionalPosition"),t.near_loc=e.getUniformLocation(t.program,"near"),t.far_loc=e.getUniformLocation(t.program,"far")},PostFxShadersManager.prototype.createDepthShaderBox=function(e){var t=new PostFxShader(this.gl);this.pFx_shaders_array.push(t);var r=ShaderSource.BoxDepthVS,i=ShaderSource.BoxDepthFS;t.program=e.createProgram(),t.shader_vertex=this.getShader(e,r,e.VERTEX_SHADER,"VERTEX"),t.shader_fragment=this.getShader(e,i,e.FRAGMENT_SHADER,"FRAGMENT"),e.attachShader(t.program,t.shader_vertex),e.attachShader(t.program,t.shader_fragment),e.linkProgram(t.program),t.cameraPosHIGH_loc=e.getUniformLocation(t.program,"encodedCameraPositionMCHigh"),t.cameraPosLOW_loc=e.getUniformLocation(t.program,"encodedCameraPositionMCLow"),t.buildingPosHIGH_loc=e.getUniformLocation(t.program,"buildingPosHIGH"),t.buildingPosLOW_loc=e.getUniformLocation(t.program,"buildingPosLOW"),t.modelViewMatrix4RelToEye_loc=e.getUniformLocation(t.program,"modelViewMatrixRelToEye"),t.modelViewProjectionMatrix4RelToEye_loc=e.getUniformLocation(t.program,"ModelViewProjectionMatrixRelToEye"),t.modelViewMatrix4_loc=e.getUniformLocation(t.program,"modelViewMatrix"),t.RefTransfMatrix=e.getUniformLocation(t.program,"RefTransfMatrix"),t.buildingRotMatrix_loc=e.getUniformLocation(t.program,"buildingRotMatrix"),t.position3_loc=e.getAttribLocation(t.program,"position"),t.attribLocationCacheObj.position=e.getAttribLocation(t.program,"position"),t.aditionalMov_loc=e.getUniformLocation(t.program,"aditionalPosition"),t.near_loc=e.getUniformLocation(t.program,"near"),t.far_loc=e.getUniformLocation(t.program,"far")},PostFxShadersManager.prototype.createSsaoShaderBox=function(e){var t=new PostFxShader(this.gl);this.pFx_shaders_array.push(t);var r=ShaderSource.BoxSsaoVS,i=ShaderSource.BoxSsaoFS;t.program=e.createProgram(),t.shader_vertex=this.getShader(e,r,e.VERTEX_SHADER,"VERTEX"),t.shader_fragment=this.getShader(e,i,e.FRAGMENT_SHADER,"FRAGMENT"),e.attachShader(t.program,t.shader_vertex),e.attachShader(t.program,t.shader_fragment),e.linkProgram(t.program),t.cameraPosHIGH_loc=e.getUniformLocation(t.program,"encodedCameraPositionMCHigh"),t.cameraPosLOW_loc=e.getUniformLocation(t.program,"encodedCameraPositionMCLow"),t.buildingPosHIGH_loc=e.getUniformLocation(t.program,"buildingPosHIGH"),t.buildingPosLOW_loc=e.getUniformLocation(t.program,"buildingPosLOW"),t.modelViewMatrix4RelToEye_loc=e.getUniformLocation(t.program,"modelViewMatrixRelToEye"),t.modelViewProjectionMatrix4RelToEye_loc=e.getUniformLocation(t.program,"ModelViewProjectionMatrixRelToEye"),t.normalMatrix4_loc=e.getUniformLocation(t.program,"normalMatrix4"),t.projectionMatrix4_loc=e.getUniformLocation(t.program,"projectionMatrix"),t.modelViewMatrix4_loc=e.getUniformLocation(t.program,"modelViewMatrix"),t.buildingRotMatrix_loc=e.getUniformLocation(t.program,"buildingRotMatrix"),t.bUse1Color_loc=e.getUniformLocation(t.program,"bUse1Color"),t.oneColor4_loc=e.getUniformLocation(t.program,"oneColor4"),t.bScale_loc=e.getUniformLocation(t.program,"bScale"),t.scale_loc=e.getUniformLocation(t.program,"scale"),t.position3_loc=e.getAttribLocation(t.program,"position"),t.normal3_loc=e.getAttribLocation(t.program,"normal"),t.color4_loc=e.getAttribLocation(t.program,"color4"),t.attribLocationCacheObj.position=e.getAttribLocation(t.program,"position"),t.attribLocationCacheObj.normal=e.getAttribLocation(t.program,"normal"),t.attribLocationCacheObj.color4=e.getAttribLocation(t.program,"color4"),t.aditionalMov_loc=e.getUniformLocation(t.program,"aditionalPosition"),t.noiseScale2_loc=e.getUniformLocation(t.program,"noiseScale"),t.kernel16_loc=e.getUniformLocation(t.program,"kernel"),t.near_loc=e.getUniformLocation(t.program,"near"),t.far_loc=e.getUniformLocation(t.program,"far"),t.fov_loc=e.getUniformLocation(t.program,"fov"),t.aspectRatio_loc=e.getUniformLocation(t.program,"aspectRatio"),t.screenWidth_loc=e.getUniformLocation(t.program,"screenWidth"),t.screenHeight_loc=e.getUniformLocation(t.program,"screenHeight"),t.hasTexture_loc=e.getUniformLocation(t.program,"hasTexture"),t.color4Aux_loc=e.getUniformLocation(t.program,"vColor4Aux"),t.depthTex_loc=e.getUniformLocation(t.program,"depthTex"),t.noiseTex_loc=e.getUniformLocation(t.program,"noiseTex"),t.diffuseTex_loc=e.getUniformLocation(t.program,"diffuseTex"),t.useRefTransfMatrix_loc=e.getUniformLocation(t.program,"useRefTransfMatrix"),t.useTexture_loc=e.getUniformLocation(t.program,"useTexture"),t.invertNormals_loc=e.getUniformLocation(t.program,"invertNormals")},PostFxShadersManager.prototype.createPngImageShader=function(e){var t=new PostFxShader(this.gl);this.pFx_shaders_array.push(t);var r=ShaderSource.PngImageVS,i=ShaderSource.PngImageFS;t.program=e.createProgram(),t.shader_vertex=this.getShader(e,r,e.VERTEX_SHADER,"VERTEX"),t.shader_fragment=this.getShader(e,i,e.FRAGMENT_SHADER,"FRAGMENT"),e.attachShader(t.program,t.shader_vertex),e.attachShader(t.program,t.shader_fragment),e.linkProgram(t.program),t.texture_loc=e.getUniformLocation(t.program,"u_texture"),t.cameraPosHIGH_loc=e.getUniformLocation(t.program,"encodedCameraPositionMCHigh"),t.cameraPosLOW_loc=e.getUniformLocation(t.program,"encodedCameraPositionMCLow"),t.buildingPosHIGH_loc=e.getUniformLocation(t.program,"buildingPosHIGH"),t.buildingPosLOW_loc=e.getUniformLocation(t.program,"buildingPosLOW"),t.modelViewProjectionMatrix4RelToEye_loc=e.getUniformLocation(t.program,"ModelViewProjectionMatrixRelToEye"),t.buildingRotMatrix_loc=e.getUniformLocation(t.program,"buildingRotMatrix"),t.position3_loc=e.getAttribLocation(t.program,"a_position"),t.texCoord2_loc=e.getAttribLocation(t.program,"a_texcoord"),t.textureFlipYAxis_loc=e.getUniformLocation(t.program,"textureFlipYAxis")},PostFxShadersManager.prototype.createSilhouetteShaderModelRef=function(e){var t=new PostFxShader(this.gl);this.pFx_shaders_array.push(t);var r=ShaderSource.SilhouetteVS,i=ShaderSource.SilhouetteFS;t.program=e.createProgram(),t.shader_vertex=this.getShader(e,r,e.VERTEX_SHADER,"VERTEX"),t.shader_fragment=this.getShader(e,i,e.FRAGMENT_SHADER,"FRAGMENT"),e.attachShader(t.program,t.shader_vertex),e.attachShader(t.program,t.shader_fragment),e.linkProgram(t.program),t.cameraPosHIGH_loc=e.getUniformLocation(t.program,"encodedCameraPositionMCHigh"),t.cameraPosLOW_loc=e.getUniformLocation(t.program,"encodedCameraPositionMCLow"),t.buildingPosHIGH_loc=e.getUniformLocation(t.program,"buildingPosHIGH"),t.buildingPosLOW_loc=e.getUniformLocation(t.program,"buildingPosLOW"),t.modelViewProjectionMatrix4RelToEye_loc=e.getUniformLocation(t.program,"ModelViewProjectionMatrixRelToEye"),t.RefTransfMatrix=e.getUniformLocation(t.program,"RefTransfMatrix"),t.buildingRotMatrix_loc=e.getUniformLocation(t.program,"buildingRotMatrix"),t.refMatrixType_loc=e.getUniformLocation(t.program,"refMatrixType"),t.refTranslationVec_loc=e.getUniformLocation(t.program,"refTranslationVec"),t.position3_loc=e.getAttribLocation(t.program,"position"),t.attribLocationCacheObj.position=e.getAttribLocation(t.program,"position"),t.aditionalMov_loc=e.getUniformLocation(t.program,"aditionalPosition"),t.color4Aux_loc=e.getUniformLocation(t.program,"vColor4Aux"),t.camSpacePixelTranslation_loc=e.getUniformLocation(t.program,"camSpacePixelTranslation"),t.screenSize_loc=e.getUniformLocation(t.program,"screenSize"),t.ProjectionMatrix_loc=e.getUniformLocation(t.program,"ProjectionMatrix"),t.ModelViewMatrixRelToEye_loc=e.getUniformLocation(t.program,"ModelViewMatrixRelToEye")};var Shader=function(){if(!(this instanceof Shader))throw new Error(Messages.CONSTRUCT_ERROR);this.shader_name,this.shader_vertex_source,this.shader_fragment_source,this.SHADER_PROGRAM,this.shader_vertex,this.shader_fragment,this._ModelViewProjectionMatrixRelToEye,this._RefTransfMatrix,this._NormalMatrix,this._encodedCamPosHIGH,this._encodedCamPosLOW,this._BuildingPosHIGH,this._BuildingPosLOW,this._lightDirection,this._color,this._position,this._texcoord,this._normal,this.samplerUniform},ShadersManager=function(){if(!(this instanceof ShadersManager))throw new Error(Messages.CONSTRUCT_ERROR);this.shaders_array=[]};ShadersManager.prototype.getMagoShader=function(e){var t;return e>=0&&e<this.shaders_array.length&&(t=this.shaders_array[e]),t},ShadersManager.prototype.getShader=function(e,t,r,i){var o=e.createShader(r);return e.shaderSource(o,t),e.compileShader(o),!!e.getShaderParameter(o,e.COMPILE_STATUS)&&o},ShadersManager.prototype.createDefaultShader=function(e){this.createStandardShader(e),this.createTextureSimpleObjectShader(e),this.createColorSelectionShader(e),this.createTextureSimpleObjectA1Shader(e),this.createCloudShader(e),this.createBlendingCubeShader(e),this.createPCloudShader(e),this.createSimpleObjectTexNormalShader(e)},ShadersManager.prototype.createColorSelectionShader=function(e){var t=new Shader;this.shaders_array.push(t),t.shader_vertex_source=ShaderSource.ColorVS,t.shader_fragment_source=ShaderSource.ColorFS,t.SHADER_PROGRAM=e.createProgram(),t.shader_vertex=this.getShader(e,t.shader_vertex_source,e.VERTEX_SHADER,"VERTEX"),t.shader_fragment=this.getShader(e,t.shader_fragment_source,e.FRAGMENT_SHADER,"FRAGMENT"),e.attachShader(t.SHADER_PROGRAM,t.shader_vertex),e.attachShader(t.SHADER_PROGRAM,t.shader_fragment),e.linkProgram(t.SHADER_PROGRAM),t._ModelViewProjectionMatrixRelToEye=e.getUniformLocation(t.SHADER_PROGRAM,"ModelViewProjectionMatrixRelToEye"),t._encodedCamPosHIGH=e.getUniformLocation(t.SHADER_PROGRAM,"encodedCameraPositionMCHigh"),t._encodedCamPosLOW=e.getUniformLocation(t.SHADER_PROGRAM,"encodedCameraPositionMCLow"),t._BuildingPosHIGH=e.getUniformLocation(t.SHADER_PROGRAM,"buildingPosHIGH"),t._BuildingPosLOW=e.getUniformLocation(t.SHADER_PROGRAM,"buildingPosLOW"),t._RefTransfMatrix=e.getUniformLocation(t.SHADER_PROGRAM,"RefTransfMatrix"),t._position=e.getAttribLocation(t.SHADER_PROGRAM,"position")},ShadersManager.prototype.createTextureSimpleObjectShader=function(e){var t=new Shader;this.shaders_array.push(t),t.shader_vertex_source=ShaderSource.TextureVS,t.shader_fragment_source=ShaderSource.TextureFS,t.SHADER_PROGRAM=e.createProgram(),t.shader_vertex=this.getShader(e,t.shader_vertex_source,e.VERTEX_SHADER,"VERTEX"),t.shader_fragment=this.getShader(e,t.shader_fragment_source,e.FRAGMENT_SHADER,"FRAGMENT"),e.attachShader(t.SHADER_PROGRAM,t.shader_vertex),e.attachShader(t.SHADER_PROGRAM,t.shader_fragment),e.linkProgram(t.SHADER_PROGRAM),t._encodedCamPosHIGH=e.getUniformLocation(t.SHADER_PROGRAM,"encodedCameraPositionMCHigh"),t._encodedCamPosLOW=e.getUniformLocation(t.SHADER_PROGRAM,"encodedCameraPositionMCLow"),t._BuildingPosHIGH=e.getUniformLocation(t.SHADER_PROGRAM,"buildingPosHIGH"),t._BuildingPosLOW=e.getUniformLocation(t.SHADER_PROGRAM,"buildingPosLOW"),t._Mmatrix=e.getUniformLocation(t.SHADER_PROGRAM,"Mmatrix"),t._ModelViewProjectionMatrixRelToEye=e.getUniformLocation(t.SHADER_PROGRAM,"ModelViewProjectionMatrixRelToEye"),t.SHADER_PROGRAM.samplerUniform=e.getUniformLocation(t.SHADER_PROGRAM,"uSampler"),t._position=e.getAttribLocation(t.SHADER_PROGRAM,"position"),t._texcoord=e.getAttribLocation(t.SHADER_PROGRAM,"aTextureCoord")},ShadersManager.prototype.createTextureSimpleObjectA1Shader=function(e){var t=new Shader;this.shaders_array.push(t),t.shader_vertex_source=ShaderSource.TextureA1VS,t.shader_fragment_source=ShaderSource.TextureA1FS,t.SHADER_PROGRAM=e.createProgram(),t.shader_vertex=this.getShader(e,t.shader_vertex_source,e.VERTEX_SHADER,"VERTEX"),t.shader_fragment=this.getShader(e,t.shader_fragment_source,e.FRAGMENT_SHADER,"FRAGMENT"),e.attachShader(t.SHADER_PROGRAM,t.shader_vertex),e.attachShader(t.SHADER_PROGRAM,t.shader_fragment),e.linkProgram(t.SHADER_PROGRAM),t._encodedCamPosHIGH=e.getUniformLocation(t.SHADER_PROGRAM,"encodedCameraPositionMCHigh"),t._encodedCamPosLOW=e.getUniformLocation(t.SHADER_PROGRAM,"encodedCameraPositionMCLow"),t._BuildingPosHIGH=e.getUniformLocation(t.SHADER_PROGRAM,"buildingPosHIGH"),t._BuildingPosLOW=e.getUniformLocation(t.SHADER_PROGRAM,"buildingPosLOW"),t._ModelViewProjectionMatrixRelToEye=e.getUniformLocation(t.SHADER_PROGRAM,"ModelViewProjectionMatrixRelToEye"),t.SHADER_PROGRAM.samplerUniform=e.getUniformLocation(t.SHADER_PROGRAM,"uSampler"),t._position=e.getAttribLocation(t.SHADER_PROGRAM,"position"),t._texcoord=e.getAttribLocation(t.SHADER_PROGRAM,"aTextureCoord")},ShadersManager.prototype.createStandardShader=function(e){var t=new Shader;this.shaders_array.push(t),t.shader_vertex_source=ShaderSource.StandardVS,t.shader_fragment_source=ShaderSource.StandardFS,t.SHADER_PROGRAM=e.createProgram(),t.shader_vertex=this.getShader(e,t.shader_vertex_source,e.VERTEX_SHADER,"VERTEX"),t.shader_fragment=this.getShader(e,t.shader_fragment_source,e.FRAGMENT_SHADER,"FRAGMENT"),e.attachShader(t.SHADER_PROGRAM,t.shader_vertex),e.attachShader(t.SHADER_PROGRAM,t.shader_fragment),e.linkProgram(t.SHADER_PROGRAM),t._ModelViewProjectionMatrixRelToEye=e.getUniformLocation(t.SHADER_PROGRAM,"ModelViewProjectionMatrixRelToEye"),t._RefTransfMatrix=e.getUniformLocation(t.SHADER_PROGRAM,"RefTransfMatrix"),t._encodedCamPosHIGH=e.getUniformLocation(t.SHADER_PROGRAM,"encodedCameraPositionMCHigh"),t._encodedCamPosLOW=e.getUniformLocation(t.SHADER_PROGRAM,"encodedCameraPositionMCLow"),t._BuildingPosHIGH=e.getUniformLocation(t.SHADER_PROGRAM,"buildingPosHIGH"),t._BuildingPosLOW=e.getUniformLocation(t.SHADER_PROGRAM,"buildingPosLOW"),t._color=e.getAttribLocation(t.SHADER_PROGRAM,"color"),t._position=e.getAttribLocation(t.SHADER_PROGRAM,"position")},ShadersManager.prototype.createCloudShader=function(e){var t=new Shader;this.shaders_array.push(t),t.shader_vertex_source=ShaderSource.CloudVS,t.shader_fragment_source=ShaderSource.CloudFS,t.SHADER_PROGRAM=e.createProgram(),t.shader_vertex=this.getShader(e,t.shader_vertex_source,e.VERTEX_SHADER,"VERTEX"),t.shader_fragment=this.getShader(e,t.shader_fragment_source,e.FRAGMENT_SHADER,"FRAGMENT"),e.attachShader(t.SHADER_PROGRAM,t.shader_vertex),e.attachShader(t.SHADER_PROGRAM,t.shader_fragment),e.linkProgram(t.SHADER_PROGRAM),t._ModelViewProjectionMatrixRelToEye=e.getUniformLocation(t.SHADER_PROGRAM,"ModelViewProjectionMatrixRelToEye"),t._encodedCamPosHIGH=e.getUniformLocation(t.SHADER_PROGRAM,"encodedCameraPositionMCHigh"),t._encodedCamPosLOW=e.getUniformLocation(t.SHADER_PROGRAM,"encodedCameraPositionMCLow"),t._cloudPosHIGH=e.getUniformLocation(t.SHADER_PROGRAM,"cloudPosHIGH"),t._cloudPosLOW=e.getUniformLocation(t.SHADER_PROGRAM,"cloudPosLOW"),t._color=e.getAttribLocation(t.SHADER_PROGRAM,"color"),t._position=e.getAttribLocation(t.SHADER_PROGRAM,"position")},ShadersManager.prototype.createBlendingCubeShader=function(e){var t=new Shader;this.shaders_array.push(t),t.shader_vertex_source=ShaderSource.BlendingCubeVS,t.shader_fragment_source=ShaderSource.BlendingCubeFS,t.SHADER_PROGRAM=e.createProgram(),t.shader_vertex=this.getShader(e,t.shader_vertex_source,e.VERTEX_SHADER,"VERTEX"),t.shader_fragment=this.getShader(e,t.shader_fragment_source,e.FRAGMENT_SHADER,"FRAGMENT"),e.attachShader(t.SHADER_PROGRAM,t.shader_vertex),e.attachShader(t.SHADER_PROGRAM,t.shader_fragment),e.linkProgram(t.SHADER_PROGRAM),t._ModelViewProjectionMatrixRelToEye=e.getUniformLocation(t.SHADER_PROGRAM,"ModelViewProjectionMatrixRelToEye"),t._encodedCamPosHIGH=e.getUniformLocation(t.SHADER_PROGRAM,"encodedCameraPositionMCHigh"),t._encodedCamPosLOW=e.getUniformLocation(t.SHADER_PROGRAM,"encodedCameraPositionMCLow"),t._color=e.getAttribLocation(t.SHADER_PROGRAM,"color"),t._position=e.getAttribLocation(t.SHADER_PROGRAM,"position")},ShadersManager.prototype.createPCloudShader=function(e){var t=new Shader;this.shaders_array.push(t),t.shader_vertex_source=ShaderSource.PointCloudVS,t.shader_fragment_source=ShaderSource.PointCloudFS,t.SHADER_PROGRAM=e.createProgram(),t.shader_vertex=this.getShader(e,t.shader_vertex_source,e.VERTEX_SHADER,"VERTEX"),t.shader_fragment=this.getShader(e,t.shader_fragment_source,e.FRAGMENT_SHADER,"FRAGMENT"),e.attachShader(t.SHADER_PROGRAM,t.shader_vertex),e.attachShader(t.SHADER_PROGRAM,t.shader_fragment),e.linkProgram(t.SHADER_PROGRAM),t._ModelViewProjectionMatrixRelToEye=e.getUniformLocation(t.SHADER_PROGRAM,"ModelViewProjectionMatrixRelToEye"),t._encodedCamPosHIGH=e.getUniformLocation(t.SHADER_PROGRAM,"encodedCameraPositionMCHigh"),t._encodedCamPosLOW=e.getUniformLocation(t.SHADER_PROGRAM,"encodedCameraPositionMCLow"),t._BuildingPosHIGH=e.getUniformLocation(t.SHADER_PROGRAM,"buildingPosHIGH"),t._BuildingPosLOW=e.getUniformLocation(t.SHADER_PROGRAM,"buildingPosLOW"),t._color=e.getAttribLocation(t.SHADER_PROGRAM,"color"),t._position=e.getAttribLocation(t.SHADER_PROGRAM,"position")},ShadersManager.prototype.createSimpleObjectTexNormalShader=function(e){var t=new Shader;this.shaders_array.push(t),t.shader_vertex_source=ShaderSource.TextureNormalVS,t.shader_fragment_source=ShaderSource.TextureNormalFS,t.SHADER_PROGRAM=e.createProgram(),t.shader_vertex=this.getShader(e,t.shader_vertex_source,e.VERTEX_SHADER,"VERTEX"),t.shader_fragment=this.getShader(e,t.shader_fragment_source,e.FRAGMENT_SHADER,"FRAGMENT"),e.attachShader(t.SHADER_PROGRAM,t.shader_vertex),e.attachShader(t.SHADER_PROGRAM,t.shader_fragment),e.linkProgram(t.SHADER_PROGRAM),t._encodedCamPosHIGH=e.getUniformLocation(t.SHADER_PROGRAM,"encodedCameraPositionMCHigh"),t._encodedCamPosLOW=e.getUniformLocation(t.SHADER_PROGRAM,"encodedCameraPositionMCLow"),t._BuildingPosHIGH=e.getUniformLocation(t.SHADER_PROGRAM,"buildingPosHIGH"),t._BuildingPosLOW=e.getUniformLocation(t.SHADER_PROGRAM,"buildingPosLOW"),t._ModelViewProjectionMatrixRelToEye=e.getUniformLocation(t.SHADER_PROGRAM,"ModelViewProjectionMatrixRelToEye"),t._NormalMatrix=e.getUniformLocation(t.SHADER_PROGRAM,"uNMatrix"),t.samplerUniform=e.getUniformLocation(t.SHADER_PROGRAM,"uSampler"),t._lightDirection=e.getUniformLocation(t.SHADER_PROGRAM,"uLightingDirection"),t._position=e.getAttribLocation(t.SHADER_PROGRAM,"position"),t._texcoord=e.getAttribLocation(t.SHADER_PROGRAM,"aTextureCoord"),t._normal=e.getAttribLocation(t.SHADER_PROGRAM,"aVertexNormal")};var ShaderSource={};ShaderSource.BlendingCubeFS="\tprecision lowp float;\n\tvarying vec4 vColor;\n\n\tvoid main()\n    {\n\t\tgl_FragColor = vColor;\n\t}",ShaderSource.BlendingCubeVS="attribute vec3 position;\nuniform mat4 ModelViewProjectionMatrixRelToEye;\nuniform vec3 encodedCameraPositionMCHigh;\nuniform vec3 encodedCameraPositionMCLow;\nattribute vec4 color;\nvarying vec4 vColor;\n\nvoid main()\n{\n    vec3 highDifference = -encodedCameraPositionMCHigh.xyz;\n    vec3 lowDifference = position.xyz - encodedCameraPositionMCLow.xyz;\n    vec4 pos = vec4(position.xyz, 1.0);\n\n    vColor=color;\n\n    gl_Position = ModelViewProjectionMatrixRelToEye * pos;\n}",ShaderSource.BlurFS="#ifdef GL_ES\n    precision highp float;\n    #endif\nuniform sampler2D colorTex;\nuniform vec2 texelSize;\nvarying vec2 vTexCoord; \t \t\n\nvoid main()\n{\n    vec3 result = vec3(0.0);\n    for (int i = 0; i < 4; ++i) {\n        for (int j = 0; j < 4; ++j) {\n            vec2 offset = vec2(texelSize.x * float(j), texelSize.y * float(i));\n            result += texture2D(colorTex, vTexCoord + offset).rgb;\n        }\n    }\n            \n    gl_FragColor.rgb = vec3(result * 0.0625); \n    gl_FragColor.a = 1.0;\n}\n",ShaderSource.BlurVS="attribute vec4 position;\nattribute vec2 texCoord;\n\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;  \n\nvarying vec2 vTexCoord;\n\nvoid main()\n{\t\n    vTexCoord = texCoord;\n    \n    gl_Position = projectionMatrix * modelViewMatrix * position;\n}\n",ShaderSource.BoxDepthFS="#ifdef GL_ES\n    precision highp float;\n#endif\nuniform float near;\nuniform float far;\n\nvarying float depth;  \n\nvec4 packDepth(const in float depth)\n{\n    const vec4 bit_shift = vec4(16777216.0, 65536.0, 256.0, 1.0);\n    const vec4 bit_mask  = vec4(0.0, 0.00390625, 0.00390625, 0.00390625); \n    vec4 res = fract(depth * bit_shift);\n    res -= res.xxyz * bit_mask;\n    return res;  \n}\n\nvoid main()\n{     \n    gl_FragData[0] = packDepth(-depth);\n}\n",ShaderSource.BoxDepthVS="attribute vec3 position;\n\nuniform mat4 modelViewMatrixRelToEye; \nuniform mat4 ModelViewProjectionMatrixRelToEye;\nuniform mat4 buildingRotMatrix;  \nuniform vec3 buildingPosHIGH;\nuniform vec3 buildingPosLOW;\nuniform vec3 encodedCameraPositionMCHigh;\nuniform vec3 encodedCameraPositionMCLow;\nuniform float near;\nuniform float far;\nuniform vec3 aditionalPosition;\n\nvarying float depth;  \nvoid main()\n{\t\n    vec4 rotatedPos = buildingRotMatrix * vec4(position.xyz + aditionalPosition.xyz, 1.0);\n    vec3 objPosHigh = buildingPosHIGH;\n    vec3 objPosLow = buildingPosLOW.xyz + rotatedPos.xyz;\n    vec3 highDifference = objPosHigh.xyz - encodedCameraPositionMCHigh.xyz;\n    vec3 lowDifference = objPosLow.xyz - encodedCameraPositionMCLow.xyz;\n    vec4 pos4 = vec4(highDifference.xyz + lowDifference.xyz, 1.0);\n    \n    //linear depth in camera space (0..far)\n    depth = (modelViewMatrixRelToEye * pos4).z/far;\n\n    gl_Position = ModelViewProjectionMatrixRelToEye * pos4;\n}\n",ShaderSource.BoxSsaoFS="#ifdef GL_ES\n    precision highp float;\n#endif\nuniform sampler2D depthTex;\nuniform sampler2D noiseTex;  \nuniform sampler2D diffuseTex;\nuniform bool hasTexture;\nvarying vec3 vNormal;\nuniform mat4 projectionMatrix;\nuniform mat4 m;\nuniform vec2 noiseScale;\nuniform float near;\nuniform float far;            \nuniform float fov;\nuniform float aspectRatio;    \nuniform float screenWidth;    \nuniform float screenHeight;    \nuniform vec3 kernel[16];   \nuniform vec4 vColor4Aux;\n\nvarying vec2 vTexCoord;   \nvarying vec3 vLightWeighting;\nvarying vec4 vcolor4;\n\nconst int kernelSize = 16;  \nconst float radius = 0.5;      \n\nfloat unpackDepth(const in vec4 rgba_depth)\n{\n    const vec4 bit_shift = vec4(0.000000059605, 0.000015258789, 0.00390625, 1.0);\n    float depth = dot(rgba_depth, bit_shift);\n    return depth;\n}                \n\nvec3 getViewRay(vec2 tc)\n{\n    float hfar = 2.0 * tan(fov/2.0) * far;\n    float wfar = hfar * aspectRatio;    \n    vec3 ray = vec3(wfar * (tc.x - 0.5), hfar * (tc.y - 0.5), -far);    \n    return ray;                      \n}         \n            \n//linear view space depth\nfloat getDepth(vec2 coord)\n{                          \n    return unpackDepth(texture2D(depthTex, coord.xy));\n}    \n\nvoid main()\n{          \n    vec2 screenPos = vec2(gl_FragCoord.x / screenWidth, gl_FragCoord.y / screenHeight);\t\t                 \n    float linearDepth = getDepth(screenPos);          \n    vec3 origin = getViewRay(screenPos) * linearDepth;   \n    vec3 normal2 = vNormal;   \n            \n    vec3 rvec = texture2D(noiseTex, screenPos.xy * noiseScale).xyz * 2.0 - 1.0;\n    vec3 tangent = normalize(rvec - normal2 * dot(rvec, normal2));\n    vec3 bitangent = cross(normal2, tangent);\n    mat3 tbn = mat3(tangent, bitangent, normal2);        \n    \n    float occlusion = 0.0;\n    for(int i = 0; i < kernelSize; ++i)\n    {    \t \n        vec3 sample = origin + (tbn * kernel[i]) * radius;\n        vec4 offset = projectionMatrix * vec4(sample, 1.0);\t\t\n        offset.xy /= offset.w;\n        offset.xy = offset.xy * 0.5 + 0.5;        \n        float sampleDepth = -sample.z/far;\n        float depthBufferValue = getDepth(offset.xy);\t\t\t\t              \n        float range_check = abs(linearDepth - depthBufferValue)+radius*0.998;\n        if (range_check < radius*1.001 && depthBufferValue <= sampleDepth)\n        {\n            occlusion +=  1.0;\n        }\n        \n    }   \n        \n    occlusion = 1.0 - occlusion / float(kernelSize);\n                                \n    vec3 lightPos = vec3(10.0, 10.0, 10.0);\n    vec3 L = normalize(lightPos);\n    float DiffuseFactor = dot(normal2, L);\n    float NdotL = abs(DiffuseFactor);\n    vec3 diffuse = vec3(NdotL);\n    vec3 ambient = vec3(1.0);\n    vec4 textureColor;\n    textureColor = vcolor4;\n\n    gl_FragColor.rgb = vec3((textureColor.xyz)*vLightWeighting * occlusion); \n    gl_FragColor.a = 1.0;   \n}\n",ShaderSource.BoxSsaoVS="attribute vec3 position;\nattribute vec3 normal;\nattribute vec4 color4;\n\nuniform mat4 projectionMatrix;  \nuniform mat4 modelViewMatrix;\nuniform mat4 modelViewMatrixRelToEye; \nuniform mat4 ModelViewProjectionMatrixRelToEye;\nuniform mat4 normalMatrix4;\nuniform mat4 buildingRotMatrix;  \nuniform vec3 buildingPosHIGH;\nuniform vec3 buildingPosLOW;\nuniform vec3 encodedCameraPositionMCHigh;\nuniform vec3 encodedCameraPositionMCLow;\nuniform vec3 aditionalPosition;\nuniform vec4 oneColor4;\nuniform bool bUse1Color;\nuniform vec3 scale;\nuniform bool bScale;\n\nvarying vec3 vNormal;\nvarying vec2 vTexCoord;  \nvarying vec3 uAmbientColor;\nvarying vec3 vLightWeighting;\nvarying vec4 vcolor4;\n\nvoid main()\n{\t\n    vec4 position2 = vec4(position.xyz, 1.0);\n    if(bScale)\n    {\n        position2.x *= scale.x;\n        position2.y *= scale.y;\n        position2.z *= scale.z;\n    }\n    vec4 rotatedPos = buildingRotMatrix * vec4(position2.xyz + aditionalPosition.xyz, 1.0);\n    vec3 objPosHigh = buildingPosHIGH;\n    vec3 objPosLow = buildingPosLOW.xyz + rotatedPos.xyz;\n    vec3 highDifference = objPosHigh.xyz - encodedCameraPositionMCHigh.xyz;\n    vec3 lowDifference = objPosLow.xyz - encodedCameraPositionMCLow.xyz;\n    vec4 pos4 = vec4(highDifference.xyz + lowDifference.xyz, 1.0);\n   \n    vec4 rotatedNormal = buildingRotMatrix * vec4(normal.xyz, 1.0);\n    vLightWeighting = vec3(1.0, 1.0, 1.0);\n    uAmbientColor = vec3(0.8, 0.8, 0.8);\n    vec3 uLightingDirection = vec3(0.5, 0.5, 0.5);\n    vec3 directionalLightColor = vec3(0.6, 0.6, 0.6);\n    vNormal = (normalMatrix4 * vec4(rotatedNormal.x, rotatedNormal.y, rotatedNormal.z, 1.0)).xyz;\n    float directionalLightWeighting = max(dot(vNormal, uLightingDirection), 0.0);\n    vLightWeighting = uAmbientColor + directionalLightColor * directionalLightWeighting;\n    if(bUse1Color)\n    {\n        vcolor4 = oneColor4;\n    }\n    else\n    {\n        vcolor4 = color4;\n    }\n\n    gl_Position = ModelViewProjectionMatrixRelToEye * pos4;\n}\n",ShaderSource.CloudFS="precision lowp float;\nvarying vec3 vColor;\n\nvoid main()\n{\n    gl_FragColor = vec4(vColor, 1.);\n}",ShaderSource.CloudVS="attribute vec3 position;\nuniform mat4 ModelViewProjectionMatrixRelToEye;\nuniform vec3 cloudPosHIGH;\nuniform vec3 cloudPosLOW;\nuniform vec3 encodedCameraPositionMCHigh;\nuniform vec3 encodedCameraPositionMCLow;\nattribute vec3 color;\nvarying vec3 vColor;\n\nvoid main()\n{\n    vec3 objPosHigh = cloudPosHIGH;\n    vec3 objPosLow = cloudPosLOW.xyz + position.xyz;\n    vec3 highDifference = objPosHigh.xyz - encodedCameraPositionMCHigh.xyz;\n    vec3 lowDifference = objPosLow.xyz - encodedCameraPositionMCLow.xyz;\n    vec4 pos = vec4(highDifference.xyz + lowDifference.xyz, 1.0);\n\n    vColor=color;\n\n    gl_Position = ModelViewProjectionMatrixRelToEye * pos;\n}",ShaderSource.ColorFS="precision mediump float;\nuniform int byteColor_r;\nuniform int byteColor_g;\nuniform int byteColor_b;\n\nvoid main()\n{\n    float byteMaxValue = 255.0;\n\n    gl_FragColor = vec4(float(byteColor_r)/byteMaxValue, float(byteColor_g)/byteMaxValue, float(byteColor_b)/byteMaxValue, 1);\n}\n",ShaderSource.ColorSelectionSsaoFS="precision highp float;\nuniform vec4 vColor4Aux;\n\nvoid main()\n{          \n    gl_FragColor = vColor4Aux;\n}\n",ShaderSource.ColorSelectionSsaoVS="attribute vec3 position;\n\nuniform mat4 buildingRotMatrix;\nuniform mat4 ModelViewProjectionMatrixRelToEye;\nuniform mat4 RefTransfMatrix;\nuniform vec3 buildingPosHIGH;\nuniform vec3 buildingPosLOW;\nuniform vec3 encodedCameraPositionMCHigh;\nuniform vec3 encodedCameraPositionMCLow;\nuniform vec3 aditionalPosition;\nuniform vec3 refTranslationVec;\nuniform int refMatrixType; // 0= identity, 1= translate, 2= transform\n\nvoid main()\n{\n    vec4 rotatedPos;\n\tif(refMatrixType == 0)\n\t{\n\t\trotatedPos = buildingRotMatrix * vec4(position.xyz, 1.0) + vec4(aditionalPosition.xyz, 0.0);\n\t}\n\telse if(refMatrixType == 1)\n\t{\n\t\trotatedPos = buildingRotMatrix * vec4(position.xyz + refTranslationVec.xyz, 1.0) + vec4(aditionalPosition.xyz, 0.0);\n\t}\n\telse if(refMatrixType == 2)\n\t{\n\t\trotatedPos = RefTransfMatrix * vec4(position.xyz, 1.0) + vec4(aditionalPosition.xyz, 0.0);\n\t}\n\n    vec3 objPosHigh = buildingPosHIGH;\n    vec3 objPosLow = buildingPosLOW.xyz + rotatedPos.xyz;\n    vec3 highDifference = objPosHigh.xyz - encodedCameraPositionMCHigh.xyz;\n    vec3 lowDifference = objPosLow.xyz - encodedCameraPositionMCLow.xyz;\n    vec4 pos4 = vec4(highDifference.xyz + lowDifference.xyz, 1.0);\n    \n    gl_PointSize = 10.0;\n    gl_Position = ModelViewProjectionMatrixRelToEye * pos4;\n}\n",ShaderSource.ColorVS="attribute vec3 position;\nuniform mat4 ModelViewProjectionMatrixRelToEye;\nuniform vec3 buildingPosHIGH;\nuniform vec3 buildingPosLOW;\nuniform vec3 encodedCameraPositionMCHigh;\nuniform vec3 encodedCameraPositionMCLow;\nuniform mat4 RefTransfMatrix;\n\nvoid main()\n{\n    vec4 rotatedPos = RefTransfMatrix * vec4(position.xyz, 1.0);\n    vec3 objPosHigh = buildingPosHIGH;\n    vec3 objPosLow = buildingPosLOW.xyz + rotatedPos.xyz;\n    vec3 highDifference = objPosHigh.xyz - encodedCameraPositionMCHigh.xyz;\n    vec3 lowDifference = objPosLow.xyz - encodedCameraPositionMCLow.xyz;\n    vec4 pos = vec4(highDifference.xyz + lowDifference.xyz, 1.0);\n    \n    gl_Position = ModelViewProjectionMatrixRelToEye * pos;\n}\n",ShaderSource.LegoDepthFS="#ifdef GL_ES\nprecision highp float;\n#endif\nuniform float near;\nuniform float far;\n\nvarying float depth;  \n\nvec4 packDepth(const in float depth)\n{\n    const vec4 bit_shift = vec4(16777216.0, 65536.0, 256.0, 1.0);\n    const vec4 bit_mask  = vec4(0.0, 0.00390625, 0.00390625, 0.00390625); \n    vec4 res = fract(depth * bit_shift);\n    res -= res.xxyz * bit_mask;\n    return res;  \n}\n\nvoid main()\n{     \n    gl_FragData[0] = packDepth(-depth);\n}\n",ShaderSource.LegoDepthVS="attribute vec3 position;\nattribute vec3 normal;\nattribute vec2 texCoord;\n\nuniform mat4 modelViewMatrixRelToEye; \nuniform mat4 RefTransfMatrix;\nuniform mat4 ModelViewProjectionMatrixRelToEye;\nuniform vec3 buildingPosHIGH;\nuniform vec3 buildingPosLOW;\nuniform vec3 encodedCameraPositionMCHigh;\nuniform vec3 encodedCameraPositionMCLow;\nuniform float near;\nuniform float far;\nuniform vec3 aditionalPosition;\n\nvarying float depth;  \nvoid main()\n{\t\n    vec4 rotatedPos = RefTransfMatrix * vec4(position.xyz + aditionalPosition.xyz, 1.0);\n    vec3 objPosHigh = buildingPosHIGH;\n    vec3 objPosLow = buildingPosLOW.xyz + rotatedPos.xyz;\n    vec3 highDifference = objPosHigh.xyz - encodedCameraPositionMCHigh.xyz;\n    vec3 lowDifference = objPosLow.xyz - encodedCameraPositionMCLow.xyz;\n    vec4 pos4 = vec4(highDifference.xyz + lowDifference.xyz, 1.0);\n\n    depth = (modelViewMatrixRelToEye * pos4).z/far;\n    \n    gl_Position = ModelViewProjectionMatrixRelToEye * pos4;\n}\n",ShaderSource.LegoSsaoFS="#ifdef GL_ES\n    precision highp float;\n#endif\nuniform sampler2D depthTex;\nuniform sampler2D noiseTex;  \nuniform sampler2D diffuseTex;\nuniform bool hasTexture;\nvarying vec3 vNormal;\nuniform mat4 projectionMatrix;\nuniform mat4 m;\nuniform vec2 noiseScale;\nuniform float near;\nuniform float far;            \nuniform float fov;\nuniform float aspectRatio;    \nuniform float screenWidth;    \nuniform float screenHeight;    \nuniform vec3 kernel[16];   \nuniform vec4 vColor4Aux;\n\nvarying vec2 vTexCoord;   \nvarying vec3 vLightWeighting;\nvarying vec4 vcolor4;\n\nconst int kernelSize = 16;  \nconst float radius = 0.5;      \n\nfloat unpackDepth(const in vec4 rgba_depth)\n{\n    const vec4 bit_shift = vec4(0.000000059605, 0.000015258789, 0.00390625, 1.0);\n    float depth = dot(rgba_depth, bit_shift);\n    return depth;\n}                \n\nvec3 getViewRay(vec2 tc)\n{\n    float hfar = 2.0 * tan(fov/2.0) * far;\n    float wfar = hfar * aspectRatio;    \n    vec3 ray = vec3(wfar * (tc.x - 0.5), hfar * (tc.y - 0.5), -far);    \n    return ray;                      \n}         \n            \n//linear view space depth\nfloat getDepth(vec2 coord)\n{                          \n    return unpackDepth(texture2D(depthTex, coord.xy));\n}    \n\nvoid main()\n{          \n    vec2 screenPos = vec2(gl_FragCoord.x / screenWidth, gl_FragCoord.y / screenHeight);\t\t                 \n    float linearDepth = getDepth(screenPos);          \n    vec3 origin = getViewRay(screenPos) * linearDepth;   \n    vec3 normal2 = vNormal;   \n            \n    vec3 rvec = texture2D(noiseTex, screenPos.xy * noiseScale).xyz * 2.0 - 1.0;\n    vec3 tangent = normalize(rvec - normal2 * dot(rvec, normal2));\n    vec3 bitangent = cross(normal2, tangent);\n    mat3 tbn = mat3(tangent, bitangent, normal2);        \n    \n    float occlusion = 0.0;\n    for(int i = 0; i < kernelSize; ++i)\n    {    \t \n        vec3 sample = origin + (tbn * kernel[i]) * radius;\n        vec4 offset = projectionMatrix * vec4(sample, 1.0);\t\t\n        offset.xy /= offset.w;\n        offset.xy = offset.xy * 0.5 + 0.5;        \n        float sampleDepth = -sample.z/far;\n        float depthBufferValue = getDepth(offset.xy);\t\t\t\t              \n        float range_check = abs(linearDepth - depthBufferValue)+radius*0.998;\n        if (range_check < radius*1.001 && depthBufferValue <= sampleDepth)\n        {\n            occlusion +=  1.0;\n        }\n        \n    }   \n        \n    occlusion = 1.0 - occlusion / float(kernelSize);\n                                \n    vec3 lightPos = vec3(10.0, 10.0, 10.0);\n    vec3 L = normalize(lightPos);\n    float DiffuseFactor = dot(normal2, L);\n    float NdotL = abs(DiffuseFactor);\n    vec3 diffuse = vec3(NdotL);\n    vec3 ambient = vec3(1.0);\n    vec4 textureColor;\n    textureColor = vcolor4;\n\n    gl_FragColor.rgb = vec3((textureColor.xyz)*vLightWeighting * occlusion); \n    gl_FragColor.a = 1.0;   \n}\n",ShaderSource.LegoSsaoVS="attribute vec3 position;\nattribute vec3 normal;\nattribute vec4 color4;\nattribute vec2 texCoord;\n\nuniform mat4 projectionMatrix;  \nuniform mat4 modelViewMatrix;\nuniform mat4 modelViewMatrixRelToEye; \nuniform mat4 ModelViewProjectionMatrixRelToEye;\nuniform mat4 RefTransfMatrix;\nuniform mat4 normalMatrix4;\nuniform vec3 buildingPosHIGH;\nuniform vec3 buildingPosLOW;\nuniform vec3 encodedCameraPositionMCHigh;\nuniform vec3 encodedCameraPositionMCLow;\nuniform vec3 aditionalPosition;\n\nvarying vec3 vNormal;\nvarying vec2 vTexCoord;  \nvarying vec3 uAmbientColor;\nvarying vec3 vLightWeighting;\nvarying vec4 vcolor4;\n\nvoid main()\n{\t\n    vec4 rotatedPos = RefTransfMatrix * vec4(position.xyz + aditionalPosition.xyz, 1.0);\n    vec3 objPosHigh = buildingPosHIGH;\n    vec3 objPosLow = buildingPosLOW.xyz + rotatedPos.xyz;\n    vec3 highDifference = objPosHigh.xyz - encodedCameraPositionMCHigh.xyz;\n    vec3 lowDifference = objPosLow.xyz - encodedCameraPositionMCLow.xyz;\n    vec4 pos4 = vec4(highDifference.xyz + lowDifference.xyz, 1.0);\n    \n    vec3 rotatedNormal = mat3(RefTransfMatrix) * normal;\n    vLightWeighting = vec3(1.0, 1.0, 1.0);\n    uAmbientColor = vec3(0.8, 0.8, 0.8);\n    vec3 uLightingDirection = vec3(0.5, 0.5, 0.5);\n    vec3 directionalLightColor = vec3(0.6, 0.6, 0.6);\n    vNormal = (normalMatrix4 * vec4(rotatedNormal.x, rotatedNormal.y, rotatedNormal.z, 1.0)).xyz;\n\n    float directionalLightWeighting = max(dot(vNormal, uLightingDirection), 0.0);\n    vLightWeighting = uAmbientColor + directionalLightColor * directionalLightWeighting;\n    vcolor4 = color4;\n\n    gl_Position = ModelViewProjectionMatrixRelToEye * pos4;\n}\n",ShaderSource.LodBuildingDepthFS="#ifdef GL_ES\n    precision highp float;\n#endif\nuniform float near;\nuniform float far;\n\nvarying float depth;  \n\nvec4 packDepth(const in float depth)\n{\n    const vec4 bit_shift = vec4(16777216.0, 65536.0, 256.0, 1.0);\n    const vec4 bit_mask  = vec4(0.0, 0.00390625, 0.00390625, 0.00390625); \n    vec4 res = fract(depth * bit_shift);\n    res -= res.xxyz * bit_mask;\n    return res;  \n}\n\nvoid main()\n{     \n    gl_FragData[0] = packDepth(-depth);\n}\n",ShaderSource.LodBuildingDepthVS="attribute vec3 position;\n\nuniform mat4 modelViewMatrixRelToEye; \nuniform mat4 ModelViewProjectionMatrixRelToEye;\nuniform mat4 buildingRotMatrix;  \nuniform vec3 buildingPosHIGH;\nuniform vec3 buildingPosLOW;\nuniform vec3 encodedCameraPositionMCHigh;\nuniform vec3 encodedCameraPositionMCLow;\nuniform float near;\nuniform float far;\nuniform vec3 aditionalPosition;\n\nvarying float depth;  \nvoid main()\n{\t\n    vec4 rotatedPos = buildingRotMatrix * vec4(position.xyz + aditionalPosition.xyz, 1.0);\n    vec3 objPosHigh = buildingPosHIGH;\n    vec3 objPosLow = buildingPosLOW.xyz + rotatedPos.xyz;\n    vec3 highDifference = objPosHigh.xyz - encodedCameraPositionMCHigh.xyz;\n    vec3 lowDifference = objPosLow.xyz - encodedCameraPositionMCLow.xyz;\n    vec4 pos4 = vec4(highDifference.xyz + lowDifference.xyz, 1.0);\n        \n    depth = (modelViewMatrixRelToEye * pos4).z/far;\n    \n    gl_Position = ModelViewProjectionMatrixRelToEye * pos4;\n}\n",ShaderSource.LodBuildingSsaoFS="#ifdef GL_ES\n    precision highp float;\n#endif\nuniform sampler2D depthTex;\nuniform sampler2D noiseTex;  \nuniform sampler2D diffuseTex;\nuniform bool hasTexture;\nuniform bool textureFlipYAxis;\nvarying vec3 vNormal;\nuniform mat4 projectionMatrix;\nuniform mat4 m;\nuniform vec2 noiseScale;\nuniform float near;\nuniform float far;            \nuniform float fov;\nuniform float aspectRatio;    \nuniform float screenWidth;    \nuniform float screenHeight;    \nuniform vec3 kernel[16];   \nuniform vec4 vColor4Aux;\n\nvarying vec2 vTexCoord;   \nvarying vec3 vLightWeighting;\nvarying vec4 vcolor4;\n\nconst int kernelSize = 16;  \nconst float radius = 0.5;      \n\nfloat unpackDepth(const in vec4 rgba_depth)\n{\n    const vec4 bit_shift = vec4(0.000000059605, 0.000015258789, 0.00390625, 1.0);\n    float depth = dot(rgba_depth, bit_shift);\n    return depth;\n}                \n\nvec3 getViewRay(vec2 tc)\n{\n    float hfar = 2.0 * tan(fov/2.0) * far;\n    float wfar = hfar * aspectRatio;    \n    vec3 ray = vec3(wfar * (tc.x - 0.5), hfar * (tc.y - 0.5), -far);    \n    return ray;                      \n}         \n            \n//linear view space depth\nfloat getDepth(vec2 coord)\n{                          \n    return unpackDepth(texture2D(depthTex, coord.xy));\n}    \n\nvoid main()\n{          \n    vec2 screenPos = vec2(gl_FragCoord.x / screenWidth, gl_FragCoord.y / screenHeight);\t\t                 \n    float linearDepth = getDepth(screenPos);          \n    vec3 origin = getViewRay(screenPos) * linearDepth;   \n\n    vec3 normal2 = vNormal;   \n            \n    vec3 rvec = texture2D(noiseTex, screenPos.xy * noiseScale).xyz * 2.0 - 1.0;\n    vec3 tangent = normalize(rvec - normal2 * dot(rvec, normal2));\n    vec3 bitangent = cross(normal2, tangent);\n    mat3 tbn = mat3(tangent, bitangent, normal2);        \n    \n    float occlusion = 0.0;\n    for(int i = 0; i < kernelSize; ++i)\n    {    \t \n        vec3 sample = origin + (tbn * kernel[i]) * radius;\n        vec4 offset = projectionMatrix * vec4(sample, 1.0);\t\t\n        offset.xy /= offset.w;\n        offset.xy = offset.xy * 0.5 + 0.5;        \n        float sampleDepth = -sample.z/far;\n        float depthBufferValue = getDepth(offset.xy);\t\t\t\t              \n        float range_check = abs(linearDepth - depthBufferValue)+radius*0.998;\n        if (range_check < radius*1.001 && depthBufferValue <= sampleDepth)\n        {\n            occlusion +=  1.0;\n        }\n        \n    }   \n        \n    occlusion = 1.0 - occlusion / float(kernelSize);\n                                \n    vec3 lightPos = vec3(10.0, 10.0, 10.0);\n    vec3 L = normalize(lightPos);\n    float DiffuseFactor = dot(normal2, L);\n    float NdotL = abs(DiffuseFactor);\n    vec3 diffuse = vec3(NdotL);\n    vec3 ambient = vec3(1.0);\n    vec4 textureColor;\n    if(hasTexture)\n    {\n        if(textureFlipYAxis)\n        {\n            textureColor = texture2D(diffuseTex, vec2(vTexCoord.s, 1.0 - vTexCoord.t));\n        }\n        else\n        {\n            textureColor = texture2D(diffuseTex, vec2(vTexCoord.s, vTexCoord.t));\n        }\n    }\n    else\n    {\n        textureColor = vcolor4;\n    }\n    \n    gl_FragColor.rgb = vec3((textureColor.xyz)*vLightWeighting * occlusion); \n    gl_FragColor.a = 1.0;   \n}\n",ShaderSource.LodBuildingSsaoVS="attribute vec3 position;\nattribute vec3 normal;\nattribute vec4 color4;\nattribute vec2 texCoord;\n\nuniform sampler2D diffuseTex;\nuniform mat4 projectionMatrix;  \nuniform mat4 modelViewMatrix;\nuniform mat4 modelViewMatrixRelToEye; \nuniform mat4 ModelViewProjectionMatrixRelToEye;\nuniform mat4 normalMatrix4;\nuniform mat4 buildingRotMatrix;  \nuniform vec3 buildingPosHIGH;\nuniform vec3 buildingPosLOW;\nuniform vec3 encodedCameraPositionMCHigh;\nuniform vec3 encodedCameraPositionMCLow;\nuniform vec3 aditionalPosition;\nuniform vec4 oneColor4;\nuniform bool bUse1Color;\nuniform bool hasTexture;\n\nvarying vec3 vNormal;\nvarying vec2 vTexCoord;   \nvarying vec3 uAmbientColor;\nvarying vec3 vLightWeighting;\nvarying vec4 vcolor4;\n\nvoid main()\n{\t\n    vec4 rotatedPos = buildingRotMatrix * vec4(position.xyz + aditionalPosition.xyz, 1.0);\n    vec3 objPosHigh = buildingPosHIGH;\n    vec3 objPosLow = buildingPosLOW.xyz + rotatedPos.xyz;\n    vec3 highDifference = objPosHigh.xyz - encodedCameraPositionMCHigh.xyz;\n    vec3 lowDifference = objPosLow.xyz - encodedCameraPositionMCLow.xyz;\n    vec4 pos4 = vec4(highDifference.xyz + lowDifference.xyz, 1.0);\n   \n    vec4 rotatedNormal = buildingRotMatrix * vec4(normal.xyz, 1.0);\n    vLightWeighting = vec3(1.0, 1.0, 1.0);\n    uAmbientColor = vec3(0.8, 0.8, 0.8);\n    vec3 uLightingDirection = vec3(0.5, 0.5, 0.5);\n    vec3 directionalLightColor = vec3(0.6, 0.6, 0.6);\n    vNormal = (normalMatrix4 * vec4(rotatedNormal.x, rotatedNormal.y, rotatedNormal.z, 1.0)).xyz;\n    float directionalLightWeighting = max(dot(vNormal, uLightingDirection), 0.0);\n    vLightWeighting = uAmbientColor + directionalLightColor * directionalLightWeighting;\n\n    if(bUse1Color)\n    {\n        vcolor4 = oneColor4;\n    }\n    else\n    {\n        vcolor4 = color4;\n    }\n    vTexCoord = texCoord;\n\n    gl_Position = ModelViewProjectionMatrixRelToEye * pos4;\n}\n",ShaderSource.ModelRefSsaoFS="#ifdef GL_ES\n    precision highp float;\n#endif\n\nuniform sampler2D depthTex;\nuniform sampler2D noiseTex;  \nuniform sampler2D diffuseTex;\nuniform bool hasTexture;\nuniform bool textureFlipYAxis;\nvarying vec3 vNormal;\nuniform mat4 projectionMatrix;\nuniform mat4 m;\nuniform vec2 noiseScale;\nuniform float near;\nuniform float far;            \nuniform float fov;\nuniform float aspectRatio;    \nuniform float screenWidth;    \nuniform float screenHeight;    \nuniform float shininessValue;\nuniform vec3 kernel[16];   \nuniform vec4 vColor4Aux;\n\nvarying vec2 vTexCoord;   \nvarying vec3 vLightWeighting;\n\nvarying vec3 diffuseColor;\nuniform vec3 specularColor;\nvarying vec3 vertexPos;\n\nconst int kernelSize = 16;  \nuniform float radius;      \n\nuniform float ambientReflectionCoef;\nuniform float diffuseReflectionCoef;  \nuniform float specularReflectionCoef; \n\nfloat unpackDepth(const in vec4 rgba_depth)\n{\n    const vec4 bit_shift = vec4(0.000000059605, 0.000015258789, 0.00390625, 1.0);\n    float depth = dot(rgba_depth, bit_shift);\n    return depth;\n}                \n\nvec3 getViewRay(vec2 tc)\n{\n    float hfar = 2.0 * tan(fov/2.0) * far;\n    float wfar = hfar * aspectRatio;    \n    vec3 ray = vec3(wfar * (tc.x - 0.5), hfar * (tc.y - 0.5), -far);    \n    return ray;                      \n}         \n            \n//linear view space depth\nfloat getDepth(vec2 coord)\n{\n    return unpackDepth(texture2D(depthTex, coord.xy));\n}    \n\nvoid main()\n{          \n    vec2 screenPos = vec2(gl_FragCoord.x / screenWidth, gl_FragCoord.y / screenHeight);\t\t                 \n    float linearDepth = getDepth(screenPos);          \n    vec3 origin = getViewRay(screenPos) * linearDepth;   \n\n    vec3 normal2 = vNormal;\n            \n    vec3 rvec = texture2D(noiseTex, screenPos.xy * noiseScale).xyz * 2.0 - 1.0;\n    vec3 tangent = normalize(rvec - normal2 * dot(rvec, normal2));\n    vec3 bitangent = cross(normal2, tangent);\n    mat3 tbn = mat3(tangent, bitangent, normal2);        \n    \n    float occlusion = 0.0;\n    for(int i = 0; i < kernelSize; ++i)\n    {    \t \n        vec3 sample = origin + (tbn * kernel[i]) * radius;\n        vec4 offset = projectionMatrix * vec4(sample, 1.0);\t\t\n        offset.xy /= offset.w;\n        offset.xy = offset.xy * 0.5 + 0.5;        \n        float sampleDepth = -sample.z/far;\n        float depthBufferValue = getDepth(offset.xy);\t\t\t\t              \n        float range_check = abs(linearDepth - depthBufferValue)+radius*0.998;\n        if (range_check < radius*1.001 && depthBufferValue <= sampleDepth)\n        {\n            occlusion +=  1.0;\n        }\n    }   \n        \n    occlusion = 1.0 - occlusion / float(kernelSize);\n\n    vec3 lightPos = vec3(0.0, 0.0, 20.0);\n    vec3 L = normalize(lightPos - vertexPos);\n    float lambertian = max(dot(normal2, L), 0.0);\n    float specular = 0.0;\n    if(lambertian > 0.0)\n    {\n        vec3 R = reflect(-L, normal2);      // Reflected light vector\n        vec3 V = normalize(-vertexPos); // Vector to viewer\n        \n        // Compute the specular term\n        float specAngle = max(dot(R, V), 0.0);\n        specular = pow(specAngle, shininessValue);\n    }\n\t\n\tif(lambertian < 0.5)\n    {\n\t\tlambertian = 0.5;\n\t}\n\n    vec4 textureColor;\n    if(hasTexture)\n    {\n        if(textureFlipYAxis)\n        {\n            textureColor = texture2D(diffuseTex, vec2(vTexCoord.s, 1.0 - vTexCoord.t));\n        }\n        else{\n            textureColor = texture2D(diffuseTex, vec2(vTexCoord.s, vTexCoord.t));\n        }\n\t\t\n        if(textureColor.w == 0.0)\n        {\n            discard;\n        }\n    }\n    else{\n        textureColor = vColor4Aux;\n    }\n\t\n\tvec3 ambientColor = vec3(textureColor.x, textureColor.y, textureColor.z);\n\n    gl_FragColor = vec4((ambientReflectionCoef * ambientColor + diffuseReflectionCoef * lambertian * textureColor.xyz + specularReflectionCoef * specular * specularColor)*vLightWeighting * occlusion, 1.0); \n}\n",ShaderSource.ModelRefSsaoVS="\tattribute vec3 position;\n\tattribute vec3 normal;\n\tattribute vec2 texCoord;\n\t\n\tuniform mat4 buildingRotMatrix; \n\tuniform mat4 projectionMatrix;  \n\tuniform mat4 modelViewMatrix;\n\tuniform mat4 modelViewMatrixRelToEye; \n\tuniform mat4 ModelViewProjectionMatrixRelToEye;\n\tuniform mat4 RefTransfMatrix;\n\tuniform mat4 normalMatrix4;\n\tuniform vec3 buildingPosHIGH;\n\tuniform vec3 buildingPosLOW;\n\tuniform vec3 encodedCameraPositionMCHigh;\n\tuniform vec3 encodedCameraPositionMCLow;\n\tuniform vec3 aditionalPosition;\n\tuniform vec3 refTranslationVec;\n\tuniform int refMatrixType; // 0= identity, 1= translate, 2= transform\n\n\tvarying vec3 vNormal;\n\tvarying vec2 vTexCoord;  \n\tvarying vec3 uAmbientColor;\n\tvarying vec3 vLightWeighting;\n\tvarying vec3 vertexPos;\n\t\n\tvoid main()\n    {\t\n\t\tvec4 rotatedPos;\n\t\tmat3 currentTMat;\n\t\tif(refMatrixType == 0)\n\t\t{\n\t\t\trotatedPos = buildingRotMatrix * vec4(position.xyz, 1.0) + vec4(aditionalPosition.xyz, 0.0);\n\t\t\tcurrentTMat = mat3(buildingRotMatrix);\n\t\t}\n\t\telse if(refMatrixType == 1)\n\t\t{\n\t\t\trotatedPos = buildingRotMatrix * vec4(position.xyz + refTranslationVec.xyz, 1.0) + vec4(aditionalPosition.xyz, 0.0);\n\t\t\tcurrentTMat = mat3(buildingRotMatrix);\n\t\t}\n\t\telse if(refMatrixType == 2)\n\t\t{\n\t\t\trotatedPos = RefTransfMatrix * vec4(position.xyz, 1.0) + vec4(aditionalPosition.xyz, 0.0);\n\t\t\tcurrentTMat = mat3(RefTransfMatrix);\n\t\t}\n\n\t\tvec3 objPosHigh = buildingPosHIGH;\n\t\tvec3 objPosLow = buildingPosLOW.xyz + rotatedPos.xyz;\n\t\tvec3 highDifference = objPosHigh.xyz - encodedCameraPositionMCHigh.xyz;\n\t\tvec3 lowDifference = objPosLow.xyz - encodedCameraPositionMCLow.xyz;\n\t\tvec4 pos4 = vec4(highDifference.xyz + lowDifference.xyz, 1.0);\n\n\t\tvertexPos = vec3(modelViewMatrixRelToEye * pos4);\n\t\tvec3 rotatedNormal = currentTMat * normal;\n\t\tvLightWeighting = vec3(1.0, 1.0, 1.0);\n\t\tuAmbientColor = vec3(0.8);\n\t\tvec3 uLightingDirection = vec3(0.7, 0.7, 0.7);\n\t\tvec3 directionalLightColor = vec3(0.6, 0.6, 0.6);\n\t\tvNormal = (normalMatrix4 * vec4(rotatedNormal.x, rotatedNormal.y, rotatedNormal.z, 1.0)).xyz;\n\t\tvTexCoord = texCoord;\n\t\tfloat directionalLightWeighting = max(dot(vNormal, uLightingDirection), 0.0);\n\t\tvLightWeighting = uAmbientColor + directionalLightColor * directionalLightWeighting;\n\n        gl_Position = ModelViewProjectionMatrixRelToEye * pos4;\n\t}\n",ShaderSource.PngImageFS="precision mediump float;\nvarying vec2 v_texcoord;\nuniform bool textureFlipYAxis;\nuniform sampler2D u_texture;\n\nvoid main()\n{\n    vec4 textureColor;\n    if(textureFlipYAxis)\n    {\n        textureColor = texture2D(u_texture, vec2(v_texcoord.s, 1.0 - v_texcoord.t));\n    }\n    else\n    {\n        textureColor = texture2D(u_texture, v_texcoord);\n    }\n    if(textureColor.w < 0.1)\n    {\n        discard;\n    }\n\n    gl_FragColor = textureColor;\n}",ShaderSource.PngImageVS="attribute vec3 a_position;\nattribute vec2 a_texcoord;\nuniform mat4 buildingRotMatrix;  \nuniform mat4 ModelViewProjectionMatrixRelToEye;  \nuniform vec3 buildingPosHIGH;\nuniform vec3 buildingPosLOW;\nuniform vec3 encodedCameraPositionMCHigh;\nuniform vec3 encodedCameraPositionMCLow;\nvarying vec2 v_texcoord;\n\nvoid main()\n{\n    vec4 position2 = vec4(a_position.xyz, 1.0);\n    vec4 rotatedPos = buildingRotMatrix * vec4(position2.xyz, 1.0);\n    vec3 objPosHigh = buildingPosHIGH;\n    vec3 objPosLow = buildingPosLOW.xyz + rotatedPos.xyz;\n    vec3 highDifference = objPosHigh.xyz - encodedCameraPositionMCHigh.xyz;\n    vec3 lowDifference = objPosLow.xyz - encodedCameraPositionMCLow.xyz;\n    vec4 pos4 = vec4(highDifference.xyz + lowDifference.xyz, 1.0);\n\n    v_texcoord = a_texcoord;\n\n    gl_Position = ModelViewProjectionMatrixRelToEye * pos4;\n}\n",ShaderSource.PointCloudFS="\tprecision lowp float;\n\tvarying vec4 vColor;\n\n\tvoid main()\n    {\n\t\tgl_FragColor = vColor;\n\t}",ShaderSource.PointCloudVS="attribute vec3 position;\nuniform mat4 ModelViewProjectionMatrixRelToEye;\nuniform vec3 buildingPosHIGH;\nuniform vec3 buildingPosLOW;\nuniform vec3 encodedCameraPositionMCHigh;\nuniform vec3 encodedCameraPositionMCLow;\nattribute vec4 color;\nvarying vec4 vColor;\n\nvoid main()\n{\n    vec3 objPosHigh = buildingPosHIGH;\n    vec3 objPosLow = buildingPosLOW.xyz + position.xyz;\n    vec3 highDifference = objPosHigh.xyz - encodedCameraPositionMCHigh.xyz;\n    vec3 lowDifference = objPosLow.xyz - encodedCameraPositionMCLow.xyz;\n    vec4 pos = vec4(highDifference.xyz + lowDifference.xyz, 1.0);\n\n    vColor=color;\n\n    gl_Position = ModelViewProjectionMatrixRelToEye * pos;\n}",ShaderSource.RenderShowDepthFS="#ifdef GL_ES\nprecision highp float;\n#endif\nuniform float near;\nuniform float far;\n\nvarying float depth;  \n\nvec4 packDepth(const in float depth)\n{\n    const vec4 bit_shift = vec4(16777216.0, 65536.0, 256.0, 1.0);\n    const vec4 bit_mask  = vec4(0.0, 0.00390625, 0.00390625, 0.00390625); \n    vec4 res = fract(depth * bit_shift);\n    res -= res.xxyz * bit_mask;\n    return res;  \n}\n\nvoid main()\n{     \n    gl_FragData[0] = packDepth(-depth);\n}\n",ShaderSource.RenderShowDepthVS="attribute vec3 position;\n\nuniform mat4 buildingRotMatrix; \nuniform mat4 modelViewMatrixRelToEye; \nuniform mat4 RefTransfMatrix;\nuniform mat4 ModelViewProjectionMatrixRelToEye;\nuniform vec3 buildingPosHIGH;\nuniform vec3 buildingPosLOW;\nuniform vec3 encodedCameraPositionMCHigh;\nuniform vec3 encodedCameraPositionMCLow;\nuniform float near;\nuniform float far;\nuniform vec3 aditionalPosition;\nuniform vec3 refTranslationVec;\nuniform int refMatrixType; // 0= identity, 1= translate, 2= transform\n\nvarying float depth;\n  \nvoid main()\n{\t\n\tvec4 rotatedPos;\n\n\tif(refMatrixType == 0)\n\t{\n\t\trotatedPos = buildingRotMatrix * vec4(position.xyz, 1.0) + vec4(aditionalPosition.xyz, 0.0);\n\t}\n\telse if(refMatrixType == 1)\n\t{\n\t\trotatedPos = buildingRotMatrix * vec4(position.xyz + refTranslationVec.xyz, 1.0) + vec4(aditionalPosition.xyz, 0.0);\n\t}\n\telse if(refMatrixType == 2)\n\t{\n\t\trotatedPos = RefTransfMatrix * vec4(position.xyz, 1.0) + vec4(aditionalPosition.xyz, 0.0);\n\t}\n\n    vec3 objPosHigh = buildingPosHIGH;\n    vec3 objPosLow = buildingPosLOW.xyz + rotatedPos.xyz;\n    vec3 highDifference = objPosHigh.xyz - encodedCameraPositionMCHigh.xyz;\n    vec3 lowDifference = objPosLow.xyz - encodedCameraPositionMCLow.xyz;\n    vec4 pos4 = vec4(highDifference.xyz + lowDifference.xyz, 1.0);\n    \n    //linear depth in camera space (0..far)\n    depth = (modelViewMatrixRelToEye * pos4).z/far;\n\n    gl_Position = ModelViewProjectionMatrixRelToEye * pos4;\n}\n",ShaderSource.ShowDepthFS="#ifdef GL_ES\n    precision highp float;\n#endif\nuniform float near;\nuniform float far;\n\nvarying float depth;  \nvarying vec3 vN; \nvarying vec4 vVSPos;\n\n// from http://spidergl.org/example.php?id=6\nvec4 packDepth(const in float depth)\n{\n    const vec4 bit_shift = vec4(16777216.0, 65536.0, 256.0, 1.0);\n    const vec4 bit_mask  = vec4(0.0, 0.00390625, 0.00390625, 0.00390625); \n    vec4 res = fract(depth * bit_shift);\n    res -= res.xxyz * bit_mask;\n\n    return res;  \n}\n\nvoid main()\n{\n    gl_FragData[0] = packDepth(-depth);\n    gl_FragData[0].r = -depth/far;\n}\n",ShaderSource.ShowDepthVS="attribute vec3 position;\nattribute vec3 normal;\n\nuniform mat4 modelViewMatrixRelToEye; \nuniform mat4 ModelViewProjectionMatrixRelToEye;\nuniform mat4 normalMatrix3;\nuniform mat4 normalMatrix4;\nuniform vec3 buildingPosHIGH;\nuniform vec3 buildingPosLOW;\nuniform vec3 encodedCameraPositionMCHigh;\nuniform vec3 encodedCameraPositionMCLow;\nuniform float near;\nuniform float far;\n\nvarying vec3 vN;\nvarying float depth;  \nvarying vec4 vVSPos;\n\nvoid main()\n{\t\n    vec3 objPosHigh = buildingPosHIGH;\n    vec3 objPosLow = buildingPosLOW.xyz + position.xyz;\n    vec3 highDifference = objPosHigh.xyz - encodedCameraPositionMCHigh.xyz;\n    vec3 lowDifference = objPosLow.xyz - encodedCameraPositionMCLow.xyz;\n    vec4 pos4 = vec4(highDifference.xyz + lowDifference.xyz, 1.0);\n\n    vN = normalize((normalMatrix4 * vec4(normal, 1.0)).xyz);\n    \n    //linear depth in camera space (0..far)\n    depth = (modelViewMatrixRelToEye * pos4).z/far;\n    vVSPos = modelViewMatrixRelToEye * pos4;\n\n    gl_Position = ModelViewProjectionMatrixRelToEye * pos4;\n}\n",ShaderSource.SilhouetteFS="precision highp float;\nuniform vec4 vColor4Aux;\n\nvoid main()\n{          \n    gl_FragColor = vColor4Aux;\n}",ShaderSource.SilhouetteVS="attribute vec3 position;\n\nuniform mat4 buildingRotMatrix; \nuniform mat4 ModelViewProjectionMatrixRelToEye;\nuniform mat4 ModelViewMatrixRelToEye;\nuniform mat4 ProjectionMatrix;\nuniform mat4 RefTransfMatrix;\nuniform vec3 buildingPosHIGH;\nuniform vec3 buildingPosLOW;\nuniform vec3 encodedCameraPositionMCHigh;\nuniform vec3 encodedCameraPositionMCLow;\nuniform vec3 aditionalPosition;\nuniform vec3 refTranslationVec;\nuniform int refMatrixType; // 0= identity, 1= translate, 2= transform\nuniform vec2 camSpacePixelTranslation;\nuniform vec2 screenSize;    \nvarying vec2 camSpaceTranslation;\n\nvoid main()\n{    \n    vec4 rotatedPos;\n\tif(refMatrixType == 0)\n\t{\n\t\trotatedPos = buildingRotMatrix * vec4(position.xyz, 1.0) + vec4(aditionalPosition.xyz, 0.0);\n\t}\n\telse if(refMatrixType == 1)\n\t{\n\t\trotatedPos = buildingRotMatrix * vec4(position.xyz + refTranslationVec.xyz, 1.0) + vec4(aditionalPosition.xyz, 0.0);\n\t}\n\telse if(refMatrixType == 2)\n\t{\n\t\trotatedPos = RefTransfMatrix * vec4(position.xyz, 1.0) + vec4(aditionalPosition.xyz, 0.0);\n\t}\n\n    vec3 objPosHigh = buildingPosHIGH;\n    vec3 objPosLow = buildingPosLOW.xyz + rotatedPos.xyz;\n    vec3 highDifference = objPosHigh.xyz - encodedCameraPositionMCHigh.xyz;\n    vec3 lowDifference = objPosLow.xyz - encodedCameraPositionMCLow.xyz;\n    vec4 pos4 = vec4(highDifference.xyz + lowDifference.xyz, 1.0);\n    vec4 camSpacePos = ModelViewMatrixRelToEye * pos4;\n    vec4 translationVec = ProjectionMatrix * vec4(camSpacePixelTranslation.x*(-camSpacePos.z), camSpacePixelTranslation.y*(-camSpacePos.z), 0.0, 1.0);\n\n    gl_Position = ModelViewProjectionMatrixRelToEye * pos4;\n    gl_Position += translationVec;  \n}",ShaderSource.SimpleDepthSsaoFS="precision highp float;\nconst vec4 bitEnc = vec4(1.0,255.0,65025.0,16581375.0);\nconst vec4 bitDec = 1.0/bitEnc;\nvarying float zDepth;\n\nvec4 EncodeFloatRGBA (float v)\n{\n    vec4 enc = bitEnc * v;\n    enc = fract(enc);\n    enc -= enc.yzww * vec2(1.0/255.0, 0.0).xxxy;\n    return enc;\n}\n\nvoid main()\n{          \n    vec4 encodedZ = EncodeFloatRGBA(zDepth);\n    gl_FragData[0] = encodedZ;\n}\n",ShaderSource.SimpleDepthSsaoVS="attribute vec3 position;\n\nuniform mat4 modelViewMatrixRelToEye; \nuniform mat4 ModelViewProjectionMatrixRelToEye;\nuniform mat4 RefTransfMatrix;\nuniform vec3 buildingPosHIGH;\nuniform vec3 buildingPosLOW;\nuniform vec3 encodedCameraPositionMCHigh;\nuniform vec3 encodedCameraPositionMCLow;\nvarying float zDepth;\nuniform float far;\n\nvoid main()\n{\t\n    vec4 rotatedPos = RefTransfMatrix * vec4(position.xyz, 1.0);\n    vec3 objPosHigh = buildingPosHIGH;\n    vec3 objPosLow = buildingPosLOW.xyz + rotatedPos.xyz;\n    vec3 highDifference = objPosHigh.xyz - encodedCameraPositionMCHigh.xyz;\n    vec3 lowDifference = objPosLow.xyz - encodedCameraPositionMCLow.xyz;\n    vec4 pos4 = vec4(highDifference.xyz + lowDifference.xyz, 1.0);\n    \n    zDepth = (modelViewMatrixRelToEye * pos4).z/far;\n\n    gl_Position = ModelViewProjectionMatrixRelToEye * pos4;\n}\n",ShaderSource.SsaoFS="#ifdef GL_ES\n    precision highp float;\n#endif\nuniform sampler2D depthTex;\nuniform sampler2D noiseTex;  \nuniform sampler2D diffuseTex;\nvarying vec3 vNormal;\nuniform mat4 projectionMatrix;\nuniform mat4 m;\nuniform vec2 noiseScale;\nuniform float near;\nuniform float far;            \nuniform float fov;\nuniform float aspectRatio;    \nuniform float screenWidth;    \nuniform float screenHeight;    \nuniform vec3 kernel[16];   \n\nvarying vec2 vTexCoord;   \n\nconst int kernelSize = 16;  \nconst float radius = 1.0;      \n\nfloat unpackDepth(const in vec4 rgba_depth)\n{\n    const vec4 bit_shift = vec4(0.000000059605, 0.000015258789, 0.00390625, 1.0);\n    float depth = dot(rgba_depth, bit_shift);\n    return depth;\n}                \n\nvec3 getViewRay(vec2 tc)\n{\n    float hfar = 2.0 * tan(fov/2.0) * far;\n    float wfar = hfar * aspectRatio;    \n    vec3 ray = vec3(wfar * (tc.x - 0.5), hfar * (tc.y - 0.5), -far);    \n    return ray;                      \n}         \n            \n//linear view space depth\nfloat getDepth(vec2 coord)\n{                          \n    return unpackDepth(texture2D(depthTex, coord.xy));\n}    \n\nvoid main()\n{          \n    vec2 screenPos = vec2(gl_FragCoord.x / screenWidth, gl_FragCoord.y / screenHeight);\t\t                 \n    float linearDepth = getDepth(screenPos);          \n    vec3 origin = getViewRay(screenPos) * linearDepth;   \n \n    vec3 normal2 = vNormal;   \n            \n    vec3 rvec = texture2D(noiseTex, screenPos.xy * noiseScale).xyz * 2.0 - 1.0;\n    vec3 tangent = normalize(rvec - normal2 * dot(rvec, normal2));\n    vec3 bitangent = cross(normal2, tangent);\n    mat3 tbn = mat3(tangent, bitangent, normal2);        \n    \n    float occlusion = 0.0;\n    for(int i = 0; i < kernelSize; ++i)\n    {    \t \n        vec3 sample = origin + (tbn * kernel[i]) * radius;\n        vec4 offset = projectionMatrix * vec4(sample, 1.0);\t\t\n        offset.xy /= offset.w;\n        offset.xy = offset.xy * 0.5 + 0.5;        \n        float sampleDepth = -sample.z/far;\n        float depthBufferValue = getDepth(offset.xy);\t\t\t\t              \n\n        float range_check = abs(linearDepth - depthBufferValue)+radius*0.998;\n        if (range_check < radius && depthBufferValue <= sampleDepth)\n        {\n            occlusion +=  1.0;\n        }\n        \n    }   \n        \n    occlusion = 1.0 - (occlusion) / float(kernelSize);\n                                \n    vec3 lightPos = vec3(10.0, 10.0, 10.0);\n    vec3 L = normalize(lightPos);\n    float NdotL = abs(dot(normal2, L));\n    vec3 diffuse = vec3(NdotL);\n    vec3 ambient = vec3(1.0);\n    vec4 textureColor = texture2D(diffuseTex, vec2(vTexCoord.s, vTexCoord.t));\n\n    gl_FragColor.rgb = vec3((textureColor.xyz*0.2 + textureColor.xyz*0.8) * occlusion); // with texture.***\n    gl_FragColor.a = 1.0;   \n}\n",ShaderSource.SsaoVS="attribute vec3 position;\nattribute vec3 normal;\nattribute vec2 texCoord;\n\nuniform mat4 projectionMatrix;  \nuniform mat4 modelViewMatrix;\nuniform mat4 modelViewMatrixRelToEye; \nuniform mat4 ModelViewProjectionMatrixRelToEye;\nuniform mat4 normalMatrix4;\nuniform vec3 buildingPosHIGH;\nuniform vec3 buildingPosLOW;\nuniform vec3 encodedCameraPositionMCHigh;\nuniform vec3 encodedCameraPositionMCLow;\n\nvarying vec3 vNormal;\nvarying vec2 vTexCoord;  \n\nvoid main()\n{\t\n    vec3 objPosHigh = buildingPosHIGH;\n    vec3 objPosLow = buildingPosLOW.xyz + position.xyz;\n    vec3 highDifference = objPosHigh.xyz - encodedCameraPositionMCHigh.xyz;\n    vec3 lowDifference = objPosLow.xyz - encodedCameraPositionMCLow.xyz;\n    vec4 pos4 = vec4(highDifference.xyz + lowDifference.xyz, 1.0);\n\n    vNormal = (normalMatrix4 * vec4(-normal.x, -normal.y, -normal.z, 1.0)).xyz;\n    vTexCoord = texCoord;\n\n    gl_Position = ModelViewProjectionMatrixRelToEye * pos4;\n}",ShaderSource.StandardFS="precision lowp float;\nvarying vec3 vColor;\n\nvoid main()\n{\n    gl_FragColor = vec4(vColor, 1.);\n}",ShaderSource.StandardVS="attribute vec3 position;\nuniform mat4 ModelViewProjectionMatrixRelToEye;\nuniform vec3 buildingPosHIGH;\nuniform vec3 buildingPosLOW;\nuniform vec3 encodedCameraPositionMCHigh;\nuniform vec3 encodedCameraPositionMCLow;\nuniform mat4 RefTransfMatrix;\nattribute vec3 color;\nvarying vec3 vColor;\n\nvoid main()\n{\n    vec4 rotatedPos = RefTransfMatrix * vec4(position.xyz, 1.0);\n    vec3 objPosHigh = buildingPosHIGH;\n    vec3 objPosLow = buildingPosLOW.xyz + rotatedPos.xyz;\n    vec3 highDifference = objPosHigh.xyz - encodedCameraPositionMCHigh.xyz;\n    vec3 lowDifference = objPosLow.xyz - encodedCameraPositionMCLow.xyz;\n    vec4 pos = vec4(highDifference.xyz + lowDifference.xyz, 1.0);\n \n    vColor=color;\n\n    gl_Position = ModelViewProjectionMatrixRelToEye * pos;\n}",ShaderSource.TextureA1FS="precision mediump float;\nvarying vec4 vColor;\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\n\nvoid main()\n{\n    gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.s, vTextureCoord.t));\n}\n",ShaderSource.TextureA1VS="attribute vec3 position;\nattribute vec4 aVertexColor;\nattribute vec2 aTextureCoord;\nuniform mat4 ModelViewProjectionMatrixRelToEye;\nuniform vec3 buildingPosHIGH;\nuniform vec3 buildingPosLOW;\nuniform vec3 encodedCameraPositionMCHigh;\nuniform vec3 encodedCameraPositionMCLow;\nvarying vec4 vColor;\nvarying vec2 vTextureCoord;\n\nvoid main()\n{\n    vec3 objPosHigh = buildingPosHIGH;\n    vec3 objPosLow = buildingPosLOW.xyz + position.xyz;\n    vec3 highDifference = objPosHigh.xyz - encodedCameraPositionMCHigh.xyz;\n    vec3 lowDifference = objPosLow.xyz - encodedCameraPositionMCLow.xyz;\n    vec4 pos = vec4(highDifference.xyz + lowDifference.xyz, 1.0);\n \n    vColor=aVertexColor;\n    vTextureCoord = aTextureCoord;\n\n    gl_Position = ModelViewProjectionMatrixRelToEye * pos;\n}",ShaderSource.TextureFS="precision mediump float;\nvarying vec4 vColor;\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\n\nvoid main()\n{\n    gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.s, vTextureCoord.t));\n}",ShaderSource.TextureNormalFS="\tprecision mediump float;\n\tvarying vec4 vColor;\n\tvarying vec2 vTextureCoord;\n\tuniform sampler2D uSampler;\n\tvarying vec3 vLightWeighting;\n\n\tvoid main()\n    {\n\t\tvec4 textureColor = texture2D(uSampler, vec2(vTextureCoord.s, vTextureCoord.t));\n        \n\t\tgl_FragColor = vec4(textureColor.rgb * vLightWeighting, textureColor.a);\n\t}\n",ShaderSource.TextureNormalVS="attribute vec3 position;\nattribute vec4 aVertexColor;\nattribute vec2 aTextureCoord;\nuniform mat4 ModelViewProjectionMatrixRelToEye;\nuniform vec3 buildingPosHIGH;\nuniform vec3 buildingPosLOW;\nuniform vec3 encodedCameraPositionMCHigh;\nuniform vec3 encodedCameraPositionMCLow;\nvarying vec4 vColor;\nvarying vec2 vTextureCoord;\nattribute vec3 aVertexNormal;\nvarying vec3 uAmbientColor;\nvarying vec3 vLightWeighting;\nuniform mat3 uNMatrix;\n\nvoid main()\n{\n    vec3 objPosHigh = buildingPosHIGH;\n    vec3 objPosLow = buildingPosLOW.xyz + position.xyz;\n    vec3 highDifference = objPosHigh.xyz - encodedCameraPositionMCHigh.xyz;\n    vec3 lowDifference = objPosLow.xyz - encodedCameraPositionMCLow.xyz;\n    vec4 pos = vec4(highDifference.xyz + lowDifference.xyz, 1.0);\n    \n    vColor = aVertexColor;\n    vTextureCoord = aTextureCoord;\n    \n    vLightWeighting = vec3(1.0, 1.0, 1.0);\n    uAmbientColor = vec3(0.7, 0.7, 0.7);\n    vec3 uLightingDirection = vec3(0.8, 0.2, -0.9);\n    vec3 directionalLightColor = vec3(0.4, 0.4, 0.4);\n    vec3 transformedNormal = uNMatrix * aVertexNormal;\n    float directionalLightWeighting = max(dot(transformedNormal, uLightingDirection), 0.0);\n    vLightWeighting = uAmbientColor + directionalLightColor * directionalLightWeighting;\n\n    gl_Position = ModelViewProjectionMatrixRelToEye * pos;\n}\n",ShaderSource.TextureVS="attribute vec3 position;\nattribute vec4 aVertexColor;\nattribute vec2 aTextureCoord;\nuniform mat4 Mmatrix;\nuniform mat4 ModelViewProjectionMatrixRelToEye;\nuniform vec3 buildingPosHIGH;\nuniform vec3 buildingPosLOW;\nuniform vec3 encodedCameraPositionMCHigh;\nuniform vec3 encodedCameraPositionMCLow;\nvarying vec4 vColor;\nvarying vec2 vTextureCoord;\n\nvoid main()\n{\n    vec4 rotatedPos = Mmatrix * vec4(position.xyz, 1.0);\n    vec3 objPosHigh = buildingPosHIGH;\n    vec3 objPosLow = buildingPosLOW.xyz + rotatedPos.xyz;\n    vec3 highDifference = objPosHigh.xyz - encodedCameraPositionMCHigh.xyz;\n    vec3 lowDifference = objPosLow.xyz - encodedCameraPositionMCLow.xyz;\n    vec4 pos = vec4(highDifference.xyz + lowDifference.xyz, 1.0);\n\n    vColor=aVertexColor;\n    vTextureCoord = aTextureCoord;\n\n    gl_Position = ModelViewProjectionMatrixRelToEye * pos;\n    \n}";var ByteColor=function(){if(!(this instanceof ByteColor))throw new Error(Messages.CONSTRUCT_ERROR);this.ByteR=0,this.ByteG=0,this.ByteB=0,this.ByteAlfa=255};ByteColor.prototype.destroy=function(){this.ByteR=null,this.ByteG=null,this.ByteB=null,this.ByteAlfa=null},ByteColor.prototype.set=function(e,t,r){this.ByteR=e,this.ByteG=t,this.ByteB=r};var Point2D=function(){if(!(this instanceof Point2D))throw new Error(Messages.CONSTRUCT_ERROR);this.x=0,this.y=0,this.IdxInIist},Point3DAux=function(){if(!(this instanceof Point3DAux))throw new Error(Messages.CONSTRUCT_ERROR);this.x=0,this.y=0,this.z=0},TTriangle=function(){if(!(this instanceof TTriangle))throw new Error(Messages.CONSTRUCT_ERROR);this.mVertex1,this.mVertex2,this.mVertex3};TTriangle.prototype.setVertices=function(e,t,r){this.mVertex1=e,this.mVertex2=t,this.mVertex3=r},TTriangle.prototype.invert=function(){var e=this.mVertex2;this.mVertex2=this.mVertex3,this.mVertex3=e};var TTrianglesList=function(){if(!(this instanceof TTrianglesList))throw new Error(Messages.CONSTRUCT_ERROR);this.tTrianglesArray=[]};TTrianglesList.prototype.newTTriangle=function(){var e=new TTriangle;return this.tTrianglesArray.push(e),e},TTrianglesList.prototype.invertTrianglesSense=function(){for(var e=0,t=this.tTrianglesArray.length;e<t;e++)this.tTrianglesArray[e].invert()},TTrianglesList.prototype.getTTriangle=function(e){return e>=0&&e<this.tTrianglesArray.length?this.tTrianglesArray[e]:void 0};var TTrianglesMatrix=function(){if(!(this instanceof TTrianglesMatrix))throw new Error(Messages.CONSTRUCT_ERROR);this.tTrianglesListsArray=[],this.totalTTrianglesArraySC=[]};TTrianglesMatrix.prototype.newTTrianglesList=function(){var e=new TTrianglesList;return this.tTrianglesListsArray.push(e),e},TTrianglesMatrix.prototype.invertTrianglesSense=function(){for(var e=0,t=this.tTrianglesListsArray.length;e<t;e++)this.tTrianglesListsArray[e].invertTrianglesSense()},TTrianglesMatrix.prototype.getTotalTTrianglesArray=function(e){for(var t=0,r=this.tTrianglesListsArray.length;t<r;t++)for(var i=0,o=this.tTrianglesListsArray[t].tTrianglesArray.length;i<o;i++){var a=this.tTrianglesListsArray[t].getTTriangle(i);e.push(a)}return e},TTrianglesMatrix.prototype.getVBOIndicesShortArray=function(){this.totalTTrianglesArraySC.length=0,this.totalTTrianglesArraySC=this.getTotalTTrianglesArray(this.totalTTrianglesArraySC);for(var e,t=this.totalTTrianglesArraySC.length,r=new Uint16Array(3*t),i=0;i<t;i++)e=this.totalTTrianglesArraySC[i],r[3*i]=e.mVertex1.mIdxInList,r[3*i+1]=e.mVertex2.mIdxInList,r[3*i+2]=e.mVertex3.mIdxInList;return r},(VertexMatrix=function(){if(!(this instanceof VertexMatrix))throw new Error(Messages.CONSTRUCT_ERROR);this.vertexListsArray=[],this.totalVertexArraySC=[]}).prototype.newVertexList=function(){var e=new VertexList;return this.vertexListsArray.push(e),e},VertexMatrix.prototype.getVertexList=function(e){return e>=0&&e<this.vertexListsArray.length?this.vertexListsArray[e]:void 0},VertexMatrix.prototype.getBoundingBox=function(e){void 0===e&&(e=new BoundingBox),this.totalVertexArraySC.length=0,this.totalVertexArraySC=this.getTotalVertexArray(this.totalVertexArraySC);for(var t=0,r=this.totalVertexArraySC.length;t<r;t++)0===t?e.init(this.totalVertexArraySC[t].point3d):e.addPoint(this.totalVertexArraySC[t].point3d);return e},VertexMatrix.prototype.setVertexIdxInList=function(){for(var e=0,t=0,r=this.vertexListsArray.length;t<r;t++)for(var i=this.vertexListsArray[t],o=0,a=i.vertexArray.length;o<a;o++)i.getVertex(o).mIdxInList=e,e++},VertexMatrix.prototype.getVertexCount=function(){for(var e=0,t=0,r=this.vertexListsArray.length;t<r;t++)e+=this.vertexListsArray[t].getVertexCount();return e},VertexMatrix.prototype.getTotalVertexArray=function(e){for(var t=0,r=this.vertexListsArray.length;t<r;t++)for(var i=this.vertexListsArray[t],o=0,a=i.vertexArray.length;o<a;o++){var n=i.getVertex(o);e.push(n)}return e},VertexMatrix.prototype.getVBOVertexColorFloatArray=function(e){this.totalVertexArraySC.length=0,this.totalVertexArraySC=this.getTotalVertexArray(this.totalVertexArraySC);var t=this.totalVertexArraySC.length;void 0===e&&(e=new Float32Array(6*t));for(var r=0;r<t;r++){var i=this.totalVertexArraySC[r];e[6*r]=i.point3d.x,e[6*r+1]=i.point3d.y,e[6*r+2]=i.point3d.z,e[6*r+3]=i.color4.r,e[6*r+4]=i.color4.g,e[6*r+5]=i.color4.b}return e},VertexMatrix.prototype.getVBOVertexColorRGBAFloatArray=function(e){this.totalVertexArraySC.length=0,this.totalVertexArraySC=this.getTotalVertexArray(this.totalVertexArraySC);var t=this.totalVertexArraySC.length;void 0===e&&(e=new Float32Array(7*t));for(var r=0;r<t;r++){var i=this.totalVertexArraySC[r];e[7*r]=i.point3d.x,e[7*r+1]=i.point3d.y,e[7*r+2]=i.point3d.z,e[7*r+3]=i.color4.r,e[7*r+4]=i.color4.g,e[7*r+5]=i.color4.b,e[7*r+6]=i.color4.a}return e},VertexMatrix.prototype.getVBOVertexFloatArray=function(e){this.totalVertexArraySC.length=0,this.totalVertexArraySC=this.getTotalVertexArray(this.totalVertexArraySC);var t=this.totalVertexArraySC.length;void 0===e&&(e=new Float32Array(3*t));for(var r=0;r<t;r++){var i=this.totalVertexArraySC[r];e[3*r]=i.point3d.x,e[3*r+1]=i.point3d.y,e[3*r+2]=i.point3d.z}return e},VertexMatrix.prototype.translateVertices=function(e,t,r,i){for(var o=0,a=this.vertexListsArray.length;o<a;o++)this.vertexListsArray[o].translateVertices(e,t,r,i)},VertexMatrix.prototype.makeTTrianglesLateralSidesLOOP=function(e){for(var t,r,i,o,a,n=0,s=0,l=this.vertexListsArray.length;s<l-1;s++){t=this.vertexListsArray[s],r=this.vertexListsArray[s+1],i=e.newTTrianglesList(),n=t.vertexArray.length;for(var c=0;c<n;c++)o=i.newTTriangle(),a=i.newTTriangle(),c===n-1?(o.setVertices(t.getVertex(c),r.getVertex(c),r.getVertex(0)),a.setVertices(t.getVertex(c),r.getVertex(0),t.getVertex(0))):(o.setVertices(t.getVertex(c),r.getVertex(c),r.getVertex(c+1)),a.setVertices(t.getVertex(c),r.getVertex(c+1),t.getVertex(c+1)))}},VertexMatrix.prototype.transformPointsByMatrix4=function(e){for(var t=0,r=this.vertexListsArray.length;t<r;t++)this.vertexListsArray[t].transformPointsByMatrix4(e)};var Polygon=function(){if(!(this instanceof Polygon))throw new Error(Messages.CONSTRUCT_ERROR);this.mPoint3DArray=[]};Polygon.prototype.addPoint3D=function(e){this.mPoint3DArray.push(e)},Polygon.prototype.newPoint3D=function(){var e=new Point3D;return this.mPoint3DArray.push(e),e};var TrianglesSurface=function(){if(!(this instanceof TrianglesSurface))throw new Error(Messages.CONSTRUCT_ERROR);this.mPoint3DArray=[],this.mTrianglesArray=[]};TrianglesSurface.prototype.destroy=function(){for(var e=0,t=this.mTrianglesArray.length;e<t;e++){var r=this.mTrianglesArray[e];null!==r&&r.destroy(),r=null}this.mTrianglesArray=null;for(var e=0,i=this.mPoint3DArray.length;e<i;e++){var o=this.mPoint3DArray[e];null!==o&&o.destroy(),o=null}this.mPoint3DArray=null},TrianglesSurface.prototype.getVertexColorsIndicesArrays=function(e){var t=null,r=e.meshArrays.length;t=0===r?e.newVertexColorIdxArray():e.meshArrays[r-1];for(var i=0,o=this.mTrianglesArray.length;i<o;i++){t.meshVertices.length/3>=65e3&&(t=e.newVertexColorIdxArray());var a=this.mTrianglesArray[i],n=a.mPoint1Idx,s=a.mPoint2Idx,l=a.mPoint3Idx,c=a.mColor1,h=a.mColor2,d=a.mColor3,u=this.mPoint3DArray[n],f=this.mPoint3DArray[s],g=this.mPoint3DArray[l];t.meshVertices.push(u.x),t.meshVertices.push(u.y),t.meshVertices.push(u.z),t.mesh_tri_indices.push(t.meshVertices.length/3-1),t.mesh_colors.push(c.r),t.mesh_colors.push(c.g),t.mesh_colors.push(c.b),t.meshVertices.push(f.x),t.meshVertices.push(f.y),t.meshVertices.push(f.z),t.mesh_tri_indices.push(t.meshVertices.length/3-1),t.mesh_colors.push(h.r),t.mesh_colors.push(h.g),t.mesh_colors.push(h.b),t.meshVertices.push(g.x),t.meshVertices.push(g.y),t.meshVertices.push(g.z),t.mesh_tri_indices.push(t.meshVertices.length/3-1),t.mesh_colors.push(d.r),t.mesh_colors.push(d.g),t.mesh_colors.push(d.b)}},TrianglesSurface.prototype.getVertexIndicesArrays=function(e){var t=null,r=e._meshArrays.length;t=0===r?e.newVertexIdxArray():e._meshArrays[r-1];for(var i=this.mTrianglesArray.length,o=t.meshVertices.length/3,a=0,n=this.mPoint3DArray.length;a<n;a++){var s=this.mPoint3DArray[a];t.meshVertices.push(s.x),t.meshVertices.push(s.y),t.meshVertices.push(s.z)}for(a=0;a<i;a++){t.meshVertices.length/3>=65e3&&(t=e.newVertexIdxArray(),o=0);var l=this.mTrianglesArray[a],c=l.mPoint1Idx,h=l.mPoint2Idx,d=l.mPoint3Idx;t.mesh_tri_indices.push(c+o),t.mesh_tri_indices.push(h+o),t.mesh_tri_indices.push(d+o)}},TrianglesSurface.prototype.getVertexIndicesArraysOriginal=function(e){var t=null,r=e._meshArrays.length;t=0===r?e.newVertexIdxArray():e._meshArrays[r-1];for(var i=0,o=this.mTrianglesArray.length;i<o;i++){t.meshVertices.length/3>=65e3&&(t=e.newVertexIdxArray());var a=this.mTrianglesArray[i],n=a.mPoint1Idx,s=a.mPoint2Idx,l=a.mPoint3Idx,c=this.mPoint3DArray[n],h=this.mPoint3DArray[s],d=this.mPoint3DArray[l];t.meshVertices.push(c.x),t.meshVertices.push(c.y),t.meshVertices.push(c.z),t.mesh_tri_indices.push(t.meshVertices.length/3-1),t.meshVertices.push(h.x),t.meshVertices.push(h.y),t.meshVertices.push(h.z),t.mesh_tri_indices.push(t.meshVertices.length/3-1),t.meshVertices.push(d.x),t.meshVertices.push(d.y),t.meshVertices.push(d.z),t.mesh_tri_indices.push(t.meshVertices.length/3-1)}},TrianglesSurface.prototype.newPoint3D=function(){var e=new Point3D;return this.mPoint3DArray.push(e),e},TrianglesSurface.prototype.newTriangle=function(){var e=new Triangle;return this.mTrianglesArray.push(e),e},TrianglesSurface.prototype.getTransformedTrianglesSurface=function(e){for(var t=new TrianglesSurface,r=0,i=this.mPoint3DArray.length;r<i;r++){var o=this.mPoint3DArray[r],a=e.transformPoint3D(o);t.mPoint3DArray.push(a)}for(var r=0,n=this.mTrianglesArray.length;r<n;r++){var s=this.mTrianglesArray[r];t.newTriangle().setPoints3DIndices(s.mPoint1Idx,s.mPoint2Idx,s.mPoint3Idx)}return t},TrianglesSurface.prototype.getBoundingBox=function(){var e=this.mPoint3DArray.length;if(0===e)return null;var t=new BoundingBox,r=this.mPoint3DArray[0];t.init(r);for(var i=1;i<e;i++){var o=this.mPoint3DArray[i];t.addPoint(o)}return t};var Fpolyhedron=function(){if(!(this instanceof Fpolyhedron))throw new Error(Messages.CONSTRUCT_ERROR);this.mFTrianglesSurfacesArray=[],this.mIFCEntityType=-1};Fpolyhedron.prototype.destroy=function(){for(var e=0,t=this.mFTrianglesSurfacesArray.length;e<t;e++){var r=this.mFTrianglesSurfacesArray[e];null!==r&&r.destroy(),r=null}this.mFTrianglesSurfacesArray=null,this.mIFCEntityType=null},Fpolyhedron.prototype.getVertexColorsIndicesArrays=function(e){for(var t=0,r=this.mFTrianglesSurfacesArray.length;t<r;t++)this.mFTrianglesSurfacesArray[t].getVertexColorsIndicesArrays(e)},Fpolyhedron.prototype.getVertexIndicesArrays=function(e){for(var t=0,r=this.mFTrianglesSurfacesArray.length;t<r;t++)this.mFTrianglesSurfacesArray[t].getVertexIndicesArrays(e)},Fpolyhedron.prototype.newFTrianglesSurface=function(){var e=new TrianglesSurface;return this.mFTrianglesSurfacesArray.push(e),e},Fpolyhedron.prototype.getTransformedFPolyhedron=function(e){for(var t=new Fpolyhedron,r=0,i=this.mFTrianglesSurfacesArray.length;r<i;r++){var o=this.mFTrianglesSurfacesArray[r].getTransformedTrianglesSurface(e);t.mFTrianglesSurfacesArray.push(o)}return t},Fpolyhedron.prototype.getBoundingBox=function(){var e=this.mFTrianglesSurfacesArray.length;if(0===e)return null;for(var t=null,r=0;r<e;r++){var i=this.mFTrianglesSurfacesArray[r].getBoundingBox();null===t?null!==i&&(t=i):null!==i&&t.addBox(i)}return t};var FpolyhedronsList=function(){if(!(this instanceof FpolyhedronsList))throw new Error(Messages.CONSTRUCT_ERROR);this.mFPolyhedronsArray=[]};FpolyhedronsList.prototype.getVertexColorsIndicesArrays=function(e){for(var t=0,r=this.mFPolyhedronsArray.length;t<r;t++){var i=this.mFPolyhedronsArray[t];27!==i.mIFCEntityType&&26!==i.mIFCEntityType&&i.getVertexColorsIndicesArrays(e)}},FpolyhedronsList.prototype.newFPolyhedron=function(){var e=new Fpolyhedron;return this.mFPolyhedronsArray.push(e),e};var Reference=function(){if(!(this instanceof Reference))throw new Error(Messages.CONSTRUCT_ERROR);this._id=0,this._block_idx=-1,this._matrix4=new Matrix4,this._VBO_ByteColorsCacheKeys_Container_idx=-1};Reference.prototype.multiplyTransformMatrix=function(e){var t=this._matrix4.getMultipliedByMatrix(e);this._matrix4=t},Reference.prototype.getBoundingBox=function(e){var t=e.getBlock(this._block_idx);return null===t?null:t._fpolyhedron.getTransformedFPolyhedron(this._matrix4).getBoundingBox()};var CompoundReference=function(){if(!(this instanceof CompoundReference))throw new Error(Messages.CONSTRUCT_ERROR);this._referencesList=[]};CompoundReference.prototype.getBoundingBox=function(e){for(var t=null,r=0,i=this._referencesList.length;r<i;r++){var o=this._referencesList[r].getBoundingBox(e);null===t?null!==o&&(t=o):null!==o&&t.addBox(o)}return t},CompoundReference.prototype.newReference=function(){var e=new Reference;return this._referencesList.push(e),e};var CompoundReferencesList=function(){if(!(this instanceof CompoundReferencesList))throw new Error(Messages.CONSTRUCT_ERROR);this.name="",this._compoundRefsArray=[],this._lodLevel=-1,this._ocCulling=new OcclusionCullingOctree,this._currentVisibleIndices=[],this._currentVisibleIndicesSC=[],this._currentVisibleIndicesSC_2=[]};CompoundReferencesList.prototype.updateCurrentVisibleIndices=function(e,t,r){this._currentVisibleIndicesSC=this._ocCulling._infinite_ocCulling_box.getIndicesVisiblesForEye(e,t,r,this._currentVisibleIndicesSC),this._currentVisibleIndicesSC_2=this._ocCulling._ocCulling_box.getIndicesVisiblesForEye(e,t,r,this._currentVisibleIndicesSC_2),this._currentVisibleIndices=this._currentVisibleIndicesSC.concat(this._currentVisibleIndicesSC_2)},CompoundReferencesList.prototype.updateCurrentVisibleIndicesInterior=function(e,t,r){this._currentVisibleIndices=this._ocCulling._ocCulling_box.getIndicesVisiblesForEye(e,t,r,this._currentVisibleIndices)},CompoundReferencesList.prototype.getBoundingBox=function(e){for(var t=null,r=0,i=this._compoundRefsArray.length;r<i;r++){var o=this._compoundRefsArray[r].getBoundingBox(e);null===t?null!==o&&(t=o):null!==o&&t.addBox(o)}return t},CompoundReferencesList.prototype.newCompoundReference=function(){var e=new CompoundReference;return this._compoundRefsArray.push(e),e},CompoundReferencesList.prototype.multiplyReferencesMatrices=function(e){for(var t=0,r=this._compoundRefsArray.length;t<r;t++)for(var i=this._compoundRefsArray[t],o=0,a=i._referencesList.length;o<a;o++)i._referencesList[o].multiplyTransformMatrix(e)};var CompoundReferencesListContainer=function(){if(!(this instanceof CompoundReferencesListContainer))throw new Error(Messages.CONSTRUCT_ERROR);this.compRefsListArray=[]};CompoundReferencesListContainer.prototype.newCompoundRefsList=function(e,t){var r=new CompoundReferencesList;return r.name=e,r._lodLevel=t,this.compRefsListArray.push(r),r},CompoundReferencesListContainer.prototype.updateCurrentVisibleIndicesOfLists=function(e,t,r){for(var i=0,o=this.compRefsListArray.length;i<o;i++)this.compRefsListArray[i].updateCurrentVisibleIndices(e,t,r)},CompoundReferencesListContainer.prototype.getCompRefListByName=function(e){for(var t,r=this.compRefsListArray.length,i=0;i<r;)this.compRefsListArray[i].name===e&&(t=this.compRefsListArray[i]),i++;return t};var VertexIdxArrays=function(){if(!(this instanceof VertexIdxArrays))throw new Error(Messages.CONSTRUCT_ERROR);this.indicesCount=-1,this.meshVertexCacheKey=null,this.meshFacesCacheKey=null},VertexIdxVBOArraysContainer=function(){if(!(this instanceof VertexIdxVBOArraysContainer))throw new Error(Messages.CONSTRUCT_ERROR);this._meshArrays=[]};VertexIdxVBOArraysContainer.prototype.newVertexIdxArray=function(){var e=new VertexIdxArrays;return this._meshArrays.push(e),e};var ByteColorsVBOArrays=function(){if(!(this instanceof ByteColorsVBOArrays))throw new Error(Messages.CONSTRUCT_ERROR);this.meshColorsCacheKey=null},ByteColorsVBOArraysContainer=function(){if(!(this instanceof ByteColorsVBOArraysContainer))throw new Error(Messages.CONSTRUCT_ERROR);this._meshArrays=[]};ByteColorsVBOArraysContainer.prototype.newByteColorsVBOArray=function(){var e=new ByteColorsVBOArrays;return this._meshArrays.push(e),e};var VertexTexcoordsArrays=function(){if(!(this instanceof VertexTexcoordsArrays))throw new Error(Messages.CONSTRUCT_ERROR);this._vertices_array=[],this._texcoords_array=[]},VNTInterleavedCacheKeys=function(){if(!(this instanceof VNTInterleavedCacheKeys))throw new Error(Messages.CONSTRUCT_ERROR);this.VNT_cacheKey=null,this.indices_cacheKey=null,this._vertices_count=0,this.indicesCount=0},VertexTexcoordsArraysCacheKeys=function(){if(!(this instanceof VertexTexcoordsArraysCacheKeys))throw new Error(Messages.CONSTRUCT_ERROR);this._verticesArray_cacheKey=null,this._texcoordsArray_cacheKey=null,this._vertices_count=0,this._normalsArray_cacheKey=null,this.verticesArrayBuffer,this.texCoordsArrayBuffer,this.normalsArrayBuffer},VertexTexcoordsArraysCacheKeysContainer=function(){if(!(this instanceof VertexTexcoordsArraysCacheKeysContainer))throw new Error(Messages.CONSTRUCT_ERROR);this._vtArrays_cacheKeys_array=[]};VertexTexcoordsArraysCacheKeysContainer.prototype.newVertexTexcoordsArraysCacheKey=function(){var e=new VertexTexcoordsArraysCacheKeys;return this._vtArrays_cacheKeys_array.push(e),e};var SimpleObject=function(){if(!(this instanceof SimpleObject))throw new Error(Messages.CONSTRUCT_ERROR);this._vtCacheKeys_container=new VertexTexcoordsArraysCacheKeysContainer},SimpleStorey=function(){if(!(this instanceof SimpleStorey))throw new Error(Messages.CONSTRUCT_ERROR);this._simpleObjects_array=[]};SimpleStorey.prototype.newSimpleObject=function(){var e=new SimpleObject;return this._simpleObjects_array.push(e),e};var SimpleBuilding=function(){if(!(this instanceof SimpleBuilding))throw new Error(Messages.CONSTRUCT_ERROR);this._simpleStoreys_list=[],this._simpleBuildingTexture};SimpleBuilding.prototype.newSimpleStorey=function(){var e=new SimpleStorey;return this._simpleStoreys_list.push(e),e};var SimpleBuildingV1=function(){if(!(this instanceof SimpleBuildingV1))throw new Error(Messages.CONSTRUCT_ERROR);this._simpleObjects_array=[],this._simpleBuildingTexture,this._texture_0,this._texture_1,this._texture_2,this._texture_3,this.color,this.textureArrayBuffer,this._vnt_cacheKeys};SimpleBuildingV1.prototype.newSimpleObject=function(){var e=new SimpleObject;return this._simpleObjects_array.push(e),e};var Header=function(){if(!(this instanceof Header))throw new Error(Messages.CONSTRUCT_ERROR);this._f4d_version=1,this._version="",this._type=-1,this._global_unique_id="",this._latitude=0,this._longitude=0,this._elevation=0,this._boundingBox=new BoundingBox,this._octZerothBox=new BoundingBox,this._dataFileName="",this._nailImageSize=0,this.isSmall=!1},BRBuildingProject=function(){if(!(this instanceof BRBuildingProject))throw new Error(Messages.CONSTRUCT_ERROR);this._header=new Header,this.move_matrix=new Float32Array(16),this.moveMatrixInv=new Float32Array(16),this.buildingPosMatInv,this.buildingPosition,this.buildingPositionHIGH,this.buildingPositionLOW,this._blocksList_Container=new BlocksListsContainer,this.createDefaultBlockReferencesLists(),this.octree,this._compRefList_Container=new CompoundReferencesListContainer,this._simpleBuilding=new SimpleBuilding,this._simpleBuilding_v1,this.radius_aprox,this._total_triangles_count=0,this._VBO_ByteColorsCacheKeysContainer_List=[],this._visibleCompRefLists_scratch=new CompoundReferencesList,this.point3dScratch=new Point3D,this.point3dScratch2=new Point3D,this._f4d_rawPathName="",this._f4d_headerPathName="",this._f4d_header_readed=!1,this._f4d_header_readed_finished=!1,this._f4d_simpleBuildingPathName="",this._f4d_simpleBuilding_readed=!1,this._f4d_simpleBuilding_readed_finished=!1,this._f4d_nailImagePathName="",this._f4d_nailImage_readed=!1,this._f4d_nailImage_readed_finished=!1,this._f4d_lod0ImagePathName="",this._f4d_lod0Image_readed=!1,this._f4d_lod0Image_readed_finished=!1,this._f4d_lod0Image_exists=!0,this._f4d_lod1ImagePathName="",this._f4d_lod1Image_readed=!1,this._f4d_lod1Image_readed_finished=!1,this._f4d_lod1Image_exists=!0,this._f4d_lod2ImagePathName="",this._f4d_lod2Image_readed=!1,this._f4d_lod2Image_readed_finished=!1,this._f4d_lod2Image_exists=!0,this._f4d_lod3ImagePathName="",this._f4d_lod3Image_readed=!1,this._f4d_lod3Image_readed_finished=!1,this._f4d_lod3Image_exists=!0,this._xdo_simpleBuildingPathName="",this._xdo_simpleBuilding_readed=!1,this._xdo_simpleBuilding_readed_finished=!1};BRBuildingProject.prototype.calculateTotalTrianglesCount=function(){for(var e=_interiorCompRefList_Container.compRefsListArray.length,t=0;t<e;t++)_interiorCompRefList_Container.compRefsListArray[t]._compoundRefsArray.length},BRBuildingProject.prototype.getTransformedRelativeEyePositionToBuilding=function(e,t,r){var i=this.buildingPosition,o=e-i.x,a=t-i.y,n=r-i.z;return void 0===this.buildingPosMatInv&&(this.buildingPosMatInv=new Matrix4,this.buildingPosMatInv.setByFloat32Array(this.moveMatrixInv)),this.point3dScratch.set(o,a,n),this.point3dScratch2=this.buildingPosMatInv.transformPoint3D(this.point3dScratch,this.point3dScratch2),this.point3dScratch2},BRBuildingProject.prototype.isCameraInsideOfBuilding=function(e,t,r){return this._header._boundingBox.isPoint3dInside(e,t,r)},BRBuildingProject.prototype.updateCurrentVisibleIndicesExterior=function(e,t,r){this._compRefList_Container.updateCurrentVisibleIndicesOfLists(e,t,r)},BRBuildingProject.prototype.getVisibleCompRefLists=function(e,t,r){return this._visibleCompRefLists_scratch=this._compRefList_Container.get_visibleCompRefObjectsList(e,t,r,this._visibleCompRefLists_scratch),this._visibleCompRefLists_scratch},BRBuildingProject.prototype.getVisibleEXTCompRefLists=function(e,t,r){return this._compRefList_Container.get_visibleCompRefObjectsList(e,t,r)},BRBuildingProject.prototype.getAllCompRefLists=function(){return this._compRefList_Container.compRefsListArray.concat(this._interiorCompRefList_Container.compRefsListArray)},BRBuildingProject.prototype.getRadiusAprox=function(){if(void 0===this._boundingBox){var e=this._compRefList_Container.getCompRefListByName("Ref_Skin1");e&&(this._boundingBox=new BoundingBox,this._boundingBox.minX=e._ocCulling._ocCulling_box.minX,this._boundingBox.maxX=e._ocCulling._ocCulling_box.maxX,this._boundingBox.minY=e._ocCulling._ocCulling_box.minY,this._boundingBox.maxY=e._ocCulling._ocCulling_box.maxY,this._boundingBox.minZ=e._ocCulling._ocCulling_box.minZ,this._boundingBox.maxZ=e._ocCulling._ocCulling_box.maxZ,this.radius_aprox=this._boundingBox.getMaxLength()/2)}return this.radius_aprox},BRBuildingProject.prototype.getBoundingBox=function(){if(void 0===this._boundingBox){var e=this._compRefList_Container.getCompRefListByName("Ref_Skin1");e&&(this._boundingBox=new BoundingBox,this._boundingBox.minX=e._ocCulling._ocCulling_box._minX,this._boundingBox.maxX=e._ocCulling._ocCulling_box.maxX,this._boundingBox.minY=e._ocCulling._ocCulling_box.minY,this._boundingBox.maxY=e._ocCulling._ocCulling_box.maxY,this._boundingBox.minZ=e._ocCulling._ocCulling_box.minZ,this._boundingBox.maxZ=e._ocCulling._ocCulling_box.maxZ,this.radius_aprox=this._boundingBox.getMaxLength()/2)}return this._boundingBox},BRBuildingProject.prototype.createDefaultBlockReferencesLists=function(){this._blocksList_Container.newBlocksList("Blocks1"),this._blocksList_Container.newBlocksList("Blocks2"),this._blocksList_Container.newBlocksList("Blocks3"),this._blocksList_Container.newBlocksList("BlocksBone"),this._blocksList_Container.newBlocksList("Blocks4")};var PCloudMesh=function(){if(!(this instanceof PCloudMesh))throw new Error(Messages.CONSTRUCT_ERROR);this.move_matrix=new Float32Array(16),this.moveMatrixInv=new Float32Array(16),this.pCloudPosMat_inv,this._pCloudPosition,this._pCloudPositionHIGH,this._pCloudPositionLOW,this._header=new Header,this.vbo_datas=new VBOVertexIdxCacheKeysContainer,this._f4d_rawPathName="",this._f4d_headerPathName="",this._f4d_header_readed=!1,this._f4d_header_readed_finished=!1,this._f4d_geometryPathName="",this._f4d_geometry_readed=!1,this._f4d_geometry_readed_finished=!1},BRBuildingProjectsList=function(){if(!(this instanceof BRBuildingProjectsList))throw new Error(Messages.CONSTRUCT_ERROR);this._BR_buildingsArray=[],this._boundingBox,this._pCloudMesh_array=[]};BRBuildingProjectsList.prototype.newBRProject=function(){var e=new BRBuildingProject;return this._BR_buildingsArray.push(e),e},BRBuildingProjectsList.prototype.getBoundingBox=function(){if(void 0===this._boundingBox)for(var e=this._BR_buildingsArray.length,t=0;t<e;t++){var r=this._BR_buildingsArray[t].getBoundingBox();void 0===this._boundingBox?null!==r&&(this._boundingBox=r):null!==r&&this._boundingBox.addBox(r)}return this._boundingBox};var ManagerUtils=function(){this.sqrtTable=[];for(var e=0;e<101;e++)this.sqrtTable[e]=Math.sqrt(1+.01*e*(.01*e))};ManagerUtils.pointToGeographicCoord=function(e,t,r){if(void 0===t&&(t=new GeographicCoord),r.configInformation.geo_view_library===Constant.WORLDWIND){var i=r.wwd.globe,o=new WorldWind.Position;o=i.computePositionFromPoint(e.x,e.y,e.z,o),t.setLonLatAlt(o.longitude,o.latitude,o.altitude)}else if(r.configInformation.geo_view_library===Constant.CESIUM){var a=Cesium.Cartographic.fromCartesian(new Cesium.Cartesian3(e.x,e.y,e.z));t.setLonLatAlt(a.longitude*(180/Math.PI),a.latitude*(180/Math.PI),a.height)}return t},ManagerUtils.geographicCoordToWorldPoint=function(e,t,r,i,o){if(void 0===i&&(i=new Point3D),o.configInformation.geo_view_library===Constant.WORLDWIND){var a=o.wwd.globe,n=new WorldWind.Vec3(0,0,0);n=a.computePointFromPosition(t,e,r,n),i.set(n[0],n[1],n[2]),n=void 0}else if(o.configInformation.geo_view_library===Constant.CESIUM){var s=Cesium.Cartesian3.fromDegrees(e,t,r);i.set(s.x,s.y,s.z),s=void 0}return i},ManagerUtils.getTransformationMatrixInPoint=function(e,t,r,i){return i.configInformation.geo_view_library===Constant.WORLDWIND||i.configInformation.geo_view_library===Constant.CESIUM&&(void 0===t&&(t=new Matrix4),Cesium.Transforms.eastNorthUpToFixedFrame(new Cesium.Cartesian3(e.x,e.y,e.z),void 0,t._floatArrays),r&&Cesium.Matrix4.inverseTransformation(t._floatArrays,r._floatArrays)),t},ManagerUtils.translatePivotPointGeoLocationData=function(e,t){if(void 0!==e){var r=new Point3D;r.set(-t.x,-t.y,-t.z),e.pivotPointTraslation=r,e.doEffectivePivotPointTranslation()}},ManagerUtils.calculateGeoLocationMatrixAtWorldPosition=function(e,t,r){if(void 0===t&&(t=new Matrix4),r.configInformation.geo_view_library===Constant.WORLDWIND){var i=new WorldWind.Vec3(0,0,0),o=new WorldWind.Vec3(0,0,0),a=new WorldWind.Vec3(0,0,0),n=WorldWind.Matrix.fromIdentity();WorldWind.WWMath.localCoordinateAxesAtPoint([e.x,e.y,e.z],r.wwd.globe,i,o,a),n.set(i[0],o[0],a[0],e.x,i[1],o[1],a[1],e.y,i[2],o[2],a[2],e.z,0,0,0,1);var s=WorldWind.Matrix.fromIdentity();s=n.columnMajorComponents(s),t.setByFloat32Array(s)}else r.configInformation.geo_view_library===Constant.CESIUM&&Cesium.Transforms.eastNorthUpToFixedFrame(e,void 0,t._floatArrays);return t},ManagerUtils.calculateGeoLocationMatrixAtLonLatAlt=function(e,t,r,i,o){void 0===i&&(i=new Matrix4);var a;return a=this.geographicCoordToWorldPoint(e,t,r,a,o),i=ManagerUtils.calculateGeoLocationMatrixAtWorldPosition(a,i,o)},ManagerUtils.calculateTransformMatrixAtWorldPosition=function(e,t,r,i,o,a,n){var s=new Matrix4,l=new Matrix4,c=new Matrix4;void 0!==t&&0!==t&&c.rotationAxisAngDeg(t,0,0,-1),void 0!==r&&0!==r&&s.rotationAxisAngDeg(r,-1,0,0),void 0!==i&&0!==i&&l.rotationAxisAngDeg(i,0,-1,0),void 0===o&&(o=new Matrix4),void 0===a&&(a=new Matrix4),o=ManagerUtils.calculateGeoLocationMatrixAtWorldPosition(e,o,n),a.copyFromMatrix4(o);var h,d,u;return h=c.getMultipliedByMatrix(a,h),d=s.getMultipliedByMatrix(h,d),u=l.getMultipliedByMatrix(d,u),a=u},ManagerUtils.calculateGeoLocationData=function(e,t,r,i,o,a,n,s){if(void 0===n&&(n=new GeoLocationData),void 0===n.geographicCoord&&(n.geographicCoord=new GeographicCoord),void 0!==e?n.geographicCoord.longitude=e:e=n.geographicCoord.longitude,void 0!==t?n.geographicCoord.latitude=t:t=n.geographicCoord.latitude,void 0!==r?n.geographicCoord.altitude=r:r=n.geographicCoord.altitude,void 0!==i&&(n.heading=i),void 0!==o&&(n.pitch=o),void 0!==a&&(n.roll=a),void 0!==n.geographicCoord.longitude&&void 0!==n.geographicCoord.latitude&&void 0!==s.configInformation){if(n.position=this.geographicCoordToWorldPoint(e,t,r,n.position,s),void 0===n.positionHIGH&&(n.positionHIGH=new Float32Array([0,0,0])),void 0===n.positionLOW&&(n.positionLOW=new Float32Array([0,0,0])),this.calculateSplited3fv([n.position.x,n.position.y,n.position.z],n.positionHIGH,n.positionLOW),void 0===n.tMatrix?n.tMatrix=new Matrix4:n.tMatrix.Identity(),void 0===n.geoLocMatrix?n.geoLocMatrix=new Matrix4:n.geoLocMatrix.Identity(),void 0===n.geoLocMatrixInv?n.geoLocMatrixInv=new Matrix4:n.geoLocMatrixInv.Identity(),void 0===n.tMatrixInv?n.tMatrixInv=new Matrix4:n.tMatrixInv.Identity(),void 0===n.rotMatrix?n.rotMatrix=new Matrix4:n.rotMatrix.Identity(),void 0===n.rotMatrixInv?n.rotMatrixInv=new Matrix4:n.rotMatrixInv.Identity(),n.tMatrix=ManagerUtils.calculateTransformMatrixAtWorldPosition(n.position,n.heading,n.pitch,n.roll,n.geoLocMatrix,n.tMatrix,s),n.rotMatrix.copyFromMatrix4(n.tMatrix),n.rotMatrix._floatArrays[12]=0,n.rotMatrix._floatArrays[13]=0,n.rotMatrix._floatArrays[14]=0,s.configInformation.geo_view_library===Constant.WORLDWIND){var l=WorldWind.Matrix.fromIdentity();l.invertMatrix(n.tMatrix._floatArrays),n.tMatrixInv.setByFloat32Array(l);var c=WorldWind.Matrix.fromIdentity();c.invertMatrix(n.rotMatrix._floatArrays),n.rotMatrixInv.setByFloat32Array(c);var h=WorldWind.Matrix.fromIdentity();h.invertMatrix(n.geoLocMatrix._floatArrays),n.geoLocMatrixInv.setByFloat32Array(h)}else s.configInformation.geo_view_library===Constant.CESIUM&&(Cesium.Matrix4.inverseTransformation(n.tMatrix._floatArrays,n.tMatrixInv._floatArrays),Cesium.Matrix4.inverseTransformation(n.rotMatrix._floatArrays,n.rotMatrixInv._floatArrays),Cesium.Matrix4.inverseTransformation(n.geoLocMatrix._floatArrays,n.geoLocMatrixInv._floatArrays));return void 0===n.pivotPoint&&(n.pivotPoint=new Point3D),n.pivotPoint.set(n.position.x,n.position.y,n.position.z),n.doEffectivePivotPointTranslation(),n}},ManagerUtils.calculateGeoLocationDataByAbsolutePoint=function(e,t,r,i,o){if(void 0===i&&(i=new GeoLocationData),void 0===i.geographicCoord&&(i.geographicCoord=new GeographicCoord),void 0!==o.configInformation){if(void 0===i.position&&(i.position=new Point3D),i.position.x=e,i.position.y=t,i.position.z=r,o.configInformation.geo_view_library===Constant.WORLDWIND){var a=o.wwd.globe,n=new WorldWind.Vec3(0,0,0);n=a.computePositionFromPoint(e,t,r,n),i.geographicCoord.longitude=n.longitude,i.geographicCoord.latitude=n.latitude,i.geographicCoord.altitude=n.altitude}else if(o.configInformation.geo_view_library===Constant.CESIUM){var s=new Cesium.Cartographic,l=new Cesium.Cartesian3;l.x=e,l.y=t,l.z=r,s=Cesium.Cartographic.fromCartesian(l,o.scene._globe._ellipsoid,s),i.geographicCoord.longitude=180*s.longitude/Math.PI,i.geographicCoord.latitude=180*s.latitude/Math.PI,i.geographicCoord.altitude=s.height}void 0===i.positionHIGH&&(i.positionHIGH=new Float32Array([0,0,0])),void 0===i.positionLOW&&(i.positionLOW=new Float32Array([0,0,0])),this.calculateSplited3fv([i.position.x,i.position.y,i.position.z],i.positionHIGH,i.positionLOW),void 0===i.tMatrix?i.tMatrix=new Matrix4:i.tMatrix.Identity(),void 0===i.geoLocMatrix?i.geoLocMatrix=new Matrix4:i.geoLocMatrix.Identity(),void 0===i.geoLocMatrixInv?i.geoLocMatrixInv=new Matrix4:i.geoLocMatrixInv.Identity(),void 0===i.tMatrixInv?i.tMatrixInv=new Matrix4:i.tMatrixInv.Identity(),void 0===i.rotMatrix?i.rotMatrix=new Matrix4:i.rotMatrix.Identity(),void 0===i.rotMatrixInv?i.rotMatrixInv=new Matrix4:i.rotMatrixInv.Identity();var c=new Matrix4,h=new Matrix4,d=new Matrix4;if(void 0!==i.heading&&0!==i.heading&&d.rotationAxisAngDeg(i.heading,0,0,-1),void 0!==i.pitch&&0!==i.pitch&&c.rotationAxisAngDeg(i.pitch,-1,0,0),void 0!==i.roll&&0!==i.roll&&h.rotationAxisAngDeg(i.roll,0,-1,0),o.configInformation.geo_view_library===Constant.WORLDWIND){var u=new WorldWind.Vec3(0,0,0),f=new WorldWind.Vec3(0,0,0),g=new WorldWind.Vec3(0,0,0),m=WorldWind.Matrix.fromIdentity(),y=WorldWind.Matrix.fromIdentity();WorldWind.WWMath.localCoordinateAxesAtPoint([i.position.x,i.position.y,i.position.z],o.wwd.globe,u,f,g),m.set(u[0],f[0],g[0],0,u[1],f[1],g[1],0,u[2],f[2],g[2],0,0,0,0,1),y.set(u[0],f[0],g[0],i.position.x,u[1],f[1],g[1],i.position.y,u[2],f[2],g[2],i.position.z,0,0,0,1);var p=WorldWind.Matrix.fromIdentity();p=m.columnMajorComponents(p);var v=WorldWind.Matrix.fromIdentity();v.invertMatrix(m);var _=WorldWind.Matrix.fromIdentity(),x=(v.columnMajorComponents(_),WorldWind.Matrix.fromIdentity());x=y.columnMajorComponents(x),i.tMatrix.setByFloat32Array(x),i.geoLocMatrix.copyFromMatrix4(i.tMatrix);var b=d.getMultipliedByMatrix(i.tMatrix,b),C=c.getMultipliedByMatrix(b,C),M=h.getMultipliedByMatrix(C,M);i.tMatrix=M,i.rotMatrix.copyFromMatrix4(i.tMatrix),i.rotMatrix._floatArrays[12]=0,i.rotMatrix._floatArrays[13]=0,i.rotMatrix._floatArrays[14]=0;var A=WorldWind.Matrix.fromIdentity();A.invertMatrix(i.tMatrix._floatArrays),i.tMatrixInv.setByFloat32Array(A);var R=WorldWind.Matrix.fromIdentity();R.invertMatrix(i.rotMatrix._floatArrays),i.rotMatrixInv.setByFloat32Array(R);var S=WorldWind.Matrix.fromIdentity();S.invertMatrix(i.geoLocMatrix._floatArrays),i.geoLocMatrixInv.setByFloat32Array(S)}else if(o.configInformation.geo_view_library===Constant.CESIUM){Cesium.Transforms.eastNorthUpToFixedFrame(i.position,void 0,i.tMatrix._floatArrays),i.geoLocMatrix.copyFromMatrix4(i.tMatrix);var b=d.getMultipliedByMatrix(i.tMatrix,b),C=c.getMultipliedByMatrix(b,C),M=h.getMultipliedByMatrix(C,M);i.tMatrix=M,i.rotMatrix.copyFromMatrix4(i.tMatrix),i.rotMatrix._floatArrays[12]=0,i.rotMatrix._floatArrays[13]=0,i.rotMatrix._floatArrays[14]=0,Cesium.Matrix4.inverse(i.tMatrix._floatArrays,i.tMatrixInv._floatArrays),Cesium.Matrix4.inverse(i.rotMatrix._floatArrays,i.rotMatrixInv._floatArrays),Cesium.Matrix4.inverse(i.geoLocMatrix._floatArrays,i.geoLocMatrixInv._floatArrays)}return void 0===i.pivotPoint&&(i.pivotPoint=new Point3D),i.pivotPoint.set(i.position.x,i.position.y,i.position.z),i}},ManagerUtils.calculateSplitedValues=function(e,t){void 0===t&&(t=new SplitValue);var r;return e>=0?(r=65536*Math.floor(e/65536),t.high=r,t.low=e-r):(r=65536*Math.floor(-e/65536),t.high=-r,t.low=e+r),t},ManagerUtils.calculateSplited3fv=function(e,t,r){if(void 0!==e){void 0===t&&(t=new Float32Array(3)),void 0===r&&(r=new Float32Array(3));var i=new SplitValue;i=this.calculateSplitedValues(e[0],i);var o=new SplitValue;o=this.calculateSplitedValues(e[1],o);var a=new SplitValue;a=this.calculateSplitedValues(e[2],a),t[0]=i.high,t[1]=o.high,t[2]=a.high,r[0]=i.low,r[1]=o.low,r[2]=a.low}},ManagerUtils.calculateAproxDist2D=function(e,t,r){var i,o,a=Math.abs(e.x-t.x),n=Math.abs(e.y-t.y);return o=a>n?n/(i=a):a/(i=n),i*r[Math.floor(100*o)]};for(var sqrtTable=new Float32Array(11),increValue=.1,i=0;i<11;i++)sqrtTable[i]=Math.sqrt(1+increValue*i*(increValue*i));ManagerUtils.calculateAproxDist3D=function(e,t){var r,i,o,a,n,s=Math.abs(e.x-t.x),l=Math.abs(e.y-t.y),c=Math.abs(e.z-t.z);if(s>l)return s>c?(i=l/(r=s),a=Math.floor(100*i),o=c/(h=r*sqrtTable[a]),n=Math.floor(100*o),h*sqrtTable[n]):(i=s/(r=c),a=Math.floor(100*i),o=l/(h=r*sqrtTable[a]),n=Math.floor(100*o),h*sqrtTable[n]);if(l>c)return i=s/(r=l),a=Math.floor(100*i),o=c/(h=r*sqrtTable[a]),n=Math.floor(100*o),h*sqrtTable[n];i=s/(r=c),a=Math.floor(100*i);var h=r*sqrtTable[a];return o=l/h,n=Math.floor(100*o),h*sqrtTable[n]},function(){function e(e){this.threads=Math.max(2,0|e),this._queue=[],this._queueSize=0,this._activeThreads=0,this._debug={start:0,end:0,time:0}}var t=window.URL||window.webkitURL;if(!t)throw new Error("This browser does not support Blob URLs");if(!window.Worker)throw new Error("This browser does not support Web Workers");e.prototype._worker={JSON:function(){var e=func;self.addEventListener("message",function(t){for(var r=t.data,i=new DataView(r),o=r.byteLength,a=Array(o),n=0;n<o;n++)a[n]=String.fromCharCode(i.getUint8(n));var s=JSON.parse(a.join("")),l=e.apply(e,s);try{r=JSON.stringify(l)}catch(e){throw new Error("Parallel function must return JSON serializable response")}o=void 0===r?0:r.length;var c=new ArrayBuffer(o);for(i=new DataView(c),n=0;n<o;n++)i.setUint8(n,255&r.charCodeAt(n));self.postMessage(c,[c]),self.close()})},Int32:function(){var e=func;self.addEventListener("message",function(t){for(var r=t.data,i=new DataView(r),o=r.byteLength/4,a=Array(o),n=0;n<o;n++)a[n]=i.getInt32(4*n);var s=e.apply(e,a);s instanceof Array||(s=[s]),o=s.length;var l=new ArrayBuffer(4*o);for(i=new DataView(l),n=0;n<o;n++)i.setInt32(4*n,s[n]);self.postMessage(l,[l]),self.close()})},Float64:function(){var e=func;self.addEventListener("message",function(t){for(var r=t.data,i=new DataView(r),o=r.byteLength/8,a=Array(o),n=0;n<o;n++)a[n]=i.getFloat64(8*n);var s=e.apply(e,a);s instanceof Array||(s=[s]),o=s.length;var l=new ArrayBuffer(8*o);for(i=new DataView(l),n=0;n<o;n++)i.setFloat64(8*n,s[n]);self.postMessage(l,[l]),self.close()})}},e.prototype._encode={JSON:function(e){try{var t=JSON.stringify(e)}catch(e){throw new Error("Arguments provided to parallel function must be JSON serializable")}len=t.length;for(var r=new ArrayBuffer(len),i=new DataView(r),o=0;o<len;o++)i.setUint8(o,255&t.charCodeAt(o));return r},Int32:function(e){len=e.length;for(var t=new ArrayBuffer(4*len),r=new DataView(t),i=0;i<len;i++)r.setInt32(4*i,e[i]);return t},Float64:function(e){len=e.length;for(var t=new ArrayBuffer(8*len),r=new DataView(t),i=0;i<len;i++)r.setFloat64(8*i,e[i]);return t}},e.prototype._decode={JSON:function(e){for(var t=new DataView(e),r=e.byteLength,i=Array(r),o=0;o<r;o++)i[o]=String.fromCharCode(t.getUint8(o));return i.length?JSON.parse(i.join("")):void 0},Int32:function(e){for(var t=new DataView(e),r=e.byteLength/4,i=Array(r),o=0;o<r;o++)i[o]=t.getInt32(4*o);return i},Float64:function(e){for(var t=new DataView(e),r=e.byteLength/8,i=Array(r),o=0;o<r;o++)i[o]=t.getFloat64(8*o);return i}},e.prototype._execute=function(e,t,r,i){if(this._activeThreads||(this._debug.start=(new Date).valueOf()),this._activeThreads<this.threads){this._activeThreads++;(new Date).valueOf();var o=new Worker(e),a=this._encode[r](t),n=this._decode[r],s=this;if("JSON"===r)l=function(e){i.call(s,n(e.data)),s.ready()};else var l=function(e){i.apply(s,n(e.data)),s.ready()};o.addEventListener("message",l),o.postMessage(a,[a])}else this._queueSize++,this._queue.push([e,t,r,i])},e.prototype.ready=function(){this._activeThreads--,this._queueSize?(this._execute.apply(this,this._queue.shift()),this._queueSize--):this._activeThreads||(this._debug.end=(new Date).valueOf(),this._debug.time=this._debug.end-this._debug.start)},e.prototype._prepare=function(e,r){var i=(e=e).name,o=e.toString();if(!i)for(i="$"+(10*Math.random()|0);-1!==o.indexOf(i);)i+=10*Math.random()|0;var a=this._worker[r].toString().replace(/^.*?[\n\r]+/gi,"").replace(/\}[\s]*$/,"").replace(/\/\*\*\/name\/\*\*\//gi,i).replace(/\/\*\*\/func\/\*\*\//gi,o);return t.createObjectURL(new Blob([a],{type:"text/javascript"}))},e.prototype.process=function(e,t){var r=this._prepare(e,"JSON"),i=this;return function(){i._execute(r,[].slice.call(arguments),"JSON",t)}},e.prototype.processInt32=function(e,t){var r=this._prepare(e,"Int32"),i=this;return function(){i._execute(r,[].slice.call(arguments),"Int32",t)}},e.prototype.processFloat64=function(e,t){var r=this._prepare(e,"Float64"),i=this;return function(){i._execute(r,[].slice.call(arguments),"Float64",t)}},window.Multithread=e}();var currentCamPos=new Point3D,lastCamPos=new Point3D,squareDistUmbral=22,building_project,compRefList_array_background,geoModifier=new GeometryModifier;onmessage=function(e){var t=possibleCameraPositionChanged(e);postMessage([t])};