"use strict";var Accessor=function(){if(!(this instanceof Accessor))throw new Error(Messages.CONSTRUCT_ERROR);this.bufferId,this.accesorType,this.bufferStart,this.stride,this.dataType,this.dimension,this.minX=0,this.minY=0,this.minZ=0,this.maxX=0,this.maxY=0,this.maxZ=0};
"use strict";var API=function(t){if(!(this instanceof API))throw new Error(Messages.CONSTRUCT_ERROR);this.magoEnable=!0,this.apiName=t,this.projectId=null,this.blockId=null,this.blockIds=null,this.objectIds=null,this.renderMode=0,this.latitude=0,this.longitude=0,this.elevation=0,this.heading=0,this.pitch=0,this.roll=0,this.color=0,this.blockType=null,this.showOutFitting=!1,this.showBoundingBox=!1,this.showShadow=!1,this.frustumFarDistance=0,this.mouseMoveMode=0};API.prototype.getMagoEnable=function(){return this.magoEnable},API.prototype.setMagoEnable=function(t){this.magoEnable=t},API.prototype.getAPIName=function(){return this.apiName},API.prototype.getProjectId=function(){return this.projectId},API.prototype.setProjectId=function(t){this.projectId=t},API.prototype.getBlockId=function(){return this.blockId},API.prototype.setBlockId=function(t){this.blockId=t},API.prototype.getBlockIds=function(){return this.blockIds},API.prototype.setBlockIds=function(t){this.blockIds=t},API.prototype.getObjectIds=function(){return this.objectIds},API.prototype.setObjectIds=function(t){this.objectIds=t},API.prototype.getRenderMode=function(){return this.renderMode},API.prototype.setRenderMode=function(t){this.renderMode=t},API.prototype.getLatitude=function(){return this.latitude},API.prototype.setLatitude=function(t){this.latitude=t},API.prototype.getLongitude=function(){return this.longitude},API.prototype.setLongitude=function(t){this.longitude=t},API.prototype.getElevation=function(){return this.elevation},API.prototype.setElevation=function(t){this.elevation=t},API.prototype.getHeading=function(){return this.heading},API.prototype.setHeading=function(t){this.heading=t},API.prototype.getPitch=function(){return this.pitch},API.prototype.setPitch=function(t){this.pitch=t},API.prototype.getRoll=function(){return this.roll},API.prototype.setRoll=function(t){this.roll=t},API.prototype.getColor=function(){return this.color},API.prototype.setColor=function(t){this.color=t},API.prototype.getBlockType=function(){return this.blockType},API.prototype.setBlockType=function(t){this.blockType=t},API.prototype.getShowOutFitting=function(){return this.showOutFitting},API.prototype.setShowOutFitting=function(t){this.showOutFitting=t},API.prototype.getShowBoundingBox=function(){return this.showBoundingBox},API.prototype.setShowBoundingBox=function(t){this.showBoundingBox=t},API.prototype.getShowShadow=function(){return this.showShadow},API.prototype.setShowShadow=function(t){this.showShadow=t},API.prototype.getFrustumFarDistance=function(){return this.frustumFarDistance},API.prototype.setFrustumFarDistance=function(t){this.frustumFarDistance=t},API.prototype.getMouseMoveMode=function(){return this.mouseMoveMode},API.prototype.setMouseMoveMode=function(t){this.mouseMoveMode=t};
"use strict";var Atmosphere=function(){if(!(this instanceof Atmosphere))throw new Error(Messages.CONSTRUCT_ERROR);this.cloudsManager=new CloudsManager,this.shadowBlendingCube=new ShadowBlendingCube},ShadowBlendingCube=function(){if(!(this instanceof ShadowBlendingCube))throw new Error(Messages.CONSTRUCT_ERROR);this.vertexMatrix=new VertexMatrix,this.tTrianglesMatrix=new TTrianglesMatrix,this.init(this.vertexMatrix,this.tTrianglesMatrix),this.vboVertexCacheKey,this.vboIndexCacheKey,this.indicesCount=0};ShadowBlendingCube.prototype.init=function(t,e){var i=150.5,r=.1,s=.1,o=.1,n=.6,a=t.newVertexList(),h=a.newVertex();h.setPosition(0,0,-i),h.setColorRGBA(r,s,o,n),h=a.newVertex(),h.setPosition(0,0,-i),h.setColorRGBA(r,s,o,n),h=a.newVertex(),h.setPosition(0,0,-i),h.setColorRGBA(r,s,o,n),h=a.newVertex(),h.setPosition(0,0,-i),h.setColorRGBA(r,s,o,n),a=t.newVertexList(),h=a.newVertex(),h.setPosition(-i,-i,-i),h.setColorRGBA(r,s,o,n),h=a.newVertex(),h.setPosition(i,-i,-i),h.setColorRGBA(r,s,o,n),h=a.newVertex(),h.setPosition(i,i,-i),h.setColorRGBA(r,s,o,n),h=a.newVertex(),h.setPosition(-i,i,-i),h.setColorRGBA(r,s,o,n),a=t.newVertexList(),h=a.newVertex(),h.setPosition(-i,-i,i),h.setColorRGBA(r,s,o,n),h=a.newVertex(),h.setPosition(i,-i,i),h.setColorRGBA(r,s,o,n),h=a.newVertex(),h.setPosition(i,i,i),h.setColorRGBA(r,s,o,n),h=a.newVertex(),h.setPosition(-i,i,i),h.setColorRGBA(r,s,o,n),a=t.newVertexList(),h=a.newVertex(),h.setPosition(0,0,i),h.setColorRGBA(r,s,o,n),h=a.newVertex(),h.setPosition(0,0,i),h.setColorRGBA(r,s,o,n),h=a.newVertex(),h.setPosition(0,0,i),h.setColorRGBA(r,s,o,n),h=a.newVertex(),h.setPosition(0,0,i),h.setColorRGBA(r,s,o,n),t.makeTTrianglesLateralSidesLOOP(e)},ShadowBlendingCube.prototype.getVBOVertexColorRGBAFloatArray=function(){var t=this.vertexMatrix.getVBOVertexColorRGBAFloatArray(t);return t},ShadowBlendingCube.prototype.getVBOIndicesShortArray=function(){this.vertexMatrix.setVertexIdxInList();var t=this.tTrianglesMatrix.getVBOIndicesShortArray();return this.indicesCount=t.length,t};var CloudsManager=function(){if(!(this instanceof CloudsManager))throw new Error(Messages.CONSTRUCT_ERROR);this.circularCloudsArray=[]};CloudsManager.prototype.newCircularCloud=function(){var t=new CircularCloud;return this.circularCloudsArray.push(t),t};var CircularCloud=function(){if(!(this instanceof CircularCloud))throw new Error(Messages.CONSTRUCT_ERROR);this.radius=200,this.depth=150,this.numPointsForCicle=8,this.vertexMatrix=new VertexMatrix,this.tTrianglesMatrix=new TTrianglesMatrix,this.shadowVertexMatrix=new VertexMatrix,this.shadowTTrianglesMatrix=new TTrianglesMatrix,this.sunLightDirection=new Point3D,this.sunLightDirection.set(1,1,-5),this.sunLightDirection.unitary(),this.longitude,this.latitude,this.altitude,this.position,this.positionHIGH,this.positionLOW,this.bbox=new BoundingBox,this.cullingPosition,this.cullingRadius,this.vboVertexCacheKey,this.vboIndexCacheKey,this.vboShadowVertexCacheKey,this.vboShadowIndexCacheKey,this.indicesCount=0,this.rendered=!1,this.point3dSC=new Point3D,this.vertexSC=new Vertex};CircularCloud.prototype.getVBOVertexColorFloatArray=function(){var t=this.vertexMatrix.getVBOVertexColorFloatArray(t);return t},CircularCloud.prototype.getVBOIndicesShortArray=function(){this.vertexMatrix.setVertexIdxInList();var t=this.tTrianglesMatrix.getVBOIndicesShortArray();return this.indicesCount=t.length,t},CircularCloud.prototype.getVBOShadowVertexFloatArray=function(){var t=this.shadowVertexMatrix.getVBOVertexFloatArray(t);return t},CircularCloud.prototype.getVBOShadowIndicesShortArray=function(){this.shadowVertexMatrix.setVertexIdxInList();var t=this.shadowTTrianglesMatrix.getVBOIndicesShortArray();return this.indicesCount=t.length,t},CircularCloud.prototype.rotateMeshByLocation=function(t){var e=new Matrix4;e.rotationAxisAngDeg(-this.longitude,0,0,1),t.transformPointsByMatrix4(e);var i,r=this.longitude*Math.PI/180,s=new Point3D,o=new Point3D;s.set(Math.cos(r),Math.sin(r),0),o.set(0,0,1),i=s.crossProduct(o,i),i.unitary(),e.rotationAxisAngDeg(90-this.latitude,i.x,i.y,0),t.transformPointsByMatrix4(e)},CircularCloud.prototype.doShadowMeshWithSunDirection=function(){var t=3e3,e=this.shadowVertexMatrix.getVertexList(5);e.translateVertices(this.sunLightDirection.x,this.sunLightDirection.y,this.sunLightDirection.z,t),e=this.shadowVertexMatrix.getVertexList(4),e.translateVertices(this.sunLightDirection.x,this.sunLightDirection.y,this.sunLightDirection.z,t),e=this.shadowVertexMatrix.getVertexList(3),e.translateVertices(this.sunLightDirection.x,this.sunLightDirection.y,this.sunLightDirection.z,t)},CircularCloud.prototype.createCloud=function(t,e,i,r,s,o){this.longitude=t,this.latitude=e,this.altitude=i,this.radius=r,this.depth=s,this.numPointsForCicle=o,this.makeMesh(this.vertexMatrix,this.tTrianglesMatrix,this.shadowVertexMatrix,this.shadowTTrianglesMatrix),this.doShadowMeshWithSunDirection(),this.rotateMeshByLocation(this.vertexMatrix),this.rotateMeshByLocation(this.shadowVertexMatrix);var n=Cesium.Cartesian3.fromDegrees(this.longitude,this.latitude,this.altitude);this.position=n;var a=Cesium.EncodedCartesian3.encode(n.x),h=Cesium.EncodedCartesian3.encode(n.y),x=Cesium.EncodedCartesian3.encode(n.z);this.positionHIGH=new Float32Array([a.high,h.high,x.high]),this.positionLOW=new Float32Array([a.low,h.low,x.low]),this.bbox=this.shadowVertexMatrix.getBoundingBox(this.bbox);var d=this.bbox.getCenterPoint3d(d);this.cullingPosition=new Cesium.Cartesian3(d.x+this.position.x,d.y+this.position.y,d.z+this.position.z),this.cullingRadius=this.bbox.getMaxLength()/2},CircularCloud.prototype.makeMesh=function(t,e,i,r){var s,o,n=16,a=2*Math.PI/n,h=0,x=this.depth/2,d=0,l=0,u=0,w=t.newVertexList(),C=i.newVertexList();u=.9+.3*Math.random();for(var c=0;c<n;c++)s=w.newVertex(),s.setPosition(d,l,x),o=C.newVertex(),o.setPosition(d,l,1.2*-x),s.setColorRGB(u,u,u);h=0;var V=.7*this.radius;w=t.newVertexList(),C=i.newVertexList();for(var c=0;c<n;c++)u=(2+Math.random())/2,s=w.newVertex(),o=C.newVertex(),d=V*Math.cos(h)*u,l=V*Math.sin(h)*u,o.setPosition(d,l,2*-x),s.setPosition(d,l,.8*x),u=.9+.3*Math.random(),s.setColorRGB(u,u,u),h+=a;h=0,w=t.newVertexList(),C=i.newVertexList();for(var c=0;c<n;c++)u=(2+Math.random())/2,s=w.newVertex(),o=C.newVertex(),d=this.radius*Math.cos(h)*u,l=this.radius*Math.sin(h)*u,o.setPosition(d,l,2*-x),s.setPosition(d,l,.4*x),u=.9+.3*Math.random(),s.setColorRGB(u,u,u),h+=a;h=0,w=t.newVertexList(),C=i.newVertexList();for(var c=0;c<n;c++)u=(2+Math.random())/2,s=w.newVertex(),o=C.newVertex(),d=this.radius*Math.cos(h)*u,l=this.radius*Math.sin(h)*u,o.setPosition(d,l,2*-x),s.setPosition(d,l,.4*-x),u=.8+.3*Math.random(),s.setColorRGB(u,u,u),h+=a;h=0,V=.7*this.radius,w=t.newVertexList(),C=i.newVertexList();for(var c=0;c<n;c++)u=(2+Math.random())/2,s=w.newVertex(),o=C.newVertex(),d=V*Math.cos(h)*u,l=V*Math.sin(h)*u,s.setPosition(d,l,.8*-x),o.setPosition(d,l,1.2*-x),u=.6+.3*Math.random(),s.setColorRGB(u,u,u),h+=a;w=t.newVertexList(),C=i.newVertexList(),u=.6+.3*Math.random();for(var c=0;c<n;c++)s=w.newVertex(),o=C.newVertex(),s.setPosition(0,0,-x),o.setPosition(0,0,-x),s.setColorRGB(u,u,u);t.makeTTrianglesLateralSidesLOOP(e),i.makeTTrianglesLateralSidesLOOP(r)};
"use strict";var Block=function(){if(!(this instanceof Block))throw new Error(Messages.CONSTRUCT_ERROR);this.vBOVertexIdxCacheKeysContainer=new VBOVertexIdxCacheKeysContainer,this.mIFCEntityType=-1,this.isSmallObj=!1,this.radius=10,this.vertexCount=0,this.lego};Block.prototype.deleteObjects=function(e){this.vBOVertexIdxCacheKeysContainer.deleteGlObjects(e),this.vBOVertexIdxCacheKeysContainer=void 0,this.mIFCEntityType=void 0,this.isSmallObj=void 0,this.radius=void 0,this.vertexCount=void 0,this.lego&&this.lego.deleteGlObjects(e),this.lego=void 0};var BlocksList=function(){if(!(this instanceof BlocksList))throw new Error(Messages.CONSTRUCT_ERROR);this.name="",this.blocksArray,this.fileLoadState=CODE.fileLoadState.READY,this.dataArraybuffer};BlocksList.prototype.newBlock=function(){void 0==this.blocksArray&&(this.blocksArray=[]);var e=new Block;return this.blocksArray.push(e),e},BlocksList.prototype.getBlock=function(e){return void 0==this.blocksArray?null:e>=0&&e<this.blocksArray.length?this.blocksArray[e]:null},BlocksList.prototype.deleteGlObjects=function(e){if(void 0!=this.blocksArray){for(var t=0,r=this.blocksArray.length;t<r;t++){var a=this.blocksArray[t];a.vBOVertexIdxCacheKeysContainer.deleteGlObjects(e),a.vBOVertexIdxCacheKeysContainer=void 0,a.mIFCEntityType=void 0,a.isSmallObj=void 0,a.radius=void 0,a.vertexCount=void 0,a.lego&&(a.lego.vbo_vicks_container.deleteGlObjects(e),a.lego.vbo_vicks_container=void 0),a.lego=void 0,this.blocksArray[t]=void 0}this.blocksArray=void 0,this.name=void 0,this.fileLoadState=void 0,this.dataArraybuffer=void 0}},BlocksList.prototype.parseArrayBuffer=function(e,t,r){this.fileLoadState=CODE.fileLoadState.PARSE_STARTED;var a=0,i=r.readUInt32(t,a,a+4);a+=4;for(var o=0;o<i;o++){var s=this.newBlock(),n=new BoundingBox;n.minX=new Float32Array(t.slice(a,a+4)),a+=4,n.minY=new Float32Array(t.slice(a,a+4)),a+=4,n.minZ=new Float32Array(t.slice(a,a+4)),a+=4,n.maxX=new Float32Array(t.slice(a,a+4)),a+=4,n.maxY=new Float32Array(t.slice(a,a+4)),a+=4,n.maxZ=new Float32Array(t.slice(a,a+4)),a+=4;var l=n.getMaxLength();l<1?s.isSmallObj=!0:s.isSmallObj=!1,s.radius=l/2;var c=r.readUInt32(t,a,a+4);a+=4;for(var v=0;v<c;v++){var d=r.readUInt32(t,a,a+4);a+=4;var y=3*d;s.vertexCount=d;var h=a,A=a+4*y,f=s.vBOVertexIdxCacheKeysContainer.newVBOVertexIdxCacheKey();f.pos_vboDataArray=new Float32Array(t.slice(h,A)),a+=4*y,d=r.readUInt32(t,a,a+4),a+=4;var C=3*d;h=a,A=a+1*C,f.nor_vboDataArray=new Int8Array(t.slice(h,A)),a+=1*C;var u=r.readUInt32(t,a,a+4);a+=4,h=a,A=a+2*u,f.idx_vboDataArray=new Int16Array(t.slice(h,A)),a+=2*u,f.indicesCount=u}}this.fileLoadState=CODE.fileLoadState.PARSE_FINISHED},BlocksList.prototype.parseArrayBufferAsimetricVersion=function(e,t,r,a){this.fileLoadState=CODE.fileLoadState.PARSE_STARTED;var i=0,o=r.readUInt32(t,i,i+4);i+=4;for(var s=0;s<o;s++){var n=new Block,l=r.readInt32(t,i,i+4);if(i+=4,n.idx=l,a[l]){i+=24;var c=r.readInt32(t,i,i+4);i+=4;for(var v=0;v<c;v++){var d=r.readUInt32(t,i,i+4);i+=4;var y=3*d;n.vertexCount=d;var h=i,A=i+4*y;i+=4*y,d=r.readUInt32(t,i,i+4),i+=4;var f=3*d;i+=1*f;var C=r.readUInt32(t,i,i+4);i+=4;var u=r.readUInt8(t,i,i+1);i+=1,i+=4*u,i+=4*u,i+=2*C}}else{a[l]=n;var b=new BoundingBox;b.minX=new Float32Array(t.slice(i,i+4)),i+=4,b.minY=new Float32Array(t.slice(i,i+4)),i+=4,b.minZ=new Float32Array(t.slice(i,i+4)),i+=4,b.maxX=new Float32Array(t.slice(i,i+4)),i+=4,b.maxY=new Float32Array(t.slice(i,i+4)),i+=4,b.maxZ=new Float32Array(t.slice(i,i+4)),i+=4;var k=b.getMaxLength();k<.9?n.isSmallObj=!0:n.isSmallObj=!1,n.radius=k/2,b.deleteObjects(),b=void 0;var c=r.readInt32(t,i,i+4);i+=4;for(var v=0;v<c;v++){var d=r.readUInt32(t,i,i+4);i+=4;var y=3*d;n.vertexCount=d;var h=i,A=i+4*y,I=n.vBOVertexIdxCacheKeysContainer.newVBOVertexIdxCacheKey();I.posVboDataArray=new Float32Array(t.slice(h,A)),i+=4*y,d=r.readUInt32(t,i,i+4),i+=4;var f=3*d;h=i,A=i+1*f,I.norVboDataArray=new Int8Array(t.slice(h,A)),i+=1*f;var C=r.readUInt32(t,i,i+4);i+=4;var u=r.readUInt8(t,i,i+1);i+=1;for(var x=[],B=0;B<u;B++)x.push(new Float32Array(t.slice(i,i+4))),i+=4;for(var w=[],B=0;B<u;B++)w.push(r.readUInt32(t,i,i+4)),i+=4;var O=w[u-1];I.bigTrianglesIndicesCount=O,h=i,A=i+2*C,I.idxVboDataArray=new Int16Array(t.slice(h,A)),i+=2*C,I.indicesCount=C}}}this.fileLoadState=CODE.fileLoadState.PARSE_FINISHED};var BlocksListsContainer=function(){if(!(this instanceof BlocksListsContainer))throw new Error(Messages.CONSTRUCT_ERROR);this.blocksListsArray=[]};BlocksListsContainer.prototype.newBlocksList=function(e){var t=new BlocksList;return t.name=e,this.blocksListsArray.push(t),t},BlocksListsContainer.prototype.getBlockList=function(e){for(var t=this.blocksListsArray.length,r=!1,a=0,i=null;!r&&a<t;){var o=this.blocksListsArray[a];o.name==e&&(r=!0,i=o),a++}return i};
"use strict";var BoundingBox=function(){if(!(this instanceof BoundingBox))throw new Error(Messages.CONSTRUCT_ERROR);this.minX=1e6,this.minY=1e6,this.minZ=1e6,this.maxX=-1e6,this.maxY=-1e6,this.maxZ=-1e6};BoundingBox.prototype.setInit=function(i){this.minX=i.x,this.minY=i.y,this.minZ=i.z,this.maxX=i.x,this.maxY=i.y,this.maxZ=i.z},BoundingBox.prototype.deleteObjects=function(){this.minX=void 0,this.minY=void 0,this.minZ=void 0,this.maxX=void 0,this.maxY=void 0,this.maxZ=void 0},BoundingBox.prototype.expand=function(i){this.minX-=i,this.minY-=i,this.minZ-=i,this.maxX+=i,this.maxY+=i,this.maxZ+=i},BoundingBox.prototype.addPoint3D=function(i){i.x<this.minX?this.minX=i.x:i.x>this.maxX&&(this.maxX=i.x),i.y<this.minY?this.minY=i.y:i.y>this.maxY&&(this.maxY=i.y),i.z<this.minZ?this.minZ=i.z:i.z>this.maxZ&&(this.maxZ=i.z)},BoundingBox.prototype.addBox=function(i){i.minX<this.minX&&(this.minX=i.minX),i.maxX>this.maxX&&(this.maxX=i.maxX),i.minY<this.minY&&(this.minY=i.minY),i.maxY>this.maxY&&(this.maxY=i.maxY),i.minZ<this.minZ&&(this.minZ=i.minZ),i.maxZ>this.maxZ&&(this.maxZ=i.maxZ)},BoundingBox.prototype.getMaxLength=function(){var i=this.maxX-this.minX,t=this.maxY-this.minY,n=this.maxZ-this.minZ;return t>i&&(i=t),n>i&&(i=n),i},BoundingBox.prototype.getXLength=function(){return this.maxX-this.minX},BoundingBox.prototype.getYLength=function(){return this.maxY-this.minY},BoundingBox.prototype.getZLength=function(){return this.maxZ-this.minZ},BoundingBox.prototype.getCenterPoint3d=function(i){return void 0==i&&(i=new Point3D),i.set((this.maxX+this.minX)/2,(this.maxY+this.minY)/2,(this.maxZ+this.minZ)/2),i},BoundingBox.prototype.isPoint3dInside=function(i,t,n){return!(i<this.minX||i>this.maxX)&&(!(t<this.minY||t>this.maxY)&&!(n<this.minZ||n>this.maxZ))};
"use strict";var Box=function(){if(!(this instanceof Box))throw new Error(Messages.CONSTRUCT_ERROR);this.triPolyhedron=new TriPolyhedron,this.vbo_vicks_container=new VBOVertexIdxCacheKeysContainer,this.vBOVertexIdxCacheKey=this.vbo_vicks_container.newVBOVertexIdxCacheKey()};Box.prototype.makeAABB=function(e,t,r){var i=-e/2,n=-t/2,s=-r/2,V=e/2,x=t/2,g=r/2,o=this.triPolyhedron.vertexList,w=o.newVertex();w.setPosition(i,n,s),w=o.newVertex(),w.setPosition(V,n,s),w=o.newVertex(),w.setPosition(V,x,s),w=o.newVertex(),w.setPosition(i,x,s),w=o.newVertex(),w.setPosition(i,n,g),w=o.newVertex(),w.setPosition(V,n,g),w=o.newVertex(),w.setPosition(V,x,g),w=o.newVertex(),w.setPosition(i,x,g);var a,c;a=this.triPolyhedron.newTriSurface(),c=a.newTriangle(),c.setVertices(o.getVertex(0),o.getVertex(2),o.getVertex(1)),c=a.newTriangle(),c.setVertices(o.getVertex(0),o.getVertex(3),o.getVertex(2)),a=this.triPolyhedron.newTriSurface(),c=a.newTriangle(),c.setVertices(o.getVertex(4),o.getVertex(5),o.getVertex(6)),c=a.newTriangle(),c.setVertices(o.getVertex(4),o.getVertex(6),o.getVertex(7)),a=this.triPolyhedron.newTriSurface(),c=a.newTriangle(),c.setVertices(o.getVertex(0),o.getVertex(1),o.getVertex(5)),c=a.newTriangle(),c.setVertices(o.getVertex(0),o.getVertex(5),o.getVertex(4)),a=this.triPolyhedron.newTriSurface(),c=a.newTriangle(),c.setVertices(o.getVertex(1),o.getVertex(2),o.getVertex(6)),c=a.newTriangle(),c.setVertices(o.getVertex(1),o.getVertex(6),o.getVertex(5)),a=this.triPolyhedron.newTriSurface(),c=a.newTriangle(),c.setVertices(o.getVertex(2),o.getVertex(3),o.getVertex(7)),c=a.newTriangle(),c.setVertices(o.getVertex(2),o.getVertex(7),o.getVertex(6)),a=this.triPolyhedron.newTriSurface(),c=a.newTriangle(),c.setVertices(o.getVertex(3),o.getVertex(0),o.getVertex(4)),c=a.newTriangle(),c.setVertices(o.getVertex(3),o.getVertex(4),o.getVertex(7))};
"use strict";function selectedObjectCallback(c,e,t,i,l,n,s,a,b,d){window[c](e,t,i,l,n,s,a,b,d)}
"use strict";var Camera=function(){if(!(this instanceof Camera))throw new Error(Messages.CONSTRUCT_ERROR);this.position=new Point3D,this.direction=new Point3D,this.up=new Point3D,this.frustum=new Frustum};
"use strict";function genNoiseTextureRGBA(e,i,t,r){var o=e.createTexture();if(e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,o),4==i&&4==t){var a=0;r[a]=50,a++,r[a]=58,a++,r[a]=229,a++,r[a]=120,a++,r[a]=212,a++,r[a]=236,a++,r[a]=251,a++,r[a]=148,a++,r[a]=75,a++,r[a]=92,a++,r[a]=246,a++,r[a]=59,a++,r[a]=197,a++,r[a]=95,a++,r[a]=235,a++,r[a]=216,a++,r[a]=130,a++,r[a]=124,a++,r[a]=215,a++,r[a]=154,a++,r[a]=25,a++,r[a]=41,a++,r[a]=221,a++,r[a]=146,a++,r[a]=187,a++,r[a]=217,a++,r[a]=130,a++,r[a]=199,a++,r[a]=142,a++,r[a]=112,a++,r[a]=61,a++,r[a]=135,a++,r[a]=67,a++,r[a]=125,a++,r[a]=159,a++,r[a]=153,a++,r[a]=215,a++,r[a]=49,a++,r[a]=49,a++,r[a]=69,a++,r[a]=126,a++,r[a]=168,a++,r[a]=61,a++,r[a]=215,a++,r[a]=21,a++,r[a]=93,a++,r[a]=183,a++,r[a]=1,a++,r[a]=125,a++,r[a]=44,a++,r[a]=22,a++,r[a]=130,a++,r[a]=197,a++,r[a]=118,a++,r[a]=109,a++,r[a]=23,a++,r[a]=195,a++,r[a]=4,a++,r[a]=148,a++,r[a]=245,a++,r[a]=124,a++,r[a]=125,a++,r[a]=185,a++,r[a]=28,a++}else for(var s=0;s<t;s++)for(var n=0;n<i;n++)r[4*(s*i+n)+0]=Math.floor(255*Math.random()),r[4*(s*i+n)+1]=Math.floor(255*Math.random()),r[4*(s*i+n)+2]=Math.floor(255*Math.random()),r[4*(s*i+n)+3]=Math.floor(255*Math.random());return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,i,t,0,e.RGBA,e.UNSIGNED_BYTE,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT),e.bindTexture(e.TEXTURE_2D,null),o.width=i,o.height=t,o}function handleTextureLoaded(e,i,t){e.bindTexture(e.TEXTURE_2D,t),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,i),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_NEAREST),e.generateMipmap(e.TEXTURE_2D),e.bindTexture(e.TEXTURE_2D,null)}var CesiumManager=function(){if(!(this instanceof CesiumManager))throw new Error(Messages.CONSTRUCT_ERROR);this.bRBuildingProjectsList=new BRBuildingProjectsList,this.terranTile=new TerranTile,this.neoBuildingsList=new NeoBuildingsList,this.renderer=new Renderer,this.selection=new Selection,this.shadersManager=new ShadersManager,this.postFxShadersManager=new PostFxShadersManager,this.vBOManager=new VBOManager,this.readerWriter=new ReaderWriter,this.magoPolicy=new Policy,this.noiseTexture,this.depthFbo,this.normalFbo,this.ssaoFbo,this.pixels=new Uint8Array(64),this.depthFboNeo,this.ssaoFboNeo,this.selectionFbo,this.handler,this.mouse_x=0,this.mouse_y=0,this.mouseLeftDown=!1,this.mouseMiddleDown=!1,this.mouseDragging=!1,this.selObjMovePlane,this.selectionCandidateObjectsArray=[],this.objectSelected,this.buildingSelected,this.octreeSelected,this.objMovState=0,this.mustCheckIfDragging=!0,this.thereAreStartMovePoint=!1,this.startMovPoint=new Point3D,this.kernel=[.33,0,.85,.25,.3,.5,.1,.3,.85,-.15,.2,.85,-.33,.05,.6,-.1,-.15,.85,-.05,-.32,.25,.2,-.15,.85,.6,0,.55,.5,.6,.45,-.01,.7,.35,-.33,.5,.45,-.45,0,.55,-.65,-.5,.7,0,-.5,.55,.33,.3,.35],this.atmosphere=new Atmosphere,this.sceneState=new SceneState,this.currentVisible_terranTiles_array=[],this.currentVisibleBuildings_array=[],this.currentVisibleBuildings_LOD0_array=[],this.currentVisibleBuildingsPost_array=[],this.fileRequestControler=new FileRequestControler,this.visibleObjControlerBuildings=new VisibleObjectsControler,this.visibleObjControlerOctrees=new VisibleObjectsControler,this.visibleObjControlerOctreesAux=new VisibleObjectsControler,this.currentVisibleNeoBuildings_array=[],this.currentVisibleClouds_array=[],this.detailed_building,this.detailed_neoBuilding,this.boundingSphere_Aux=new Cesium.BoundingSphere,this.radiusAprox_aux,this.currentRenderables_neoRefLists_array=[],this.filteredVisibleTiles_array=[],this.detailedVisibleTiles_array=[],this.LOD0VisibleTiles_array=[],this.lastCamPos=new Point3D,this.squareDistUmbral=22,this.compRefList_array,this.compRefList_array_background,this.intCRefList_array=[],this.intNeoRefList_array=[],this.lowestOctreeArray=[],this.backGround_fileReadings_count=0,this.backGround_imageReadings_count=0,this.isCameraMoving=!1,this.isCameraInsideBuilding=!1,this.isCameraInsideNeoBuilding=!1,this.min_squaredDist_to_see_detailed=1e5,this.min_squaredDist_to_see_LOD0=1e5,this.min_squaredDist_to_see=15e6,this.min_squaredDist_to_see_smallBuildings=7e5,this.renders_counter=0,this.render_time=0,this.bPicking=!1,this.scene,this.renderingModeTemp=0,this.frustumIdx,this.numFrustums,this.isLastFrustum=!1,this.highLightColor4=new Float32Array([.2,1,.2,1]),this.currentSelectedObj_idx=-1,this.currentByteColorPicked=new Uint8Array(4),this.currentShader,this.renderingTime=0,this.xdo_rendering_time=0,this.xdo_rendering_time_arrays=0,this.amountRenderTime=0,this.xdo_amountRenderTime=0,this.xdo_amountRenderTime_arrays=0,this.averageRenderTime=0,this.xdo_averageRenderTime=0,this.xdo_averageRenderTime_arrays=0,this.allBuildingsLoaded=!1,this.renderingCounter=0,this.averageRenderingCounter=0,this.testFilesLoaded=!1,this.pointSC=new Point3D,this.pointSC_2=new Point3D,this.arrayAuxSC=[],this.currentTimeSC,this.dateSC,this.startTimeSC,this.maxMilisecondsForRender=10,this.terranTileSC,this.textureAux_1x1,this.resultRaySC=new Float32Array(3),this.matrix4SC=new Matrix4,this.unitaryBoxSC=new Box,this.unitaryBoxSC.makeAABB(1,1,1),this.unitaryBoxSC.vBOVertexIdxCacheKey=this.unitaryBoxSC.triPolyhedron.getVBOArrayModePosNorCol(this.unitaryBoxSC.vBOVertexIdxCacheKey),this.demoBlocksLoaded=!1};CesiumManager.prototype.start=function(e,i,t,r){if(this.magoPolicy.getMagoEnable()){var o=!1;this.frustumIdx=t,this.numFrustums=r,t==r-1&&(o=!0,this.isLastFrustum=!0);var a=i.pick;a||this.renderNeoBuildingsAsimectricVersion(e,o,t,r)}},CesiumManager.prototype.isCameraMoved=function(e,i){var t=!1,r=this.lastCamPos.squareDistTo(e.x,e.y,e.z);return r>i&&(t=!0,this.lastCamPos.x=e.x,this.lastCamPos.y=e.y,this.lastCamPos.z=e.z),t},CesiumManager.prototype.updateCameraMoved=function(e){},CesiumManager.prototype.renderAtmosphere=function(e,i,t,r,o,a){var s=this.atmosphere.cloudsManager.circularCloudsArray.length;if(0!=s){var n=Cesium.EncodedCartesian3.encode(i.x),l=Cesium.EncodedCartesian3.encode(i.y),d=Cesium.EncodedCartesian3.encode(i.z);this.encodedCamPosMC_High[0]=n.high,this.encodedCamPosMC_High[1]=l.high,this.encodedCamPosMC_High[2]=d.high,this.encodedCamPosMC_Low[0]=n.low,this.encodedCamPosMC_Low[1]=l.low,this.encodedCamPosMC_Low[2]=d.low;var u=this.shadersManager,h=u.getMagoShader(4),c=h.SHADER_PROGRAM;e.useProgram(c),e.enableVertexAttribArray(h._color),e.enableVertexAttribArray(h._position),Cesium.Matrix4.toArray(r,this.modelViewProjRelToEye_matrix),e.uniformMatrix4fv(h._ModelViewProjectionMatrixRelToEye,!1,this.modelViewProjRelToEye_matrix),e.uniform3fv(h._encodedCamPosHIGH,this.encodedCamPosMC_High),e.uniform3fv(h._encodedCamPosLOW,this.encodedCamPosMC_Low),e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL),e.depthRange(0,1);for(var f,m=0;m<s;m++)f=this.atmosphere.cloudsManager.circularCloudsArray[m],e.uniform3fv(h._cloudPosHIGH,f.positionHIGH),e.uniform3fv(h._cloudPosLOW,f.positionLOW),void 0==f.vbo_vertexCacheKey&&(f.vbo_vertexCacheKey=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,f.vbo_vertexCacheKey),e.bufferData(e.ARRAY_BUFFER,f.getVBOVertexColorFloatArray(),e.STATIC_DRAW)),void 0==f.vbo_indexCacheKey&&(f.vbo_indexCacheKey=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,f.vbo_indexCacheKey),e.bufferData(e.ELEMENT_ARRAY_BUFFER,f.getVBOIndicesShortArray(),e.STATIC_DRAW)),e.bindBuffer(e.ARRAY_BUFFER,f.vbo_vertexCacheKey),e.vertexAttribPointer(h._position,3,e.FLOAT,!1,24,0),e.vertexAttribPointer(h._color,3,e.FLOAT,!1,24,12),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,f.vbo_indexCacheKey),e.drawElements(e.TRIANGLES,f.indicesCount,e.UNSIGNED_SHORT,0);e.disableVertexAttribArray(h._color),e.disableVertexAttribArray(h._position),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)}},CesiumManager.prototype.renderCloudShadows=function(e,i,t,r,o,a){var s=this.atmosphere.cloudsManager.circularCloudsArray.length;if(0!=s){var n=Cesium.EncodedCartesian3.encode(i.x),l=Cesium.EncodedCartesian3.encode(i.y),d=Cesium.EncodedCartesian3.encode(i.z);this.encodedCamPosMC_High[0]=n.high,this.encodedCamPosMC_High[1]=l.high,this.encodedCamPosMC_High[2]=d.high,this.encodedCamPosMC_Low[0]=n.low,this.encodedCamPosMC_Low[1]=l.low,this.encodedCamPosMC_Low[2]=d.low;var u=this.shadersManager,h=u.getMagoShader(4),c=h.SHADER_PROGRAM;e.useProgram(c),e.enableVertexAttribArray(h._position),Cesium.Matrix4.toArray(r,this.modelViewProjRelToEye_matrix),e.uniformMatrix4fv(h._ModelViewProjectionMatrixRelToEye,!1,this.modelViewProjRelToEye_matrix),e.uniform3fv(h._encodedCamPosHIGH,this.encodedCamPosMC_High),e.uniform3fv(h._encodedCamPosLOW,this.encodedCamPosMC_Low),e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL),e.depthRange(0,1),e.colorMask(!1,!1,!1,!1),e.depthMask(!1),e.enable(e.CULL_FACE),e.enable(e.STENCIL_TEST),e.enable(e.POLYGON_OFFSET_FILL),e.polygonOffset(1,2),e.cullFace(e.FRONT),e.stencilFunc(e.ALWAYS,0,255),e.stencilOp(e.KEEP,e.INCR,e.KEEP),e.clearStencil(0);for(var f,m=0;m<s;m++)f=this.atmosphere.cloudsManager.circularCloudsArray[m],e.uniform3fv(h._cloudPosHIGH,f.positionHIGH),e.uniform3fv(h._cloudPosLOW,f.positionLOW),void 0==f.vbo_shadowVertexCacheKey&&(f.vbo_shadowVertexCacheKey=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,f.vbo_shadowVertexCacheKey),e.bufferData(e.ARRAY_BUFFER,f.getVBOShadowVertexFloatArray(),e.STATIC_DRAW)),void 0==f.vbo_shadowIndexCacheKey&&(f.vbo_shadowIndexCacheKey=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,f.vbo_shadowIndexCacheKey),e.bufferData(e.ELEMENT_ARRAY_BUFFER,f.getVBOShadowIndicesShortArray(),e.STATIC_DRAW)),e.bindBuffer(e.ARRAY_BUFFER,f.vbo_shadowVertexCacheKey),e.vertexAttribPointer(h._position,3,e.FLOAT,!1,0,0),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,f.vbo_shadowIndexCacheKey),e.drawElements(e.TRIANGLES,f.indicesCount,e.UNSIGNED_SHORT,0);e.cullFace(e.BACK),e.stencilFunc(e.ALWAYS,0,255),e.stencilOp(e.KEEP,e.DECR,e.KEEP);for(var m=0;m<s;m++)f=this.atmosphere.cloudsManager.circularCloudsArray[m],e.uniform3fv(h._cloudPosHIGH,f.positionHIGH),e.uniform3fv(h._cloudPosLOW,f.positionLOW),void 0==f.vbo_shadowVertexCacheKey&&(f.vbo_shadowVertexCacheKey=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,f.vbo_shadowVertexCacheKey),e.bufferData(e.ARRAY_BUFFER,f.getVBOShadowVertexFloatArray(),e.STATIC_DRAW)),void 0==f.vbo_shadowIndexCacheKey&&(f.vbo_shadowIndexCacheKey=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,f.vbo_shadowIndexCacheKey),e.bufferData(e.ELEMENT_ARRAY_BUFFER,f.getVBOShadowIndicesShortArray(),e.STATIC_DRAW)),e.bindBuffer(e.ARRAY_BUFFER,f.vbo_shadowVertexCacheKey),e.vertexAttribPointer(h._position,3,e.FLOAT,!1,0,0),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,f.vbo_shadowIndexCacheKey),e.drawElements(e.TRIANGLES,f.indicesCount,e.UNSIGNED_SHORT,0);e.disableVertexAttribArray(h._position),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.CULL_FACE),e.colorMask(!0,!0,!0,!0),e.depthMask(!0),e.stencilFunc(e.NOTEQUAL,0,255),e.stencilOp(e.REPLACE,e.REPLACE,e.REPLACE),e.disable(e.DEPTH_TEST),e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),e.cullFace(e.FRONT),h=u.getMagoShader(5),e.useProgram(h.SHADER_PROGRAM),e.enableVertexAttribArray(h._color),e.enableVertexAttribArray(h._position),e.uniformMatrix4fv(h._ModelViewProjectionMatrixRelToEye,!1,this.modelViewProjRelToEye_matrix),e.uniform3fv(h._encodedCamPosHIGH,this.encodedCamPosMC_High),e.uniform3fv(h._encodedCamPosLOW,this.encodedCamPosMC_Low);var g=this.atmosphere.shadowBlendingCube;void 0==g.vbo_vertexCacheKey&&(g.vbo_vertexCacheKey=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,g.vbo_vertexCacheKey),e.bufferData(e.ARRAY_BUFFER,g.getVBOVertexColorRGBAFloatArray(),e.STATIC_DRAW)),void 0==g.vbo_indexCacheKey&&(g.vbo_indexCacheKey=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,g.vbo_indexCacheKey),e.bufferData(e.ELEMENT_ARRAY_BUFFER,g.getVBOIndicesShortArray(),e.STATIC_DRAW)),e.bindBuffer(e.ARRAY_BUFFER,g.vbo_vertexCacheKey),e.vertexAttribPointer(h._position,3,e.FLOAT,!1,28,0),e.vertexAttribPointer(h._color,4,e.FLOAT,!1,28,12),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,g.vbo_indexCacheKey),e.drawElements(e.TRIANGLES,g.indicesCount,e.UNSIGNED_SHORT,0),e.disableVertexAttribArray(h._position),e.disableVertexAttribArray(h._color),e.enable(e.DEPTH_TEST),e.disable(e.BLEND),e.disable(e.STENCIL_TEST)}},CesiumManager.prototype.calculateEncodedCameraPositionMCHighLow=function(e,i,t){var r=Cesium.EncodedCartesian3.encode(t.x),o=Cesium.EncodedCartesian3.encode(t.y),a=Cesium.EncodedCartesian3.encode(t.z);e[0]=r.high,e[1]=o.high,e[2]=a.high,i[0]=r.low,i[1]=o.low,i[2]=a.low},CesiumManager.prototype.prepareNeoBuildings=function(e){for(var i,t,r,o,a,s="",n=this.readerWriter.geometryDataPath,l=this.visibleObjControlerBuildings.currentVisibles0.length,d=0;d<l;d++)if(i=this.visibleObjControlerBuildings.currentVisibles0[d],!i.allFilesLoaded){if(s=i.buildingFileName,t=i.metaData,t.fileLoadState==CODE.fileLoadState.READY&&this.fileRequestControler.filesRequestedCount<this.fileRequestControler.maxFilesRequestedCount){var u=n+"/"+s+"/Header.hed";this.readerWriter.getNeoHeader(e,u,i,this.readerWriter,this);continue}for(var h=i._blocksList_Container.blocksListsArray.length,c=0;c<h-1;c++)if(r=i._blocksList_Container.blocksListsArray[c],r.fileLoadState==CODE.fileLoadState.READY&&this.fileRequestControler.filesRequestedCount<this.fileRequestControler.maxFilesRequestedCount){var f=n+"/"+s+"/"+r.name;this.readerWriter.getNeoBlocksArraybuffer(f,r,this)}else;var m=i._neoRefLists_Container.neoRefsLists_Array.length;if(0==m)for(var c=0;c<4;c++)r=i._blocksList_Container.blocksListsArray[c],o=i._neoRefLists_Container.newNeoRefsList(r),0==c?a="Ref_Skin1":1==c?a="Ref_Skin2":2==c?a="Ref_Skin3":3==c&&(a="Ref_Bone"),o.name=a;for(var c=0;c<m;c++)if(o=i._neoRefLists_Container.neoRefsLists_Array[c],o.fileLoadState==CODE.fileLoadState.READY&&this.fileRequestControler.filesRequestedCount<this.fileRequestControler.maxFilesRequestedCount){var f=n+"/"+s+"/"+o.name;this.readerWriter.getNeoReferencesArraybuffer(f,o,this)}else;}l=this.visibleObjControlerBuildings.currentVisibles1.length;for(var d=0;d<l;d++)if(i=this.visibleObjControlerBuildings.currentVisibles1[d],s=i.buildingFileName,t=i.metaData,t.fileLoadState==CODE.fileLoadState.READY&&this.fileRequestControler.filesRequestedCount<this.fileRequestControler.maxFilesRequestedCount){var u=n+"/"+s+"/Header.hed";this.readerWriter.getNeoHeader(e,u,i,this.readerWriter,this)}else if(void 0!=i.lod2Building){if(i.lod2Building.fileLoadState==CODE.fileLoadState.READY&&this.fileRequestControler.filesRequestedCount<this.fileRequestControler.maxFilesRequestedCount){var f=n+"/"+s+"/simpleBuilding_LOD2";this.readerWriter.getLodBuildingArraybuffer(f,i.lod2Building,this)}}else i.lod2Building=new LodBuilding},CesiumManager.prototype.prepareNeoBuildingsAsimetricVersion=function(e){for(var i,t=this.readerWriter.geometryDataPath,r=this.visibleObjControlerBuildings.currentVisibles0.length,o=0;o<r;o++)if(i=this.visibleObjControlerBuildings.currentVisibles0[o],!i.allFilesLoaded){var a=i.metaData;if(a.fileLoadState==CODE.fileLoadState.READY){if(!(this.fileRequestControler.filesRequestedCount<this.fileRequestControler.maxFilesRequestedCount))return;var s=t+"/"+i.buildingFileName+"/HeaderAsimetric.hed";this.readerWriter.getNeoHeaderAsimetricVersion(e,s,i,this.readerWriter,this)}}r=this.visibleObjControlerBuildings.currentVisibles2.length;for(var o=0;o<r;o++)if(i=this.visibleObjControlerBuildings.currentVisibles2[o],!i.allFilesLoaded){var a=i.metaData;if(a.fileLoadState==CODE.fileLoadState.READY){if(!(this.fileRequestControler.filesRequestedCount<this.fileRequestControler.maxFilesRequestedCount))return;var s=t+"/"+i.buildingFileName+"/HeaderAsimetric.hed";this.readerWriter.getNeoHeaderAsimetricVersion(e,s,i,this.readerWriter,this)}}},CesiumManager.prototype.loadBuildingOctree=function(e){if(void 0!=e.octree&&!e.octreeLoadedAllFiles){for(var i,t,r=this.readerWriter.geometryDataPath,o=e.buildingFileName,a=r+"/"+o+"/inLOD4",s=-1,n=!0,l=e._blocksList_Container.getBlockList("Blocks4"),d=1;d<9;d++)for(var u=1;u<9;u++)for(var h=1;h<9;h++){s=100*d+10*u+h;var c=s.toString();if(i=e.octree.getOctreeByNumberName(c),0==i.neoRefsList_Array.length){if(this.fileRequestControler.filesRequestedCount<this.fileRequestControler.maxFilesRequestedCount){t=new NeoReferencesList,t.blocksList=l,i.neoRefsList_Array.push(t);var f=a+"/"+c;this.readerWriter.getNeoReferencesArraybuffer(f,t,this)}n=!1}else t=i.neoRefsList_Array[0],void 0!=t&&t.fileLoadState==CODE.fileLoadState.READY&&(n=!1)}n&&(e.octreeLoadedAllFiles=!0)}},CesiumManager.prototype.upDateSceneStateMatrices=function(e){var i=this.scene,t=i._context.uniformState;Cesium.Matrix4.toArray(t._modelViewProjectionRelativeToEye,e.modelViewProjRelToEyeMatrix._floatArrays),Cesium.Matrix4.toArray(t._modelViewRelativeToEye,e.modelViewRelToEyeMatrix._floatArrays),e.modelViewMatrix._floatArrays=Cesium.Matrix4.clone(t.view,e.modelViewMatrix._floatArrays),Cesium.Matrix4.toArray(t._projection,e.projectionMatrix._floatArrays);var r=i.context._us._cameraPosition;ManagerUtils.calculateSplited3fv([r.x,r.y,r.z],e.encodedCamPosHigh,e.encodedCamPosLow),e.modelViewMatrixInv._floatArrays=Cesium.Matrix4.inverseTransformation(e.modelViewMatrix._floatArrays,e.modelViewMatrixInv._floatArrays),e.normalMatrix4._floatArrays=Cesium.Matrix4.transpose(e.modelViewMatrixInv._floatArrays,e.normalMatrix4._floatArrays),e.camera.frustum.far[0]=i._frustumCommandsList[0].far,e.camera.frustum.near[0]=i._frustumCommandsList[0].near,e.camera.frustum.fovRad=i._camera.frustum._fov,e.camera.frustum.fovyRad=i._camera.frustum._fovy,e.camera.frustum.aspectRatio=i._camera.frustum._aspectRatio,e.drawingBufferWidth=i.drawingBufferWidth,e.drawingBufferHeight=i.drawingBufferHeight},CesiumManager.prototype.renderNeoBuildings=function(e,i){var t=e.context._gl,r=e.context._us._cameraPosition;if(void 0==this.textureAux_1x1&&(this.textureAux_1x1=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.textureAux_1x1),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array([200,200,200,255])),t.bindTexture(t.TEXTURE_2D,null)),void 0==this.depthFboNeo&&(this.depthFboNeo=new FBO(t,e.drawingBufferWidth,e.drawingBufferHeight)),!this.isCameraMoving){var o=e._frameState.cullingVolume;this.currentVisibleNeoBuildings_array.length=0,this.doFrustumCullingNeoBuildings(o,this.currentVisibleNeoBuildings_array,r),this.prepareNeoBuildings(t,e)}this.visibleObjControlerBuildings.currentVisibles0.length>0?this.detailed_neoBuilding=this.visibleObjControlerBuildings.currentVisibles0[0]:this.detailed_neoBuilding=void 0,1==this.bPicking&&(this.objectSelected=this.getSelectedObjectPicking(t,e,this.currentRenderables_neoRefLists_array)),Cesium.Matrix4.toArray(e._context._us._modelViewProjectionRelativeToEye,this.modelViewProjRelToEye_matrix),Cesium.Matrix4.toArray(e._context._us._modelViewRelativeToEye,this.modelViewRelToEye_matrix),Cesium.Matrix4.toArray(e._context._us._modelView,this.modelView_matrix),Cesium.Matrix4.toArray(e._context._us._projection,this.projection_matrix),this.calculateEncodedCameraPositionMCHighLow(this.encodedCamPosMC_High,this.encodedCamPosMC_Low,r);var a=e._context._us._modelView,s=new Cesium.Matrix4;s=Cesium.Matrix4.inverseTransformation(a,s),this.normalMat4=Cesium.Matrix4.transpose(s,this.normalMat4),this.normalMat3=Cesium.Matrix4.getRotation(this.normalMat4,this.normalMat3),Cesium.Matrix3.toArray(this.normalMat3,this.normalMat3_array),Cesium.Matrix4.toArray(this.normalMat4,this.normalMat4_array);var n=e._camera,l=n.frustum,d=e._context._us._currentFrustum.y;t.enable(t.CULL_FACE);var u,h=0,c=!1;r=null;var f,m=this.postFxShadersManager.pFx_shaders_array[3];this.depthFboNeo.bind(),t.clearColor(0,0,0,1),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),t.viewport(0,0,e.drawingBufferWidth,e.drawingBufferHeight);var g=m.program;t.useProgram(g),t.enableVertexAttribArray(m.position3_loc),m.normal3_loc!=-1&&t.enableVertexAttribArray(m.normal3_loc),t.uniformMatrix4fv(m.modelViewProjectionMatrix4RelToEye_loc,!1,this.modelViewProjRelToEye_matrix),t.uniformMatrix4fv(m.modelViewMatrix4RelToEye_loc,!1,this.modelViewRelToEye_matrix),t.uniformMatrix4fv(m.modelViewMatrix4_loc,!1,this.modelView_matrix),t.uniformMatrix4fv(m.projectionMatrix4_loc,!1,this.projection_matrix),t.uniform3fv(m.cameraPosHIGH_loc,this.encodedCamPosMC_High),t.uniform3fv(m.cameraPosLOW_loc,this.encodedCamPosMC_Low),t.uniform1f(m.near_loc,l._near),t.uniform1f(m.far_loc,d),t.uniformMatrix3fv(m.normalMatrix3_loc,!1,this.normalMat3_array),t.uniformMatrix4fv(m.normalMatrix4_loc,!1,this.normalMat4_array),u=this.visibleObjControlerBuildings.currentVisibles0.length;for(var _=0;_<u;_++)f=this.visibleObjControlerBuildings.currentVisibles0[_],this.isCameraMoving||this.getRenderablesDetailedNeoBuilding(t,e,f,this.currentRenderables_neoRefLists_array),t.uniformMatrix4fv(m.buildingRotMatrix_loc,!1,f.move_matrix),t.uniform3fv(m.buildingPosHIGH_loc,f.buildingPositionHIGH),t.uniform3fv(m.buildingPosLOW_loc,f.buildingPositionLOW),this.renderDetailedNeoBuilding(t,r,e,m,c,h,f.currentRenderablesNeoRefLists);m=this.postFxShadersManager.pFx_shaders_array[7],g=m.program,t.useProgram(g),t.enableVertexAttribArray(m.position3_loc),t.uniformMatrix4fv(m.modelViewProjectionMatrix4RelToEye_loc,!1,this.modelViewProjRelToEye_matrix),t.uniformMatrix4fv(m.modelViewMatrix4RelToEye_loc,!1,this.modelViewRelToEye_matrix),t.uniformMatrix4fv(m.modelViewMatrix4_loc,!1,this.modelView_matrix),t.uniformMatrix4fv(m.projectionMatrix4_loc,!1,this.projection_matrix),t.uniform3fv(m.cameraPosHIGH_loc,this.encodedCamPosMC_High),t.uniform3fv(m.cameraPosLOW_loc,this.encodedCamPosMC_Low),t.uniform1f(m.near_loc,l._near),t.uniform1f(m.far_loc,d),t.uniformMatrix3fv(m.normalMatrix3_loc,!1,this.normalMat3_array),t.uniformMatrix4fv(m.normalMatrix4_loc,!1,this.normalMat4_array),t.uniform1i(m.hasAditionalMov_loc,!0),t.uniform3fv(m.aditionalMov_loc,[0,0,0]),u=this.visibleObjControlerBuildings.currentVisibles1.length;for(var _=0;_<u;_++)f=this.visibleObjControlerBuildings.currentVisibles1[_],f.lod2Building&&(t.uniformMatrix4fv(m.buildingRotMatrix_loc,!1,f.move_matrix),t.uniform3fv(m.buildingPosHIGH_loc,f.buildingPositionHIGH),t.uniform3fv(m.buildingPosLOW_loc,f.buildingPositionLOW),this.renderLodBuilding(t,r,e,m,c,h,f.lod2Building));for(var b=3,C=this.currentVisibleNeoBuildings_array.length,_=0;_<C;_++){f=this.currentVisibleNeoBuildings_array[_];var x=f.neoSimpleBuilding;if(0==x.texturesArray.length){if(this.backGround_imageReadings_count<10){var v=x.newTexture(),y=this.readerWriter.geometryDataPath+"/"+f.buildingFileName+Constant.SIMPLE_BUILDING_TEXTURE3x3_BMP;this.readerWriter.readTexture(t,y,v,this)}}else var A=x.texturesArray[0]}m.normal3_loc!=-1&&t.disableVertexAttribArray(m.normal3_loc),t.disableVertexAttribArray(m.position3_loc),this.depthFboNeo.unbind(),e._context._currentFramebuffer._bind(),void 0==this.noiseTexture&&(this.noiseTexture=genNoiseTextureRGBA(t,4,4,this.pixels)),h=1,m=this.postFxShadersManager.pFx_shaders_array[4],g=m.program,t.useProgram(g),t.enableVertexAttribArray(m.texCoord2_loc),t.enableVertexAttribArray(m.position3_loc),m.normal3_loc!=-1&&t.enableVertexAttribArray(m.normal3_loc),t.uniformMatrix4fv(m.modelViewProjectionMatrix4RelToEye_loc,!1,this.modelViewProjRelToEye_matrix),t.uniform3fv(m.cameraPosHIGH_loc,this.encodedCamPosMC_High),t.uniform3fv(m.cameraPosLOW_loc,this.encodedCamPosMC_Low),t.uniformMatrix4fv(m.projectionMatrix4_loc,!1,this.projection_matrix),t.uniformMatrix4fv(m.modelViewMatrix4_loc,!1,this.modelView_matrix),t.uniform1f(m.near_loc,l._near),t.uniform1f(m.far_loc,d),t.uniformMatrix3fv(m.normalMatrix3_loc,!1,this.normalMat3_array),t.uniformMatrix4fv(m.normalMatrix4_loc,!1,this.normalMat4_array),t.uniform1i(m.depthTex_loc,0),t.uniform1i(m.noiseTex_loc,1),t.uniform1i(m.diffuseTex_loc,2),t.uniform1f(m.fov_loc,l._fovy),t.uniform1f(m.aspectRatio_loc,l._aspectRatio),t.uniform1f(m.screenWidth_loc,e.drawingBufferWidth),t.uniform1f(m.screenHeight_loc,e.drawingBufferHeight),t.uniform2fv(m.noiseScale2_loc,[this.depthFboNeo.width/this.noiseTexture.width,this.depthFboNeo.height/this.noiseTexture.height]),t.uniform3fv(m.kernel16_loc,this.kernel),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,this.depthFboNeo.colorBuffer),t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,this.noiseTexture),c=!0,r=null,u=this.visibleObjControlerBuildings.currentVisibles0.length;for(var _=0;_<u;_++)f=this.visibleObjControlerBuildings.currentVisibles0[_],t.uniformMatrix4fv(m.buildingRotMatrix_loc,!1,f.move_matrix),t.uniform3fv(m.buildingPosHIGH_loc,f.buildingPositionHIGH),t.uniform3fv(m.buildingPosLOW_loc,f.buildingPositionLOW),this.renderDetailedNeoBuilding(t,r,e,m,c,h,f.currentRenderablesNeoRefLists);t.disableVertexAttribArray(m.texCoord2_loc),m=this.postFxShadersManager.pFx_shaders_array[8],g=m.program,t.useProgram(g),t.enableVertexAttribArray(m.position3_loc),t.enableVertexAttribArray(m.normal3_loc),t.enableVertexAttribArray(m.color4_loc),t.uniformMatrix4fv(m.modelViewProjectionMatrix4RelToEye_loc,!1,this.modelViewProjRelToEye_matrix),t.uniformMatrix4fv(m.modelViewMatrix4RelToEye_loc,!1,this.modelViewRelToEye_matrix),t.uniformMatrix4fv(m.modelViewMatrix4_loc,!1,this.modelView_matrix),t.uniformMatrix4fv(m.projectionMatrix4_loc,!1,this.projection_matrix),t.uniform3fv(m.cameraPosHIGH_loc,this.encodedCamPosMC_High),t.uniform3fv(m.cameraPosLOW_loc,this.encodedCamPosMC_Low),t.uniform1f(m.near_loc,l._near),t.uniform1f(m.far_loc,d),t.uniformMatrix3fv(m.normalMatrix3_loc,!1,this.normalMat3_array),t.uniformMatrix4fv(m.normalMatrix4_loc,!1,this.normalMat4_array),t.uniform1i(m.hasAditionalMov_loc,!0),t.uniform3fv(m.aditionalMov_loc,[0,0,0]),t.uniform1i(m.depthTex_loc,0),t.uniform1i(m.noiseTex_loc,1),t.uniform1i(m.diffuseTex_loc,2),t.uniform1f(m.fov_loc,l._fovy),t.uniform1f(m.aspectRatio_loc,l._aspectRatio),t.uniform1f(m.screenWidth_loc,e.drawingBufferWidth),t.uniform1f(m.screenHeight_loc,e.drawingBufferHeight),t.uniform1i(m.depthTex_loc,0),t.uniform1i(m.noiseTex_loc,1),t.uniform2fv(m.noiseScale2_loc,[this.depthFboNeo.width/this.noiseTexture.width,this.depthFboNeo.height/this.noiseTexture.height]),t.uniform3fv(m.kernel16_loc,this.kernel),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,this.depthFboNeo.colorBuffer),t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,this.noiseTexture),u=this.visibleObjControlerBuildings.currentVisibles1.length;for(var _=0;_<u;_++)f=this.visibleObjControlerBuildings.currentVisibles1[_],f.lod2Building&&(t.uniformMatrix4fv(m.buildingRotMatrix_loc,!1,f.move_matrix),t.uniform3fv(m.buildingPosHIGH_loc,f.buildingPositionHIGH),t.uniform3fv(m.buildingPosLOW_loc,f.buildingPositionLOW),this.renderLodBuilding(t,r,e,m,c,h,f.lod2Building));b=3,C=this.currentVisibleNeoBuildings_array.length;for(var _=0;_<C;_++){var f=this.currentVisibleNeoBuildings_array[_],x=f.neoSimpleBuilding;if(0==x.texturesArray.length){if(this.backGround_imageReadings_count<10){var v=x.newTexture(),y=this.readerWriter.geometryDataPath+"/"+f.buildingFileName+Constant.SIMPLE_BUILDING_TEXTURE3x3_BMP;this.readerWriter.readTexture(t,y,v,this)}}else{var A=x.texturesArray[0];A.loadFinished&&(void 0!=A.textureId||delete A.texImage)}}m.normal3_loc!=-1&&t.disableVertexAttribArray(m.normal3_loc),t.disableVertexAttribArray(m.position3_loc)},CesiumManager.prototype.renderNeoBuildingsAsimectricVersion=function(e,i,t,r){if(0!=this.renderingModeTemp||i){this.frustumIdx=t,this.numFrustums=r,this.isLastFrustum=i;var o=e.context._gl,a=e.context._us._cameraPosition;if(void 0==this.textureAux_1x1&&(this.textureAux_1x1=o.createTexture(),o.bindTexture(o.TEXTURE_2D,this.textureAux_1x1),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,1,1,0,o.RGBA,o.UNSIGNED_BYTE,new Uint8Array([200,200,200,255])),o.bindTexture(o.TEXTURE_2D,null)),void 0==this.depthFboNeo&&(this.depthFboNeo=new FBO(o,e.drawingBufferWidth,e.drawingBufferHeight)),e.drawingBufferWidth==this.depthFboNeo.width&&e.drawingBufferHeight==this.depthFboNeo.height||(this.depthFboNeo=new FBO(o,e.drawingBufferWidth,e.drawingBufferHeight)),!this.isCameraMoving&&!this.mouseLeftDown&&!this.mouseMiddleDown&&this.isLastFrustum){void 0==this.myCameraSC&&(this.myCameraSC=new Cesium.Camera(e)),this.myCameraSC.near=e._context._us._currentFrustum.x,this.myCameraSC.far=e._context._us._currentFrustum.y,this.myCameraSC.frustum.fov=e._camera.frustum.fov;var s=this.myCameraSC.frustum.computeCullingVolume(e._camera.position,e._camera.direction,e._camera.up);this.currentVisibleNeoBuildings_array.length=0,this.doFrustumCullingNeoBuildings(s,this.currentVisibleNeoBuildings_array,a),this.prepareNeoBuildingsAsimetricVersion(o)}this.upDateSceneStateMatrices(this.sceneState);var n=0,l=!1,d=void 0;if(!this.isCameraMoving&&this.isLastFrustum){this.visibleObjControlerOctrees.initArrays(),this.visibleObjControlerOctreesAux.initArrays();for(var u=this.visibleObjControlerBuildings.currentVisibles0.length,h=0;h<u;h++){var c=this.visibleObjControlerBuildings.currentVisibles0[h];this.getRenderablesDetailedNeoBuildingAsimetricVersion(o,e,c,this.visibleObjControlerOctrees,this.visibleObjControlerOctreesAux,0),this.prepareVisibleOctreesAsimetricVersion(o,e,this.visibleObjControlerOctrees)}u=this.visibleObjControlerBuildings.currentVisibles2.length;for(var h=0;h<u;h++){var c=this.visibleObjControlerBuildings.currentVisibles2[h];this.getRenderablesDetailedNeoBuildingAsimetricVersion(o,e,c,this.visibleObjControlerOctrees,this.visibleObjControlerOctreesAux,2)}}else;1==this.bPicking&&i&&(this.arrayAuxSC.length=0,this.objectSelected=this.getSelectedObjectPickingAsimetricMode(o,e,this.visibleObjControlerOctrees,this.arrayAuxSC),this.buildingSelected=this.arrayAuxSC[0],this.octreeSelected=this.arrayAuxSC[1],this.arrayAuxSC.length=0,void 0!=this.buildingSelected&&(this.displayLocationAndRotation(this.buildingSelected),this.selectedObjectNotice(this.buildingSelected)),void 0!=this.objectSelected),this.depthFboNeo.bind(),o.clearColor(0,0,0,1),o.clear(o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT),o.viewport(0,0,e.drawingBufferWidth,e.drawingBufferHeight),this.renderLowestOctreeLegoAsimetricVersion(o,a,e,d,l,n,this.visibleObjControlerOctrees),this.depthFboNeo.unbind(),e._context._currentFramebuffer._bind(),void 0==this.noiseTexture&&(this.noiseTexture=genNoiseTextureRGBA(o,4,4,this.pixels)),n=1,this.renderLowestOctreeLegoAsimetricVersion(o,a,e,d,l,n,this.visibleObjControlerOctrees)}},CesiumManager.prototype.getSelectedObjectPicking=function(e,i,t){this.bPicking=!1;var r=i.context._us._cameraPosition;if(void 0==this.selectionFbo&&(this.selectionFbo=new FBO(e,i.drawingBufferWidth,i.drawingBufferHeight)),!this.isCameraMoving){var o=i._frameState.cullingVolume;this.currentVisibleNeoBuildings_array.length=0,this.doFrustumCullingNeoBuildings(o,this.currentVisibleNeoBuildings_array,r)}if(this.detailed_neoBuilding){Cesium.Matrix4.toArray(i._context._us._modelViewProjectionRelativeToEye,this.modelViewProjRelToEye_matrix),Cesium.Matrix4.toArray(i._context._us._modelViewRelativeToEye,this.modelViewRelToEye_matrix),Cesium.Matrix4.toArray(i._context._us._modelView,this.modelView_matrix),Cesium.Matrix4.toArray(i._context._us._projection,this.projection_matrix),this.calculateEncodedCameraPositionMCHighLow(this.encodedCamPosMC_High,this.encodedCamPosMC_Low,r);var a=i._context._us._modelView,s=new Cesium.Matrix4;s=Cesium.Matrix4.inverse(a,s),this.normalMat4=Cesium.Matrix4.transpose(s,this.normalMat4),this.normalMat3=Cesium.Matrix4.getRotation(this.normalMat4,this.normalMat3),Cesium.Matrix3.toArray(this.normalMat3,this.normalMat3_array),Cesium.Matrix4.toArray(this.normalMat4,this.normalMat4_array);i._camera;e.enable(e.CULL_FACE),this.selectionFbo.bind();var n=this.postFxShadersManager.pFx_shaders_array[5];e.clearColor(1,1,1,1),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT);var l=n.program;e.useProgram(l),e.enableVertexAttribArray(n.position3_loc),e.uniformMatrix4fv(n.modelViewProjectionMatrix4RelToEye_loc,!1,this.modelViewProjRelToEye_matrix),
e.uniformMatrix4fv(n.buildingRotMatrix_loc,!1,this.detailed_neoBuilding.move_matrix),e.uniform3fv(n.cameraPosHIGH_loc,this.encodedCamPosMC_High),e.uniform3fv(n.cameraPosLOW_loc,this.encodedCamPosMC_Low),e.uniform3fv(n.buildingPosHIGH_loc,this.detailed_neoBuilding.buildingPositionHIGH),e.uniform3fv(n.buildingPosLOW_loc,this.detailed_neoBuilding.buildingPositionLOW);var d=-1,u=!1;r=null,this.renderDetailedNeoBuilding(e,r,i,n,u,d,t),e.disableVertexAttribArray(n.position3_loc);var h=new Uint8Array(4);e.readPixels(this.mouse_x,i.drawingBufferHeight-this.mouse_y,1,1,e.RGBA,e.UNSIGNED_BYTE,h),e.bindFramebuffer(e.FRAMEBUFFER,null);var c=64516*h[0]+254*h[1]+h[2];return this.selectionCandidateObjectsArray[c]}},CesiumManager.prototype.getSelectedObjectPickingAsimetricMode=function(e,i,t,r){this.bPicking=!1;i.context._us._cameraPosition;void 0==this.selectionFbo&&(this.selectionFbo=new FBO(e,i.drawingBufferWidth,i.drawingBufferHeight)),this.selectionCandidateObjectsArray.length=0;for(var o,a,s,n=0,l=0,d=0,u=255,h=[],c=t.currentVisibles0.length,f=0;f<c;f++)if(s=t.currentVisibles0[f],void 0!=s.neoReferencesMotherAndIndices){o=s.neoReferencesMotherAndIndices.neoRefsIndices.length;for(var m=0;m<o;m++)a=s.neoReferencesMotherAndIndices.motherNeoRefsList[s.neoReferencesMotherAndIndices.neoRefsIndices[m]],void 0==a.selColor4&&(a.selColor4=new Color),a.selColor4.set(n,l,d,u),this.selectionCandidateObjectsArray.push(a),h.push(s),d++,d>=254&&(d=0,l++,l>=254&&n++)}c=t.currentVisibles1.length;for(var f=0;f<c;f++)if(s=t.currentVisibles1[f],void 0!=s.neoReferencesMotherAndIndices){o=s.neoReferencesMotherAndIndices.neoRefsIndices.length;for(var m=0;m<o;m++)a=s.neoReferencesMotherAndIndices.motherNeoRefsList[s.neoReferencesMotherAndIndices.neoRefsIndices[m]],void 0==a.selColor4&&(a.selColor4=new Color),a.selColor4.set(n,l,d,u),this.selectionCandidateObjectsArray.push(a),h.push(s),d++,d>=254&&(d=0,l++,l>=254&&n++)}c=t.currentVisibles2.length;for(var f=0;f<c;f++)s=t.currentVisibles2[f],void 0!=s.lego&&(void 0==s.lego.selColor4&&(s.lego.selColor4=new Color),s.lego.selColor4.set(n,l,d,u),h.push(s),d++,d>=254&&(d=0,l++,l>=254&&n++));this.selectionFbo.bind();var g=this.postFxShadersManager.pFx_shaders_array[5];e.clearColor(1,1,1,1),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT);var _=g.program;e.useProgram(_),e.enableVertexAttribArray(g.position3_loc),e.uniformMatrix4fv(g.modelViewProjectionMatrix4RelToEye_loc,!1,this.sceneState.modelViewProjRelToEyeMatrix._floatArrays),e.uniform3fv(g.cameraPosHIGH_loc,this.sceneState.encodedCamPosHigh),e.uniform3fv(g.cameraPosLOW_loc,this.sceneState.encodedCamPosLow);for(var b,C=!1,x=!1,v=-1,y=0,A=-1,c=t.currentVisibles0.length,f=0;f<c;f++)if(s=t.currentVisibles0[f],void 0!=s.neoReferencesMotherAndIndices){b=s.neoBuildingOwner;var M=b.geoLocDataManager.getGeoLocationData(0);e.uniform3fv(g.buildingPosHIGH_loc,M.positionHIGH),e.uniform3fv(g.buildingPosLOW_loc,M.positionLOW),A=0,y=0,this.renderer.renderNeoRefListsAsimetricVersionColorSelection(e,s.neoReferencesMotherAndIndices,b,this,C,g,x,v,y,A)}c=t.currentVisibles1.length;for(var f=0;f<c;f++)if(s=t.currentVisibles1[f],void 0!=s.neoReferencesMotherAndIndices){b=s.neoBuildingOwner;var M=b.geoLocDataManager.getGeoLocationData(0);e.uniform3fv(g.buildingPosHIGH_loc,M.positionHIGH),e.uniform3fv(g.buildingPosLOW_loc,M.positionLOW),A=0,y=0,this.renderer.renderNeoRefListsAsimetricVersionColorSelection(e,s.neoReferencesMotherAndIndices,b,this,C,g,x,v,y,A)}c=t.currentVisibles2.length;for(var f=0;f<c;f++)if(s=t.currentVisibles2[f],void 0!=s.lego&&(b=s.neoBuildingOwner,s.lego.fileLoadState!=CODE.fileLoadState.READY&&2!=s.lego.fileLoadState)){var M=b.geoLocDataManager.getGeoLocationData(0);e.uniformMatrix4fv(g.RefTransfMatrix,!1,M.rotMatrix._floatArrays),e.uniform3fv(g.buildingPosHIGH_loc,M.positionHIGH),e.uniform3fv(g.buildingPosLOW_loc,M.positionLOW),e.uniform1i(g.hasTexture_loc,!1),e.uniform4fv(g.color4Aux_loc,[s.lego.selColor4.r/255,s.lego.selColor4.g/255,s.lego.selColor4.b/255,1]),e.uniform1i(g.hasAditionalMov_loc,!1),e.uniform3fv(g.aditionalMov_loc,[0,0,0]),this.renderer.renderLodBuildingColorSelection(e,s.lego,this,g,v)}g.position3_loc!=-1&&e.disableVertexAttribArray(g.position3_loc),e.disableVertexAttribArray(g.position3_loc);var p=new Uint8Array(4);e.readPixels(this.mouse_x,i.drawingBufferHeight-this.mouse_y,1,1,e.RGBA,e.UNSIGNED_BYTE,p),e.bindFramebuffer(e.FRAMEBUFFER,null);var R=64516*p[0]+254*p[1]+p[2],S=this.selectionCandidateObjectsArray[R];this.selectionCandidateObjectsArray.length=0;var T=h[R];if(void 0==T)return void(B=void 0);var B=h[R].neoBuildingOwner;return h=void 0,r[0]=B,r[1]=T,r[2]=S,S},CesiumManager.prototype.getRayCamSpace=function(e,i,t){var r=1,o=i._camera,a=o.frustum,s=a._fovy,n=a.aspectRatio,l=2*Math.tan(s/2)*r,d=l*n,u=this.mouse_x,h=i.drawingBufferHeight-this.mouse_y;return void 0==t&&(t=new Float32Array(3)),t[0]=d*(u/i.drawingBufferWidth-.5),t[1]=l*(h/i.drawingBufferHeight-.5),t[2]=-r,t},CesiumManager.prototype.calculateSelObjMovePlane=function(e,i,t,r){e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL),e.depthRange(0,1);var o=(t._camera,t._context._us._currentFrustum.y),a=t._frustumCommandsList.length;o=t._frustumCommandsList[a-1].far,this.selectionFbo.bind();var s=this.postFxShadersManager.pFx_shaders_array[3];e.clearColor(1,1,1,1),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT);var n=s.program;e.useProgram(n),e.enableVertexAttribArray(s.position3_loc),e.uniformMatrix4fv(s.modelViewProjectionMatrix4RelToEye_loc,!1,this.modelViewProjRelToEye_matrix),e.uniformMatrix4fv(s.modelViewMatrix4RelToEye_loc,!1,this.modelViewRelToEye_matrix),e.uniform3fv(s.cameraPosHIGH_loc,this.encodedCamPosMC_High),e.uniform3fv(s.cameraPosLOW_loc,this.encodedCamPosMC_Low),e.uniform3fv(s.buildingPosHIGH_loc,this.detailed_neoBuilding.buildingPositionHIGH),e.uniform3fv(s.buildingPosLOW_loc,this.detailed_neoBuilding.buildingPositionLOW),e.uniform1f(s.far_loc,o);var l=-1,d=!1;this.renderDetailedNeoBuilding(e,i,t,s,d,l,r),e.disableVertexAttribArray(s.position3_loc);var u=new Uint8Array(4);e.readPixels(this.mouse_x,t.drawingBufferHeight-this.mouse_y,1,1,e.RGBA,e.UNSIGNED_BYTE,u);var h=u[0]/16777216+u[1]/65536+u[2]/256+u[3];h/=256;var c=h*o;this.resultRaySC=this.getRayCamSpace(e,t,this.resultRaySC);var f=new Float32Array(3);f[0]=this.resultRaySC[0]*c,f[1]=this.resultRaySC[1]*c,f[2]=this.resultRaySC[2]*c;var m=new Cesium.Matrix4;m=Cesium.Matrix4.inverse(t._context._us._modelView,m);var g=new Cesium.Cartesian3(f[0],f[1],f[2]),_=new Cesium.Cartesian3;_=Cesium.Matrix4.multiplyByPoint(m,g,_);var b=new Cesium.Cartesian3;b=Cesium.Matrix4.multiplyByPoint(this.detailed_neoBuilding.transfMat_inv,_,b),this.selObjMovePlane=new Plane,this.selObjMovePlane.setPointAndNormal(b.x,b.y,b.z,0,0,1),e.bindFramebuffer(e.FRAMEBUFFER,null)},CesiumManager.prototype.calculateSelObjMovePlaneAsimetricMode=function(e,i,t,r){e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL),e.depthRange(0,1);var o=(t._camera,t._context._us._currentFrustum.x),a=t._context._us._currentFrustum.y,s=t._frustumCommandsList.length;if(a=t._frustumCommandsList[s-1].far,this.selectionFbo.bind(),this.octreeSelected.neoReferencesMotherAndIndices){0==this.octreeSelected.neoReferencesMotherAndIndices.currentVisibleIndices.length&&(this.octreeSelected.neoReferencesMotherAndIndices.currentVisibleIndices=this.octreeSelected.neoReferencesMotherAndIndices.neoRefsIndices);var n=this.postFxShadersManager.pFx_shaders_array[3];e.clearColor(1,1,1,1),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT);var l=n.program;e.useProgram(l),e.enableVertexAttribArray(n.position3_loc),e.uniformMatrix4fv(n.modelViewProjectionMatrix4RelToEye_loc,!1,this.sceneState.modelViewProjRelToEyeMatrix._floatArrays),e.uniformMatrix4fv(n.modelViewMatrix4RelToEye_loc,!1,this.sceneState.modelViewRelToEyeMatrix._floatArrays),e.uniform3fv(n.cameraPosHIGH_loc,this.sceneState.encodedCamPosHigh),e.uniform3fv(n.cameraPosLOW_loc,this.sceneState.encodedCamPosLow);var d=0,u=this.buildingSelected.geoLocDataManager.getGeoLocationData(0);e.uniform3fv(n.buildingPosHIGH_loc,u.positionHIGH),e.uniform3fv(n.buildingPosLOW_loc,u.positionLOW),e.uniform1f(n.far_loc,a);var h=-1,c=!1,f=!1,c=!1,m=0;this.octreeSelected.setRenderedFalseToAllReferences();this.renderer.renderNeoRefListsAsimetricVersion(e,this.octreeSelected.neoReferencesMotherAndIndices,this.buildingSelected,this,f,n,c,h,m,void 0,d),e.disableVertexAttribArray(n.position3_loc)}var g,_=this.octreeSelected.neoBuildingOwner;if(void 0!=_){this.arrayAuxSC.length=0,_.octree.extractLowestOctreesIfHasTriPolyhedrons(this.arrayAuxSC);for(var b=this.arrayAuxSC.length,C=0;C<b;C++)if(g=this.arrayAuxSC[C],void 0!=g.lego&&void 0!=_){n=this.postFxShadersManager.pFx_shaders_array[7],l=n.program,e.useProgram(l),e.enableVertexAttribArray(n.position3_loc),e.uniformMatrix4fv(n.modelViewProjectionMatrix4RelToEye_loc,!1,this.sceneState.modelViewProjRelToEyeMatrix._floatArrays),e.uniformMatrix4fv(n.modelViewMatrix4RelToEye_loc,!1,this.sceneState.modelViewRelToEyeMatrix._floatArrays),e.uniform3fv(n.cameraPosHIGH_loc,this.sceneState.encodedCamPosHigh),e.uniform3fv(n.cameraPosLOW_loc,this.sceneState.encodedCamPosLow),e.uniformMatrix4fv(n.normalMatrix4_loc,!1,this.sceneState.normalMatrix4._floatArrays),e.uniform1f(n.near_loc,o),e.uniform1f(n.far_loc,a),e.uniform1i(n.hasAditionalMov_loc,!0),e.uniform3fv(n.aditionalMov_loc,[0,0,0]);var u=_.geoLocDataManager.getGeoLocationData(0);e.uniform3fv(n.buildingPosHIGH_loc,u.positionHIGH),e.uniform3fv(n.buildingPosLOW_loc,u.positionLOW),e.uniformMatrix4fv(n.buildingRotMatrix_loc,!1,u.rotMatrix._floatArrays);var h=0;this.renderer.renderLodBuilding(e,g.lego,this,n,h),n.position3_loc!=-1&&e.disableVertexAttribArray(n.position3_loc)}}var x=new Uint8Array(4);e.readPixels(this.mouse_x,t.drawingBufferHeight-this.mouse_y,1,1,e.RGBA,e.UNSIGNED_BYTE,x);var v=x[0]/16777216+x[1]/65536+x[2]/256+x[3];v/=256;var y=v*a;this.resultRaySC=this.getRayCamSpace(e,t,this.resultRaySC);var A=new Float32Array(3);A[0]=this.resultRaySC[0]*y,A[1]=this.resultRaySC[1]*y,A[2]=this.resultRaySC[2]*y;var M=this.sceneState.modelViewMatrixInv._floatArrays,p=new Cesium.Cartesian3(A[0],A[1],A[2]),R=new Cesium.Cartesian3;R=Cesium.Matrix4.multiplyByPoint(M,p,R);var S=new Cesium.Cartesian3,u=this.buildingSelected.geoLocDataManager.getGeoLocationData(0);S=Cesium.Matrix4.multiplyByPoint(u.tMatrixInv._floatArrays,R,S),this.selObjMovePlane=new Plane,this.selObjMovePlane.setPointAndNormal(S.x,S.y,S.z,0,0,1),e.bindFramebuffer(e.FRAMEBUFFER,null)},CesiumManager.prototype.enableCameraMotion=function(e,i){i.screenSpaceCameraController.enableRotate=e,i.screenSpaceCameraController.enableZoom=e,i.screenSpaceCameraController.enableLook=e,i.screenSpaceCameraController.enableTilt=e,i.screenSpaceCameraController.enableTranslate=e},CesiumManager.prototype.isDragging=function(e){var i=e._context._gl;if(0==this.magoPolicy.mouseMoveMode){this.arrayAuxSC.length=0;var t=this.getSelectedObjectPickingAsimetricMode(i,e,this.visibleObjControlerOctrees,this.arrayAuxSC),r=this.arrayAuxSC[0];return this.arrayAuxSC.length=0,r==this.buildingSelected}if(1==this.magoPolicy.mouseMoveMode){this.arrayAuxSC.length=0;var t=this.getSelectedObjectPickingAsimetricMode(i,e,this.visibleObjControlerOctrees,this.arrayAuxSC);return this.arrayAuxSC.length=0,t==this.objectSelected}return!1},CesiumManager.prototype.moveSelectedObject=function(e,i){if(void 0!=this.objectSelected){var t=e._context._gl,r=e.context._us._cameraPosition;void 0==this.selObjMovePlane&&this.calculateSelObjMovePlane(t,r,e,i);var o=e._camera,a=o._position,s=new Cesium.Cartesian2(this.mouse_x,this.mouse_y),n=new Cesium.Ray;n=o.getPickRay(s,n);var l=new Cesium.Cartesian3(n.direction.x,n.direction.y,n.direction.z),d=new Cesium.Cartesian3;d=Cesium.Matrix4.multiplyByPoint(this.detailed_neoBuilding.transfMat_inv,a,d);var u=new Cesium.Cartesian3;u=Cesium.Matrix4.multiplyByPoint(this.detailed_neoBuilding.moveMatrixInv,l,u);var h=new Line;h.setPointAndDir(d.x,d.y,d.z,u.x,u.y,u.z);var c=new Point3D;if(c=this.selObjMovePlane.intersectionLine(h,c),void 0==this.objectSelected.moveVector&&(this.objectSelected.moveVector=new Point3D),this.thereAreStartMovePoint){var f=c.x-this.startMovPoint.x,m=c.y-this.startMovPoint.y,g=c.z-this.startMovPoint.z;this.objectSelected.moveVector.set(f,m,g)}else this.startMovPoint=c,this.startMovPoint.add(-this.objectSelected.moveVector.x,-this.objectSelected.moveVector.y,-this.objectSelected.moveVector.z),this.thereAreStartMovePoint=!0}},CesiumManager.prototype.moveSelectedObjectAsimetricMode=function(e,i){var t=e._context._gl,r=e.context._us._cameraPosition;if(0==this.magoPolicy.mouseMoveMode){if(void 0==this.buildingSelected)return;void 0==this.selObjMovePlane&&this.calculateSelObjMovePlaneAsimetricMode(t,r,e,i);var o=e._camera,a=o._position,s=new Cesium.Cartesian2(this.mouse_x,this.mouse_y),n=new Cesium.Ray;n=o.getPickRay(s,n);var l=new Cesium.Cartesian3(n.direction.x,n.direction.y,n.direction.z),d=new Cesium.Cartesian3,u=new Cesium.Cartesian3,h=this.buildingSelected.geoLocDataManager.getGeoLocationData(0);d=Cesium.Matrix4.multiplyByPoint(h.geoLocMatrixInv._floatArrays,a,d),this.pointSC=h.geoLocMatrixInv.rotatePoint3D(l,this.pointSC),u.x=this.pointSC.x,u.y=this.pointSC.y,u.z=this.pointSC.z;var c=new Line;c.setPointAndDir(d.x,d.y,d.z,u.x,u.y,u.z);var f=new Point3D;if(f=this.selObjMovePlane.intersectionLine(c,f),f.set(-f.x,-f.y,-f.z),void 0==this.buildingSelected.moveVector&&(this.buildingSelected.moveVector=new Point3D),this.thereAreStartMovePoint){var m=f.x-this.startMovPoint.x,g=f.y-this.startMovPoint.y,_=f.z-this.startMovPoint.z;this.buildingSelected.moveVector.set(m,g,_);var b=new Point3D;b.add(m,g,_);var C;C=this.buildingSelected.geoLocDataManager.geoLocationDataArray[0],b.add(C.pivotPoint.x,C.pivotPoint.y,C.pivotPoint.z);var x=Cesium.Cartographic.fromCartesian(new Cesium.Cartesian3(b.x,b.y,b.z)),v=x.longitude*(180/Math.PI),y=x.latitude*(180/Math.PI);x.height;this.changeLocationAndRotation(this.buildingSelected.buildingId,y,v,void 0,void 0,void 0,void 0),this.displayLocationAndRotation(this.buildingSelected)}else this.startMovPoint=f,this.thereAreStartMovePoint=!0}else if(1==this.magoPolicy.mouseMoveMode){if(void 0==this.objectSelected)return;void 0==this.selObjMovePlane&&this.calculateSelObjMovePlaneAsimetricMode(t,r,e,i);var o=e._camera,a=o._position,s=new Cesium.Cartesian2(this.mouse_x,this.mouse_y),n=new Cesium.Ray;n=o.getPickRay(s,n);var l=new Cesium.Cartesian3(n.direction.x,n.direction.y,n.direction.z),d=new Cesium.Cartesian3,u=new Cesium.Cartesian3,h=this.buildingSelected.geoLocDataManager.getGeoLocationData(0);d=Cesium.Matrix4.multiplyByPoint(h.tMatrixInv._floatArrays,a,d),u=Cesium.Matrix4.multiplyByPoint(h.rotMatrixInv._floatArrays,l,u);var c=new Line;c.setPointAndDir(d.x,d.y,d.z,u.x,u.y,u.z);var f=new Point3D;f=this.selObjMovePlane.intersectionLine(c,f);var A=new Cesium.Cartesian3;if(A=Cesium.Matrix4.multiplyByPoint(h.rotMatrix._floatArrays,f,A),f.x=A.x,f.y=A.y,f.z=A.z,void 0==this.objectSelected.moveVector&&(this.objectSelected.moveVector=new Point3D),this.thereAreStartMovePoint){var m=f.x-this.startMovPoint.x,g=f.y-this.startMovPoint.y,_=f.z-this.startMovPoint.z;this.objectSelected.moveVector.set(m,g,_)}else this.startMovPoint=f,this.startMovPoint.add(-this.objectSelected.moveVector.x,-this.objectSelected.moveVector.y,-this.objectSelected.moveVector.z),this.thereAreStartMovePoint=!0}},CesiumManager.prototype.getRenderablesDetailedNeoBuilding=function(e,i,t,r){if(r.length=0,t.currentRenderablesNeoRefLists.length=0,void 0==t)return r;if(void 0==t.move_matrix)return ManagerUtils.calculateBuildingPositionMatrix(t),r;var o=i.context._us._cameraPosition,a=t.getTransformedRelativeEyePositionToBuilding(o.x,o.y,o.z);this.isCameraInsideNeoBuilding=t.isCameraInsideOfBuilding(a.x,a.y,a.z),r.length=0;var s,n=10,l=0;if(this.isCameraInsideNeoBuilding&&void 0!=t.octree){this.loadBuildingOctree(t),void 0==this.myCameraSC&&(this.myCameraSC=new Cesium.Camera(i)),void 0==t.buildingPosMatInv&&(t.buildingPosMatInv=new Matrix4,t.buildingPosMatInv.setByFloat32Array(t.moveMatrixInv));var d,u,h=i.frameState.camera,c=h.direction;this.pointSC.set(c.x,c.y,c.z),d=t.buildingPosMatInv.transformPoint3D(this.pointSC,d),this.pointSC.set(h.up.x,h.up.y,h.up.z),u=t.buildingPosMatInv.transformPoint3D(this.pointSC,u),this.myCameraSC.position.x=a.x,this.myCameraSC.position.y=a.y,this.myCameraSC.position.z=a.z,this.myCameraSC.direction.x=d.x,this.myCameraSC.direction.y=d.y,this.myCameraSC.direction.z=d.z,this.myCameraSC.up.x=u.x,this.myCameraSC.up.y=u.y,this.myCameraSC.up.z=u.z;var f=this.myCameraSC.frustum.computeCullingVolume(this.myCameraSC.position,this.myCameraSC.direction,this.myCameraSC.up);this.intNeoRefList_array.length=0,t.octree.getFrustumVisibleNeoRefListArray(f,this.intNeoRefList_array,this.boundingSphere_Aux,a.x,a.y,a.z),this.matrix4SC.setByFloat32Array(t.move_matrix);for(var m=0;m<this.intNeoRefList_array.length;m++)if(s=this.intNeoRefList_array[m],s.fileLoadState==CODE.fileLoadState.LOADING_FINISHED)l<n&&(s.parseArrayBuffer(e,s.dataArraybuffer,this.readerWriter),s.dataArraybuffer=null,this.matrix4SC&&s.multiplyReferencesMatrices(this.matrix4SC),l+=1);else if(s.fileLoadState==CODE.fileLoadState.PARSE_FINISHED){var g=s.blocksList;if(g.fileLoadState==CODE.fileLoadState.READY){if(this.fileRequestControler.filesRequestedCount<this.fileRequestControler.maxFilesRequestedCount){var _=this.readerWriter.geometryDataPath,b=t.buildingFileName,C=_+"/"+b+"/"+g.name;this.readerWriter.getNeoBlocksArraybuffer(C,g,this)}continue}s.updateCurrentVisibleIndicesInterior(a.x,a.y,a.z),t.currentRenderablesNeoRefLists.push(s)}}this.matrix4SC.setByFloat32Array(t.move_matrix);for(var x=t._neoRefLists_Container.neoRefsLists_Array.length,m=0;m<x;m++)s=t._neoRefLists_Container.neoRefsLists_Array[m],s.fileLoadState==CODE.fileLoadState.LOADING_FINISHED&&l<n&&(s.parseArrayBuffer(e,s.dataArraybuffer,this.readerWriter),s.dataArraybuffer=null,this.matrix4SC&&s.multiplyReferencesMatrices(this.matrix4SC),l+=1);t.updateCurrentVisibleIndicesExterior(a.x,a.y,a.z);for(var v=t._neoRefLists_Container,y=v.neoRefsLists_Array.length,m=0;m<y;m++)t.currentRenderablesNeoRefLists.push(v.neoRefsLists_Array[m]);return t.currentRenderablesNeoRefLists},CesiumManager.prototype.getRenderablesDetailedNeoBuildingAsimetricVersion=function(e,i,t,r,o,a){if(void 0!=t){t.currentRenderablesNeoRefLists.length=0;var s=t.geoLocDataManager.getGeoLocationData(0);if(void 0!=s){if(void 0!=t.octree){if(0==a||1==a){void 0==this.myCameraSC&&(this.myCameraSC=new Cesium.Camera(i));var n=i.frameState.camera,l=i._frustumCommandsList[this.frustumIdx].near,d=i._frustumCommandsList[this.frustumIdx].far;s=t.geoLocDataManager.getGeoLocationData(0),this.myCameraSC=s.getTransformedRelativeCamera(n,this.myCameraSC);var u=t.isCameraInsideOfBuilding(this.myCameraSC.position.x,this.myCameraSC.position.y,this.myCameraSC.position.z),h=500,c=4e3,f=5e8;"basicBuilding"==t.buildingType&&(h=500,c=25e3,f=5e8),"outfitting"==t.buildingType?this.myCameraSC.frustum.fov=.7:this.myCameraSC.frustum.fov=.9,this.myCameraSC.near=l,this.myCameraSC.far=d;var m=this.myCameraSC.frustum.computeCullingVolume(this.myCameraSC.position,this.myCameraSC.direction,this.myCameraSC.up),g=3,_=(this.myCameraSC.position.x+g*this.myCameraSC.direction.x,this.myCameraSC.position.y+g*this.myCameraSC.direction.y,this.myCameraSC.position.z+g*this.myCameraSC.direction.z,r.currentVisibles0.length),b=r.currentVisibles1.length,C=t.octree.getFrustumVisibleLowestOctreesByLOD(m,r,o,this.boundingSphere_Aux,this.myCameraSC.position.x,this.myCameraSC.position.y,this.myCameraSC.position.z,h,c,f);if(!C)return}else t.octree.extractLowestOctreesIfHasTriPolyhedrons(r.currentVisibles2);for(var x,v=(this.readerWriter.geometryDataPath,t.buildingFileName,o.currentVisibles0.length),y=_;y<v;y++)if(x=o.currentVisibles0[y],0!=x.triPolyhedronsCount){if(void 0==x.neoReferencesMotherAndIndices)x.neoReferencesMotherAndIndices=new NeoReferencesMotherAndIndices,x.neoReferencesMotherAndIndices.motherNeoRefsList=t.motherNeoReferencesArray;else{var A=!u;x.neoReferencesMotherAndIndices.updateCurrentVisibleIndices(A,this.myCameraSC.position.x,this.myCameraSC.position.y,this.myCameraSC.position.z)}0!=x.neoReferencesMotherAndIndices.fileLoadState||(x.neoBuildingOwner=t)}if("outfitting"==t.buildingType)return;v=o.currentVisibles1.length;for(var y=b;y<v;y++){if(x=o.currentVisibles1[y],void 0==x.neoReferencesMotherAndIndices)x.neoReferencesMotherAndIndices=new NeoReferencesMotherAndIndices,x.neoReferencesMotherAndIndices.motherNeoRefsList=t.motherNeoReferencesArray;else{var A=!u;x.neoReferencesMotherAndIndices.updateCurrentVisibleIndices(A,this.myCameraSC.position.x,this.myCameraSC.position.y,this.myCameraSC.position.z)}0!=x.neoReferencesMotherAndIndices.fileLoadState||(x.neoBuildingOwner=t)}}}else if(currentCalculatingPositionsCount<maxNumberOfCalculatingPositions&&void 0!=t.metaData){s=t.geoLocDataManager.newGeoLocationData("defaultLoc");var M=t.metaData.geographicCoord.longitude,p=t.metaData.geographicCoord.latitude,R=t.metaData.geographicCoord.altitude,S=t.metaData.heading,T=t.metaData.pitch,B=t.metaData.roll;ManagerUtils.calculateGeoLocationData(M,p,R-500,S,T,B,s),t.octree}}},CesiumManager.prototype.prepareVisibleOctreesAsimetricVersion=function(e,i,t){if(!(this.fileRequestControler.filesRequestedCount>=this.fileRequestControler.maxFilesRequestedCount)){for(var r,o,a=30,s=0,n=this.readerWriter.geometryDataPath,l=t.currentVisibles0.length,d=0;d<l;d++)if(r=t.currentVisibles0[d],o=r.neoBuildingOwner,0!=r.triPolyhedronsCount)if(0!=r.neoReferencesMotherAndIndices.fileLoadState){if(r.neoReferencesMotherAndIndices.fileLoadState==CODE.fileLoadState.LOADING_FINISHED){if(s<a){var u=o.geoLocDataManager.getGeoLocationData(0);this.matrix4SC.setByFloat32Array(u.rotMatrix._floatArrays),r.neoReferencesMotherAndIndices.parseArrayBufferReferences(e,r.neoReferencesMotherAndIndices.dataArraybuffer,this.readerWriter,r.neoBuildingOwner.motherNeoReferencesArray,this.matrix4SC),r.neoReferencesMotherAndIndices.dataArraybuffer=void 0,r.neoReferencesMotherAndIndices.multiplyKeyTransformMatrix(0,u.rotMatrix),s+=1}}else if(r.neoReferencesMotherAndIndices.fileLoadState==CODE.fileLoadState.PARSE_FINISHED){var h=r.neoReferencesMotherAndIndices.blocksList;if(h.fileLoadState==CODE.fileLoadState.READY){if(!(this.fileRequestControler.filesRequestedCount<this.fileRequestControler.maxFilesRequestedCount))return;o=r.neoBuildingOwner;var n=this.readerWriter.geometryDataPath,c=o.buildingFileName,f=r.octree_number_name.toString(),c=o.buildingFileName,m=n+"/"+c+"/Models",g=m+"/"+f+"_Model";this.readerWriter.getNeoBlocksArraybuffer(g,h,this);continue}}}else{if(!(this.fileRequestControler.filesRequestedCount<this.fileRequestControler.maxFilesRequestedCount))return;o=r.neoBuildingOwner,void 0==r.neoReferencesMotherAndIndices.blocksList&&(r.neoReferencesMotherAndIndices.blocksList=new BlocksList);var f=r.octree_number_name.toString(),c=o.buildingFileName,_=n+"/"+c+"/References",b=_+"/"+f+"_Ref";this.readerWriter.getNeoReferencesArraybuffer(b,r.neoReferencesMotherAndIndices,this)}l=t.currentVisibles1.length;for(var d=0;d<l;d++)if(r=t.currentVisibles1[d],o=r.neoBuildingOwner,void 0==r.neoReferencesMotherAndIndices&&(r.neoReferencesMotherAndIndices=new NeoReferencesMotherAndIndices,r.neoReferencesMotherAndIndices.motherNeoRefsList=o.motherNeoReferencesArray),0!=r.neoReferencesMotherAndIndices.fileLoadState){if(r.neoReferencesMotherAndIndices.fileLoadState==CODE.fileLoadState.LOADING_FINISHED){if(s<a){var u=o.geoLocDataManager.getGeoLocationData(0);this.matrix4SC.setByFloat32Array(u.rotMatrix._floatArrays),r.neoReferencesMotherAndIndices.parseArrayBufferReferences(e,r.neoReferencesMotherAndIndices.dataArraybuffer,this.readerWriter,r.neoBuildingOwner.motherNeoReferencesArray,this.matrix4SC),r.neoReferencesMotherAndIndices.dataArraybuffer=void 0,r.neoReferencesMotherAndIndices.multiplyKeyTransformMatrix(0,u.rotMatrix),s+=1}}else if(r.neoReferencesMotherAndIndices.fileLoadState==CODE.fileLoadState.PARSE_FINISHED){var h=r.neoReferencesMotherAndIndices.blocksList;if(h.fileLoadState==CODE.fileLoadState.READY){if(!(this.fileRequestControler.filesRequestedCount<this.fileRequestControler.maxFilesRequestedCount))return;o=r.neoBuildingOwner;var f=r.octree_number_name.toString(),c=o.buildingFileName,m=n+"/"+c+"/Models",g=m+"/"+f+"_Model";this.readerWriter.getNeoBlocksArraybuffer(g,h,this);continue}}}else{if(!(this.fileRequestControler.filesRequestedCount<this.fileRequestControler.maxFilesRequestedCount))return;void 0==r.neoReferencesMotherAndIndices.blocksList&&(r.neoReferencesMotherAndIndices.blocksList=new BlocksList);var f=r.octree_number_name.toString(),f=r.octree_number_name.toString(),c=o.buildingFileName,_=n+"/"+c+"/References",b=_+"/"+f+"_Ref";this.readerWriter.getNeoReferencesArraybuffer(b,r.neoReferencesMotherAndIndices,this)}}},CesiumManager.prototype.renderDetailedNeoBuilding=function(e,i,t,r,o,a,s){if(a==-1){this.selectionCandidateObjectsArray.length=0;for(var n=0,l=0,d=0,u=255,h=s,c=h.length,f=0;f<c;f++)for(var m=h[f],g=m.neoRefs_Array.length,_=0;_<g;_++){var b=m.neoRefs_Array[_];void 0==b.selColor4&&(b.selColor4=new Color),b.selColor4.set(n,l,d,u),this.selectionCandidateObjectsArray.push(b),d++,d>=254&&(d=0,l++,l>=254&&n++)}}var C=!1;a==-1?this.renderer.renderNeoRefListsColorSelection(e,s,this.detailed_neoBuilding,this,C,r,o,a):this.renderer.renderNeoRefLists(e,s,this.detailed_neoBuilding,this,C,r,o,a)},CesiumManager.prototype.renderLowestOctreeLegoAsimetricVersion=function(e,i,t,r,o,a,s){if(e.frontFace(e.CCW),a==-1);else{var n,l,d,u,h=!1;o=!1;var c=0;if(0==a){n=this.postFxShadersManager.pFx_shaders_array[3],l=n.program,e.useProgram(l),e.enableVertexAttribArray(n.position3_loc),n.normal3_loc!=-1&&e.enableVertexAttribArray(n.normal3_loc),e.uniformMatrix4fv(n.modelViewProjectionMatrix4RelToEye_loc,!1,this.sceneState.modelViewProjRelToEyeMatrix._floatArrays),e.uniformMatrix4fv(n.modelViewMatrix4RelToEye_loc,!1,this.sceneState.modelViewRelToEyeMatrix._floatArrays),e.uniformMatrix4fv(n.modelViewMatrix4_loc,!1,this.sceneState.modelViewMatrix._floatArrays),e.uniformMatrix4fv(n.projectionMatrix4_loc,!1,this.sceneState.projectionMatrix._floatArrays),e.uniform3fv(n.cameraPosHIGH_loc,this.sceneState.encodedCamPosHigh),e.uniform3fv(n.cameraPosLOW_loc,this.sceneState.encodedCamPosLow),e.uniform1f(n.near_loc,this.sceneState.camera.frustum.near),e.uniform1f(n.far_loc,this.sceneState.camera.frustum.far),e.uniformMatrix4fv(n.normalMatrix4_loc,!1,this.sceneState.normalMatrix4._floatArrays);for(var f=s.currentVisibles0.length,m=0;m<f;m++)u=s.currentVisibles0[m],u.setRenderedFalseToAllReferences();f=s.currentVisibles1.length;for(var m=0;m<f;m++)u=s.currentVisibles1[m],u.setRenderedFalseToAllReferences();var g=0,_=0;if(this.isLastFrustum){for(var f=s.currentVisibles0.length,m=0;m<f;m++)if(u=s.currentVisibles0[m],void 0!=u.neoReferencesMotherAndIndices){d=u.neoBuildingOwner;var b=d.geoLocDataManager.getGeoLocationData(0);e.uniformMatrix4fv(n.buildingRotMatrix_loc,!1,b.rotMatrix._floatArrays),e.uniform3fv(n.buildingPosHIGH_loc,b.positionHIGH),e.uniform3fv(n.buildingPosLOW_loc,b.positionLOW),this.renderer.renderNeoRefListsAsimetricVersion(e,u.neoReferencesMotherAndIndices,d,this,h,n,o,a,_,0,g)}g=0,_=.9,f=s.currentVisibles1.length;for(var m=0;m<f;m++)if(u=s.currentVisibles1[m],void 0!=u.neoReferencesMotherAndIndices&&(d=u.neoBuildingOwner,0!=this.renderingModeTemp||"outfitting"!=d.buildingType)){var b=d.geoLocDataManager.getGeoLocationData(0);e.uniformMatrix4fv(n.buildingRotMatrix_loc,!1,b.rotMatrix._floatArrays),e.uniform3fv(n.buildingPosHIGH_loc,b.positionHIGH),e.uniform3fv(n.buildingPosLOW_loc,b.positionLOW),this.renderer.renderNeoRefListsAsimetricVersion(e,u.neoReferencesMotherAndIndices,d,this,h,n,o,a,_,1,g)}}n=this.postFxShadersManager.pFx_shaders_array[7],l=n.program,e.useProgram(l),e.enableVertexAttribArray(n.position3_loc),e.uniformMatrix4fv(n.modelViewProjectionMatrix4RelToEye_loc,!1,this.sceneState.modelViewProjRelToEyeMatrix._floatArrays),e.uniformMatrix4fv(n.modelViewMatrix4RelToEye_loc,!1,this.sceneState.modelViewRelToEyeMatrix._floatArrays),e.uniformMatrix4fv(n.modelViewMatrix4_loc,!1,this.sceneState.modelViewMatrix._floatArrays),e.uniformMatrix4fv(n.projectionMatrix4_loc,!1,this.sceneState.projectionMatrix._floatArrays),e.uniform3fv(n.cameraPosHIGH_loc,this.sceneState.encodedCamPosHigh),e.uniform3fv(n.cameraPosLOW_loc,this.sceneState.encodedCamPosLow),e.uniform1f(n.near_loc,this.sceneState.camera.frustum.near),e.uniform1f(n.far_loc,this.sceneState.camera.frustum.far),e.uniformMatrix4fv(n.normalMatrix4_loc,!1,this.sceneState.normalMatrix4._floatArrays),e.uniform1i(n.hasAditionalMov_loc,!0),e.uniform3fv(n.aditionalMov_loc,[0,0,0]),f=s.currentVisibles2.length;for(var m=0;m<f;m++)if(u=s.currentVisibles2[m],void 0==u.lego&&(u.lego=new Lego,u.lego.fileLoadState=CODE.fileLoadState.READY),(void 0!=u.lego||void 0!=u.lego.dataArrayBuffer)&&(d=u.neoBuildingOwner,void 0!=d&&"outfitting"!=d.buildingType))if(u.lego.fileLoadState!=CODE.fileLoadState.READY||this.isCameraMoving){if(2!=u.lego.fileLoadState||this.isCameraMoving){if(u.lego.vbo_vicks_container.vboCacheKeysArray[0]&&u.lego.vbo_vicks_container.vboCacheKeysArray[0].tcoordVboDataArray&&void 0==d.simpleBuilding3x3Texture){d.simpleBuilding3x3Texture=new Texture;var C=d.buildingFileName,x=this.readerWriter.geometryDataPath+"/"+C+"/SimpleBuildingTexture3x3.bmp";this.readerWriter.readLegoSimpleBuildingTexture(e,x,d.simpleBuilding3x3Texture,this)}var b=d.geoLocDataManager.getGeoLocationData(0);e.uniformMatrix4fv(n.buildingRotMatrix_loc,!1,b.rotMatrix._floatArrays),e.uniform3fv(n.buildingPosHIGH_loc,b.positionHIGH),e.uniform3fv(n.buildingPosLOW_loc,b.positionLOW);var o=!1;this.renderer.renderLodBuilding(e,u.lego,this,n,a,o)}else if(c<100){var v=0;u.lego.parseArrayBuffer(e,this.readerWriter,u.lego.dataArrayBuffer,v),u.lego.dataArrayBuffer=void 0,c++}}else if(this.fileRequestControler.filesRequestedCount<this.fileRequestControler.maxFilesRequestedCount){var y=u.octree_number_name.toString(),C=d.buildingFileName,A=this.readerWriter.geometryDataPath+"/"+C+"/Bricks",M=A+"/"+y+"_Brick";this.readerWriter.getOctreeLegoArraybuffer(M,u,this)}n.position3_loc!=-1&&e.disableVertexAttribArray(n.position3_loc)}if(1==a){void 0==this.noiseTexture&&(this.noiseTexture=genNoiseTextureRGBA(e,4,4,this.pixels)),n=this.postFxShadersManager.pFx_shaders_array[4],l=n.program,e.useProgram(l),e.enableVertexAttribArray(n.texCoord2_loc),e.enableVertexAttribArray(n.position3_loc),e.enableVertexAttribArray(n.normal3_loc),e.uniformMatrix4fv(n.modelViewProjectionMatrix4RelToEye_loc,!1,this.sceneState.modelViewProjRelToEyeMatrix._floatArrays),e.uniformMatrix4fv(n.modelViewMatrix4RelToEye_loc,!1,this.sceneState.modelViewRelToEyeMatrix._floatArrays),e.uniformMatrix4fv(n.modelViewMatrix4_loc,!1,this.sceneState.modelViewMatrix._floatArrays),e.uniformMatrix4fv(n.projectionMatrix4_loc,!1,this.sceneState.projectionMatrix._floatArrays),e.uniform3fv(n.cameraPosHIGH_loc,this.sceneState.encodedCamPosHigh),e.uniform3fv(n.cameraPosLOW_loc,this.sceneState.encodedCamPosLow),e.uniformMatrix4fv(n.normalMatrix4_loc,!1,this.sceneState.normalMatrix4._floatArrays),e.uniform1f(n.near_loc,this.sceneState.camera.frustum.near),e.uniform1f(n.far_loc,this.sceneState.camera.frustum.far),e.uniform1f(n.fov_loc,this.sceneState.camera.frustum.fovyRad),e.uniform1f(n.aspectRatio_loc,this.sceneState.camera.frustum.aspectRatio),e.uniform1f(n.screenWidth_loc,t.drawingBufferWidth),e.uniform1f(n.screenHeight_loc,t.drawingBufferHeight),e.uniform1i(n.depthTex_loc,0),e.uniform1i(n.noiseTex_loc,1),e.uniform1i(n.diffuseTex_loc,2),e.uniform2fv(n.noiseScale2_loc,[this.depthFboNeo.width/this.noiseTexture.width,this.depthFboNeo.height/this.noiseTexture.height]),e.uniform3fv(n.kernel16_loc,this.kernel),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this.depthFboNeo.colorBuffer),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,this.noiseTexture);for(var f=s.currentVisibles0.length,m=0;m<f;m++)u=s.currentVisibles0[m],
u.setRenderedFalseToAllReferences();f=s.currentVisibles1.length;for(var m=0;m<f;m++)u=s.currentVisibles1[m],u.setRenderedFalseToAllReferences();if(g=0,_=0,this.isLastFrustum){for(var f=s.currentVisibles0.length,m=0;m<f;m++)if(u=s.currentVisibles0[m],void 0!=u.neoReferencesMotherAndIndices){d=u.neoBuildingOwner;var b=d.geoLocDataManager.getGeoLocationData(0);e.uniformMatrix4fv(n.buildingRotMatrix_loc,!1,b.rotMatrix._floatArrays),e.uniform3fv(n.buildingPosHIGH_loc,b.positionHIGH),e.uniform3fv(n.buildingPosLOW_loc,b.positionLOW),o=d.texturesLoaded.length>0,this.renderer.renderNeoRefListsAsimetricVersion(e,u.neoReferencesMotherAndIndices,d,this,h,n,o,a,_,0,g)}_=.9,g=0,f=s.currentVisibles1.length;for(var m=0;m<f;m++)if(u=s.currentVisibles1[m],void 0!=u.neoReferencesMotherAndIndices&&(d=u.neoBuildingOwner,0!=this.renderingModeTemp||"outfitting"!=d.buildingType)){var b=d.geoLocDataManager.getGeoLocationData(0);e.uniformMatrix4fv(n.buildingRotMatrix_loc,!1,b.rotMatrix._floatArrays),e.uniform3fv(n.buildingPosHIGH_loc,b.positionHIGH),e.uniform3fv(n.buildingPosLOW_loc,b.positionLOW),o=d.texturesLoaded.length>0,this.renderer.renderNeoRefListsAsimetricVersion(e,u.neoReferencesMotherAndIndices,d,this,h,n,o,a,_,1,g)}}n=this.postFxShadersManager.pFx_shaders_array[8],l=n.program,e.useProgram(l),e.enableVertexAttribArray(n.position3_loc),e.enableVertexAttribArray(n.normal3_loc),e.enableVertexAttribArray(n.color4_loc),e.uniformMatrix4fv(n.modelViewProjectionMatrix4RelToEye_loc,!1,this.sceneState.modelViewProjRelToEyeMatrix._floatArrays),e.uniformMatrix4fv(n.modelViewMatrix4RelToEye_loc,!1,this.sceneState.modelViewRelToEyeMatrix._floatArrays),e.uniformMatrix4fv(n.modelViewMatrix4_loc,!1,this.sceneState.modelViewMatrix._floatArrays),e.uniformMatrix4fv(n.projectionMatrix4_loc,!1,this.sceneState.projectionMatrix._floatArrays),e.uniform3fv(n.cameraPosHIGH_loc,this.sceneState.encodedCamPosHigh),e.uniform3fv(n.cameraPosLOW_loc,this.sceneState.encodedCamPosLow),e.uniform1f(n.near_loc,this.sceneState.camera.frustum.near),e.uniform1f(n.far_loc,this.sceneState.camera.frustum.far),e.uniformMatrix4fv(n.normalMatrix4_loc,!1,this.sceneState.normalMatrix4._floatArrays),e.uniform1i(n.hasAditionalMov_loc,!0),e.uniform3fv(n.aditionalMov_loc,[0,0,0]),e.uniform1i(n.hasTexture_loc,!1),e.uniform1i(n.depthTex_loc,0),e.uniform1i(n.noiseTex_loc,1),e.uniform1i(n.diffuseTex_loc,2),e.uniform1f(n.fov_loc,this.sceneState.camera.frustum.fovyRad),e.uniform1f(n.aspectRatio_loc,this.sceneState.camera.frustum.aspectRatio),e.uniform1f(n.screenWidth_loc,t.drawingBufferWidth),e.uniform1f(n.screenHeight_loc,t.drawingBufferHeight),e.uniform2fv(n.noiseScale2_loc,[this.depthFboNeo.width/this.noiseTexture.width,this.depthFboNeo.height/this.noiseTexture.height]),e.uniform3fv(n.kernel16_loc,this.kernel),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this.depthFboNeo.colorBuffer),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,this.noiseTexture),e.activeTexture(e.TEXTURE2),e.bindTexture(e.TEXTURE_2D,this.textureAux_1x1);var p;f=s.currentVisibles2.length;for(var m=0;m<f;m++)if(u=s.currentVisibles2[m],(void 0!=u.legoDataArrayBuffer||void 0!=u.lego)&&(d=u.neoBuildingOwner,void 0!=d&&"outfitting"!=d.buildingType)){d.isHighLighted?(e.uniform1i(n.bUse1Color_loc,!0),e.uniform4fv(n.oneColor4_loc,this.highLightColor4)):d.isColorChanged?(e.uniform1i(n.bUse1Color_loc,!0),e.uniform4fv(n.oneColor4_loc,[d.aditionalColor.r,d.aditionalColor.g,d.aditionalColor.b,d.aditionalColor.a])):e.uniform1i(n.bUse1Color_loc,!1);var o=!0;void 0!=d.simpleBuilding3x3Texture&&d.simpleBuilding3x3Texture.texId?(e.enableVertexAttribArray(n.texCoord2_loc),e.uniform1i(n.hasTexture_loc,!0),p!=d.simpleBuilding3x3Texture.texId&&(e.bindTexture(e.TEXTURE_2D,d.simpleBuilding3x3Texture.texId),p=d.simpleBuilding3x3Texture.texId)):(e.uniform1i(n.hasTexture_loc,!1),e.disableVertexAttribArray(n.texCoord2_loc),o=!1);var b=d.geoLocDataManager.getGeoLocationData(0);e.uniformMatrix4fv(n.buildingRotMatrix_loc,!1,b.rotMatrix._floatArrays),e.uniform3fv(n.buildingPosHIGH_loc,b.positionHIGH),e.uniform3fv(n.buildingPosLOW_loc,b.positionLOW),void 0!=u.lego&&this.renderer.renderLodBuilding(e,u.lego,this,n,a,o)}if(this.magoPolicy.getShowBoundingBox()){n=this.postFxShadersManager.pFx_shaders_array[12],l=n.program,e.useProgram(l),e.enableVertexAttribArray(n.position3_loc),e.enableVertexAttribArray(n.normal3_loc),e.disableVertexAttribArray(n.color4_loc),e.uniformMatrix4fv(n.modelViewProjectionMatrix4RelToEye_loc,!1,this.sceneState.modelViewProjRelToEyeMatrix._floatArrays),e.uniformMatrix4fv(n.modelViewMatrix4RelToEye_loc,!1,this.sceneState.modelViewRelToEyeMatrix._floatArrays),e.uniformMatrix4fv(n.modelViewMatrix4_loc,!1,this.sceneState.modelViewMatrix._floatArrays),e.uniformMatrix4fv(n.projectionMatrix4_loc,!1,this.sceneState.projectionMatrix._floatArrays),e.uniform3fv(n.cameraPosHIGH_loc,this.sceneState.encodedCamPosHigh),e.uniform3fv(n.cameraPosLOW_loc,this.sceneState.encodedCamPosLow),e.uniform1f(n.near_loc,this.sceneState.camera.frustum.near),e.uniform1f(n.far_loc,this.sceneState.camera.frustum.far),e.uniformMatrix4fv(n.normalMatrix4_loc,!1,this.sceneState.normalMatrix4._floatArrays),e.uniform1i(n.hasAditionalMov_loc,!0),e.uniform3fv(n.aditionalMov_loc,[0,0,0]),e.uniform1i(n.bScale_loc,!0),e.uniform1i(n.bUse1Color_loc,!0),e.uniform4fv(n.oneColor4_loc,[1,0,1,1]),e.uniform1i(n.depthTex_loc,0),e.uniform1i(n.noiseTex_loc,1),e.uniform1i(n.diffuseTex_loc,2),e.uniform1f(n.fov_loc,this.sceneState.camera.frustum.fovyRad),e.uniform1f(n.aspectRatio_loc,this.sceneState.camera.frustum.aspectRatio),e.uniform1f(n.screenWidth_loc,t.drawingBufferWidth),e.uniform1f(n.screenHeight_loc,t.drawingBufferHeight),e.uniform2fv(n.noiseScale2_loc,[this.depthFboNeo.width/this.noiseTexture.width,this.depthFboNeo.height/this.noiseTexture.height]),e.uniform3fv(n.kernel16_loc,this.kernel),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this.depthFboNeo.colorBuffer),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,this.noiseTexture);for(var R=this.visibleObjControlerBuildings.currentVisibles0.length,S=0;S<R;S++){if(d=this.visibleObjControlerBuildings.currentVisibles0[S],"testId_F110T"==d.buildingId);e.uniform3fv(n.scale_loc,[d.bbox.getXLength(),d.bbox.getYLength(),d.bbox.getZLength()]);var b=d.geoLocDataManager.getGeoLocationData(0);e.uniformMatrix4fv(n.buildingRotMatrix_loc,!1,b.rotMatrix._floatArrays),e.uniform3fv(n.buildingPosHIGH_loc,b.positionHIGH),e.uniform3fv(n.buildingPosLOW_loc,b.positionLOW),this.pointSC=d.bbox.getCenterPoint3d(this.pointSC),e.uniform3fv(n.aditionalMov_loc,[this.pointSC.x,this.pointSC.y,this.pointSC.z]),this.renderer.renderTriPolyhedron(e,this.unitaryBoxSC,this,n,a,d.isHighLighted)}R=this.visibleObjControlerBuildings.currentVisibles2.length;for(var S=0;S<R;S++){if(d=this.visibleObjControlerBuildings.currentVisibles2[S],"testId_F110T"==d.buildingId);e.uniform3fv(n.scale_loc,[d.bbox.getXLength(),d.bbox.getYLength(),d.bbox.getZLength()]);var b=d.geoLocDataManager.getGeoLocationData(0);e.uniformMatrix4fv(n.buildingRotMatrix_loc,!1,b.rotMatrix._floatArrays),e.uniform3fv(n.buildingPosHIGH_loc,b.positionHIGH),e.uniform3fv(n.buildingPosLOW_loc,b.positionLOW),this.pointSC=d.bbox.getCenterPoint3d(this.pointSC),e.uniform3fv(n.aditionalMov_loc,[this.pointSC.x,this.pointSC.y,this.pointSC.z]),this.renderer.renderTriPolyhedron(e,this.unitaryBoxSC,this,n,a,d.isHighLighted)}}}n.texCoord2_loc!=-1&&e.disableVertexAttribArray(n.texCoord2_loc),n.position3_loc!=-1&&e.disableVertexAttribArray(n.position3_loc),n.normal3_loc!=-1&&e.disableVertexAttribArray(n.normal3_loc),n.color4_loc!=-1&&e.disableVertexAttribArray(n.color4_loc)}},CesiumManager.prototype.createDefaultShaders=function(e){var i="modelReferencesSsao",t=this.postFxShadersManager.newShader(i),r=ShaderSource.modelRefSsaoVsSource,o=ShaderSource.modelRefSsaoFsSource;t.program=e.createProgram(),t.shader_vertex=this.postFxShadersManager.getShader(e,r,e.VERTEX_SHADER,"VERTEX"),t.shader_fragment=this.postFxShadersManager.getShader(e,o,e.FRAGMENT_SHADER,"FRAGMENT"),e.attachShader(t.program,t.shader_vertex),e.attachShader(t.program,t.shader_fragment),e.linkProgram(t.program);var a;a=t.newUniformDataPair("Matrix4fv","mvpMat4RelToEye"),a.uniformLocation=e.getUniformLocation(t.program,"ModelViewProjectionMatrixRelToEye"),a.matrix4fv=this.sceneState.modelViewProjRelToEyeMatrix._floatArrays,a=t.newUniformDataPair("Matrix4fv","mvMat4RelToEye"),a.uniformLocation=e.getUniformLocation(t.program,"modelViewMatrixRelToEye"),a.matrix4fv=this.sceneState.modelViewRelToEyeMatrix._floatArrays,a=t.newUniformDataPair("Matrix4fv","pMat4"),a.uniformLocation=e.getUniformLocation(t.program,"projectionMatrix"),a.matrix4fv=this.sceneState.projectionMatrix._floatArrays,a=t.newUniformDataPair("Vec3fv","encodedCamPosHigh"),a.uniformLocation=e.getUniformLocation(t.program,"encodedCameraPositionMCHigh"),a.vec3fv=this.sceneState.encodedCamPosHigh,a=t.newUniformDataPair("Vec3fv","encodedCamPosLow"),a.uniformLocation=e.getUniformLocation(t.program,"encodedCameraPositionMCLow"),a.vec3fv=this.sceneState.encodedCamPosLow,a=t.newUniformDataPair("Matrix4fv","normalMat4"),a.uniformLocation=e.getUniformLocation(t.program,"normalMatrix4"),a.matrix4fv=this.sceneState.normalMatrix4._floatArrays,a=t.newUniformDataPair("1f","frustumFar"),a.uniformLocation=e.getUniformLocation(t.program,"far"),a.floatValue=this.sceneState.camera.frustum.far,a=t.newUniformDataPair("1f","fovy"),a.uniformLocation=e.getUniformLocation(t.program,"fov"),a.floatValue=this.sceneState.camera.frustum.fovyRad,a=t.newUniformDataPair("1f","aspectRatio"),a.uniformLocation=e.getUniformLocation(t.program,"aspectRatio"),a.floatValue=this.sceneState.camera.frustum.aspectRatio,a=t.newUniformDataPair("1i","drawBuffWidht"),a.uniformLocation=e.getUniformLocation(t.program,"screenWidth"),a.intValue=this.sceneState.drawingBufferWidth,a=t.newUniformDataPair("1i","drawBuffHeight"),a.uniformLocation=e.getUniformLocation(t.program,"screenHeight"),a.intValue=this.sceneState.drawingBufferHeight,a=t.newUniformDataPair("1i","depthTex"),a.uniformLocation=e.getUniformLocation(t.program,"depthTex"),a.intValue=0,a=t.newUniformDataPair("1i","noiseTex"),a.uniformLocation=e.getUniformLocation(t.program,"noiseTex"),a.intValue=1},CesiumManager.prototype.renderLodBuilding=function(e,i,t,r,o,a,s){s.fileLoadState==CODE.fileLoadState.LOADING_FINISHED&&s.parseArrayBuffer(e,this.readerWriter),this.renderer.renderLodBuilding(e,s,this,r,a)},CesiumManager.prototype.createFirstTimeVBOCacheKeys=function(e,i){var t=i._simpleBuilding_v1,r=i._simpleBuilding_v1._simpleObjects_array[0],o=r._vtCacheKeys_container._vtArrays_cacheKeys_array[0];o._verticesArray_cacheKey=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,o._verticesArray_cacheKey),e.bufferData(e.ARRAY_BUFFER,r._vtCacheKeys_container._vtArrays_cacheKeys_array[0].verticesArrayBuffer,e.STATIC_DRAW),r._vtCacheKeys_container._vtArrays_cacheKeys_array[0].verticesArrayBuffer=null,void 0!=r._vtCacheKeys_container._vtArrays_cacheKeys_array[0].normalsArrayBuffer&&(o._normalsArray_cacheKey=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,o._normalsArray_cacheKey),e.bufferData(e.ARRAY_BUFFER,r._vtCacheKeys_container._vtArrays_cacheKeys_array[0].normalsArrayBuffer,e.STATIC_DRAW),r._vtCacheKeys_container._vtArrays_cacheKeys_array[0].normalsArrayBuffer=null),void 0==t._simpleBuildingTexture&&(t._simpleBuildingTexture=e.createTexture()),e.bindTexture(e.TEXTURE_2D,t._simpleBuildingTexture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,new Uint8Array([240,240,240,255])),e.bindTexture(e.TEXTURE_2D,null),i._f4d_nailImage_readed_finished=!0},CesiumManager.prototype.reCalculateModelViewProjectionRelToEyeMatrix=function(e){for(var i=0;i<16;i++)if(0==e.context._us._modelView[i])return;var t=new Cesium.Matrix4;t=Cesium.Matrix4.clone(e.context._us._modelView),t[12]=0,t[13]=0,t[14]=0;var r=new Cesium.Matrix4;Cesium.Matrix4.multiply(e.context._us._projection,t,r),Cesium.Matrix4.toArray(r,this.modelViewProjRelToEye_matrix)},CesiumManager.prototype.renderTerranTileServiceFormatPostFxShader=function(e,i){if(i&&!this.isCameraInsideNeoBuilding){var t=e.context._gl,r=e.context._us._cameraPosition,o=e._frameState.cullingVolume;t.disable(t.CULL_FACE),this.detailed_building?this.squareDistUmbral=20.25:this.squareDistUmbral=2500,this.isCameraMoved(r,this.squareDistUmbral),void 0==this.depthFbo&&(this.depthFbo=new FBO(t,e.drawingBufferWidth,e.drawingBufferHeight)),void 0==this.ssaoFbo&&(this.ssaoFbo=new FBO(t,e.drawingBufferWidth,e.drawingBufferHeight)),this.depthFbo.width==e.drawingBufferWidth&&this.depthFbo.height==e.drawingBufferHeight||(this.depthFbo=new FBO(t,e.drawingBufferWidth,e.drawingBufferHeight)),this.isCameraMoving||(this.currentVisibleBuildings_array.length=0,this.currentVisibleBuildings_LOD0_array.length=0,this.detailed_building,this.doFrustumCullingTerranTileServiceFormat(t,o,this.currentVisibleBuildings_array,r)),this.reCalculateModelViewProjectionRelToEyeMatrix(e),Cesium.Matrix4.toArray(e._context._us._modelViewRelativeToEye,this.modelViewRelToEye_matrix),Cesium.Matrix4.toArray(e._context._us._modelView,this.modelView_matrix),Cesium.Matrix4.toArray(e._context._us._projection,this.projection_matrix),this.calculateEncodedCameraPositionMCHighLow(this.encodedCamPosMC_High,this.encodedCamPosMC_Low,r);var a;this.detailed_building&&i&&(a=this.shadersManager.getMagoShader(0)),t.enable(t.DEPTH_TEST),t.depthFunc(t.LEQUAL),t.depthRange(0,1);var s;this.isCameraMoved(r,10);var n=e._context._us._modelView,l=new Cesium.Matrix4;l=Cesium.Matrix4.inverseTransformation(n,l),this.normalMat4=Cesium.Matrix4.transpose(l,this.normalMat4),this.normalMat3=Cesium.Matrix4.getRotation(this.normalMat4,this.normalMat3),Cesium.Matrix3.toArray(this.normalMat3,this.normalMat3_array),Cesium.Matrix4.toArray(this.normalMat4,this.normalMat4_array),this.render_time=0,this.isCameraMoving&&(this.dateSC=new Date,this.currentTimeSC,this.startTimeSC=this.dateSC.getTime()),this.currentVisibleBuildingsPost_array.length=0;var d="",u=e._camera,h=u.frustum,c=e._context._us._currentFrustum.y;c=5e3,this.depthFbo.bind(),t.clearColor(0,0,0,1),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),t.viewport(0,0,this.depthFbo.width,this.depthFbo.height),a=this.postFxShadersManager.pFx_shaders_array[0],s=a.program,t.useProgram(s),t.enableVertexAttribArray(a.position3_loc),t.enableVertexAttribArray(a.normal3_loc),t.uniformMatrix4fv(a.modelViewProjectionMatrix4RelToEye_loc,!1,this.modelViewProjRelToEye_matrix),t.uniformMatrix4fv(a.modelViewMatrix4RelToEye_loc,!1,this.modelViewRelToEye_matrix),t.uniformMatrix4fv(a.modelViewMatrix4_loc,!1,this.modelView_matrix),t.uniformMatrix4fv(a.projectionMatrix4_loc,!1,this.projection_matrix),t.uniform3fv(a.cameraPosHIGH_loc,this.encodedCamPosMC_High),t.uniform3fv(a.cameraPosLOW_loc,this.encodedCamPosMC_Low),t.uniform1f(a.near_loc,h._near),t.uniform1f(a.far_loc,c),t.uniformMatrix3fv(a.normalMatrix3_loc,!1,this.normalMat3_array),t.uniformMatrix4fv(a.normalMatrix4_loc,!1,this.normalMat4_array);for(var f=this.currentVisibleBuildings_LOD0_array.length,m=0;m<f;m++){var g=this.currentVisibleBuildings_LOD0_array[m];if(2==g._header._f4d_version){var _=g._simpleBuilding_v1._simpleObjects_array[0];if(null==_._vtCacheKeys_container._vtArrays_cacheKeys_array[0]._verticesArray_cacheKey){this.createFirstTimeVBOCacheKeys(t,g);continue}if(!g._f4d_nailImage_readed){if(this.backGround_imageReadings_count<100){this.backGround_imageReadings_count++,g._f4d_nailImage_readed=!0;var b=g._simpleBuilding_v1;this.readerWriter.readNailImageOfArrayBuffer(t,b.textureArrayBuffer,g,this.readerWriter,this,3)}continue}!g._f4d_lod0Image_readed&&g._f4d_nailImage_readed_finished&&g._f4d_lod0Image_exists&&!this.isCameraMoving&&this.backGround_fileReadings_count<1&&(d=this.readerWriter.geometryDataPath+Constant.RESULT_XDO2F4D+g._header._global_unique_id+".jpg",this.readerWriter.readNailImage(t,d,g,this.readerWriter,this,0),this.backGround_fileReadings_count++)}else this.currentVisibleBuildingsPost_array.push(g);g._simpleBuilding_v1&&this.renderer.renderSimpleBuildingV1PostFxShader(t,g,this,-1,a)}for(var C=this.currentVisibleBuildings_array.length,x=0;x<C;x++){var g=this.currentVisibleBuildings_array[x];if(2==g._header._f4d_version){var _=g._simpleBuilding_v1._simpleObjects_array[0];if(null==_._vtCacheKeys_container._vtArrays_cacheKeys_array[0]._verticesArray_cacheKey){this.createFirstTimeVBOCacheKeys(t,g);continue}if(!g._f4d_nailImage_readed){if(this.backGround_imageReadings_count<100){this.backGround_imageReadings_count++,g._f4d_nailImage_readed=!0;var b=g._simpleBuilding_v1;this.readerWriter.readNailImageOfArrayBuffer(t,b.textureArrayBuffer,g,this.readerWriter,this,3)}continue}}else this.currentVisibleBuildingsPost_array.push(g);g._simpleBuilding_v1&&g._f4d_nailImage_readed_finished&&this.renderer.renderSimpleBuildingV1PostFxShader(t,g,this,-1,a)}t.disableVertexAttribArray(a.position3_loc),t.disableVertexAttribArray(a.normal3_loc),this.depthFbo.unbind(),e._context._currentFramebuffer._bind(),this.depthFbo.width==e.drawingBufferWidth&&this.depthFbo.height==e.drawingBufferHeight||(this.depthFbo=new FBO(t,e.drawingBufferWidth,e.drawingBufferHeight)),t.clearColor(0,0,0,1),t.viewport(0,0,e.drawingBufferWidth,e.drawingBufferHeight),void 0==this.noiseTexture&&(this.noiseTexture=genNoiseTextureRGBA(t,4,4,this.pixels)),a=this.postFxShadersManager.pFx_shaders_array[1],s=a.program,t.useProgram(s),t.enableVertexAttribArray(a.texCoord2_loc),t.enableVertexAttribArray(a.position3_loc),t.enableVertexAttribArray(a.normal3_loc),t.uniformMatrix4fv(a.modelViewProjectionMatrix4RelToEye_loc,!1,this.modelViewProjRelToEye_matrix),t.uniform3fv(a.cameraPosHIGH_loc,this.encodedCamPosMC_High),t.uniform3fv(a.cameraPosLOW_loc,this.encodedCamPosMC_Low),t.uniformMatrix4fv(a.projectionMatrix4_loc,!1,this.projection_matrix),t.uniformMatrix4fv(a.modelViewMatrix4_loc,!1,this.modelView_matrix),t.uniform1f(a.near_loc,h._near),t.uniform1f(a.far_loc,c),t.uniformMatrix3fv(a.normalMatrix3_loc,!1,this.normalMat3_array),t.uniformMatrix4fv(a.normalMatrix4_loc,!1,this.normalMat4_array),t.uniform1i(a.depthTex_loc,0),t.uniform1i(a.noiseTex_loc,1),t.uniform1i(a.diffuseTex_loc,2),t.uniform1f(a.fov_loc,h._fovy),t.uniform1f(a.aspectRatio_loc,h._aspectRatio),t.uniform1f(a.screenWidth_loc,e.drawingBufferWidth),t.uniform1f(a.screenHeight_loc,e.drawingBufferHeight),t.uniform2fv(a.noiseScale2_loc,[this.depthFbo.width/this.noiseTexture.width,this.depthFbo.height/this.noiseTexture.height]),t.uniform3fv(a.kernel16_loc,this.kernel),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,this.depthFbo.colorBuffer),t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,this.noiseTexture);for(var f=this.currentVisibleBuildings_LOD0_array.length,m=0;m<f;m++){var g=this.currentVisibleBuildings_LOD0_array[m];if(2==g._header._f4d_version){var _=g._simpleBuilding_v1._simpleObjects_array[0];if(null==_._vtCacheKeys_container._vtArrays_cacheKeys_array[0]._verticesArray_cacheKey){this.createFirstTimeVBOCacheKeys(t,g);continue}if(!g._f4d_nailImage_readed){if(this.backGround_imageReadings_count<100){this.backGround_imageReadings_count++,g._f4d_nailImage_readed=!0;var b=g._simpleBuilding_v1;this.readerWriter.readNailImageOfArrayBuffer(t,b.textureArrayBuffer,g,this.readerWriter,this,3)}continue}!g._f4d_lod0Image_readed&&g._f4d_nailImage_readed_finished&&g._f4d_lod0Image_exists&&!this.isCameraMoving&&this.backGround_fileReadings_count<1&&(d=this.readerWriter.geometryDataPath+Constant.RESULT_XDO2F4D+g._header._global_unique_id+".jpg",this.readerWriter.readNailImage(t,d,g,this.readerWriter,this,0),this.backGround_fileReadings_count++)}else this.currentVisibleBuildingsPost_array.push(g);g._simpleBuilding_v1&&(g._f4d_lod0Image_exists&&g._f4d_lod0Image_readed_finished?this.renderer.renderSimpleBuildingV1PostFxShader(t,g,this,0,a):g._f4d_nailImage_readed_finished&&this.renderer.renderSimpleBuildingV1PostFxShader(t,g,this,3,a))}for(var C=this.currentVisibleBuildings_array.length,x=0;x<C;x++){var g=this.currentVisibleBuildings_array[x];if(2==g._header._f4d_version){var _=g._simpleBuilding_v1._simpleObjects_array[0];if(null==_._vtCacheKeys_container._vtArrays_cacheKeys_array[0]._verticesArray_cacheKey){this.createFirstTimeVBOCacheKeys(t,g);continue}if(!g._f4d_nailImage_readed){if(this.backGround_imageReadings_count<100){this.backGround_imageReadings_count++,g._f4d_nailImage_readed=!0;var b=g._simpleBuilding_v1;this.readerWriter.readNailImageOfArrayBuffer(t,b.textureArrayBuffer,g,this.readerWriter,this,3)}continue}}else this.currentVisibleBuildingsPost_array.push(g);g._simpleBuilding_v1&&g._f4d_nailImage_readed_finished&&this.renderer.renderSimpleBuildingV1PostFxShader(t,g,this,3,a)}t.activeTexture(t.TEXTURE0),t.disableVertexAttribArray(a.texCoord2_loc),t.disableVertexAttribArray(a.position3_loc),t.disableVertexAttribArray(a.normal3_loc),t.viewport(0,0,e._canvas.width,e._canvas.height),e._context._currentFramebuffer._bind();for(var v=this.currentVisibleBuildingsPost_array.length,m=0;m<v;m++)this.renderer.render_F4D_simpleBuilding(t,this.currentVisibleBuildingsPost_array[m],this.modelViewProjRelToEye_matrix,this.encodedCamPosMC_High,this.encodedCamPosMC_Low,this.shadersManager);t.bindBuffer(t.ARRAY_BUFFER,null),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)}},CesiumManager.prototype.deleteNeoBuilding=function(e,i){i==this.buildingSelected&&(this.buildingSelected=void 0,this.octreeSelected=void 0,this.objectSelected=void 0),i.metaData.fileLoadState=CODE.fileLoadState.READY,i._blocksList_Container&&i._blocksList_Container.blocksListsArray.length>0&&(i._blocksList_Container.blocksListsArray[0].deleteGlObjects(e),i._blocksList_Container.blocksListsArray[0]=void 0,i._blocksList_Container.blocksListsArray=void 0),i._blocksList_Container=void 0;for(var t=i.motherBlocksArray.length,r=0;r<t;r++)i.motherBlocksArray[r]&&i.motherBlocksArray[r].deleteObjects(e),i.motherBlocksArray[r]=void 0;i.motherBlocksArray=[];for(var o=i.motherNeoReferencesArray.length,r=0;r<o;r++)i.motherNeoReferencesArray[r]&&i.motherNeoReferencesArray[r].deleteGlObjects(e),i.motherNeoReferencesArray[r]=void 0;i.motherNeoReferencesArray=[],void 0!=i.octree&&i.octree.deleteGlObjects(e),i.octree=void 0,i.octreeLoadedAllFiles=!1,i.allFilesLoaded=!1,i.isReadyToRender=!1,i.neoSimpleBuilding=void 0,i.lod2Building=void 0,i.lod3Building=void 0},CesiumManager.prototype.doFrustumCullingNeoBuildings=function(e,i,t){i.length=0;var r;this.detailed_neoBuilding;var o=1e4,a=1,s=1e9,n=9e5;this.visibleObjControlerBuildings.currentVisibles0.length=0,this.visibleObjControlerBuildings.currentVisibles1.length=0,this.visibleObjControlerBuildings.currentVisibles2.length=0,this.visibleObjControlerBuildings.currentVisibles3.length=0,this.visibleObjControlerBuildings.initArrays();for(var l=100,d=0,u=this.neoBuildingsList.neoBuildingsArray.length,h=0;h<u;h++){var c=this.neoBuildingsList.neoBuildingsArray[h];if((2!=this.renderingModeTemp||0!=c.isDemoBlock)&&(this.magoPolicy.getShowOutFitting()||"outfitting"!=c.buildingType))if(void 0!=c.bbox){this.pointSC=c.bbox.getCenterPoint3d(this.pointSC);var f=void 0,m=c.geoLocDataManager.getGeoLocationData(0);if(void 0!=m&&(f=m.pivotPoint,void 0!=f)){if("basicBuilding"==c.buildingType){o=5e4}if(r=Cesium.Cartesian3.distanceSquared(t,f),r>this.magoPolicy.getFrustumFarSquaredDistance())this.deleteNeoBuilding(this.scene._context._gl,c);else{this.boundingSphere_Aux.center=Cesium.Cartesian3.clone(f),0==this.renderingModeTemp?this.radiusAprox_aux=1.2*(c.bbox.maxX-c.bbox.minX)/2:1==this.renderingModeTemp?this.radiusAprox_aux=5.2*(c.bbox.maxX-c.bbox.minX)/2:2==this.renderingModeTemp&&(this.radiusAprox_aux=1.2*(c.bbox.maxX-c.bbox.minX)/2),this.radiusAprox_aux?this.boundingSphere_Aux.radius=this.radiusAprox_aux:this.boundingSphere_Aux.radius=50;var g=e.computeVisibility(this.boundingSphere_Aux);g!=Cesium.Intersect.OUTSIDE?this.isLastFrustum&&r<o?this.visibleObjControlerBuildings.currentVisibles0.push(c):r<a?this.visibleObjControlerBuildings.currentVisibles1.push(c):r<s?this.visibleObjControlerBuildings.currentVisibles2.push(c):r<n&&this.visibleObjControlerBuildings.currentVisibles3.push(c):this.deleteNeoBuilding(this.scene._context._gl,c)}}}else d<l&&(this.visibleObjControlerBuildings.currentVisibles0.push(c),d++)}return i},CesiumManager.prototype.doFrustumCullingNeoBuildings_OLD=function(e,i,t){i.length=0;var r;this.detailed_neoBuilding;var o=1e4,a=1,s=1e9,n=9e5;this.visibleObjControlerBuildings.currentVisibles0.length=0,this.visibleObjControlerBuildings.currentVisibles1.length=0,this.visibleObjControlerBuildings.currentVisibles2.length=0,this.visibleObjControlerBuildings.currentVisibles3.length=0,this.visibleObjControlerBuildings.initArrays();for(var l=0,d=0,u=0,h=4e3,c=0,f=this.neoBuildingsList.neoBuildingsArray.length,m=0;m<f;m++){var g=this.neoBuildingsList.neoBuildingsArray[m];if((0!=this.renderingModeTemp&&1!=this.renderingModeTemp||!g.isDemoBlock)&&(2!=this.renderingModeTemp||0!=g.isDemoBlock)&&(this.magoPolicy.getShowOutFitting()||"outfitting"!=g.buildingType))if(void 0!=g.buildingPosition)if(void 0!=g.bbox){this.pointSC=g.bbox.getCenterPoint3d(this.pointSC);var _=void 0;if(0==this.renderingModeTemp&&(_=g.transfMat.transformPoint3D(this.pointSC,_)),1==this.renderingModeTemp||2==this.renderingModeTemp)if(void 0==g.geoLocationDataAux){var b;if(b="outfitting"==g.buildingType?this.neoBuildingsList.getNeoBuildingByTypeId("structure",g.buildingId):g,void 0==b)continue;if(void 0==b.bbox)continue;if("testId_P320T"==g.buildingId);this.pointSC_2=b.bbox.getCenterPoint3d(this.pointSC_2),this.pointSC_2.x=-this.pointSC_2.x,this.pointSC_2.y=-this.pointSC_2.y,this.pointSC_2.z=-this.pointSC_2.z;var C;1==this.renderingModeTemp?C=MagoConfig.getInformation().blockConfig.blocks:2==this.renderingModeTemp&&(C=MagoConfig.getInformation().demoBlockConfig.blocks);var x=C[g.buildingId];if(x){var v,y,A,l,u;b.geoLocationDataAux?(v=b.geoLocationDataAux.longitude,y=b.geoLocationDataAux.latitude,A=b.geoLocationDataAux.elevation,l=b.geoLocationDataAux.heading,d=b.geoLocationDataAux.pitch,u=b.geoLocationDataAux.roll):(v=x.LONGITUDE,y=x.LATITUDE,A=x.ELEVATION,l=x.HEADING,d=x.PITCH,u=x.ROLL),this.changeLocationAndRotation(g.buildingId,y,v,A,l,d,u)}else this.pointSC=g.bbox.getCenterPoint3d(this.pointSC),_=g.transfMat.transformPoint3D(this.pointSC,_)}else _=g.geoLocationDataAux.pivotPoint;else this.pointSC=g.bbox.getCenterPoint3d(this.pointSC),_=g.transfMat.transformPoint3D(this.pointSC,_);if(void 0!=_)if(r=Cesium.Cartesian3.distanceSquared(t,_),r>this.magoPolicy.getFrustumFarSquaredDistance())this.deleteNeoBuilding(this.scene._context._gl,g);else{this.boundingSphere_Aux.center=Cesium.Cartesian3.clone(_),0==this.renderingModeTemp?this.radiusAprox_aux=1.2*(g.bbox.maxX-g.bbox.minX)/2:1==this.renderingModeTemp?this.radiusAprox_aux=5.2*(g.bbox.maxX-g.bbox.minX)/2:2==this.renderingModeTemp&&(this.radiusAprox_aux=1.2*(g.bbox.maxX-g.bbox.minX)/2),this.radiusAprox_aux?this.boundingSphere_Aux.radius=this.radiusAprox_aux:this.boundingSphere_Aux.radius=50;var M=e.computeVisibility(this.boundingSphere_Aux);M!=Cesium.Intersect.OUTSIDE?this.isLastFrustum&&r<o?this.visibleObjControlerBuildings.currentVisibles0.push(g):r<a?this.visibleObjControlerBuildings.currentVisibles1.push(g):r<s?this.visibleObjControlerBuildings.currentVisibles2.push(g):r<n&&this.visibleObjControlerBuildings.currentVisibles3.push(g):0==this.renderingModeTemp&&this.deleteNeoBuilding(this.scene._context._gl,g)}}else this.visibleObjControlerBuildings.currentVisibles0.push(g);else{if(c<h&&void 0!=g.metaData){var v=g.metaData.longitude,y=g.metaData.latitude,p=g.metaData.altitude;if(void 0!=v&&void 0!=y&&void 0!=p){if("F140T"==g.buildingId);var R=Cesium.Cartesian3.fromDegrees(v,y,p-500);g.buildingPosition=R;var S=(Cesium.EncodedCartesian3.encode(R),Cesium.EncodedCartesian3.encode(R.x)),T=Cesium.EncodedCartesian3.encode(R.y),B=Cesium.EncodedCartesian3.encode(R.z);g.buildingPositionHIGH=new Float32Array([S.high,T.high,B.high]),g.buildingPositionLOW=new Float32Array([S.low,T.low,B.low]),c+=1}void 0==g.move_matrix&&(ManagerUtils.calculateBuildingPositionMatrix(g),c+=1)}this.visibleObjControlerBuildings.currentVisibles0.push(g)}}return i},CesiumManager.prototype.flyToBuilding=function(e,i){var t=this.getNeoBuildingById(e,i);if(void 0!=t){var r;if(1==this.renderingModeTemp||2==this.renderingModeTemp)if(void 0==t.geoLocationDataAux){var o=MagoConfig.getInformation().blockConfig.blocks,a=o[t.buildingId];a?(t.geoLocationDataAux=ManagerUtils.calculateGeoLocationData(a.LONGITUDE,a.LATITUDE,a.ELEVATION,heading,pitch,roll,t.geoLocationDataAux),this.pointSC=t.bbox.getCenterPoint3d(this.pointSC),r=t.geoLocationDataAux.pivotPoint):(this.pointSC=t.bbox.getCenterPoint3d(this.pointSC),r=t.transfMat.transformPoint3D(this.pointSC,r))}else this.pointSC=t.bbox.getCenterPoint3d(this.pointSC),r=t.geoLocationDataAux.pivotPoint;else{var s=t.geoLocDataManager.getGeoLocationData(0);this.pointSC=t.bbox.getCenterPoint3d(this.pointSC),r=s.tMatrix.transformPoint3D(this.pointSC,r)}if(void 0!=r){this.boundingSphere_Aux.center=Cesium.Cartesian3.clone(r),0==this.renderingModeTemp&&(this.radiusAprox_aux=1.2*(t.bbox.maxX-t.bbox.minX)/2),1==this.renderingModeTemp&&(this.radiusAprox_aux=1.2*(t.bbox.maxX-t.bbox.minX)/2),2==this.renderingModeTemp&&(this.radiusAprox_aux=1.2*(t.bbox.maxX-t.bbox.minX)/2),this.boundingSphere_Aux.radius=this.radiusAprox_aux;var n=(this.scene.viewer,3);this.scene.camera.flyToBoundingSphere(this.boundingSphere_Aux,n)}}},CesiumManager.prototype.getNeoBuildingById=function(e,i){for(var t,r=this.neoBuildingsList.neoBuildingsArray.length,o=!1,a=0;!o&&a<r;)this.neoBuildingsList.neoBuildingsArray[a].buildingId==i&&this.neoBuildingsList.neoBuildingsArray[a].buildingType==e&&(o=!0,t=this.neoBuildingsList.neoBuildingsArray[a]),a++;return t},CesiumManager.prototype.doFrustumCullingTerranTileServiceFormat=function(e,i,t,r){var o,a,s;this.filteredVisibleTiles_array.length=0,this.detailedVisibleTiles_array.length=0,this.LOD0VisibleTiles_array.length=0;var n,l=10;this.currentVisible_terranTiles_array.length=0,this.terranTile.getIntersectedSmallestTiles(i,this.currentVisible_terranTiles_array,this.boundingSphere_Aux);var d=this.currentVisible_terranTiles_array.length;if(0!=d){for(var u=0;u<d;u++)this.terranTileSC=this.currentVisible_terranTiles_array[u],o=Cesium.Cartesian3.distanceSquared(r,this.terranTileSC.position),o>this.min_squaredDist_to_see||(o<1.2*this.min_squaredDist_to_see_detailed?this.detailedVisibleTiles_array.push(this.terranTileSC):o<1.2*this.min_squaredDist_to_see_LOD0?this.LOD0VisibleTiles_array.push(this.terranTileSC):this.filteredVisibleTiles_array.push(this.terranTileSC));this.boundingSphere_Aux.radius=50;for(var h,c,f=!1,m=this.detailedVisibleTiles_array.length,u=0;u<m;u++)if(this.terranTileSC=this.detailedVisibleTiles_array[u],this.terranTileSC.fileReading_started){this.terranTileSC.fileReading_finished&&!this.terranTileSC.fileParsingFinished&&this.terranTileSC.parseFileAllBuildings(this),f=!1,this.terranTileSC.visibilityType==Cesium.Intersect.INTERSECTING&&(f=!0),s=this.terranTileSC._BR_buildingsArray.length;for(var g=0;g<s;g++)n=this.detailedVisibleTiles_array[u]._BR_buildingsArray[g],void 0!=n.buildingPosition?(o=Cesium.Cartesian3.distanceSquared(r,n.buildingPosition),o<this.min_squaredDist_to_see_detailed?n._compRefList_Container.compRefsListArray.length>0?1==n._header._f4d_version&&(a?o<a?(a=o,this.currentVisibleBuildings_LOD0_array.push(this.detailed_building),this.detailed_building=n):this.currentVisibleBuildings_LOD0_array.push(n):(a=o,this.detailed_building=n)):n._header.isSmall?t.push(n):this.currentVisibleBuildings_LOD0_array.push(n):o<this.min_squaredDist_to_see_LOD0?f?(this.boundingSphere_Aux.center=Cesium.Cartesian3.clone(n.buildingPosition),f&&i.computeVisibility(this.boundingSphere_Aux)!=Cesium.Intersect.OUTSIDE&&this.currentVisibleBuildings_LOD0_array.push(n)):this.currentVisibleBuildings_LOD0_array.push(n):f?(this.boundingSphere_Aux.center=Cesium.Cartesian3.clone(n.buildingPosition),f&&i.computeVisibility(this.boundingSphere_Aux)!=Cesium.Intersect.OUTSIDE&&t.push(n)):t.push(n)):this.currentVisibleBuildings_LOD0_array.push(n);
}else this.backGround_fileReadings_count<l&&(c=this.terranTileSC._numberName.toString(),h=this.readerWriter.geometryDataPath+Constant.RESULT_XDO2F4D_TERRAINTILES+c+".til",this.readerWriter.getTileArrayBuffer(e,h,this.terranTileSC,this.readerWriter,this),this.backGround_fileReadings_count++);for(var _=this.LOD0VisibleTiles_array.length,u=0;u<_;u++)if(this.terranTileSC=this.LOD0VisibleTiles_array[u],this.terranTileSC.fileReading_started){this.terranTileSC.fileReading_finished&&!this.terranTileSC.fileParsingFinished&&this.terranTileSC.parseFileAllBuildings(this),f=!1,this.terranTileSC.visibilityType==Cesium.Intersect.INTERSECTING&&(f=!0),s=this.terranTileSC._BR_buildingsArray.length;for(var g=0;g<s;g++)n=this.LOD0VisibleTiles_array[u]._BR_buildingsArray[g],void 0!=n.buildingPosition?(o=Cesium.Cartesian3.distanceSquared(r,n.buildingPosition),o<this.min_squaredDist_to_see_LOD0?f?(this.boundingSphere_Aux.center=Cesium.Cartesian3.clone(n.buildingPosition),i.computeVisibility(this.boundingSphere_Aux)!=Cesium.Intersect.OUTSIDE&&this.currentVisibleBuildings_LOD0_array.push(n)):this.currentVisibleBuildings_LOD0_array.push(n):f?(this.boundingSphere_Aux.center=Cesium.Cartesian3.clone(n.buildingPosition),i.computeVisibility(this.boundingSphere_Aux)!=Cesium.Intersect.OUTSIDE&&t.push(n)):t.push(n)):t.push(n)}else this.backGround_fileReadings_count<l&&(c=this.terranTileSC._numberName.toString(),h=this.readerWriter.geometryDataPath+Constant.RESULT_XDO2F4D_TERRAINTILES+c+".til",this.readerWriter.getTileArrayBuffer(e,h,this.terranTileSC,this.readerWriter,this),this.backGround_fileReadings_count++);for(var b=this.filteredVisibleTiles_array.length,u=0;u<b;u++)if(this.terranTileSC=this.filteredVisibleTiles_array[u],this.terranTileSC.fileReading_started){this.terranTileSC.fileReading_finished&&!this.terranTileSC.fileParsingFinished&&this.terranTileSC.parseFileAllBuildings(this),f=!1,this.terranTileSC.visibilityType==Cesium.Intersect.INTERSECTING&&(f=!0),s=this.terranTileSC._BR_buildingsArray.length;for(var g=0;g<s;g++)n=this.filteredVisibleTiles_array[u]._BR_buildingsArray[g],void 0!=n.buildingPosition?(o=Cesium.Cartesian3.distanceSquared(r,n.buildingPosition),n._header.isSmall?o<this.min_squaredDist_to_see_smallBuildings&&(f?(this.boundingSphere_Aux.center=Cesium.Cartesian3.clone(n.buildingPosition),i.computeVisibility(this.boundingSphere_Aux)!=Cesium.Intersect.OUTSIDE&&t.push(n)):t.push(n)):o<this.min_squaredDist_to_see_LOD0?f?(this.boundingSphere_Aux.center=Cesium.Cartesian3.clone(n.buildingPosition),i.computeVisibility(this.boundingSphere_Aux)!=Cesium.Intersect.OUTSIDE&&this.currentVisibleBuildings_LOD0_array.push(n)):this.currentVisibleBuildings_LOD0_array.push(n):f?(this.boundingSphere_Aux.center=Cesium.Cartesian3.clone(n.buildingPosition),i.computeVisibility(this.boundingSphere_Aux)!=Cesium.Intersect.OUTSIDE&&t.push(n)):t.push(n)):t.push(n)}else this.backGround_fileReadings_count<l&&(c=this.terranTileSC._numberName.toString(),h=this.readerWriter.geometryDataPath+Constant.RESULT_XDO2F4D_TERRAINTILES+c+".til",this.readerWriter.getTileArrayBuffer(e,h,this.terranTileSC,this.readerWriter,this),this.backGround_fileReadings_count++);return t}},CesiumManager.prototype.doFrustumCullingClouds=function(e,i,t){this.currentVisibleClouds_array.length=0;for(var r=this.atmosphere.cloudsManager.circularCloudsArray.length,o=0;o<r;o++){var a=this.atmosphere.cloudsManager.circularCloudsArray[o];if(void 0!=a.cullingPosition){this.boundingSphere_Aux.center=Cesium.Cartesian3.clone(a.cullingPosition),this.radiusAprox_aux=a.cullingRadius,this.radiusAprox_aux?this.boundingSphere_Aux.radius=this.radiusAprox_aux:this.boundingSphere_Aux.radius=50;var s=e.computeVisibility(this.boundingSphere_Aux);s!==Cesium.Intersect.OUTSIDE&&this.currentVisibleClouds_array.push(a)}}return i},CesiumManager.prototype.highLightBuildings=function(){for(var e=this.neoBuildingsList.neoBuildingsArray.length,i=0;i<e;i++)this.neoBuildingsList.neoBuildingsArray[i].isHighLighted=!1;for(var t="structure",r=this.magoPolicy.highLightedBuildings.length,i=0;i<r;i++){var o=this.magoPolicy.highLightedBuildings[i],a=this.neoBuildingsList.getNeoBuildingByTypeId(t,o.projectId+"_"+o.blockId);a&&(a.isHighLighted=!0)}},CesiumManager.prototype.renderModeChanged=function(){0==this.renderModeTemp||1==this.renderModeTemp||2==this.renderModeTemp},CesiumManager.prototype.buildingColorChanged=function(e,i){var t=this.getNeoBuildingById("structure",e);t&&(void 0==t.aditionalColor&&(t.aditionalColor=new Color),t.isColorChanged=!0,t.aditionalColor.setRGB(i[0],i[1],i[2]))},CesiumManager.prototype.objectColorChanged=function(e,i,t){var r=this.getNeoBuildingById("structure",e);if(r){for(var o,a=r.motherNeoReferencesArray.length,s=!1,n=0;!s&&n<a;)r.motherNeoReferencesArray[n]&&r.motherNeoReferencesArray[n].objectId==i&&(o=r.motherNeoReferencesArray[n],s=!0),n++;o&&(void 0==o.aditionalColor&&(o.aditionalColor=new Color),o.aditionalColor.setRGB(t[0],t[1],t[2]))}},CesiumManager.prototype.policyColorChanged=function(e,i){for(var t=this.getNeoBuildingById("structure",e),r=this.neoBuildingsList.neoBuildingsArray.length,o=0;o<r;o++)this.neoBuildingsList.neoBuildingsArray[o].isColorChanged=!1;t.isColorChanged=!0,this.magoPolicy.colorChangedObjectId=i},CesiumManager.prototype.displayLocationAndRotation=function(e){var i,t,r,o,a,s,n=e.geoLocDataManager.geoLocationDataArray[0];i=n.geographicCoord.latitude,t=n.geographicCoord.longitude,r=n.geographicCoord.altitude,o=n.heading,a=n.pitch,s=n.roll;var l=e.buildingId.split("_");showLocationAndRotationAPI(l[0],l[1],null,n.geographicCoord.latitude,n.geographicCoord.longitude,n.geographicCoord.altitude,n.heading,n.pitch,n.roll)},CesiumManager.prototype.selectedObjectNotice=function(e){var i,t,r,o,a,s,n=e.geoLocDataManager.geoLocationDataArray[0];i=n.geographicCoord.latitude,t=n.geographicCoord.longitude,r=n.geographicCoord.altitude,o=n.heading,a=n.pitch,s=n.roll;var l=e.buildingId.split("_");if(MagoConfig.getInformation().callbackConfig.enable){var d=null;void 0!=this.objectSelected&&(d=this.objectSelected.objectId),selectedObjectCallback(MagoConfig.getInformation().callbackConfig.selectedObject,l[0],l[1],d,n.geographicCoord.latitude,n.geographicCoord.longitude,n.geographicCoord.altitude,n.heading,n.pitch,n.roll)}},CesiumManager.prototype.changeLocationAndRotation=function(e,i,t,r,o,a,s){var n=this.getNeoBuildingById("structure",e);if(void 0!=n){var l=n.geoLocDataManager.geoLocationDataArray[0];if(l=ManagerUtils.calculateGeoLocationData(t,i,r,o,a,s,l),void 0!=l){this.pointSC=n.bbox.getCenterPoint3d(this.pointSC),ManagerUtils.translatePivotPointGeoLocationData(l,this.pointSC),n.octree&&n.octree.multiplyKeyTransformMatrix(0,l.rotMatrix);var d=this.getNeoBuildingById("outfitting",e);void 0!=d&&(l=d.geoLocDataManager.geoLocationDataArray[0],l=ManagerUtils.calculateGeoLocationData(t,i,r,o,a,s,l),void 0!=l&&(this.pointSC=n.bbox.getCenterPoint3d(this.pointSC),ManagerUtils.translatePivotPointGeoLocationData(l,this.pointSC),d.octree&&d.octree.multiplyKeyTransformMatrix(0,l.rotMatrix)))}}},CesiumManager.prototype.createDeploymentGeoLocationsForHeavyIndustries=function(){for(var e,i,t,r,o=MagoConfig.getInformation().blockConfig.blocks,a=this.neoBuildingsList.neoBuildingsArray.length,s=0;s<a;s++){if(e=this.neoBuildingsList.neoBuildingsArray[s],526==s);if(t="outfitting"==e.buildingType?this.neoBuildingsList.getNeoBuildingByTypeId("structure",e.buildingId):e,void 0!=t&&void 0!=t.bbox){i=o[e.buildingId];var n,l,d,u,h,c;if("gangnam_del"==e.buildingId);if(i)n=i.LONGITUDE,l=i.LATITUDE,d=i.ELEVATION,u=i.HEADING,h=i.PITCH,c=i.ROLL,r=e.geoLocDataManager.newGeoLocationData("deploymentLoc"),ManagerUtils.calculateGeoLocationData(n,l,d,u,h,c,r),this.pointSC=t.bbox.getCenterPoint3d(this.pointSC),ManagerUtils.translatePivotPointGeoLocationData(r,this.pointSC);else;}}},CesiumManager.prototype.getObjectIndexFile=function(){this.readerWriter.getObjectIndexFile(this.scene.context._gl,this.readerWriter.geometryDataPath+Constant.OBJECT_INDEX_FILE,this.readerWriter,this.neoBuildingsList,this)},CesiumManager.prototype.callAPI=function(e){var i=e.getAPIName();if("changeMagoState"===i)this.magoPolicy.setMagoEnable(e.getMagoEnable());else if("changeRender"===i)this.renderingModeTemp=e.getRenderMode();else if("searchBlock"===i)this.flyToBuilding(e.getBlockType(),e.getProjectId()+"_"+e.getBlockId());else if("changeHighLighting"===i){this.magoPolicy.highLightedBuildings.length=0;var t=e.getProjectId(),r=e.getBlockIds().split(","),o=null,a=!1;null!=e.getObjectIds()&&0!=e.getObjectIds().length&&(o=e.getObjectIds().split(","),a=!0);for(var s=[],n=0,l=r.length;n<l;n++){var d=new ProjectLayer;d.setProjectId(t),d.setBlockId(r[n].trim()),a?d.setObjectId(o[n].trim()):d.setObjectId(null),s.push(d)}this.magoPolicy.setHighLightedBuildings(s),this.highLightBuildings()}else if("changeColor"===i){this.magoPolicy.colorBuildings.length=0;var t=e.getProjectId(),r=e.getBlockIds().split(","),o=null,a=!1;null!=e.getObjectIds()&&0!=e.getObjectIds().length&&(o=e.getObjectIds().split(","),a=!0);for(var u=[],n=0,l=r.length;n<l;n++)if(a)for(var h=0,c=o.length;h<c;h++){var d=new ProjectLayer;d.setProjectId(t),d.setBlockId(r[n].trim()),d.setObjectId(o[h].trim()),u.push(d)}else{var d=new ProjectLayer;d.setProjectId(t),d.setBlockId(r[n].trim()),d.setObjectId(null),u.push(d)}this.magoPolicy.setColorBuildings(u);var f=e.getColor().split(","),m=[f[0]/255,f[1]/255,f[2]/255];this.magoPolicy.setColor(m);for(var g=u.length,n=0;n<g;n++){var _=u[n].projectId+"_"+u[n].blockId;null==u[n].objectId?this.buildingColorChanged(_,m):this.objectColorChanged(_,u[n].objectId,m)}}else if("show"===i)this.magoPolicy.setHideBuildings.length=0;else if("hide"===i)this.magoPolicy.setHideBuildings(e.gethideBuilds());else if("move"===i);else if("changeOutFitting"===i)this.magoPolicy.setShowOutFitting(e.getShowOutFitting());else if("changeBoundingBox"===i)this.magoPolicy.setShowBoundingBox(e.getShowBoundingBox());else if("changeShadow"===i)this.magoPolicy.setShowShadow(e.getShowShadow());else if("changefrustumFarDistance"===i)this.magoPolicy.setFrustumFarSquaredDistance(e.getFrustumFarDistance()*e.getFrustumFarDistance());else if("changeLocationAndRotation"===i){var b=e.getProjectId()+"_"+e.getBlockId(),C="structure";this.neoBuildingsList.getNeoBuildingByTypeId(C,b);this.changeLocationAndRotation(e.getProjectId()+"_"+e.getBlockId(),parseFloat(e.getLatitude()),parseFloat(e.getLongitude()),parseFloat(e.getElevation()),parseFloat(e.getHeading()),parseFloat(e.getPitch()),parseFloat(e.getRoll()))}else{if("getLocationAndRotation"===i)return this.neoBuildingsList.getNeoBuildingByTypeId("structure",e.getProjectId()+"_"+e.getBlockId());"changeMouseMove"===i&&this.magoPolicy.setMouseMoveMode(e.getMouseMoveMode())}};
"use strict";var CODE={};CODE.fileLoadState={READY:0,LOADING_STARTED:1,LOADING_FINISHED:2,PARSE_STARTED:3,PARSE_FINISHED:4};
"use strict";var Color=function(){if(!(this instanceof Color))throw new Error(Messages.CONSTRUCT_ERROR);this.r=0,this.g=0,this.b=0,this.a=1};Color.prototype.set=function(t,s,i,o){this.r=t,this.g=s,this.b=i,this.a=o},Color.prototype.setRGB=function(t,s,i){this.r=t,this.g=s,this.b=i},Color.prototype.setRGBA=function(t,s,i,o){this.r=t,this.g=s,this.b=i,this.a=o};
"use strict";var MagoConfig=MagoConfig||{};MagoConfig.getInformation=function(){return this.jsonConfig},MagoConfig.init=function(i,n){this.jsonConfig=i,MagoConfig.backgroundProvider(i),MagoConfig.initDeployConfig(i),MagoConfig.initRenderingConfig(i),MagoConfig.initGeoConfig(i),MagoConfig.initBlocksConfig(n),MagoConfig.initCallbackConfig(i)},MagoConfig.backgroundProvider=function(i){null!==i.backgroundProvider&&""!==i.backgroundProvider&&(void 0===i.backgroundProvider.enable||null===i.backgroundProvider.enable||i.backgroundProvider.enable===!1||"false"===i.backgroundProvider.enable?i.backgroundProvider.enable=!1:i.backgroundProvider.enable=!0,void 0!==i.backgroundProvider.url&&null!==i.backgroundProvider.url&&""!==i.deployConfig.url||(i.backgroundProvider.url=""),void 0!==i.backgroundProvider.layers&&null!==i.backgroundProvider.layers&&""!==i.deployConfig.layers||(i.backgroundProvider.layers="uos:uos_upload_image"),void 0!==i.backgroundProvider.parameters&&null!==i.backgroundProvider.parameters&&""!==i.deployConfig.parameters||(i.backgroundProvider.parameters=""),void 0!==i.backgroundProvider.proxy&&null!==i.backgroundProvider.proxy&&""!==i.deployConfig.proxy||(i.backgroundProvider.proxy="/proxy/")),this.jsonConfig.backgroundProvider=i.backgroundProvider},MagoConfig.initDeployConfig=function(i){null!==i.deployConfig&&""!==i.deployConfig&&(void 0!==i.deployConfig.customer&&null!==i.deployConfig.customer&&""!==i.deployConfig.customer||(i.deployConfig.customer="github"),void 0!==i.deployConfig.viewLibrary&&null!==i.deployConfig.viewLibrary&&""!==i.deployConfig.viewLibrary||(i.deployConfig.viewLibrary=Constant.CESIUM),void 0!==i.deployConfig.dataPath&&null!==i.deployConfig.dataPath&&""!==i.deployConfig.dataPath||(i.deployConfig.dataPath="/data")),this.jsonConfig.deployConfig=i.deployConfig},MagoConfig.initRenderingConfig=function(i){null!==i.renderingConfg&&""!==i.renderingConfg&&(void 0===i.renderingConfg.renderMode||null===i.renderingConfg.renderMode||""===i.renderingConfg.renderMode||"1"===i.renderingConfg.renderMode?i.renderingConfg.renderMode=1:i.renderingConfg.renderMode=0,void 0===i.renderingConfg.cullFaceEnable||null===i.renderingConfg.cullFaceEnable||""===i.renderingConfg.cullFaceEnable||i.renderingConfg.cullFaceEnable===!1||"false"===i.renderingConfg.cullFaceEnable?i.renderingConfg.cullFaceEnable=!1:i.renderingConfg.cullFaceEnable=!0,void 0===i.renderingConfg.timelineEnable||null===i.renderingConfg.timelineEnable||""===i.renderingConfg.timelineEnable||i.renderingConfg.timelineEnable===!1||"false"===i.renderingConfg.timelineEnable?i.renderingConfg.timelineEnable=!1:i.renderingConfg.timelineEnable=!0),this.jsonConfig.renderingConfg=i.renderingConfg},MagoConfig.initGeoConfig=function(i){null!==i.geoConfig&&""!==i.geoConfig&&(void 0!==i.geoConfig.initEntity&&null!==i.geoConfig.initEntity&&""!==i.geoConfig.initEntity&&(void 0!==i.geoConfig.initEntity.name&&null!==i.geoConfig.initEntity.name&&""!==i.geoConfig.initEntity.name||(i.geoConfig.initEntity.name=[""]),void 0!==i.geoConfig.initEntity.longitude&&null!==i.geoConfig.initEntity.longitude&&""!==i.geoConfig.initEntity.longitude||(i.geoConfig.initEntity.longitude=126.924185),void 0!==i.geoConfig.initEntity.latitude&&null!==i.geoConfig.initEntity.latitude&&""!==i.geoConfig.initEntity.latitude||(i.geoConfig.initEntity.latitude=37.521168),void 0!==i.geoConfig.initEntity.height&&null!==i.geoConfig.initEntity.height||(i.geoConfig.initEntity.height=0)),void 0!==i.geoConfig.initBuilding&&null!==i.geoConfig.initBuilding&&""!==i.geoConfig.initBuilding&&(void 0!==i.geoConfig.initBuilding.latitude&&null!==i.geoConfig.initBuilding.latitude&&0!==i.geoConfig.initBuilding.latitude.length||(i.geoConfig.initBuilding.latitude=[37.5172076]),void 0!==i.geoConfig.initBuilding.longitude&&null!==i.geoConfig.initBuilding.longitude&&0!==i.geoConfig.initBuilding.longitude.length||(i.geoConfig.initBuilding.longitude=[126.929]),void 0!==i.geoConfig.initBuilding.height&&null!==i.geoConfig.initBuilding.height&&0!==i.geoConfig.initBuilding.height.length||(i.geoConfig.initBuilding.height=[42.9]),void 0!==i.geoConfig.initBuilding.buildingFileName&&null!==i.geoConfig.initBuilding.buildingFileName&&0!==i.geoConfig.initBuilding.buildingFileName.length||(i.geoConfig.initBuilding.buildingFileName=["F4D_Duplex_A_20110907_optimized"])),void 0!==i.geoConfig.initTerrain&&null!==i.geoConfig.initTerrain&&""!==i.geoConfig.initTerrain&&(void 0===i.geoConfig.initTerrain.enable||null===i.geoConfig.initTerrain.enable||""===i.geoConfig.initTerrain.enable||i.geoConfig.initTerrain.enable===!0||"true"===i.geoConfig.initTerrain.enable?i.geoConfig.initTerrain.enable=!0:i.geoConfig.initTerrain.enable=!1,void 0!==i.geoConfig.initTerrain.url&&null!==i.geoConfig.initTerrain.url&&""!==i.geoConfig.initTerrain.url||(i.geoConfig.initTerrain.url="https://assets.agi.com/stk-terrain/world"),void 0!==i.geoConfig.initTerrain.requestWaterMask&&null!==i.geoConfig.initTerrain.requestWaterMask&&""!==i.geoConfig.initTerrain.requestWaterMask&&i.geoConfig.initTerrain.requestWaterMask!==!0&&"true"!==i.geoConfig.initTerrain.requestWaterMask||(i.geoConfig.initTerrain.requestWaterMask=!0),void 0!==i.geoConfig.initTerrain.requestVertexNormals&&null!==i.geoConfig.initTerrain.requestVertexNormals&&""!==i.geoConfig.initTerrain.requestVertexNormals&&i.geoConfig.initTerrain.requestWaterMask!==!0&&"true"!==i.geoConfig.initTerrain.requestVertexNormals||(i.geoConfig.initTerrain.requestVertexNormals=!0)),void 0!==i.geoConfig.initCamera&&null!==i.geoConfig.initCamera&&""!==i.geoConfig.initCamera&&(void 0===i.geoConfig.initCamera.enable||null===i.geoConfig.initCamera.enable||""===i.geoConfig.initCamera.enable||i.geoConfig.initCamera.enable===!0||"true"===i.geoConfig.initCamera.enable?i.geoConfig.initCamera.enable=!0:i.geoConfig.initCamera.enable=!1,void 0!==i.geoConfig.initCamera.longitude&&null!==i.geoConfig.initCamera.longitude&&""!==i.geoConfig.initCamera.longitude||(i.geoConfig.initCamera.longitude=126.924185),void 0!==i.geoConfig.initCamera.latitude&&null!==i.geoConfig.initCamera.latitude&&""!==i.geoConfig.initCamera.latitude||(i.geoConfig.initCamera.latitude=37.521168),void 0!==i.geoConfig.initCamera.height&&null!==i.geoConfig.initCamera.height||(i.geoConfig.initCamera.height=0),void 0!==i.geoConfig.initCamera.duration&&null!==i.geoConfig.initCamera.duration||(i.geoConfig.initCamera.duration=3))),this.jsonConfig.geoConfig=i.geoConfig},MagoConfig.initBlocksConfig=function(i){null!==i&&null!==i.blocks&&void 0!==i.blocks&&(this.jsonConfig.blockConfig=i)},MagoConfig.initCallbackConfig=function(i){this.jsonConfig.callbackConfig=i.callbackConfig};
"use strict";var Constant={};Constant.CESIUM="cesium",Constant.WORLDWIND="worldwind",Constant.OBJECT_INDEX_FILE="/objectIndexFile.ihe",Constant.SIMPLE_BUILDING_TEXTURE3x3_BMP="/SimpleBuildingTexture3x3.bmp",Constant.RESULT_XDO2F4D="/Result_xdo2f4d/Images/",Constant.RESULT_XDO2F4D_TERRAINTILES="/Result_xdo2f4d/F4D_TerrainTiles/",Constant.RESULT_XDO2F4D_TERRAINTILEFILE_TXT="/Result_xdo2f4d/f4dTerranTileFile.txt";
"use strict";var FBO=function(e,E,r){if(!(this instanceof FBO))throw new Error(Messages.CONSTRUCT_ERROR);if(this.gl=e,this.width=E,this.height=r,this.fbo=e.createFramebuffer(),this.depthBuffer=e.createRenderbuffer(),this.colorBuffer=e.createTexture(),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this.colorBuffer),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,E,r,0,e.RGBA,e.UNSIGNED_BYTE,null),e.bindFramebuffer(e.FRAMEBUFFER,this.fbo),e.bindRenderbuffer(e.RENDERBUFFER,this.depthBuffer),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,E,r),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,this.depthBuffer),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.colorBuffer,0),e.checkFramebufferStatus(e.FRAMEBUFFER)!==e.FRAMEBUFFER_COMPLETE)throw"Incomplete frame buffer object.";e.bindFramebuffer(e.FRAMEBUFFER,null)};FBO.prototype.bind=function(){this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.fbo)},FBO.prototype.unbind=function(){this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null)};
"use strict";var FileRequestControler=function(){if(!(this instanceof FileRequestControler))throw new Error(Messages.CONSTRUCT_ERROR);this.maxFilesRequestedCount=6,this.filesRequestedCount=0};
"use strict";var Frustum=function(){if(!(this instanceof Frustum))throw new Error(Messages.CONSTRUCT_ERROR);this.near=new Float32Array([.1]),this.far=new Float32Array([1e3]),this.fovyRad=new Float32Array([.8037]),this.fovRad=new Float32Array([1.047]),this.aspectRatio=new Float32Array([1.3584])};
"use strict";var GeographicCoord=function(){if(!(this instanceof GeographicCoord))throw new Error(Messages.CONSTRUCT_ERROR);this.longitude,this.latitude,this.altitude};GeographicCoord.prototype.setLonLatAlt=function(t,i,o){this.longitude=t,this.latitude=i,this.altitude=o};
"use strict";var GeoLocationData=function(t){if(!(this instanceof GeoLocationData))throw new Error(Messages.CONSTRUCT_ERROR);this.name,void 0==t?this.name="noName":this.name=t,this.geographicCoord,this.heading,this.pitch,this.roll,this.date,this.position,this.positionHIGH,this.positionLOW,this.pivotPoint,this.geoLocMatrix,this.geoLocMatrixInv,this.tMatrix,this.tMatrixInv,this.rotMatrix,this.rotMatrixInv,this.aditionalTraslation};GeoLocationData.prototype.getTransformedRelativeCamera=function(t,o){var i=new Point3D;return i.set(t.position.x-this.position.x,t.position.y-this.position.y,t.position.z-this.position.z),o.position=this.rotMatrixInv.transformPoint3D(i,o.position),i.set(t.direction.x,t.direction.y,t.direction.z),o.direction=this.rotMatrixInv.transformPoint3D(i,o.direction),i.set(t.up.x,t.up.y,t.up.z),o.up=this.rotMatrixInv.transformPoint3D(i,o.up),i.x=void 0,i.y=void 0,i.z=void 0,i=void 0,o};var GeoLocationDataManager=function(){if(!(this instanceof GeoLocationDataManager))throw new Error(Messages.CONSTRUCT_ERROR);this.geoLocationDataArray=[],this.geoLocationDataCache={}};GeoLocationDataManager.prototype.newGeoLocationData=function(t){void 0==t&&(t="noName"+this.geoLocationDataArray.length.toString());var o=new GeoLocationData(t);return this.geoLocationDataArray.push(o),this.geoLocationDataCache[t]=o,o},GeoLocationDataManager.prototype.getGeoLocationData=function(t){return this.geoLocationDataArray[t]};
"use strict";var Texture=function(){if(!(this instanceof Texture))throw new Error(Messages.CONSTRUCT_ERROR);this.textureTypeName="",this.textureImageFileName="",this.texId,this.fileLoadState=CODE.fileLoadState.READY},NeoSimpleBuilding=function(){if(!(this instanceof NeoSimpleBuilding))throw new Error(Messages.CONSTRUCT_ERROR);this.accesorsArray=[],this.vbo_vicks_container=new VBOVertexIdxCacheKeysContainer,this.texturesArray=[]};NeoSimpleBuilding.prototype.newAccesor=function(){var t=new Accessor;return this.accesorsArray.push(t),t},NeoSimpleBuilding.prototype.newTexture=function(){var t=new NeoTexture;return this.texturesArray.push(t),t};var LodBuilding=function(){if(!(this instanceof LodBuilding))throw new Error(Messages.CONSTRUCT_ERROR);this.dataArraybuffer,this.vbo_vicks_container=new VBOVertexIdxCacheKeysContainer,this.fileLoadState=CODE.fileLoadState.READY};LodBuilding.prototype.parseArrayBuffer=function(t,e){if(this.fileLoadState==CODE.fileLoadState.LOADING_FINISHED){this.fileLoadState=CODE.fileLoadState.PARSE_STARTED;var i=0,r=new BoundingBox;r.minX=new Float32Array(this.dataArraybuffer.slice(i,i+4)),i+=4,r.minY=new Float32Array(this.dataArraybuffer.slice(i,i+4)),i+=4,r.minZ=new Float32Array(this.dataArraybuffer.slice(i,i+4)),i+=4,r.maxX=new Float32Array(this.dataArraybuffer.slice(i,i+4)),i+=4,r.maxY=new Float32Array(this.dataArraybuffer.slice(i,i+4)),i+=4,r.maxZ=new Float32Array(this.dataArraybuffer.slice(i,i+4)),i+=4;var n=this.vbo_vicks_container.newVBOVertexIdxCacheKey(),a=e.readUInt32(this.dataArraybuffer,i,i+4);i+=4;var o=3*a,s=i,d=i+4*o;n.posVboDataArray=new Float32Array(this.dataArraybuffer.slice(s,d)),i+=4*o,n.vertexCount=a;var u=e.readUInt8(this.dataArraybuffer,i,i+1);if(i+=1,u){a=e.readUInt32(this.dataArraybuffer,i,i+4),i+=4;var h=3*a,s=i,d=i+1*h;n.norVboDataArray=new Int8Array(this.dataArraybuffer.slice(s,d)),i+=1*h}var l=e.readUInt8(this.dataArraybuffer,i,i+1);if(i+=1,l){a=e.readUInt32(this.dataArraybuffer,i,i+4),i+=4;var c=4*a,s=i,d=i+1*c;n.colVboDataArray=new Uint8Array(this.dataArraybuffer.slice(s,d)),i+=1*c}e.readUInt8(this.dataArraybuffer,i,i+1);i+=1,this.fileLoadState=CODE.fileLoadState.PARSE_FINISHED}};var NeoBuilding=function(){if(!(this instanceof NeoBuilding))throw new Error(Messages.CONSTRUCT_ERROR);this.metaData,this.buildingId,this.buildingType,this.buildingFileName="",this.bbox,this.bboxAbsoluteCenterPos,this.frustumCulled=!1,this.geoLocDataManager=new GeoLocationDataManager,this.geoLocationDataAux,this.isDemoBlock=!1,this.currentRenderablesNeoRefLists=[],this.preExtractedLowestOctreesArray=[],this.motherNeoReferencesArray=[],this.motherBlocksArray=[],this.aditionalColor,this.texturesLoaded=[],this.texturesLoadedCache={},this.octree,this.octreeLoadedAllFiles=!1,this.allFilesLoaded=!1,this.isReadyToRender=!1,this.moveVector,this.simpleBuilding3x3Texture,this.neoSimpleBuilding,this.lod2Building,this.lod3Building,this.point3dScratch=new Point3D,this.point3dScratch2=new Point3D};NeoBuilding.prototype.setRenderedFalseToAllReferences=function(){for(var t=this.motherNeoReferencesArray.length,e=0;e<t;e++){var i=this.motherNeoReferencesArray[e];i.bRendered=!1}},NeoBuilding.prototype.getTextureId=function(t){for(var e,i=this.texturesLoaded.length,r=!1,n=0;!r&&n<i;)this.texturesLoaded[n].textureImageFileName==t.textureImageFileName&&(r=!0,e=this.texturesLoaded[n].texId),n++;return e},NeoBuilding.prototype.getSameTexture=function(t){for(var e,i=this.texturesLoaded.length,r=!1,n=0;!r&&n<i;)this.texturesLoaded[n].textureImageFileName==t.textureImageFileName&&(r=!0,e=this.texturesLoaded[n]),n++;return e},NeoBuilding.prototype.updateCurrentVisibleIndicesExterior=function(t,e,i){this._neoRefLists_Container.updateCurrentVisibleIndicesOfLists(t,e,i)},NeoBuilding.prototype.updateCurrentAllIndicesExterior=function(){this._neoRefLists_Container.updateCurrentAllIndicesOfLists()},NeoBuilding.prototype.isCameraInsideOfBuilding=function(t,e,i){return this.metaData.bbox.isPoint3dInside(t,e,i)},NeoBuilding.prototype.getTransformedRelativeEyePositionToBuilding=function(t,e,i){var r=this.buildingPosition,n=t-r.x,a=e-r.y,o=i-r.z;return void 0==this.buildingPosMatInv&&(this.buildingPosMatInv=new Matrix4,this.buildingPosMatInv.setByFloat32Array(this.moveMatrixInv)),this.point3dScratch.set(n,a,o),this.point3dScratch2=this.buildingPosMatInv.transformPoint3D(this.point3dScratch,this.point3dScratch2),this.point3dScratch2},NeoBuilding.prototype.getTransformedRelativeCameraToBuilding=function(t,e){var i=this.buildingPosition;return void 0==this.buildingPosMatInv&&(this.buildingPosMatInv=new Matrix4,this.buildingPosMatInv.setByFloat32Array(this.moveMatrixInv)),this.point3dScratch.set(t.position.x-i.x,t.position.y-i.y,t.position.z-i.z),e.position=this.buildingPosMatInv.transformPoint3D(this.point3dScratch,e.position),this.point3dScratch.set(t.direction.x,t.direction.y,t.direction.z),e.direction=this.buildingPosMatInv.transformPoint3D(this.point3dScratch,e.direction),this.point3dScratch.set(t.up.x,t.up.y,t.up.z),e.up=this.buildingPosMatInv.transformPoint3D(this.point3dScratch,e.up),e};var NeoBuildingsList=function(){if(!(this instanceof NeoBuildingsList))throw new Error(Messages.CONSTRUCT_ERROR);this.neoBuildingsArray=[]};NeoBuildingsList.prototype.newNeoBuilding=function(){var t=new NeoBuilding;return this.neoBuildingsArray.push(t),t},NeoBuildingsList.prototype.getNeoBuildingByTypeId=function(t,e){for(var i,r=this.neoBuildingsArray.length,n=!1,a=0;!n&&a<r;)this.neoBuildingsArray[a].buildingType==t&&this.neoBuildingsArray[a].buildingId==e&&(n=!0,i=this.neoBuildingsArray[a]),a++;return i},NeoBuildingsList.prototype.setNeoBuildingsFrustumCulled=function(t){for(var e=this.neoBuildingsArray.length,i=0;i<e;i++)this.neoBuildingsArray[i].frustumCulled=t};
"use strict";var GeometryModifier=function(){if(!(this instanceof GeometryModifier))throw new Error(Messages.CONSTRUCT_ERROR)};GeometryModifier.prototype.setPoint3d=function(e,r,o,t){e.x=r,e.y=o,e.z=t},GeometryModifier.prototype.point3dSquareDistTo=function(e,r,o,t){var i=e.x-r,n=e.y-o,s=e.z-t;return i*i+n*n+s*s},GeometryModifier.prototype.Matrix4SetByFloat32Array=function(e,r){for(var o=0;o<16;o++)e._floatArrays[o]=r[o]},GeometryModifier.prototype.Matrix4TransformPoint3D=function(e,r){var o=new Point3D;return o.x=r.x*e._floatArrays[0]+r.y*e._floatArrays[4]+r.z*e._floatArrays[8]+e._floatArrays[12],o.y=r.x*e._floatArrays[1]+r.y*e._floatArrays[5]+r.z*e._floatArrays[9]+e._floatArrays[13],o.z=r.x*e._floatArrays[2]+r.y*e._floatArrays[6]+r.z*e._floatArrays[10]+e._floatArrays[14],o},GeometryModifier.prototype.Matrix4GetMultipliedByMatrix=function(e,r){for(var o=new Matrix4,t=0;t<4;t++)for(var i=0;i<4;i++){var n=4*t+i;o._floatArrays[n]=0;for(var s=0;s<4;s++)o._floatArrays[n]+=r._floatArrays[4*s+i]*e._floatArrays[4*t+s]}return o},GeometryModifier.prototype.referenceMultiplyTransformMatrix=function(e,r){var o=this.Matrix4GetMultipliedByMatrix(e._matrix4,r);e._matrix4=o},GeometryModifier.prototype.compoundReferencesListMultiplyReferencesMatrices=function(e,r){for(var o=e._compoundRefsArray.length,t=0;t<o;t++)for(var i=e._compoundRefsArray[t],n=i._referencesList.length,s=0;s<n;s++){var l=i._referencesList[s];this.referenceMultiplyTransformMatrix(l,r)}},GeometryModifier.prototype.compoundReferencesListGetVisibleCompRefObjectsList=function(e,r,o,t){var i=new CompoundReferencesList;i._myBlocksList=e._myBlocksList;var n=e._ocCulling._ocCulling_box,s=this.occlusionCullingOctreeCellGetIndicesVisiblesForEye(n,r,o,t);if(s)for(var l=s.length,c=0;c<l;c++)i._compoundRefsArray.push(e._compoundRefsArray[s[c]]);var a=e._ocCulling._infinite_ocCulling_box,u=this.occlusionCullingOctreeCellGetIndicesVisiblesForEye(a,eye_x,eye_y,eye_z);if(u)for(var l=u.length,c=0;c<l;c++)i._compoundRefsArray.push(e._compoundRefsArray[u[c]]);return i&&0==i.length?null:i},GeometryModifier.prototype.compoundReferencesListContainerGetVisibleCompRefObjectsList=function(e,r,o,t){for(var i=[],n=void 0,s=e.compRefsListArray.length,l=0;l<s;l++){n=e.compRefsListArray[l];var c=this.compoundReferencesListGetVisibleCompRefObjectsList(n,r,o,t);null!=c&&i.push(c)}return i},GeometryModifier.prototype.bRbuildingProjectGetVisibleCompRefLists=function(e,r,o,t){var i=e._interiorCompRefList_Container,n=this.compoundReferencesListContainerGetVisibleCompRefObjectsList(i,eye_x,eye_y,eye_z),s=e._compRefList_Container,l=this.compoundReferencesListContainerGetVisibleCompRefObjectsList(s,r,o,t),c=l.concat(n);return c},GeometryModifier.prototype.occlusionCullingOctreeCellSetDimensions=function(e,r,o,t,i,n,s){e.minX=r,e.maxX=o,e.minY=t,e.maxY=i,e.minZ=n,e.maxZ=s},GeometryModifier.prototype.occlusionCullingOctreeCellSetSizesSubBoxes=function(e){if(e._subBoxesArray.length>0){var r=(e.maxX+e.minX)/2,o=(e.maxY+e.minY)/2,t=(e.maxZ+e.minZ)/2;this.occlusionCullingOctreeCellSetDimensions(e._subBoxesArray[0],e.minX,r,e.minY,o,e.minZ,t),this.occlusionCullingOctreeCellSetDimensions(e._subBoxesArray[1],r,e.maxX,e.minY,o,e.minZ,t),this.occlusionCullingOctreeCellSetDimensions(e._subBoxesArray[2],r,e.maxX,o,e.maxY,e.minZ,t),this.occlusionCullingOctreeCellSetDimensions(e._subBoxesArray[3],e.minX,r,o,e.maxY,e.minZ,half_z),this.occlusionCullingOctreeCellSetDimensions(e._subBoxesArray[4],e.minX,r,e.minY,o,t,e.maxZ),this.occlusionCullingOctreeCellSetDimensions(e._subBoxesArray[5],r,e.maxX,e.minY,o,t,e.maxZ),this.occlusionCullingOctreeCellSetDimensions(e._subBoxesArray[6],r,e.maxX,o,e.maxY,t,e.maxZ),this.occlusionCullingOctreeCellSetDimensions(e._subBoxesArray[7],e.minX,r,o,e.maxY,t,e.maxZ);for(var i=0;i<e._subBoxesArray.length;i++)this.occlusionCullingOctreeCellSetSizesSubBoxes(e._subBoxesArray[i])}},GeometryModifier.prototype.occlusionCullingOctreeCellIntersectsWithPoint3D=function(e,r,o,t){var i=!1;return r>e.minX&&r<e.maxX&&o>e.minY&&o<e.maxY&&t>e.minZ&&t<e.maxZ&&(i=!0),i},GeometryModifier.prototype.occlusionCullingOctreeCellGetIntersectedSubBoxByPoint3D=function(e,r,o,t){var i=null;if(null==e._ocCulling_Cell_owner&&!this.occlusionCullingOctreeCellIntersectsWithPoint3D(e,r,o,t))return null;var n=e._subBoxesArray.length;if(n>0){var s=(e.minX+e.maxX)/2,l=(e.minY+e.maxY)/2,c=(e.minZ+e.maxZ)/2,a=null,u=void 0;u=r<s?o<l?t<c?0:4:t<c?3:7:o<center_y?t<center_z?1:5:t<center_z?2:6,a=e._subBoxesArray[u],i=this.occlusionCullingOctreeCellGetIntersectedSubBoxByPoint3D(a,r,o,t)}else i=e;return i},GeometryModifier.prototype.occlusionCullingOctreeCellGetIndicesVisiblesForEye=function(e,r,o,t){var i=null,n=this.occlusionCullingOctreeCellGetIntersectedSubBoxByPoint3D(e,r,o,t);return null!=n&&n._indicesArray.length>0&&(i=n._indicesArray),i},GeometryModifier.prototype.occlusionCullingOctreeCellExpandBox=function(e,r){e.minX-=r,e.maxX+=r,e.minY-=r,e.maxY+=r,e.minZ-=r,e.maxZ+=r},GeometryModifier.prototype.vertexTexcoordsArraysCacheKeysContainerNewVertexTexcoordsArraysCacheKey=function(e){var r=new VertexTexcoordsArraysCacheKeys;return e._vtArrays_cacheKeys_array.push(r),r},GeometryModifier.prototype.blocksListGetBlock=function(e,r){var o=null;return r>=0&&r<e.blocksArray.length&&(o=e.blocksArray[r]),o},GeometryModifier.prototype.blocksListsContainerNewBlocksList=function(e,r){var o=new BlocksList;return o.name=r,e.blocksListsArray.push(o),o},GeometryModifier.prototype.blocksListsContainerGetBlockList=function(e,r){for(var o=e.blocksListsArray.length,t=!1,i=0,n=null;!t&&i<o;){var s=e.blocksListsArray[i];s.name==r&&(t=!0,n=s),i++}return n},GeometryModifier.prototype.bRbuildingProjectCreateDefaultBlockReferencesLists=function(e){this.f4dBlocksListsContainerNewBlocksList(e._blocksList_Container,"Blocks1"),this.f4dBlocksListsContainerNewBlocksList(e._blocksList_Container,"Blocks2"),this.f4dBlocksListsContainerNewBlocksList(e._blocksList_Container,"Blocks3"),this.f4dBlocksListsContainerNewBlocksList(e._blocksList_Container,"Blocks4"),this.f4dBlocksListsContainerNewBlocksList(e._blocksList_Container,"BlocksBone")},GeometryModifier.prototype.bRbuildingProjectsListNewBRProject=function(e){var r=new BRBuildingProject;return this.bRbuildingProjectCreateDefaultBlockReferencesLists(r),e._BR_buildingsArray.push(r),r};
"use strict";var ByteColor=function(){if(!(this instanceof ByteColor))throw new Error(Messages.CONSTRUCT_ERROR);this.ByteR=0,this.ByteG=0,this.ByteB=0,this.ByteAlfa=255};ByteColor.prototype.destroy=function(){this.ByteR=null,this.ByteG=null,this.ByteB=null,this.ByteAlfa=null},ByteColor.prototype.set=function(e,t,r){this.ByteR=e,this.ByteG=t,this.ByteB=r};var Point2D=function(){if(!(this instanceof Point2D))throw new Error(Messages.CONSTRUCT_ERROR);this.x=0,this.y=0,this.IdxInIist},Point3DAux=function(){if(!(this instanceof Point3DAux))throw new Error(Messages.CONSTRUCT_ERROR);this.x=0,this.y=0,this.z=0},TTriangle=function(){if(!(this instanceof TTriangle))throw new Error(Messages.CONSTRUCT_ERROR);this.mVertex1,this.mVertex2,this.mVertex3};TTriangle.prototype.setVertices=function(e,t,r){this.mVertex1=e,this.mVertex2=t,this.mVertex3=r},TTriangle.prototype.invert=function(){var e=this.mVertex2;this.mVertex2=this.mVertex3,this.mVertex3=e};var TTrianglesList=function(){if(!(this instanceof TTrianglesList))throw new Error(Messages.CONSTRUCT_ERROR);this.tTrianglesArray=[]};TTrianglesList.prototype.newTTriangle=function(){var e=new TTriangle;return this.tTrianglesArray.push(e),e},TTrianglesList.prototype.invertTrianglesSense=function(){for(var e=0,t=this.tTrianglesArray.length;e<t;e++)this.tTrianglesArray[e].invert()},TTrianglesList.prototype.getTTriangle=function(e){return e>=0&&e<this.tTrianglesArray.length?this.tTrianglesArray[e]:void 0};var TTrianglesMatrix=function(){if(!(this instanceof TTrianglesMatrix))throw new Error(Messages.CONSTRUCT_ERROR);this.tTrianglesListsArray=[],this.totalTTrianglesArraySC=[]};TTrianglesMatrix.prototype.newTTrianglesList=function(){var e=new TTrianglesList;return this.tTrianglesListsArray.push(e),e},TTrianglesMatrix.prototype.invertTrianglesSense=function(){for(var e=0,t=this.tTrianglesListsArray.length;e<t;e++)this.tTrianglesListsArray[e].invertTrianglesSense()},TTrianglesMatrix.prototype.getTotalTTrianglesArray=function(e){for(var t=0,r=this.tTrianglesListsArray.length;t<r;t++)for(var i=0,s=this.tTrianglesListsArray[t].tTrianglesArray.length;i<s;i++){var n=this.tTrianglesListsArray[t].getTTriangle(i);e.push(n)}return e},TTrianglesMatrix.prototype.getVBOIndicesShortArray=function(){this.totalTTrianglesArraySC.length=0,this.totalTTrianglesArraySC=this.getTotalTTrianglesArray(this.totalTTrianglesArraySC);for(var e,t=new Uint16Array(3*i),r=0,i=this.totalTTrianglesArraySC.length;r<i;r++)e=this.totalTTrianglesArraySC[r],t[3*r]=e.mVertex1.mIdxInList,t[3*r+1]=e.mVertex2.mIdxInList,t[3*r+2]=e.mVertex3.mIdxInList;return t};var VertexMatrix=function(){if(!(this instanceof VertexMatrix))throw new Error(Messages.CONSTRUCT_ERROR);this.vertexListsArray=[],this.totalVertexArraySC=[]};VertexMatrix.prototype.newVertexList=function(){var e=new VertexList;return this.vertexListsArray.push(e),e},VertexMatrix.prototype.getVertexList=function(e){return e>=0&&e<this.vertexListsArray.length?this.vertexListsArray[e]:void 0},VertexMatrix.prototype.getBoundingBox=function(e){void 0==e&&(e=new BoundingBox),this.totalVertexArraySC.length=0,this.totalVertexArraySC=this.getTotalVertexArray(this.totalVertexArraySC);for(var t=0,r=this.totalVertexArraySC.length;t<r;t++)0==t?e.setInit(this.totalVertexArraySC[t].point3d):e.addPoint3D(this.totalVertexArraySC[t].point3d);return e},VertexMatrix.prototype.setVertexIdxInList=function(){for(var e=0,t=0,r=this.vertexListsArray.length;t<r;t++)for(var i=this.vertexListsArray[t],s=0,n=i.vertexArray.length;s<n;s++){var o=i.getVertex(s);o.mIdxInList=e,e++}},VertexMatrix.prototype.getVertexCount=function(){for(var e=0,t=0,r=this.vertexListsArray.length;t<r;t++)e+=this.vertexListsArray[t].getVertexCount();return e},VertexMatrix.prototype.getTotalVertexArray=function(e){for(var t=0,r=this.vertexListsArray.length;t<r;t++)for(var i=this.vertexListsArray[t],s=0,n=i.vertexArray.length;s<n;s++){var o=i.getVertex(s);e.push(o)}return e},VertexMatrix.prototype.getVBOVertexColorFloatArray=function(e){this.totalVertexArraySC.length=0,this.totalVertexArraySC=this.getTotalVertexArray(this.totalVertexArraySC);var t=this.totalVertexArraySC.length;void 0==e&&(e=new Float32Array(6*t));for(var r=0;r<t;r++){var i=this.totalVertexArraySC[r];e[6*r]=i.point3d.x,e[6*r+1]=i.point3d.y,e[6*r+2]=i.point3d.z,e[6*r+3]=i.color4.r,e[6*r+4]=i.color4.g,e[6*r+5]=i.color4.b}return e},VertexMatrix.prototype.getVBOVertexColorRGBAFloatArray=function(e){this.totalVertexArraySC.length=0,this.totalVertexArraySC=this.getTotalVertexArray(this.totalVertexArraySC);var t=this.totalVertexArraySC.length;void 0==e&&(e=new Float32Array(7*t));for(var r=0;r<t;r++){var i=this.totalVertexArraySC[r];e[7*r]=i.point3d.x,e[7*r+1]=i.point3d.y,e[7*r+2]=i.point3d.z,e[7*r+3]=i.color4.r,e[7*r+4]=i.color4.g,e[7*r+5]=i.color4.b,e[7*r+6]=i.color4.a}return e},VertexMatrix.prototype.getVBOVertexFloatArray=function(e){this.totalVertexArraySC.length=0,this.totalVertexArraySC=this.getTotalVertexArray(this.totalVertexArraySC);var t=this.totalVertexArraySC.length;void 0==e&&(e=new Float32Array(3*t));for(var r=0;r<t;r++){var i=this.totalVertexArraySC[r];e[3*r]=i.point3d.x,e[3*r+1]=i.point3d.y,e[3*r+2]=i.point3d.z}return e},VertexMatrix.prototype.translateVertices=function(e,t,r,i){for(var s=0,n=this.vertexListsArray.length;s<n;s++)this.vertexListsArray[s].translateVertices(e,t,r,i)},VertexMatrix.prototype.makeTTrianglesLateralSidesLOOP=function(e){for(var t,r,i,s,n,o=0,a=0,h=this.vertexListsArray.length;a<h-1;a++){t=this.vertexListsArray[a],r=this.vertexListsArray[a+1],i=e.newTTrianglesList(),o=t.vertexArray.length;for(var l=0;l<o;l++)s=i.newTTriangle(),n=i.newTTriangle(),l==o-1?(s.setVertices(t.getVertex(l),r.getVertex(l),r.getVertex(0)),n.setVertices(t.getVertex(l),r.getVertex(0),t.getVertex(0))):(s.setVertices(t.getVertex(l),r.getVertex(l),r.getVertex(l+1)),n.setVertices(t.getVertex(l),r.getVertex(l+1),t.getVertex(l+1)))}},VertexMatrix.prototype.transformPointsByMatrix4=function(e){for(var t=0,r=this.vertexListsArray.length;t<r;t++){var i=this.vertexListsArray[t];i.transformPointsByMatrix4(e)}};var Polygon=function(){if(!(this instanceof Polygon))throw new Error(Messages.CONSTRUCT_ERROR);this.mPoint3DArray=[]};Polygon.prototype.addPoint3D=function(e){this.mPoint3DArray.push(e)},Polygon.prototype.newPoint3D=function(){var e=new Point3D;return this.mPoint3DArray.push(e),e};var TrianglesSurface=function(){if(!(this instanceof TrianglesSurface))throw new Error(Messages.CONSTRUCT_ERROR);this.mPoint3DArray=[],this.mTrianglesArray=[]};TrianglesSurface.prototype.destroy=function(){for(var e=0,t=this.mTrianglesArray.length;e<t;e++){var r=this.mTrianglesArray[e];null!=r&&r.destroy(),r=null}this.mTrianglesArray=null;for(var e=0,i=this.mPoint3DArray.length;e<i;e++){var s=this.mPoint3DArray[e];null!=s&&s.destroy(),s=null}this.mPoint3DArray=null},TrianglesSurface.prototype.getVertexColorsIndicesArrays=function(e){var t=null,r=e.meshArrays.length;t=0==r?e.newVertexColorIdxArray():e.meshArrays[r-1];for(var i=65e3,s=0,n=this.mTrianglesArray.length;s<n;s++){t.meshVertices.length/3>=i&&(t=e.newVertexColorIdxArray());var o=this.mTrianglesArray[s],a=o.mPoint1Idx,h=o.mPoint2Idx,l=o.mPoint3Idx,u=o.mColor1,c=o.mColor2,d=o.mColor3,_=this.mPoint3DArray[a],g=this.mPoint3DArray[h],y=this.mPoint3DArray[l];t.meshVertices.push(_.x),t.meshVertices.push(_.y),t.meshVertices.push(_.z),t.mesh_tri_indices.push(t.meshVertices.length/3-1),t.mesh_colors.push(u.r),t.mesh_colors.push(u.g),t.mesh_colors.push(u.b),t.meshVertices.push(g.x),t.meshVertices.push(g.y),t.meshVertices.push(g.z),t.mesh_tri_indices.push(t.meshVertices.length/3-1),t.mesh_colors.push(c.r),t.mesh_colors.push(c.g),t.mesh_colors.push(c.b),t.meshVertices.push(y.x),t.meshVertices.push(y.y),t.meshVertices.push(y.z),t.mesh_tri_indices.push(t.meshVertices.length/3-1),t.mesh_colors.push(d.r),t.mesh_colors.push(d.g),t.mesh_colors.push(d.b)}},TrianglesSurface.prototype.getVertexIndicesArrays=function(e){var t=null,r=e._meshArrays.length;t=0==r?e.newVertexIdxArray():e._meshArrays[r-1];for(var i=65e3,s=this.mTrianglesArray.length,n=t.meshVertices.length/3,o=0,a=this.mPoint3DArray.length;o<a;o++){var h=this.mPoint3DArray[o];t.meshVertices.push(h.x),t.meshVertices.push(h.y),t.meshVertices.push(h.z)}for(var o=0;o<s;o++){t.meshVertices.length/3>=i&&(t=e.newVertexIdxArray(),n=0);var l=this.mTrianglesArray[o],u=l.mPoint1Idx,c=l.mPoint2Idx,d=l.mPoint3Idx;t.mesh_tri_indices.push(u+n),t.mesh_tri_indices.push(c+n),t.mesh_tri_indices.push(d+n)}},TrianglesSurface.prototype.getVertexIndicesArraysOriginal=function(e){var t=null,r=e._meshArrays.length;t=0==r?e.newVertexIdxArray():e._meshArrays[r-1];for(var i=65e3,s=0,n=this.mTrianglesArray.length;s<n;s++){t.meshVertices.length/3>=i&&(t=e.newVertexIdxArray());var o=this.mTrianglesArray[s],a=o.mPoint1Idx,h=o.mPoint2Idx,l=o.mPoint3Idx,u=this.mPoint3DArray[a],c=this.mPoint3DArray[h],d=this.mPoint3DArray[l];t.meshVertices.push(u.x),t.meshVertices.push(u.y),t.meshVertices.push(u.z),t.mesh_tri_indices.push(t.meshVertices.length/3-1),t.meshVertices.push(c.x),t.meshVertices.push(c.y),t.meshVertices.push(c.z),t.mesh_tri_indices.push(t.meshVertices.length/3-1),t.meshVertices.push(d.x),t.meshVertices.push(d.y),t.meshVertices.push(d.z),t.mesh_tri_indices.push(t.meshVertices.length/3-1)}},TrianglesSurface.prototype.newPoint3D=function(){var e=new Point3D;return this.mPoint3DArray.push(e),e},TrianglesSurface.prototype.newTriangle=function(){var e=new Triangle;return this.mTrianglesArray.push(e),e},TrianglesSurface.prototype.getTransformedTrianglesSurface=function(e){for(var t=new TrianglesSurface,r=0,i=this.mPoint3DArray.length;r<i;r++){var s=this.mPoint3DArray[r],n=e.transformPoint3D(s);t.mPoint3DArray.push(n)}for(var r=0,o=this.mTrianglesArray.length;r<o;r++){var a=this.mTrianglesArray[r],h=t.newTriangle();h.setPoints3DIndices(a.mPoint1Idx,a.mPoint2Idx,a.mPoint3Idx)}return t},TrianglesSurface.prototype.getBoundingBox=function(){var e=this.mPoint3DArray.length;if(0==e)return null;var t=new BoundingBox,r=this.mPoint3DArray[0];t.setInit(r);for(var i=1;i<e;i++){var s=this.mPoint3DArray[i];t.addPoint3D(s)}return t};var Fpolyhedron=function(){if(!(this instanceof Fpolyhedron))throw new Error(Messages.CONSTRUCT_ERROR);this.mFTrianglesSurfacesArray=[],this.mIFCEntityType=-1};Fpolyhedron.prototype.destroy=function(){for(var e=0,t=this.mFTrianglesSurfacesArray.length;e<t;e++){var r=this.mFTrianglesSurfacesArray[e];null!=r&&r.destroy(),r=null}this.mFTrianglesSurfacesArray=null,this.mIFCEntityType=null},Fpolyhedron.prototype.getVertexColorsIndicesArrays=function(e){for(var t=0,r=this.mFTrianglesSurfacesArray.length;t<r;t++){var i=this.mFTrianglesSurfacesArray[t];i.getVertexColorsIndicesArrays(e)}},Fpolyhedron.prototype.getVertexIndicesArrays=function(e){for(var t=0,r=this.mFTrianglesSurfacesArray.length;t<r;t++){var i=this.mFTrianglesSurfacesArray[t];i.getVertexIndicesArrays(e)}},Fpolyhedron.prototype.newFTrianglesSurface=function(){var e=new TrianglesSurface;return this.mFTrianglesSurfacesArray.push(e),e},Fpolyhedron.prototype.getTransformedFPolyhedron=function(e){for(var t=new Fpolyhedron,r=0,i=this.mFTrianglesSurfacesArray.length;r<i;r++){var s=this.mFTrianglesSurfacesArray[r],n=s.getTransformedTrianglesSurface(e);t.mFTrianglesSurfacesArray.push(n)}return t},Fpolyhedron.prototype.getBoundingBox=function(){var e=this.mFTrianglesSurfacesArray.length;if(0==e)return null;for(var t=null,r=0;r<e;r++){var i=this.mFTrianglesSurfacesArray[r],s=i.getBoundingBox();null==t?null!=s&&(t=s):null!=s&&t.addBox(s)}return t};var FpolyhedronsList=function(){if(!(this instanceof FpolyhedronsList))throw new Error(Messages.CONSTRUCT_ERROR);this.mFPolyhedronsArray=[]};FpolyhedronsList.prototype.getVertexColorsIndicesArrays=function(e){for(var t=0,r=this.mFPolyhedronsArray.length;t<r;t++){var i=this.mFPolyhedronsArray[t];27!=i.mIFCEntityType&&26!=i.mIFCEntityType&&i.getVertexColorsIndicesArrays(e)}},FpolyhedronsList.prototype.newFPolyhedron=function(){var e=new Fpolyhedron;return this.mFPolyhedronsArray.push(e),e};var Reference=function(){if(!(this instanceof Reference))throw new Error(Messages.CONSTRUCT_ERROR);this._id=0,this._block_idx=-1,this._matrix4=new Matrix4,this._VBO_ByteColorsCacheKeys_Container_idx=-1};Reference.prototype.multiplyTransformMatrix=function(e){var t=this._matrix4.getMultipliedByMatrix(e);this._matrix4=t},Reference.prototype.getBoundingBox=function(e){var t=e.getBlock(this._block_idx);if(null==t)return null;var r=t._fpolyhedron,i=r.getTransformedFPolyhedron(this._matrix4),s=i.getBoundingBox();return s},Reference.prototype.newByteColorsSurface=function(){var e=new f4d_ByteColorsSurface;return this._ByteColorsSurfacesList.push(e),e};var CompoundReference=function(){if(!(this instanceof CompoundReference))throw new Error(Messages.CONSTRUCT_ERROR);this._referencesList=[]};CompoundReference.prototype.getBoundingBox=function(e){for(var t=null,r=0,i=this._referencesList.length;r<i;r++){var s=this._referencesList[r],n=s.getBoundingBox(e);null==t?null!=n&&(t=n):null!=n&&t.addBox(n)}return t},CompoundReference.prototype.newReference=function(){var e=new Reference;return this._referencesList.push(e),e};var CompoundReferencesList=function(){if(!(this instanceof CompoundReferencesList))throw new Error(Messages.CONSTRUCT_ERROR);this.name="",this._compoundRefsArray=[],this._lodLevel=-1,this._ocCulling=new OcclusionCullingOctree,this._currentVisibleIndices=[],this._currentVisibleIndicesSC=[],this._currentVisibleIndicesSC_2=[]};CompoundReferencesList.prototype.updateCurrentVisibleIndices=function(e,t,r){this._currentVisibleIndicesSC=this._ocCulling._infinite_ocCulling_box.getIndicesVisiblesForEye(e,t,r,this._currentVisibleIndicesSC),this._currentVisibleIndicesSC_2=this._ocCulling._ocCulling_box.getIndicesVisiblesForEye(e,t,r,this._currentVisibleIndicesSC_2),this._currentVisibleIndices=this._currentVisibleIndicesSC.concat(this._currentVisibleIndicesSC_2)},CompoundReferencesList.prototype.updateCurrentVisibleIndicesInterior=function(e,t,r){this._currentVisibleIndices=this._ocCulling._ocCulling_box.getIndicesVisiblesForEye(e,t,r,this._currentVisibleIndices)},CompoundReferencesList.prototype.getBoundingBox=function(e){for(var t=null,r=0,i=this._compoundRefsArray.length;r<i;r++){var s=this._compoundRefsArray[r],n=s.getBoundingBox(e);null==t?null!=n&&(t=n):null!=n&&t.addBox(n)}return t},CompoundReferencesList.prototype.newCompoundReference=function(){var e=new CompoundReference;return this._compoundRefsArray.push(e),e},CompoundReferencesList.prototype.multiplyReferencesMatrices=function(e){for(var t=0,r=this._compoundRefsArray.length;t<r;t++)for(var i=this._compoundRefsArray[t],s=0,n=i._referencesList.length;s<n;s++){var o=i._referencesList[s];o.multiplyTransformMatrix(e)}};var CompoundReferencesListContainer=function(){if(!(this instanceof CompoundReferencesListContainer))throw new Error(Messages.CONSTRUCT_ERROR);this.compRefsListArray=[]};CompoundReferencesListContainer.prototype.newCompoundRefsList=function(e,t){var r=new CompoundReferencesList;return r.name=e,r._lodLevel=t,this.compRefsListArray.push(r),r},CompoundReferencesListContainer.prototype.updateCurrentVisibleIndicesOfLists=function(e,t,r){for(var i=0,s=this.compRefsListArray.length;i<s;i++)this.compRefsListArray[i].updateCurrentVisibleIndices(e,t,r)},CompoundReferencesListContainer.prototype.getCompRefListByName=function(e){for(var t,r=!1,i=this.compRefsListArray.length,s=0;!r&&s<i;)this.compRefsListArray[s].name==e&&(t=this.compRefsListArray[s]),s++;return t};var VertexIdxArrays=function(){if(!(this instanceof VertexIdxArrays))throw new Error(Messages.CONSTRUCT_ERROR);this.indicesCount=-1,this.meshVertexCacheKey=null,this.meshFacesCacheKey=null},VertexIdxVBOArraysContainer=function(){if(!(this instanceof VertexIdxVBOArraysContainer))throw new Error(Messages.CONSTRUCT_ERROR);this._meshArrays=[]};VertexIdxVBOArraysContainer.prototype.newVertexIdxArray=function(){var e=new VertexIdxArrays;return this._meshArrays.push(e),e};var ByteColorsVBOArrays=function(){if(!(this instanceof ByteColorsVBOArrays))throw new Error(Messages.CONSTRUCT_ERROR);this.meshColorsCacheKey=null},ByteColorsVBOArraysContainer=function(){if(!(this instanceof ByteColorsVBOArraysContainer))throw new Error(Messages.CONSTRUCT_ERROR);this._meshArrays=[]};ByteColorsVBOArraysContainer.prototype.newByteColorsVBOArray=function(){var e=new ByteColorsVBOArrays;return this._meshArrays.push(e),e};var VertexTexcoordsArrays=function(){if(!(this instanceof VertexTexcoordsArrays))throw new Error(Messages.CONSTRUCT_ERROR);this._vertices_array=[],this._texcoords_array=[]},VNTInterleavedCacheKeys=function(){if(!(this instanceof VNTInterleavedCacheKeys))throw new Error(Messages.CONSTRUCT_ERROR);this.VNT_cacheKey=null,this.indices_cacheKey=null,this._vertices_count=0,this.indicesCount=0},VertexTexcoordsArraysCacheKeys=function(){if(!(this instanceof VertexTexcoordsArraysCacheKeys))throw new Error(Messages.CONSTRUCT_ERROR);this._verticesArray_cacheKey=null,this._texcoordsArray_cacheKey=null,this._vertices_count=0,this._normalsArray_cacheKey=null,this.verticesArrayBuffer,this.texCoordsArrayBuffer,this.normalsArrayBuffer},VertexTexcoordsArraysCacheKeysContainer=function(){if(!(this instanceof VertexTexcoordsArraysCacheKeysContainer))throw new Error(Messages.CONSTRUCT_ERROR);this._vtArrays_cacheKeys_array=[]};VertexTexcoordsArraysCacheKeysContainer.prototype.newVertexTexcoordsArraysCacheKey=function(){var e=new VertexTexcoordsArraysCacheKeys;return this._vtArrays_cacheKeys_array.push(e),e};var SimpleObject=function(){if(!(this instanceof SimpleObject))throw new Error(Messages.CONSTRUCT_ERROR);this._vtCacheKeys_container=new VertexTexcoordsArraysCacheKeysContainer},SimpleStorey=function(){if(!(this instanceof SimpleStorey))throw new Error(Messages.CONSTRUCT_ERROR);this._simpleObjects_array=[]};SimpleStorey.prototype.newSimpleObject=function(){var e=new SimpleObject;return this._simpleObjects_array.push(e),e};var SimpleBuilding=function(){if(!(this instanceof SimpleBuilding))throw new Error(Messages.CONSTRUCT_ERROR);this._simpleStoreys_list=[],this._simpleBuildingTexture};SimpleBuilding.prototype.newSimpleStorey=function(){var e=new SimpleStorey;return this._simpleStoreys_list.push(e),e};var SimpleBuildingV1=function(){if(!(this instanceof SimpleBuildingV1))throw new Error(Messages.CONSTRUCT_ERROR);this._simpleObjects_array=[],this._simpleBuildingTexture,this._texture_0,this._texture_1,this._texture_2,this._texture_3,this.color,this.textureArrayBuffer,this._vnt_cacheKeys};SimpleBuildingV1.prototype.newSimpleObject=function(){var e=new SimpleObject;return this._simpleObjects_array.push(e),e};var Header=function(){if(!(this instanceof Header))throw new Error(Messages.CONSTRUCT_ERROR);this._f4d_version=1,this._version="",this._type=-1,this._global_unique_id="",this._latitude=0,this._longitude=0,this._elevation=0,this._boundingBox=new BoundingBox,this._octZerothBox=new BoundingBox,this._dataFileName="",this._nailImageSize=0,this.isSmall=!1},BRBuildingProject=function(){if(!(this instanceof BRBuildingProject))throw new Error(Messages.CONSTRUCT_ERROR);this._header=new Header,this.move_matrix=new Float32Array(16),this.moveMatrixInv=new Float32Array(16),this.buildingPosMatInv,this.buildingPosition,this.buildingPositionHIGH,this.buildingPositionLOW,this._blocksList_Container=new BlocksListsContainer,this.createDefaultBlockReferencesLists(),this.octree,this._compRefList_Container=new CompoundReferencesListContainer,this._simpleBuilding=new SimpleBuilding,this._simpleBuilding_v1,this.radius_aprox,this._total_triangles_count=0,this._VBO_ByteColorsCacheKeysContainer_List=[],this._visibleCompRefLists_scratch=new CompoundReferencesList,this.point3dScratch=new Point3D,this.point3dScratch2=new Point3D,this._f4d_rawPathName="",this._f4d_headerPathName="",this._f4d_header_readed=!1,this._f4d_header_readed_finished=!1,this._f4d_simpleBuildingPathName="",this._f4d_simpleBuilding_readed=!1,this._f4d_simpleBuilding_readed_finished=!1,this._f4d_nailImagePathName="",this._f4d_nailImage_readed=!1,this._f4d_nailImage_readed_finished=!1,this._f4d_lod0ImagePathName="",this._f4d_lod0Image_readed=!1,this._f4d_lod0Image_readed_finished=!1,this._f4d_lod0Image_exists=!0,this._f4d_lod1ImagePathName="",this._f4d_lod1Image_readed=!1,this._f4d_lod1Image_readed_finished=!1,this._f4d_lod1Image_exists=!0,this._f4d_lod2ImagePathName="",this._f4d_lod2Image_readed=!1,this._f4d_lod2Image_readed_finished=!1,this._f4d_lod2Image_exists=!0,this._f4d_lod3ImagePathName="",this._f4d_lod3Image_readed=!1,this._f4d_lod3Image_readed_finished=!1,this._f4d_lod3Image_exists=!0,this._xdo_simpleBuildingPathName="",this._xdo_simpleBuilding_readed=!1,this._xdo_simpleBuilding_readed_finished=!1};BRBuildingProject.prototype.calculateTotalTrianglesCount=function(){for(var e,t=0,r=_interiorCompRefList_Container.compRefsListArray.length,i=0;i<r;i++){e=_interiorCompRefList_Container.compRefsListArray[i],t=e._compoundRefsArray.length;for(var s=0;s<t;s++);}},BRBuildingProject.prototype.getTransformedRelativeEyePositionToBuilding=function(e,t,r){var i=this.buildingPosition,s=e-i.x,n=t-i.y,o=r-i.z;return void 0==this.buildingPosMatInv&&(this.buildingPosMatInv=new Matrix4,this.buildingPosMatInv.setByFloat32Array(this.moveMatrixInv)),this.point3dScratch.set(s,n,o),this.point3dScratch2=this.buildingPosMatInv.transformPoint3D(this.point3dScratch,this.point3dScratch2),this.point3dScratch2},BRBuildingProject.prototype.isCameraInsideOfBuilding=function(e,t,r){return this._header._boundingBox.isPoint3dInside(e,t,r)},BRBuildingProject.prototype.updateCurrentVisibleIndicesExterior=function(e,t,r){this._compRefList_Container.updateCurrentVisibleIndicesOfLists(e,t,r)},BRBuildingProject.prototype.getVisibleCompRefLists=function(e,t,r){return this._visibleCompRefLists_scratch=this._compRefList_Container.get_visibleCompRefObjectsList(e,t,r,this._visibleCompRefLists_scratch),this._visibleCompRefLists_scratch},BRBuildingProject.prototype.getVisibleEXTCompRefLists=function(e,t,r){return this._compRefList_Container.get_visibleCompRefObjectsList(e,t,r)},BRBuildingProject.prototype.getAllCompRefLists=function(){var e=this._compRefList_Container.compRefsListArray.concat(this._interiorCompRefList_Container.compRefsListArray);return e},BRBuildingProject.prototype.getRadiusAprox=function(){if(void 0==this._boundingBox){var e=this._compRefList_Container.getCompRefListByName("Ref_Skin1");e&&(this._boundingBox=new BoundingBox,this._boundingBox.minX=e._ocCulling._ocCulling_box.minX,this._boundingBox.maxX=e._ocCulling._ocCulling_box.maxX,this._boundingBox.minY=e._ocCulling._ocCulling_box.minY,this._boundingBox.maxY=e._ocCulling._ocCulling_box.maxY,this._boundingBox.minZ=e._ocCulling._ocCulling_box.minZ,this._boundingBox.maxZ=e._ocCulling._ocCulling_box.maxZ,this.radius_aprox=this._boundingBox.getMaxLength()/2)}return this.radius_aprox},BRBuildingProject.prototype.getBoundingBox=function(){if(void 0==this._boundingBox){var e=this._compRefList_Container.getCompRefListByName("Ref_Skin1");e&&(this._boundingBox=new BoundingBox,this._boundingBox.minX=e._ocCulling._ocCulling_box._minX,this._boundingBox.maxX=e._ocCulling._ocCulling_box.maxX,this._boundingBox.minY=e._ocCulling._ocCulling_box.minY,this._boundingBox.maxY=e._ocCulling._ocCulling_box.maxY,this._boundingBox.minZ=e._ocCulling._ocCulling_box.minZ,this._boundingBox.maxZ=e._ocCulling._ocCulling_box.maxZ,this.radius_aprox=this._boundingBox.getMaxLength()/2)}return this._boundingBox},BRBuildingProject.prototype.createDefaultBlockReferencesLists=function(){this._blocksList_Container.newBlocksList("Blocks1"),this._blocksList_Container.newBlocksList("Blocks2"),this._blocksList_Container.newBlocksList("Blocks3"),this._blocksList_Container.newBlocksList("BlocksBone"),this._blocksList_Container.newBlocksList("Blocks4")};var PCloudMesh=function(){if(!(this instanceof PCloudMesh))throw new Error(Messages.CONSTRUCT_ERROR);this.move_matrix=new Float32Array(16),this.moveMatrixInv=new Float32Array(16),this.pCloudPosMat_inv,this._pCloudPosition,this._pCloudPositionHIGH,this._pCloudPositionLOW,this._header=new Header,this.vbo_datas=new VBOVertexIdxCacheKeysContainer,this._f4d_rawPathName="",this._f4d_headerPathName="",this._f4d_header_readed=!1,this._f4d_header_readed_finished=!1,this._f4d_geometryPathName="",this._f4d_geometry_readed=!1,this._f4d_geometry_readed_finished=!1},BRBuildingProjectsList=function(){if(!(this instanceof BRBuildingProjectsList))throw new Error(Messages.CONSTRUCT_ERROR);this._BR_buildingsArray=[],this._boundingBox,this._pCloudMesh_array=[]};BRBuildingProjectsList.prototype.newBRProject=function(){var e=new BRBuildingProject;return this._BR_buildingsArray.push(e),e},BRBuildingProjectsList.prototype.getBoundingBox=function(){if(void 0==this._boundingBox)for(var e=this._BR_buildingsArray.length,t=0;t<e;t++){var r=this._BR_buildingsArray[t],i=r.getBoundingBox();void 0==this._boundingBox?null!=i&&(this._boundingBox=i):null!=i&&this._boundingBox.addBox(i)}return this._boundingBox};
"use strict";var GlobeTile=function(){if(!(this instanceof GlobeTile))throw new Error(Messages.CONSTRUCT_ERROR)};GlobeTile.prototype.newSubTile=function(){var e=this.subTilesArray.length,i=new GlobeTile;return i.depth=this.depth+1,i.numberName=10*this.numberName+e+1,this.subTilesArray.push(i),i};
"use strict";var Lego=function(){if(!(this instanceof Lego))throw new Error(Messages.CONSTRUCT_ERROR);this.vbo_vicks_container=new VBOVertexIdxCacheKeysContainer,this.fileLoadState=CODE.fileLoadState.READY,this.dataArrayBuffer,this.selColor4};Lego.prototype.parseArrayBuffer=function(a,e,r,t){if(this.fileLoadState==CODE.fileLoadState.LOADING_FINISHED){this.fileLoadState=CODE.fileLoadState.PARSE_STARTED;var i=new BoundingBox;i.minX=new Float32Array(r.slice(t,t+4)),t+=4,i.minY=new Float32Array(r.slice(t,t+4)),t+=4,i.minZ=new Float32Array(r.slice(t,t+4)),t+=4,i.maxX=new Float32Array(r.slice(t,t+4)),t+=4,i.maxY=new Float32Array(r.slice(t,t+4)),t+=4,i.maxZ=new Float32Array(r.slice(t,t+4)),t+=4;var o=this.vbo_vicks_container.newVBOVertexIdxCacheKey(),n=e.readUInt32(r,t,t+4);t+=4;var s=3*n,l=t,c=t+4*s;o.posVboDataArray=new Float32Array(r.slice(l,c)),t+=4*s,o.vertexCount=n;var d=e.readUInt8(r,t,t+1);if(t+=1,d){n=e.readUInt32(r,t,t+4),t+=4;var A=3*n;l=t,c=t+1*A,o.norVboDataArray=new Int8Array(r.slice(l,c)),t+=1*A}var f=e.readUInt8(r,t,t+1);if(t+=1,f){n=e.readUInt32(r,t,t+4),t+=4;var y=4*n,l=t,c=t+1*y;o.colVboDataArray=new Uint8Array(r.slice(l,c)),t+=1*y}var I=e.readUInt8(r,t,t+1);if(t+=1,I){e.readUInt16(r,t,t+2);t+=2,n=e.readUInt32(r,t,t+4),t+=4;var v=2*n,l=t,c=t+4*v;o.tcoordVboDataArray=new Float32Array(r.slice(l,c)),t+=4*v}this.fileLoadState=CODE.fileLoadState.PARSE_FINISHED}return t};
"use strict";var Line=function(){if(!(this instanceof Line))throw new Error(Messages.CONSTRUCT_ERROR);this.point=new Point3D,this.direction=new Point3D};Line.prototype.setPointAndDir=function(i,t,n,e,o,s){this.point.set(i,t,n),this.direction.set(e,o,s),this.direction.unitary()};
"use strict";function magoStart(a,n){getMagoConfig(a,n)}function getMagoConfig(a,n){$.ajax({url:"/sample/database.json",type:"GET",dataType:"json",success:function(e){getBlocksConfig(a,n,e)},error:function(a){alert(a.responseText)}})}function getBlocksConfig(a,n,e){$.ajax({url:"/sample/blocks.json",type:"GET",dataType:"json",success:function(t){managerFactory=new ManagerFactory(a,n,e,t)},error:function(a){alert(a.responseText)}})}function changeMagoStateAPI(a){var n=new API("changeMagoState");n.setMagoEnable(a),null!=managerFactory&&managerFactory.callAPI(n)}function changeRenderAPI(a){var n=new API("changeRender");n.setRenderMode(a),null!=managerFactory&&managerFactory.callAPI(n)}function changeOutFittingAPI(a){var n=new API("changeOutFitting");n.setShowOutFitting(a),null!=managerFactory&&managerFactory.callAPI(n)}function changeBoundingBoxAPI(a){var n=new API("changeBoundingBox");n.setShowBoundingBox(a),null!=managerFactory&&managerFactory.callAPI(n)}function changeShadowAPI(a){var n=new API("changeShadow");n.setShowShadow(a),null!=managerFactory&&managerFactory.callAPI(n)}function changeFrustumFarDistanceAPI(a){var n=new API("changefrustumFarDistance");n.setFrustumFarDistance(a),null!=managerFactory&&managerFactory.callAPI(n)}function searchBlockAPI(a,n,e){var t=new API("searchBlock");t.setProjectId(a),t.setBlockType(n),t.setBlockId(e),null!=managerFactory&&managerFactory.callAPI(t)}function changeHighLightingAPI(a,n,e){var t=new API("changeHighLighting");t.setProjectId(a),t.setBlockIds(n),t.setObjectIds(e),null!=managerFactory&&managerFactory.callAPI(t)}function changeColorAPI(a,n,e,t){var o=new API("changeColor");o.setProjectId(a),o.setBlockIds(n),o.setObjectIds(e),o.setColor(t),null!=managerFactory&&managerFactory.callAPI(o)}function changeLocationAndRotationAPI(a,n,e,t,o,c,r,l){var g=new API("changeLocationAndRotation");g.setProjectId(a),g.setBlockId(n),g.setLatitude(e),g.setLongitude(t),g.setElevation(o),g.setHeading(c),g.setPitch(r),g.setRoll(l),null!=managerFactory&&managerFactory.callAPI(g)}function getLocationAndRotationAPI(a,n){var e=new API("getLocationAndRotation");if(e.setProjectId(a),e.setBlockId(n),null!=managerFactory){var t=managerFactory.callAPI(e);return t}}function showLocationAndRotationAPI(a,n,e,t,o,c,r,l,g){$("#projectId").val(a),$("#moveBlockId").val(n),void 0!==e&&null!==e&&$("#moveObjectId").val(e),$("#latitude").val(t),$("#longitude").val(o),void 0===c&&(c=0),$("#elevation").val(c),void 0===r&&(r=0),$("#heading").val(r),void 0===l&&(l=0),$("#pitch").val(l),void 0===g&&(g=0),$("#roll").val(g)}function changeMouseMoveAPI(a){var n=new API("changeMouseMove");n.setMouseMoveMode(a),null!=managerFactory&&managerFactory.callAPI(n)}
"use strict";var ManagerFactory=function(e,n,i,o){function a(){MagoConfig.getInformation().deployConfig.viewLibrary===Constant.CESIUM?t():MagoConfig.getInformation().deployConfig.viewLibrary===Constant.WORLDWIND}function t(){var n=e.scene.context._gl;e.scene.magoManager.selection.init(n,e.scene.drawingBufferWidth,e.scene.drawingBufferHeight),e.scene.magoManager.shadersManager.createDefaultShader(n),e.scene.magoManager.postFxShadersManager.gl=n,e.scene.magoManager.postFxShadersManager.createDefaultShaders(n),e.scene.magoManager.createDefaultShaders(n),e.scene.magoManager.scene=e.scene,m=e.scene.magoManager,C=e.scene,e.scene.globe.depthTestAgainstTerrain=!0,e.scene.magoManager.getObjectIndexFile(),e.scene.magoManager.handler=new Cesium.ScreenSpaceEventHandler(C.canvas),g()}function r(n){e.scene.screenSpaceCameraController.enableRotate=n,e.scene.screenSpaceCameraController.enableZoom=n,e.scene.screenSpaceCameraController.enableLook=n,e.scene.screenSpaceCameraController.enableTilt=n,e.scene.screenSpaceCameraController.enableTranslate=n}function g(){m.handler.setInputAction(function(e){m.dateSC=new Date,m.startTimeSC=m.dateSC.getTime(),m.mouse_x=e.position.x,m.mouse_y=e.position.y,m.mouseLeftDown=!0},Cesium.ScreenSpaceEventType.LEFT_DOWN),m.handler.setInputAction(function(e){m.dateSC=new Date,m.startTimeSC=m.dateSC.getTime(),m.mouse_x=e.position.x,m.mouse_y=e.position.y,m.mouseMiddleDown=!0},Cesium.ScreenSpaceEventType.MIDDLE_DOWN),m.handler.setInputAction(function(e){m.mouseLeftDown?e.startPosition.x==e.endPosition.x&&e.startPosition.y==e.endPosition.y||(0==m.magoPolicy.mouseMoveMode?void 0!=m.buildingSelected?(m.mouse_x=e.startPosition.x,m.mouse_y=e.startPosition.y,m.mustCheckIfDragging&&(m.isDragging(m.scene)&&(m.mouseDragging=!0,r(!1)),m.mustCheckIfDragging=!1)):m.isCameraMoving=!0:1==m.magoPolicy.mouseMoveMode&&(void 0!=m.objectSelected?(m.mouse_x=e.startPosition.x,m.mouse_y=e.startPosition.y,m.mustCheckIfDragging&&(m.isDragging(m.scene)&&(m.mouseDragging=!0,r(!1)),m.mustCheckIfDragging=!1)):m.isCameraMoving=!0),m.isCameraMoving=!0,m.mouseDragging&&m.moveSelectedObjectAsimetricMode(m.scene,m.currentRenderablesNeoRefListsArray)):(m.mouseDragging=!1,r(!0),m.mouseMiddleDown&&(m.isCameraMoving=!0))},Cesium.ScreenSpaceEventType.MOUSE_MOVE),m.handler.setInputAction(function(e){m.isCameraMoving=!1,m.mouseLeftDown=!1,m.mouseDragging=!1,m.selObjMovePlane=void 0,m.mustCheckIfDragging=!0,m.thereAreStartMovePoint=!1,r(!0),m.dateSC=new Date,m.currentTimeSC=m.dateSC.getTime();var n=m.currentTimeSC-m.startTimeSC;n<1e3&&m.mouse_x==e.position.x&&m.mouse_y==e.position.y&&(m.bPicking=!0)},Cesium.ScreenSpaceEventType.LEFT_UP),m.handler.setInputAction(function(e){m.isCameraMoving=!1,m.mouseMiddleDown=!1,m.mouseDragging=!1,m.selObjMovePlane=void 0,m.mustCheckIfDragging=!0,m.thereAreStartMovePoint=!1,r(!0),m.dateSC=new Date,m.currentTimeSC=m.dateSC.getTime();var n=m.currentTimeSC-m.startTimeSC;n<500&&m.mouse_x==e.position.x&&m.mouse_y==e.position.y&&(m.bPicking=!0)},Cesium.ScreenSpaceEventType.MIDDLE_UP)}function s(e){var n=3;if("q"===e.key||"Q"===e.key){var i=m.buildingSelected;if(void 0!=i){var o=i.geoLocDataManager.geoLocationDataArray[0];if(void 0!=o){void 0==o.heading&&(o.heading=0);var a=o.heading;m.changeLocationAndRotation(i.buildingId,o.latitude,o.longitude,o.elevation,a+n,o.pitch,o.roll)}}}else if("a"===e.key||"A"===e.key){var i=m.buildingSelected;if(void 0!=i){var o=i.geoLocDataManager.geoLocationDataArray[0];if(void 0!=o){void 0==o.heading&&(o.heading=0);var a=o.heading;m.changeLocationAndRotation(i.buildingId,o.latitude,o.longitude,o.elevation,a-n,o.pitch,o.roll)}}}else if("w"===e.key||"W"===e.key){var i=m.buildingSelected;if(void 0!=i){var o=i.geoLocDataManager.geoLocationDataArray[0];if(void 0!=o){void 0==o.pitch&&(o.pitch=0);var t=o.pitch;m.changeLocationAndRotation(i.buildingId,o.latitude,o.longitude,o.elevation,o.heading,t+n,o.roll)}}}else if("s"===e.key||"S"===e.key){var i=m.buildingSelected;if(void 0!=i){var o=i.geoLocDataManager.geoLocationDataArray[0];if(void 0!=o){void 0==o.pitch&&(o.pitch=0);var t=o.pitch;m.changeLocationAndRotation(i.buildingId,o.latitude,o.longitude,o.elevation,o.heading,t-n,o.roll)}}}else if("e"===e.key||"E"===e.key){var i=m.buildingSelected;if(void 0!=i){var o=i.geoLocDataManager.geoLocationDataArray[0];if(void 0!=o){void 0==o.roll&&(o.roll=0);var r=o.roll;m.changeLocationAndRotation(i.buildingId,o.latitude,o.longitude,o.elevation,o.heading,o.pitch,r+n)}}}else if("d"===e.key||"D"===e.key){var i=m.buildingSelected;if(void 0!=i){var o=i.geoLocDataManager.geoLocationDataArray[0];if(void 0!=o){void 0==o.roll&&(o.roll=0);var r=o.roll;m.changeLocationAndRotation(i.buildingId,o.latitude,o.longitude,o.elevation,o.heading,o.pitch,r-n)}}}}function d(){var n=new Cesium.WebMapServiceImageryProvider({url:MagoConfig.getInformation().backgroundProvider.url,layers:MagoConfig.getInformation().backgroundProvider.layers,parameters:{service:MagoConfig.getInformation().backgroundProvider.parameters.service,version:MagoConfig.getInformation().backgroundProvider.parameters.version,request:MagoConfig.getInformation().backgroundProvider.parameters.request,transparent:MagoConfig.getInformation().backgroundProvider.parameters.transparent,format:MagoConfig.getInformation().backgroundProvider.parameters.format}});e.imageryLayers.addImageryProvider(n)}function c(){return e.entities.add({name:MagoConfig.getInformation().geoConfig.initEntity.name,position:Cesium.Cartesian3.fromDegrees(MagoConfig.getInformation().geoConfig.initEntity.longitude,MagoConfig.getInformation().geoConfig.initEntity.latitude,MagoConfig.getInformation().geoConfig.initEntity.height),box:{dimensions:new Cesium.Cartesian3(3e8,3e8,3e8),fill:!1,material:Cesium.Color.TRANSPARENT,outline:!0,outlineWidth:3,outlineColor:Cesium.Color.BLACK}})}function l(){if(MagoConfig.getInformation().geoConfig.initTerrain.enable){var n=new Cesium.CesiumTerrainProvider({url:MagoConfig.getInformation().geoConfig.initTerrain.url,requestWaterMask:MagoConfig.getInformation().geoConfig.initTerrain.requestWaterMask,requestVertexNormals:MagoConfig.getInformation().geoConfig.initTerrain.requestVertexNormals});e.terrainProvider=n}}function u(){e.camera.flyTo({destination:Cesium.Cartesian3.fromDegrees(MagoConfig.getInformation().geoConfig.initCamera.longitude,MagoConfig.getInformation().geoConfig.initCamera.latitude,MagoConfig.getInformation().geoConfig.initCamera.height),duration:MagoConfig.getInformation().geoConfig.initCamera.duration})}function f(){var n=new API("renderMode");n.setRenderMode(MagoConfig.getInformation().renderingConfg.renderMode),m.callAPI(n),MagoConfig.getInformation().renderingConfg.timelineEnable||($(e._animation.container).css("visibility","hidden"),$(e._timeline.container).css("visibility","hidden"),e.forceResize())}if(!(this instanceof ManagerFactory))throw new Error(Messages.CONSTRUCT_ERROR);var m=null,C=null;return null===i.deployConfig||""===i.deployConfig||null===i.deployConfig.viewLibrary||""===i.deployConfig.viewLibrary||i.deployConfig.viewLibrary===Constant.CESIUM?(MagoConfig.init(i,o),null===e&&(e=new Cesium.Viewer(n)),e.scene.magoManager=new CesiumManager,i.backgroundProvider.enable&&d(),a(),c(),i.geoConfig.initTerrain.enable&&l(),i.geoConfig.initCamera.enable&&u(),f()):i.deployConfig.viewLibrary===Constant.WORLDWIND&&(e=null),document.addEventListener("keydown",function(e){s(e)},!1),{callAPI:function(e){var n=m.callAPI(e);if("getLocationAndRotation"===e.getAPIName())return n},init:function(){},search:function(e){},renderMode:function(e){},highlighting:function(e){},setColor:function(){},show:function(){a()},hide:function(){},move:function(){},demo:function(e,n){}}};
"use strict";function ManagerUtils(){}ManagerUtils.calculateBuildingPositionMatrix=function(i){var t=i.metaData;if(void 0==t||void 0==t.geographicCoord.longitude||void 0==t.geographicCoord.latitude||void 0==t.geographicCoord.altitude)return!1;var o;o=void 0!=i.buildingPosition?i.buildingPosition:Cesium.Cartesian3.fromDegrees(t.geographicCoord.longitude,t.geographicCoord.latitude,t.geographicCoord.altitude),i.buildingPosition=o;var a=Cesium.EncodedCartesian3.encode(o.x),r=Cesium.EncodedCartesian3.encode(o.y),n=Cesium.EncodedCartesian3.encode(o.z);return i.buildingPositionHIGH=new Float32Array(3),i.buildingPositionHIGH[0]=a.high,i.buildingPositionHIGH[1]=r.high,i.buildingPositionHIGH[2]=n.high,i.buildingPositionLOW=new Float32Array(3),i.buildingPositionLOW[0]=a.low,i.buildingPositionLOW[1]=r.low,i.buildingPositionLOW[2]=n.low,i.move_matrix=new Float32Array(16),i.moveMatrixInv=new Float32Array(16),i.transfMat=new Matrix4,i.transfMatInv=new Matrix4,Cesium.Transforms.eastNorthUpToFixedFrame(o,void 0,i.move_matrix),i.transfMat.setByFloat32Array(i.move_matrix),i.transfMat_inv=new Float32Array(16),Cesium.Matrix4.inverse(i.move_matrix,i.transfMat_inv),i.move_matrix[12]=0,i.move_matrix[13]=0,i.move_matrix[14]=0,i.buildingPosition=o,Cesium.Matrix4.inverse(i.move_matrix,i.moveMatrixInv),i.transfMatInv.setByFloat32Array(i.moveMatrixInv),!0},ManagerUtils.translatePivotPointGeoLocationData=function(i,t){if(void 0!=i){var o=new Point3D;o.set(-t.x,-t.y,-t.z);var a,r;r=i.tMatrix.transformPoint3D(t,r),a=i.tMatrix.rotatePoint3D(o,a),i.position.x+=a.x,i.position.y+=a.y,i.position.z+=a.z,i.aditionalTraslation=a,i.positionLOW[0]+=a.x,i.positionLOW[1]+=a.y,i.positionLOW[2]+=a.z,r.x+=a.x,r.y+=a.y,r.z+=a.z,void 0==i.pivotPoint&&(i.pivotPoint=new Point3D),i.pivotPoint.set(r.x,r.y,r.z)}},ManagerUtils.calculateGeoLocationData=function(i,t,o,a,r,n,e){if(void 0==e&&(e=new GeoLocationData),void 0==e.geographicCoord&&(e.geographicCoord=new GeographicCoord),void 0!=i&&(e.geographicCoord.longitude=i),void 0!=t&&(e.geographicCoord.latitude=t),void 0!=o&&(e.geographicCoord.altitude=o),void 0!=a&&(e.heading=a),void 0!=r&&(e.pitch=r),void 0!=n&&(e.roll=n),void 0!=e.geographicCoord.longitude&&void 0!=e.geographicCoord.latitude){e.position=Cesium.Cartesian3.fromDegrees(e.geographicCoord.longitude,e.geographicCoord.latitude,e.geographicCoord.altitude),void 0==e.positionHIGH&&(e.positionHIGH=new Float32Array([0,0,0])),void 0==e.positionLOW&&(e.positionLOW=new Float32Array([0,0,0])),this.calculateSplited3fv([e.position.x,e.position.y,e.position.z],e.positionHIGH,e.positionLOW),void 0==e.tMatrix?e.tMatrix=new Matrix4:e.tMatrix.Identity(),void 0==e.geoLocMatrix?e.geoLocMatrix=new Matrix4:e.geoLocMatrix.Identity(),void 0==e.geoLocMatrixInv?e.geoLocMatrixInv=new Matrix4:e.geoLocMatrixInv.Identity(),void 0==e.tMatrixInv?e.tMatrixInv=new Matrix4:e.tMatrixInv.Identity(),void 0==e.rotMatrix?e.rotMatrix=new Matrix4:e.rotMatrix.Identity(),void 0==e.rotMatrixInv?e.rotMatrixInv=new Matrix4:e.rotMatrixInv.Identity();var d=new Matrix4,l=new Matrix4,s=new Matrix4;void 0!=e.heading&&0!=e.heading&&s.rotationAxisAngDeg(e.heading,0,0,-1),void 0!=e.pitch&&0!=e.pitch&&d.rotationAxisAngDeg(e.pitch,-1,0,0),void 0!=e.roll&&0!=e.roll&&l.rotationAxisAngDeg(e.roll,0,-1,0),Cesium.Transforms.eastNorthUpToFixedFrame(e.position,void 0,e.tMatrix._floatArrays),e.geoLocMatrix.copyFromMatrix4(e.tMatrix);var g=s.getMultipliedByMatrix(e.tMatrix,g),c=d.getMultipliedByMatrix(g,c),v=l.getMultipliedByMatrix(c,v);return e.tMatrix=v,e.rotMatrix.copyFromMatrix4(e.tMatrix),e.rotMatrix._floatArrays[12]=0,e.rotMatrix._floatArrays[13]=0,e.rotMatrix._floatArrays[14]=0,Cesium.Matrix4.inverse(e.tMatrix._floatArrays,e.tMatrixInv._floatArrays),Cesium.Matrix4.inverse(e.rotMatrix._floatArrays,e.rotMatrixInv._floatArrays),Cesium.Matrix4.inverse(e.geoLocMatrix._floatArrays,e.geoLocMatrixInv._floatArrays),void 0==e.pivotPoint&&(e.pivotPoint=new Point3D),e.pivotPoint.set(e.position.x,e.position.y,e.position.z),e}},ManagerUtils.calculateSplitedValues=function(i,t){void 0==t&&(t=new SplitValue);var o;return i>=0?(o=65536*Math.floor(i/65536),t.high=o,t.low=i-o):(o=65536*Math.floor(-i/65536),t.high=-o,t.low=i+o),t},ManagerUtils.calculateSplited3fv=function(i,t,o){if(void 0!=i){void 0==t&&(t=new Float32Array(3)),void 0==o&&(o=new Float32Array(3));var a=new SplitValue;a=this.calculateSplitedValues(i[0],a);var r=new SplitValue;r=this.calculateSplitedValues(i[1],r);var n=new SplitValue;n=this.calculateSplitedValues(i[2],n),t[0]=a.high,t[1]=r.high,t[2]=n.high,o[0]=a.low,o[1]=r.low,o[2]=n.low}},ManagerUtils.getBuildingCurrentPosition=function(i,t){if(void 0!=t){var o;if(1==i)if(void 0==t.geoLocationDataAux){var a=MagoConfig.getInformation().blockConfig.blocks,r=a[t.buildingId];r?(t.geoLocationDataAux=ManagerUtils.calculateGeoLocationData(r.LONGITUDE,r.LATITUDE,r.ELEVATION,t.geoLocationDataAux),t.point3dScratch.set(0,0,50),o=t.geoLocationDataAux.tMatrix.transformPoint3D(t.point3dScratch,o)):(t.point3dScratch=t.bbox.getCenterPoint3d(t.point3dScratch),o=t.transfMat.transformPoint3D(t.point3dScratch,o))}else t.point3dScratch.set(0,0,50),o=t.geoLocationDataAux.tMatrix.transformPoint3D(t.point3dScratch,o);else t.point3dScratch=t.bbox.getCenterPoint3d(t.point3dScratch),o=t.transfMat.transformPoint3D(t.point3dScratch,o);return o}};
"use strict";var Matrix4=function(){if(!(this instanceof Matrix4))throw new Error(Messages.CONSTRUCT_ERROR);this._floatArrays=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]};Matrix4.prototype.Identity=function(){this._floatArrays=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},Matrix4.prototype.getRowMajorMatrix=function(){var t=new Float32Array(16);return t[0]=this.get(0,0),t[1]=this.get(1,0),t[2]=this.get(2,0),t[3]=this.get(3,0),t[4]=this.get(0,1),t[5]=this.get(1,1),t[6]=this.get(2,1),t[7]=this.get(3,1),t[8]=this.get(0,2),t[9]=this.get(1,2),t[10]=this.get(2,2),t[11]=this.get(3,2),t[12]=this.get(0,3),t[13]=this.get(1,3),t[14]=this.get(2,3),t[15]=this.get(3,3),t},Matrix4.prototype.rotationAxisAngDeg=function(t,r,i,a){var e=new Quaternion;e.rotationAngDeg(t,r,i,a),this.rotationByQuaternion(e),e=void 0},Matrix4.prototype.rotationAxisAngRad=function(t,r,i,a){var e=new Quaternion;e.rotationAngRad(t,r,i,a),this.rotationByQuaternion(e),e=void 0},Matrix4.prototype.rotationByQuaternion=function(t){var r=t.w,i=t.x,a=t.y,e=t.z;this._floatArrays[this.getIndexOfArray(0,0)]=1-2*a*a-2*e*e,this._floatArrays[this.getIndexOfArray(0,1)]=2*i*a+2*e*r,this._floatArrays[this.getIndexOfArray(0,2)]=2*i*e-2*a*r,this._floatArrays[this.getIndexOfArray(0,3)]=0,this._floatArrays[this.getIndexOfArray(1,0)]=2*i*a-2*e*r,this._floatArrays[this.getIndexOfArray(1,1)]=1-2*i*i-2*e*e,this._floatArrays[this.getIndexOfArray(1,2)]=2*a*e+2*i*r,this._floatArrays[this.getIndexOfArray(1,3)]=0,this._floatArrays[this.getIndexOfArray(2,0)]=2*i*e+2*a*r,this._floatArrays[this.getIndexOfArray(2,1)]=2*a*e-2*i*r,this._floatArrays[this.getIndexOfArray(2,2)]=1-2*i*i-2*a*a,this._floatArrays[this.getIndexOfArray(2,3)]=0,this._floatArrays[this.getIndexOfArray(3,0)]=0,this._floatArrays[this.getIndexOfArray(3,1)]=0,this._floatArrays[this.getIndexOfArray(3,2)]=0,this._floatArrays[this.getIndexOfArray(3,3)]=1},Matrix4.prototype.setByFloat32Array=function(t){for(var r=0;r<16;r++)this._floatArrays[r]=t[r]},Matrix4.prototype.getIndexOfArray=function(t,r){return 4*t+r},Matrix4.prototype.get=function(t,r){return this._floatArrays[this.getIndexOfArray(t,r)]},Matrix4.prototype.transformPoint3D=function(t,r){void 0==r&&(r=new Point3D);var i=t.x,a=t.y,e=t.z;return r.x=i*this.get(0,0)+a*this.get(1,0)+e*this.get(2,0)+this.get(3,0),r.y=i*this.get(0,1)+a*this.get(1,1)+e*this.get(2,1)+this.get(3,1),r.z=i*this.get(0,2)+a*this.get(1,2)+e*this.get(2,2)+this.get(3,2),r},Matrix4.prototype.rotatePoint3D=function(t,r){void 0==r&&(r=new Point3D);var i=t.x,a=t.y,e=t.z;return r.x=i*this.get(0,0)+a*this.get(1,0)+e*this.get(2,0),r.y=i*this.get(0,1)+a*this.get(1,1)+e*this.get(2,1),r.z=i*this.get(0,2)+a*this.get(1,2)+e*this.get(2,2),r},Matrix4.prototype.getMultipliedByMatrix=function(t,r){void 0==r&&(r=new Matrix4);for(var i=0;i<4;i++)for(var a=0;a<4;a++){var e=this.getIndexOfArray(i,a);r._floatArrays[e]=0;for(var s=0;s<4;s++)r._floatArrays[e]+=t.get(s,a)*this.get(i,s)}return r},Matrix4.prototype.copyFromMatrix4=function(t){for(var r=0;r<16;r++)this._floatArrays[r]=t._floatArrays[r]};
"use strict";var Messages={};Messages.CONSTRUCT_ERROR="  new   .";
"use strict";var MetaData=function(){if(!(this instanceof MetaData))throw new Error(Messages.CONSTRUCT_ERROR);this.guid,this.version="",this.geographicCoord,this.heading,this.pitch,this.roll,this.bbox,this.imageLodCount,this.oct_min_x=0,this.oct_max_x=0,this.oct_min_y=0,this.oct_max_y=0,this.oct_min_z=0,this.oct_max_z=0,this.isSmall=!1,this.fileLoadState=CODE.fileLoadState.READY};MetaData.prototype.parseFileHeader=function(i,t){var a=5,o=0,e=0;void 0==t&&(t=new ReaderWriter);for(var s=0;s<a;s++)this.version+=String.fromCharCode(new Int8Array(i.slice(e,e+1))),e+=1;void 0==this.guid&&(this.guid=""),o=t.readInt32(i,e,e+4),e+=4;for(var s=0;s<o;s++)this.guid+=String.fromCharCode(new Int8Array(i.slice(e,e+1))),e+=1;void 0==this.longitude?(this.longitude=new Float64Array(i.slice(e,e+8))[0],e+=8):e+=8,void 0==this.latitude?(this.latitude=new Float64Array(i.slice(e,e+8))[0],e+=8):e+=8,void 0==this.altitude?(this.altitude=new Float32Array(i.slice(e,e+4))[0],e+=4):e+=4,void 0==this.bbox&&(this.bbox=new BoundingBox),this.bbox.minX=new Float32Array(i.slice(e,e+4))[0],e+=4,this.bbox.minY=new Float32Array(i.slice(e,e+4))[0],e+=4,this.bbox.minZ=new Float32Array(i.slice(e,e+4))[0],e+=4,this.bbox.maxX=new Float32Array(i.slice(e,e+4))[0],e+=4,this.bbox.maxY=new Float32Array(i.slice(e,e+4))[0],e+=4,this.bbox.maxZ=new Float32Array(i.slice(e,e+4))[0],e+=4;t.readUInt8(i,e,e+1);e+=1,this.oct_min_x=new Float32Array(i.slice(e,e+4))[0],e+=4,this.oct_min_y=new Float32Array(i.slice(e,e+4))[0],e+=4,this.oct_min_z=new Float32Array(i.slice(e,e+4))[0],e+=4,this.oct_max_x=new Float32Array(i.slice(e,e+4))[0],e+=4,this.oct_max_y=new Float32Array(i.slice(e,e+4))[0],e+=4,this.oct_max_z=new Float32Array(i.slice(e,e+4))[0],e+=4;var r=!1;return(this.bbox.maxX-this.bbox.minX>40||this.bbox.maxY-this.bbox.minY>40)&&(r=!0),!r&&this.bbox.maxZ-this.bbox.minZ<30&&(this.isSmall=!0),e},MetaData.prototype.parseFileHeaderAsimetricVersion=function(i,t){var a=5,o=0,e=0;void 0==t&&(t=new ReaderWriter);for(var s=0;s<a;s++)this.version+=String.fromCharCode(new Int8Array(i.slice(e,e+1))),e+=1;void 0==this.guid&&(this.guid=""),o=t.readInt32(i,e,e+4),e+=4;for(var s=0;s<o;s++)this.guid+=String.fromCharCode(new Int8Array(i.slice(e,e+1))),e+=1;void 0==this.longitude?(this.longitude=new Float64Array(i.slice(e,e+8))[0],e+=8):e+=8,void 0==this.latitude?(this.latitude=new Float64Array(i.slice(e,e+8))[0],e+=8):e+=8,void 0==this.altitude?(this.altitude=new Float32Array(i.slice(e,e+4))[0],e+=4):e+=4,void 0==this.bbox&&(this.bbox=new BoundingBox),this.bbox.minX=new Float32Array(i.slice(e,e+4))[0],e+=4,this.bbox.minY=new Float32Array(i.slice(e,e+4))[0],e+=4,this.bbox.minZ=new Float32Array(i.slice(e,e+4))[0],e+=4,this.bbox.maxX=new Float32Array(i.slice(e,e+4))[0],e+=4,this.bbox.maxY=new Float32Array(i.slice(e,e+4))[0],e+=4,this.bbox.maxZ=new Float32Array(i.slice(e,e+4))[0],e+=4;var r=!1;return(this.bbox.maxX-this.bbox.minX>40||this.bbox.maxY-this.bbox.minY>40)&&(r=!0),!r&&this.bbox.maxZ-this.bbox.minZ<30&&(this.isSmall=!0),e};
"use strict";!function(){function e(e){this.threads=Math.max(2,0|e),this._queue=[],this._queueSize=0,this._activeThreads=0,this._debug={start:0,end:0,time:0}}var t=window.URL||window.webkitURL;if(!t)throw new Error("This browser does not support Blob URLs");if(!window.Worker)throw new Error("This browser does not support Web Workers");e.prototype._worker={JSON:function(){var e=func;self.addEventListener("message",function(t){for(var r=t.data,n=new DataView(r),a=r.byteLength,i=Array(a),o=0;o<a;o++)i[o]=String.fromCharCode(n.getUint8(o));var s=JSON.parse(i.join("")),u=e.apply(e,s);try{r=JSON.stringify(u)}catch(e){throw new Error("Parallel function must return JSON serializable response")}a="undefined"==typeof r?0:r.length;var f=new ArrayBuffer(a);for(n=new DataView(f),o=0;o<a;o++)n.setUint8(o,255&r.charCodeAt(o));self.postMessage(f,[f]),self.close()})},Int32:function(){var e=func;self.addEventListener("message",function(t){for(var r=t.data,n=new DataView(r),a=r.byteLength/4,i=Array(a),o=0;o<a;o++)i[o]=n.getInt32(4*o);var s=e.apply(e,i);s instanceof Array||(s=[s]),a=s.length;var u=new ArrayBuffer(4*a);for(n=new DataView(u),o=0;o<a;o++)n.setInt32(4*o,s[o]);self.postMessage(u,[u]),self.close()})},Float64:function(){var e=func;self.addEventListener("message",function(t){for(var r=t.data,n=new DataView(r),a=r.byteLength/8,i=Array(a),o=0;o<a;o++)i[o]=n.getFloat64(8*o);var s=e.apply(e,i);s instanceof Array||(s=[s]),a=s.length;var u=new ArrayBuffer(8*a);for(n=new DataView(u),o=0;o<a;o++)n.setFloat64(8*o,s[o]);self.postMessage(u,[u]),self.close()})}},e.prototype._encode={JSON:function(e){try{var t=JSON.stringify(e)}catch(e){throw new Error("Arguments provided to parallel function must be JSON serializable")}len=t.length;for(var r=new ArrayBuffer(len),n=new DataView(r),a=0;a<len;a++)n.setUint8(a,255&t.charCodeAt(a));return r},Int32:function(e){len=e.length;for(var t=new ArrayBuffer(4*len),r=new DataView(t),n=0;n<len;n++)r.setInt32(4*n,e[n]);return t},Float64:function(e){len=e.length;for(var t=new ArrayBuffer(8*len),r=new DataView(t),n=0;n<len;n++)r.setFloat64(8*n,e[n]);return t}},e.prototype._decode={JSON:function(e){for(var t=new DataView(e),r=e.byteLength,n=Array(r),a=0;a<r;a++)n[a]=String.fromCharCode(t.getUint8(a));return n.length?JSON.parse(n.join("")):void 0},Int32:function(e){for(var t=new DataView(e),r=e.byteLength/4,n=Array(r),a=0;a<r;a++)n[a]=t.getInt32(4*a);return n},Float64:function(e){for(var t=new DataView(e),r=e.byteLength/8,n=Array(r),a=0;a<r;a++)n[a]=t.getFloat64(8*a);return n}},e.prototype._execute=function(e,t,r,n){if(this._activeThreads||(this._debug.start=(new Date).valueOf()),this._activeThreads<this.threads){this._activeThreads++;var a=((new Date).valueOf(),new Worker(e)),i=this._encode[r](t),o=this._decode[r],s=this;if("JSON"===r)var u=function(e){n.call(s,o(e.data)),s.ready()};else var u=function(e){n.apply(s,o(e.data)),s.ready()};a.addEventListener("message",u),a.postMessage(i,[i])}else this._queueSize++,this._queue.push([e,t,r,n])},e.prototype.ready=function(){this._activeThreads--,this._queueSize?(this._execute.apply(this,this._queue.shift()),this._queueSize--):this._activeThreads||(this._debug.end=(new Date).valueOf(),this._debug.time=this._debug.end-this._debug.start)},e.prototype._prepare=function(e,r){e=e;var n=e.name,a=e.toString();if(!n)for(n="$"+(10*Math.random()|0);a.indexOf(n)!==-1;)n+=10*Math.random()|0;var i=this._worker[r].toString().replace(/^.*?[\n\r]+/gi,"").replace(/\}[\s]*$/,"").replace(/\/\*\*\/name\/\*\*\//gi,n).replace(/\/\*\*\/func\/\*\*\//gi,a),o=t.createObjectURL(new Blob([i],{type:"text/javascript"}));return o},e.prototype.process=function(e,t){var r=this._prepare(e,"JSON"),n=this;return function(){n._execute(r,[].slice.call(arguments),"JSON",t)}},e.prototype.processInt32=function(e,t){var r=this._prepare(e,"Int32"),n=this;return function(){n._execute(r,[].slice.call(arguments),"Int32",t)}},e.prototype.processFloat64=function(e,t){var r=this._prepare(e,"Float64"),n=this;return function(){n._execute(r,[].slice.call(arguments),"Float64",t)}},window.Multithread=e}();
"use strict";var NeoReference=function(){if(!(this instanceof NeoReference))throw new Error(Messages.CONSTRUCT_ERROR);this._id=0,this.objectId="",this._block_idx=-1,this._matrix4=new Matrix4,this._originalMatrix4=new Matrix4,this.tMatrixAuxArray,this.vBOVertexIdxCacheKeysContainer,this.MESH_TEXCOORD_cacheKey,this.hasTexture=!1,this.texture,this.color4,this.aditionalColor,this.selColor4,this.vertexCount=0,this.moveVector,this.bRendered=!1};NeoReference.prototype.multiplyTransformMatrix=function(e){this._matrix4=this._originalMatrix4.getMultipliedByMatrix(e)},NeoReference.prototype.multiplyKeyTransformMatrix=function(e,r){void 0==this.tMatrixAuxArray&&(this.tMatrixAuxArray=[]),this.tMatrixAuxArray[e]=this._originalMatrix4.getMultipliedByMatrix(r,this.tMatrixAuxArray[e])},NeoReference.prototype.hasKeyMatrix=function(e){return void 0!=this.tMatrixAuxArray&&void 0!=this.tMatrixAuxArray[e]},NeoReference.prototype.deleteGlObjects=function(e){this._id=void 0,this._block_idx=void 0,this._matrix4._floatArrays=void 0,this._matrix4=void 0,this._originalMatrix4._floatArrays=void 0,this._originalMatrix4=void 0,this.MESH_TEXCOORD_cacheKey&&(e.deleteBuffer(this.MESH_TEXCOORD_cacheKey),this.MESH_TEXCOORD_cacheKey=void 0),this.hasTexture=void 0,this.texture=void 0,this.color4=void 0,this.selColor4=void 0,this.vertexCount=void 0,this.moveVector=void 0,this.bRendered=void 0};var NeoReferencesList=function(){if(!(this instanceof NeoReferencesList))throw new Error(Messages.CONSTRUCT_ERROR);this.name="",this.neoRefs_Array=[],this.blocksList,this.lod_level=-1,this.fileLoadState=CODE.fileLoadState.READY,this.dataArraybuffer,this.neoBuildingOwner,this.exterior_ocCullOctree=new OcclusionCullingOctreeCell,this.interior_ocCullOctree=new OcclusionCullingOctreeCell,this._currentVisibleIndices=[],this._currentVisibleIndicesSC=[],this._currentVisibleIndicesSC_2=[]};NeoReferencesList.prototype.newNeoReference=function(){var e=new NeoReference;return this.neoRefs_Array.push(e),e},NeoReferencesList.prototype.setRenderedFalseToAllReferences=function(){for(var e=0,r=this.neoRefs_Array.length;e<r;e++){var t=this.neoRefs_Array[e];t.bRendered=!1}},NeoReferencesList.prototype.setRenderedTrueToReferencesWithId=function(e){for(var r=0,t=this.neoRefs_Array.length;r<t;r++){var i=this.neoRefs_Array[r];if(i._id==e)return void(i.bRendered=!0)}},NeoReferencesList.prototype.multiplyReferencesMatrices=function(e){for(var r=0,t=this.neoRefs_Array.length;r<t;r++){var i=this.neoRefs_Array[r];i.multiplyTransformMatrix(e)}},NeoReferencesList.prototype.deleteGlObjects=function(e){for(var r=0,t=this.neoRefs_Array.length;r<t;r++)this.neoRefs_Array[r].deleteGlObjects(e),this.neoRefs_Array[r]=void 0;this.neoRefs_Array.length=0,this.blocksList=void 0,this.lod_level=void 0,this.fileLoadState=CODE.fileLoadState.READY,this.dataArraybuffer=void 0,this.neoBuildingOwner=void 0,this.exterior_ocCullOctree=void 0,this.interior_ocCullOctree=void 0,this._currentVisibleIndices=void 0,this._currentVisibleIndicesSC=void 0,this._currentVisibleIndicesSC_2=void 0},NeoReferencesList.prototype.updateCurrentVisibleIndicesInterior=function(e,r,t){this._currentVisibleIndices=this.interior_ocCullOctree.getIndicesVisiblesForEye(e,r,t,this._currentVisibleIndicesSC_2)},NeoReferencesList.prototype.updateCurrentAllIndicesInterior=function(){this._currentVisibleIndices.length=0;for(var e=0,r=this.neoRefs_Array.length;e<r;e++)this._currentVisibleIndices.push(e)},NeoReferencesList.prototype.updateCurrentVisibleIndicesExterior=function(e,r,t){this._currentVisibleIndices=this.exterior_ocCullOctree.getIndicesVisiblesForEye(e,r,t,this._currentVisibleIndicesSC_2)},NeoReferencesList.prototype.updateCurrentVisibleIndices=function(e,r,t){this._currentVisibleIndicesSC=this.exterior_ocCullOctree.getIndicesVisiblesForEye(e,r,t,this._currentVisibleIndicesSC),this._currentVisibleIndicesSC_2=this.interior_ocCullOctree.getIndicesVisiblesForEye(e,r,t,this._currentVisibleIndicesSC_2),this._currentVisibleIndices=this._currentVisibleIndicesSC.concat(this._currentVisibleIndicesSC_2)},NeoReferencesList.prototype.parseArrayBuffer=function(e,r,t){this.fileLoadState=CODE.fileLoadState.PARSE_STARTED;var i,a,o=0,s=t.readUInt32(r,o,o+4);o+=4;for(var n=0;n<s;n++){var l=this.newNeoReference(),d=t.readUInt32(r,o,o+4);o+=4,l._id=d;var c=t.readUInt32(r,o,o+4);o+=4,l._block_idx=c,l._originalMatrix4._floatArrays[0]=t.readFloat32(r,o,o+4),o+=4,l._originalMatrix4._floatArrays[1]=t.readFloat32(r,o,o+4),o+=4,l._originalMatrix4._floatArrays[2]=t.readFloat32(r,o,o+4),o+=4,l._originalMatrix4._floatArrays[3]=t.readFloat32(r,o,o+4),o+=4,l._originalMatrix4._floatArrays[4]=t.readFloat32(r,o,o+4),o+=4,l._originalMatrix4._floatArrays[5]=t.readFloat32(r,o,o+4),o+=4,l._originalMatrix4._floatArrays[6]=t.readFloat32(r,o,o+4),o+=4,l._originalMatrix4._floatArrays[7]=t.readFloat32(r,o,o+4),o+=4,l._originalMatrix4._floatArrays[8]=t.readFloat32(r,o,o+4),o+=4,l._originalMatrix4._floatArrays[9]=t.readFloat32(r,o,o+4),o+=4,l._originalMatrix4._floatArrays[10]=t.readFloat32(r,o,o+4),o+=4,l._originalMatrix4._floatArrays[11]=t.readFloat32(r,o,o+4),o+=4,l._originalMatrix4._floatArrays[12]=t.readFloat32(r,o,o+4),o+=4,l._originalMatrix4._floatArrays[13]=t.readFloat32(r,o,o+4),o+=4,l._originalMatrix4._floatArrays[14]=t.readFloat32(r,o,o+4),o+=4,l._originalMatrix4._floatArrays[15]=t.readFloat32(r,o,o+4),o+=4;var f=t.readUInt8(r,o,o+1);if(o+=1,f){var h=t.readUInt16(r,o,o+2);o+=2;var _=t.readUInt8(r,o,o+1);o+=1;var u;5121==h&&(u=1);var v=t.readUInt8(r,o,o+u);o+=u;var y=t.readUInt8(r,o,o+u);o+=u;var I=t.readUInt8(r,o,o+u);o+=u;var x=255;4==_&&(x=t.readUInt8(r,o,o+u),o+=u),l.color4=new Color,l.color4.set(v,y,I,x)}var C=t.readUInt8(r,o,o+1);o+=1;var R=t.readUInt8(r,o,o+1);if(o+=1,C||R){var A=t.readInt32(r,o,o+4);o+=4,A>0&&void 0==l.vBOVertexIdxCacheKeysContainer&&(l.vBOVertexIdxCacheKeysContainer=new VBOVertexIdxCacheKeysContainer);for(var b=0;b<A;b++){var p=l.vBOVertexIdxCacheKeysContainer.newVBOVertexIdxCacheKey();if(C){var h=t.readUInt16(r,o,o+2);o+=2;var _=t.readUInt8(r,o,o+1);o+=1;var u;5120==h||5121==h?u=1:5122==h||5123==h?u=2:5126==h&&(u=4);var O=t.readUInt32(r,bytesReaded,bytesReaded+4);bytesReaded+=4;var g=O*_;l.vertexCount=O,i=bytesReaded,a=bytesReaded+u*g,p.colVboDataArray=new Float32Array(r.slice(i,a)),bytesReaded+=u*g}if(R){var h=t.readInt32(r,o,o+2);o+=2;var u;5120==h||5121==h?u=1:5122==h||5123==h?u=2:5126==h&&(u=4);var O=t.readUInt32(r,bytesReaded,bytesReaded+4);bytesReaded+=4;var g=2*O;l.vertexCount=O,i=bytesReaded,a=bytesReaded+u*g,p.tcoordVboDataArray=new Float32Array(r.slice(i,a)),bytesReaded+=u*g}}}var M=t.readUInt32(r,o,o+4);if(o+=4,M>0){l.texture=new Texture,l.hasTexture=!0;var F=t.readUInt32(r,o,o+4);o+=4;for(var b=0;b<F;b++)l.texture.textureTypeName+=String.fromCharCode(new Int8Array(r.slice(o,o+1))),o+=1;var U=t.readUInt32(r,o,o+4);o+=4;for(var b=0;b<U;b++)l.texture.textureImageFileName+=String.fromCharCode(new Int8Array(r.slice(o,o+1))),o+=1}else l.hasTexture=!1}var V=this.exterior_ocCullOctree;o=this.exterior_ocCullOctree.parseArrayBuffer(r,o,t),V.expandBox(1e3),V.setSizesSubBoxes();var S=this.interior_ocCullOctree;o=this.interior_ocCullOctree.parseArrayBuffer(r,o,t),S.setSizesSubBoxes(),this.fileLoadState=CODE.fileLoadState.PARSE_FINISHED};var NeoReferencesMotherAndIndices=function(){if(!(this instanceof NeoReferencesMotherAndIndices))throw new Error(Messages.CONSTRUCT_ERROR);this.motherNeoRefsList,this.blocksList,this.neoRefsIndices=[],this.fileLoadState=0,this.dataArraybuffer,this.exterior_ocCullOctree,this.interior_ocCullOctree,this.currentVisibleIndices=[]};NeoReferencesMotherAndIndices.prototype.multiplyKeyTransformMatrix=function(e,r){for(var t=this.neoRefsIndices.length,i=0;i<t;i++)this.motherNeoRefsList[this.neoRefsIndices[i]].multiplyKeyTransformMatrix(e,r)},NeoReferencesMotherAndIndices.prototype.updateCurrentVisibleIndices=function(e,r,t,i){e?void 0!=this.exterior_ocCullOctree&&(this.exterior_ocCullOctree._subBoxesArray&&this.exterior_ocCullOctree._subBoxesArray.length>0?this.currentVisibleIndices=this.exterior_ocCullOctree.getIndicesVisiblesForEye(r,t,i,this.currentVisibleIndices):this.currentVisibleIndices=this.neoRefsIndices):void 0!=this.interior_ocCullOctree&&(this.interior_ocCullOctree._subBoxesArray&&this.interior_ocCullOctree._subBoxesArray.length>0?this.currentVisibleIndices=this.interior_ocCullOctree.getIndicesVisiblesForEye(r,t,i,this.currentVisibleIndices):this.currentVisibleIndices=this.neoRefsIndices)},NeoReferencesMotherAndIndices.prototype.getNeoReference=function(e){return this.motherNeoRefsList[this.neoRefsIndices[e]]},NeoReferencesMotherAndIndices.prototype.deleteObjects=function(e){this.motherNeoRefsList=void 0,this.blocksList&&this.blocksList.deleteGlObjects(e),this.blocksList=void 0,this.neoRefsIndices=void 0,this.fileLoadState=0,this.dataArraybuffer=void 0,this.exterior_ocCullOctree=void 0,this.interior_ocCullOctree=void 0},NeoReferencesMotherAndIndices.prototype.setRenderedFalseToAllReferences=function(){for(var e=this.neoRefsIndices.length,r=0;r<e;r++)this.motherNeoRefsList[this.neoRefsIndices[r]].bRendered=!1},NeoReferencesMotherAndIndices.prototype.parseArrayBufferReferences=function(e,r,t,i,a){this.fileLoadState=CODE.fileLoadState.PARSE_STARTED;var o,s,n=0,l=t.readUInt32(r,n,n+4);n+=4;for(var d=0;d<l;d++){var c=new NeoReference,f=t.readUInt32(r,n,n+4);if(n+=4,c._id=f,this.motherNeoRefsList=i,void 0!=i[c._id]){c=i[c._id],this.neoRefsIndices.push(c._id);var h=t.readUInt8(r,n,n+1);n+=1;var _=String.fromCharCode.apply(null,new Int8Array(r.slice(n,n+h)));c.objectId=_,n+=h;var u=t.readUInt32(r,n,n+4);n+=4,c._block_idx=u,t.readFloat32(r,n,n+4),n+=4,t.readFloat32(r,n,n+4),n+=4,t.readFloat32(r,n,n+4),n+=4,t.readFloat32(r,n,n+4),n+=4,t.readFloat32(r,n,n+4),n+=4,t.readFloat32(r,n,n+4),n+=4,t.readFloat32(r,n,n+4),n+=4,t.readFloat32(r,n,n+4),n+=4,t.readFloat32(r,n,n+4),n+=4,t.readFloat32(r,n,n+4),n+=4,t.readFloat32(r,n,n+4),n+=4,t.readFloat32(r,n,n+4),n+=4,t.readFloat32(r,n,n+4),n+=4,t.readFloat32(r,n,n+4),n+=4,t.readFloat32(r,n,n+4),n+=4,t.readFloat32(r,n,n+4),n+=4;var v=t.readUInt8(r,n,n+1);if(n+=1,v){var y=t.readUInt16(r,n,n+2);n+=2;var I=t.readUInt8(r,n,n+1);n+=1;var x;5121==y&&(x=1);var C=t.readUInt8(r,n,n+x);n+=x;var R=t.readUInt8(r,n,n+x);n+=x;var A=t.readUInt8(r,n,n+x);n+=x;var b=255;4==I&&(b=t.readUInt8(r,n,n+x),n+=x)}var p=t.readUInt8(r,n,n+1);n+=1;var O=t.readUInt8(r,n,n+1);if(n+=1,p||O){var g=t.readInt32(r,n,n+4);n+=4;for(var M=0;M<g;M++){if(p){var y=t.readUInt16(r,n,n+2);n+=2;var I=t.readUInt8(r,n,n+1);n+=1;var x;5120==y||5121==y?x=1:5122==y||5123==y?x=2:5126==y&&(x=4);var F=t.readUInt32(r,n,n+4);n+=4;var U=F*I;o=n,s=n+x*U,n+=x*U}if(O){var y=t.readUInt16(r,n,n+2);n+=2;var x;5120==y||5121==y?x=1:5122==y||5123==y?x=2:5126==y&&(x=4);var F=t.readUInt32(r,n,n+4);n+=4;var U=2*F;o=n,s=n+x*U,n+=x*U}}}var V=t.readUInt32(r,n,n+4);if(n+=4,V>0){var S=t.readUInt32(r,n,n+4);n+=4;for(var M=0;M<S;M++)n+=1;var L=t.readUInt32(r,n,n+4);n+=4;for(var M=0;M<L;M++)n+=1}}else{i[c._id]=c,this.neoRefsIndices.push(c._id);var h=t.readUInt8(r,n,n+1);n+=1;var _=String.fromCharCode.apply(null,new Int8Array(r.slice(n,n+h)));c.objectId=_,n+=h;var u=t.readUInt32(r,n,n+4);n+=4,c._block_idx=u,c._originalMatrix4._floatArrays[0]=t.readFloat32(r,n,n+4),n+=4,c._originalMatrix4._floatArrays[1]=t.readFloat32(r,n,n+4),n+=4,c._originalMatrix4._floatArrays[2]=t.readFloat32(r,n,n+4),n+=4,c._originalMatrix4._floatArrays[3]=t.readFloat32(r,n,n+4),n+=4,c._originalMatrix4._floatArrays[4]=t.readFloat32(r,n,n+4),n+=4,c._originalMatrix4._floatArrays[5]=t.readFloat32(r,n,n+4),n+=4,c._originalMatrix4._floatArrays[6]=t.readFloat32(r,n,n+4),n+=4,c._originalMatrix4._floatArrays[7]=t.readFloat32(r,n,n+4),n+=4,c._originalMatrix4._floatArrays[8]=t.readFloat32(r,n,n+4),n+=4,c._originalMatrix4._floatArrays[9]=t.readFloat32(r,n,n+4),n+=4,c._originalMatrix4._floatArrays[10]=t.readFloat32(r,n,n+4),n+=4,c._originalMatrix4._floatArrays[11]=t.readFloat32(r,n,n+4),n+=4,c._originalMatrix4._floatArrays[12]=t.readFloat32(r,n,n+4),n+=4,c._originalMatrix4._floatArrays[13]=t.readFloat32(r,n,n+4),n+=4,c._originalMatrix4._floatArrays[14]=t.readFloat32(r,n,n+4),n+=4,c._originalMatrix4._floatArrays[15]=t.readFloat32(r,n,n+4),n+=4;var v=t.readUInt8(r,n,n+1);if(n+=1,v){var y=t.readUInt16(r,n,n+2);n+=2;var I=t.readUInt8(r,n,n+1);n+=1;var x;5121==y&&(x=1);var C=t.readUInt8(r,n,n+x);n+=x;var R=t.readUInt8(r,n,n+x);n+=x;var A=t.readUInt8(r,n,n+x);n+=x;var b=255;4==I&&(b=t.readUInt8(r,n,n+x),n+=x),c.color4=new Color,c.color4.set(C,R,A,b)}var p=t.readUInt8(r,n,n+1);n+=1;var O=t.readUInt8(r,n,n+1);if(n+=1,p||O){var g=t.readInt32(r,n,n+4);n+=4,g>0&&void 0==c.vBOVertexIdxCacheKeysContainer&&(c.vBOVertexIdxCacheKeysContainer=new VBOVertexIdxCacheKeysContainer);for(var M=0;M<g;M++){var N=c.vBOVertexIdxCacheKeysContainer.newVBOVertexIdxCacheKey();if(p){var y=t.readUInt16(r,n,n+2);n+=2;var I=t.readUInt8(r,n,n+1);n+=1;var x;5120==y||5121==y?x=1:5122==y||5123==y?x=2:5126==y&&(x=4);var F=t.readUInt32(r,n,n+4);n+=4;var U=F*I;c.vertexCount=F,o=n,s=n+x*U,N.colVboDataArray=new Float32Array(r.slice(o,s)),n+=x*U}if(O){var y=t.readUInt16(r,n,n+2);n+=2;var x;5120==y||5121==y?x=1:5122==y||5123==y?x=2:5126==y&&(x=4);var F=t.readUInt32(r,n,n+4);n+=4;var U=2*F;c.vertexCount=F,o=n,s=n+x*U,N.tcoordVboDataArray=new Float32Array(r.slice(o,s)),n+=x*U}}}var V=t.readUInt32(r,n,n+4);if(n+=4,V>0){c.texture=new Texture,c.hasTexture=!0;var S=t.readUInt32(r,n,n+4);n+=4;for(var M=0;M<S;M++)c.texture.textureTypeName+=String.fromCharCode(new Int8Array(r.slice(n,n+1))),n+=1;var L=t.readUInt32(r,n,n+4);n+=4;for(var M=0;M<L;M++)c.texture.textureImageFileName+=String.fromCharCode(new Int8Array(r.slice(n,n+1))),n+=1}else c.hasTexture=!1;a&&c.multiplyTransformMatrix(a)}}void 0==this.exterior_ocCullOctree&&(this.exterior_ocCullOctree=new OcclusionCullingOctreeCell);var w=this.exterior_ocCullOctree;n=this.exterior_ocCullOctree.parseArrayBuffer(r,n,t),w.expandBox(1e3),w.setSizesSubBoxes(),void 0==this.interior_ocCullOctree&&(this.interior_ocCullOctree=new OcclusionCullingOctreeCell);var E=this.interior_ocCullOctree;n=this.interior_ocCullOctree.parseArrayBuffer(r,n,t),E.setSizesSubBoxes(),this.fileLoadState=CODE.fileLoadState.PARSE_FINISHED};var NeoReferencesListsContainer=function(){if(!(this instanceof NeoReferencesListsContainer))throw new Error(Messages.CONSTRUCT_ERROR);this.neoRefsLists_Array=[]};NeoReferencesListsContainer.prototype.newNeoRefsList=function(e){var r=new NeoReferencesList;return r.blocksList=e,this.neoRefsLists_Array.push(r),r},NeoReferencesListsContainer.prototype.updateCurrentVisibleIndicesOfLists=function(e,r,t){for(var i=0,a=this.neoRefsLists_Array.length;i<a;i++)this.neoRefsLists_Array[i].updateCurrentVisibleIndices(e,r,t)},NeoReferencesListsContainer.prototype.updateCurrentAllIndicesOfLists=function(){for(var e=0,r=this.neoRefsLists_Array.length;e<r;e++)this.neoRefsLists_Array[e].updateCurrentAllIndicesInterior()};
"use strict";var NeoTexture=function(){if(!(this instanceof NeoTexture))throw new Error(Messages.CONSTRUCT_ERROR);this.lod,this.textureId,this.texImage,this.loadStarted=!1,this.loadFinished=!1};
"use strict";var OcclusionCullingOctreeCell=function(i){if(!(this instanceof OcclusionCullingOctreeCell))throw new Error(Messages.CONSTRUCT_ERROR);this._ocCulling_Cell_owner=i,this.minX=0,this.maxX=0,this.minY=0,this.maxY=0,this.minZ=0,this.maxZ=0,this._indicesArray=[],this._subBoxesArray=[],this._indicesUInt32Array=[]};OcclusionCullingOctreeCell.prototype.newSubBox=function(){var i=new OcclusionCullingOctreeCell(this);return this._subBoxesArray.push(i),i},OcclusionCullingOctreeCell.prototype.create8SubBoxes=function(){this._subBoxesArray.length=0;for(var i=0;i<8;i++)this.newSubBox()},OcclusionCullingOctreeCell.prototype.setDimensions=function(i,s,t,e,n,r){this.minX=i,this.maxX=s,this.minY=t,this.maxY=e,this.minZ=n,this.maxZ=r},OcclusionCullingOctreeCell.prototype.setSizesSubBoxes=function(){if(this._subBoxesArray.length>0){var i=(this.maxX+this.minX)/2,s=(this.maxY+this.minY)/2,t=(this.maxZ+this.minZ)/2;this._subBoxesArray[0].setDimensions(this.minX,i,this.minY,s,this.minZ,t),this._subBoxesArray[1].setDimensions(i,this.maxX,this.minY,s,this.minZ,t),this._subBoxesArray[2].setDimensions(i,this.maxX,s,this.maxY,this.minZ,t),this._subBoxesArray[3].setDimensions(this.minX,i,s,this.maxY,this.minZ,t),this._subBoxesArray[4].setDimensions(this.minX,i,this.minY,s,t,this.maxZ),this._subBoxesArray[5].setDimensions(i,this.maxX,this.minY,s,t,this.maxZ),this._subBoxesArray[6].setDimensions(i,this.maxX,s,this.maxY,t,this.maxZ),this._subBoxesArray[7].setDimensions(this.minX,i,s,this.maxY,t,this.maxZ);for(var e=0;e<this._subBoxesArray.length;e++)this._subBoxesArray[e].setSizesSubBoxes()}},OcclusionCullingOctreeCell.prototype.intersectsWithPoint3D=function(i,s,t){var e=!1;return i>this.minX&&i<this.maxX&&s>this.minY&&s<this.maxY&&t>this.minZ&&t<this.maxZ&&(e=!0),e},OcclusionCullingOctreeCell.prototype.getIntersectedSubBoxByPoint3D=function(i,s,t){if(null==this._ocCulling_Cell_owner&&!this.intersectsWithPoint3D(i,s,t))return null;var e=null,n=this._subBoxesArray.length;if(n>0){var r,l=(this.minX+this.maxX)/2,o=(this.minY+this.maxY)/2,h=(this.minZ+this.maxZ)/2,a=null;r=i<l?s<o?t<h?0:4:t<h?3:7:s<o?t<h?1:5:t<h?2:6,a=this._subBoxesArray[r],e=a.getIntersectedSubBoxByPoint3D(i,s,t)}else e=this;return e},OcclusionCullingOctreeCell.prototype.getIndicesVisiblesForEye=function(i,s,t,e){var n=this.getIntersectedSubBoxByPoint3D(i,s,t);return null!=n&&n._indicesArray.length>0&&(e=n._indicesArray),e},OcclusionCullingOctreeCell.prototype.expandBox=function(i){this.minX-=i,this.maxX+=i,this.minY-=i,this.maxY+=i,this.minZ-=i,this.maxZ+=i},OcclusionCullingOctreeCell.prototype.parseArrayBuffer=function(i,s,t){var e=t.readInt8(i,s,s+1);if(s+=1,e){var n=t.readFloat32(i,s,s+4);s+=4;var r=t.readFloat32(i,s,s+4);s+=4;var l=t.readFloat32(i,s,s+4);s+=4;var o=t.readFloat32(i,s,s+4);s+=4;var h=t.readFloat32(i,s,s+4);s+=4;var a=t.readFloat32(i,s,s+4);s+=4,this.setDimensions(n,r,l,o,h,a)}var u=t.readUInt32(i,s,s+4);if(s+=4,0==u){var c=t.readUInt32(i,s,s+4);s+=4;for(var m=0;m<c;m++){var x=t.readUInt32(i,s,s+4);s+=4,this._indicesArray.push(x)}}else for(var m=0;m<u;m++){var C=this.newSubBox();s=C.parseArrayBuffer(i,s,t)}return s};var OcclusionCullingOctree=function(){if(!(this instanceof OcclusionCullingOctree))throw new Error(Messages.CONSTRUCT_ERROR);this._ocCulling_box=new OcclusionCullingOctreeCell(null),this._infinite_ocCulling_box=new OcclusionCullingOctreeCell(null)};
"use strict";var Octree=function(e){if(!(this instanceof Octree))throw new Error(Messages.CONSTRUCT_ERROR);this.centerPos=new Point3D,this.half_dx=0,this.half_dy=0,this.half_dz=0,this.octree_owner,this.octree_level=0,this.octree_number_name=0,this.squareDistToEye=1e4,this.triPolyhedronsCount=0,this.fileLoadState=CODE.fileLoadState.READY,e&&(this.octree_owner=e,this.octree_level=e.octree_level+1),this.neoBuildingOwner,this.subOctrees_array=[],this.neoRefsList_Array=[],this.neoReferencesMotherAndIndices,this.lego};Octree.prototype.new_subOctree=function(){var e=new Octree(this);return e.octree_level=this.octree_level+1,this.subOctrees_array.push(e),e},Octree.prototype.deleteGlObjects=function(e){if(void 0!=this.lego&&(this.lego.vbo_vicks_container.deleteGlObjects(e),this.legoDataArrayBuffer=void 0),this.centerPos=void 0,this.half_dx=void 0,this.half_dy=void 0,this.half_dz=void 0,this.octree_owner=void 0,this.octree_level=void 0,this.octree_number_name=void 0,this.squareDistToEye=void 0,this.triPolyhedronsCount=void 0,this.fileLoadState=void 0,this.neoBuildingOwner=void 0,this.neoReferencesMotherAndIndices&&this.neoReferencesMotherAndIndices.deleteObjects(e),this.neoReferencesMotherAndIndices=void 0,this.legoDataArrayBuffer=void 0,this.lego=void 0,void 0!=this.neoRefsList_Array){for(var t=0,r=this.neoRefsList_Array.length;t<r;t++)this.neoRefsList_Array[t]&&this.neoRefsList_Array[t].deleteGlObjects(e),this.neoRefsList_Array[t]=void 0;this.neoRefsList_Array=void 0}if(void 0!=this.subOctrees_array){for(var t=0,s=this.subOctrees_array.length;t<s;t++)this.subOctrees_array[t].deleteGlObjects(e),this.subOctrees_array[t]=void 0;this.subOctrees_array=void 0}},Octree.prototype.deleteLod0GlObjects=function(e){if(this.neoRefsList_Array){for(var t=0,r=this.neoRefsList_Array.length;t<r;t++)this.neoRefsList_Array[t]&&this.neoRefsList_Array[t].deleteGlObjects(e),this.neoRefsList_Array[t]=void 0;this.neoRefsList_Array.legnth=0}if(void 0!=this.subOctrees_array)for(var t=0,s=this.subOctrees_array.length;t<s;t++)this.subOctrees_array[t].deleteLod0GlObjects(e)},Octree.prototype.setRenderedFalseToAllReferences=function(){if(this.neoReferencesMotherAndIndices){this.neoReferencesMotherAndIndices.setRenderedFalseToAllReferences();for(var e=this.subOctrees_array.length,t=0;t<e;t++)this.subOctrees_array[t].setRenderedFalseToAllReferences()}},Octree.prototype.makeTree=function(e){if(this.octree_level<e){for(var t=0;t<8;t++){var r=this.new_subOctree();r.octree_number_name=10*this.octree_number_name+(t+1)}this.setSizesSubBoxes();for(var t=0;t<8;t++)this.subOctrees_array[t].makeTree(e)}},Octree.prototype.getNumberOfDigits=function(e){if(e>0){var t=Math.floor(Math.log10(e)+1);return t}return 1},Octree.prototype.getMotherOctree=function(){return void 0==this.octree_owner?this:this.octree_owner.getMotherOctree()},Octree.prototype.getOctree=function(e,t){if(1==t)return 0==e?this.getMotherOctree():this.subOctrees_array[e-1];var r=t-1,s=Math.pow(10,r),i=Math.floor(e/s)%10,o=e-i*s;return this.subOctrees_array[i-1].getOctree(o,t-1)},Octree.prototype.getOctreeByNumberName=function(e){var t=this.getMotherOctree(),r=this.getNumberOfDigits(e);if(1==r)return 0==e?t:t.subOctrees_array[e-1];if(0!=t.subOctrees_array.length){var s=r-1,i=Math.pow(10,s),o=Math.floor(e/i)%10,n=e-o*i;return t.subOctrees_array[o-1].getOctree(n,r-1)}},Octree.prototype.setSizesSubBoxes=function(){if(this.subOctrees_array.length>0){var e=this.centerPos.x,t=this.centerPos.y,r=this.centerPos.z,s=this.centerPos.x-this.half_dx,i=this.centerPos.y-this.half_dy,o=this.centerPos.z-this.half_dz,n=this.centerPos.x+this.half_dx,a=this.centerPos.y+this.half_dy,h=this.centerPos.z+this.half_dz;this.subOctrees_array[0].setBoxSize(s,e,i,t,o,r),this.subOctrees_array[1].setBoxSize(e,n,i,t,o,r),this.subOctrees_array[2].setBoxSize(e,n,t,a,o,r),this.subOctrees_array[3].setBoxSize(s,e,t,a,o,r),this.subOctrees_array[4].setBoxSize(s,e,i,t,r,h),this.subOctrees_array[5].setBoxSize(e,n,i,t,r,h),this.subOctrees_array[6].setBoxSize(e,n,t,a,r,h),this.subOctrees_array[7].setBoxSize(s,e,t,a,r,h);for(var c=0;c<8;c++)this.subOctrees_array[c].setSizesSubBoxes()}},Octree.prototype.setBoxSize=function(e,t,r,s,i,o){this.centerPos.x=(t+e)/2,this.centerPos.y=(s+r)/2,this.centerPos.z=(o+i)/2,this.half_dx=(t-e)/2,this.half_dy=(s-r)/2,this.half_dz=(o-i)/2},Octree.prototype.getCenterPos=function(){return this.centerPos},Octree.prototype.getRadiusAprox=function(){return Math.abs(3*this.half_dx)},Octree.prototype.getCRefListArray=function(e){if(void 0==e&&(e=[]),this.subOctrees_array.length>0)for(var t=0,r=this.subOctrees_array.length;t<r;t++)this.subOctrees_array[t].getCRefListArray(e);else this.compRefsListArray.length>0&&e.push(this.compRefsListArray[0])},Octree.prototype.getNeoRefListArray=function(e){void 0==e&&(e=[]);var t=this.subOctrees_array.length;if(t>0)for(var r=0;r<t;r++)this.subOctrees_array[r].getNeoRefListArray(e);else this.neoRefsList_Array.length>0&&e.push(this.neoRefsList_Array[0])},Octree.prototype.getFrustumVisibleCRefListArray=function(e,t,r,s,i,o){var n=[],a=[];this.getFrustumVisibleOctrees(e,n,r);for(var h=n.length,c=0;c<h;c++)n[c].setSquareDistToEye(s,i,o),this.putOctreeInEyeDistanceSortedArray(a,n[c],s,i,o);for(var c=0;c<h;c++)a[c].getCRefListArray(t);n.length=0,excludedOctArray.length=0,n=void 0,excludedOctArray=void 0},Octree.prototype.getFrustumVisibleNeoRefListArray=function(e,t,r,s,i,o){var n=[],a=[];this.getFrustumVisibleOctreesNeoBuilding(e,n,r);for(var h=n.length,c=0;c<h;c++)n[c].setSquareDistToEye(s,i,o),this.putOctreeInEyeDistanceSortedArray(a,n[c],s,i,o);for(var c=0;c<h;c++)a[c].getNeoRefListArray(t);n=null,a=null},Octree.prototype.getFrustumVisibleLowestOctreesByLOD=function(e,t,r,s,i,o,n,a,h,c){var u=[],l=[],y=!1;this.getFrustumVisibleOctreesNeoBuildingAsimetricVersion(e,u,s);for(var f=u.length,d=0;d<f;d++)u[d].setSquareDistToEye(i,o,n);for(var d=0;d<f;d++)u[d].squareDistToEye<a?u[d].triPolyhedronsCount>0&&(this.putOctreeInEyeDistanceSortedArray(t.currentVisibles0,u[d],i,o,n),r.currentVisibles0.push(u[d]),y=!0):u[d].squareDistToEye<h?u[d].triPolyhedronsCount>0&&(this.putOctreeInEyeDistanceSortedArray(t.currentVisibles1,u[d],i,o,n),r.currentVisibles1.push(u[d]),y=!0):u[d].squareDistToEye<c?u[d].triPolyhedronsCount>0&&(this.putOctreeInEyeDistanceSortedArray(t.currentVisibles2,u[d],i,o,n),r.currentVisibles2.push(u[d]),y=!0):u[d].triPolyhedronsCount>0&&(this.putOctreeInEyeDistanceSortedArray(t.currentVisibles3,u[d],i,o,n),r.currentVisibles3.push(u[d]),y=!0);return u=null,l=null,y},Octree.prototype.getFrustumVisibleOctreesNeoBuilding=function(e,t,r){if(0!=this.subOctrees_array.length||0!=this.neoRefsList_Array.length){void 0==t&&(t=[]),void 0==r&&(r=new Cesium.BoundingSphere),r.center.x=this.centerPos.x,r.center.y=this.centerPos.y,r.center.z=this.centerPos.z,0==this.subOctrees_array.length?r.radius=this.getRadiusAprox():r.radius=this.getRadiusAprox();var s=e.computeVisibility(r);if(s==Cesium.Intersect.INSIDE)this.getAllSubOctreesIfHasRefLists(t);else if(s==Cesium.Intersect.INTERSECTING)if(0==this.subOctrees_array.length)t.push(this);else for(var i=0,o=this.subOctrees_array.length;i<o;i++)this.subOctrees_array[i].getFrustumVisibleOctreesNeoBuilding(e,t,r)}},Octree.prototype.getFrustumVisibleOctreesNeoBuildingAsimetricVersion=function(e,t,r){if(void 0!=this.subOctrees_array&&(0!=this.subOctrees_array.length||0!=this.triPolyhedronsCount)){void 0==t&&(t=[]),void 0==r&&(r=new Cesium.BoundingSphere),r.center.x=this.centerPos.x,r.center.y=this.centerPos.y,r.center.z=this.centerPos.z,0==this.subOctrees_array.length?r.radius=this.getRadiusAprox():r.radius=this.getRadiusAprox();var s=e.computeVisibility(r);if(s==Cesium.Intersect.INSIDE)this.getAllSubOctreesIfHasRefLists(t);else if(s==Cesium.Intersect.INTERSECTING)if(0==this.subOctrees_array.length)t.push(this);else for(var i=0,o=this.subOctrees_array.length;i<o;i++)this.subOctrees_array[i].getFrustumVisibleOctreesNeoBuildingAsimetricVersion(e,t,r)}},Octree.prototype.getFrustumVisibleOctrees=function(e,t,r){if(0!=this.subOctrees_array.length||0!=this.compRefsListArray.length){void 0==t&&(t=[]),void 0==r&&(r=new Cesium.BoundingSphere),r.center.x=this.centerPos.x,r.center.y=this.centerPos.y,r.center.z=this.centerPos.z,0==this.subOctrees_array.length?r.radius=this.getRadiusAprox():r.radius=this.getRadiusAprox();var s=e.computeVisibility(r);if(s==Cesium.Intersect.INSIDE)this.getAllSubOctrees(t);else if(s==Cesium.Intersect.INTERSECTING)if(0==this.subOctrees_array.length&&this.neoRefsList_Array.length>0)t.push(this);else for(var i=0,o=this.subOctrees_array.length;i<o;i++)this.subOctrees_array[i].getFrustumVisibleOctrees(e,t,r)}},Octree.prototype.setSquareDistToEye=function(e,t,r){this.squareDistToEye=(this.centerPos.x-e)*(this.centerPos.x-e)+(this.centerPos.y-t)*(this.centerPos.y-t)+(this.centerPos.z-r)*(this.centerPos.z-r)},Octree.prototype.getIndexToInsertBySquaredDistToEye=function(e,t){for(var r=!1,s=e.length,i=0,o=0;!r&&i<s;)e[i].squareDistToEye>t.squareDistToEye&&(o=i,r=!0),i++;return r||(o=s),o},Octree.prototype.putOctreeInEyeDistanceSortedArray=function(e,t,r,s,i){var o=this.getIndexToInsertBySquaredDistToEye(e,t);e.splice(o,0,t)},Octree.prototype.getAllSubOctreesIfHasRefLists=function(e){if(void 0!=this.subOctrees_array)if(void 0==e&&(e=[]),this.subOctrees_array.length>0)for(var t=0,r=this.subOctrees_array.length;t<r;t++)this.subOctrees_array[t].getAllSubOctreesIfHasRefLists(e);else this.triPolyhedronsCount>0&&e.push(this)},Octree.prototype.getAllSubOctrees=function(e){if(void 0==e&&(e=[]),this.subOctrees_array.length>0)for(var t=0,r=this.subOctrees_array.length;t<r;t++)this.subOctrees_array[t].getAllSubOctrees(e);else e.push(this)},Octree.prototype.extractLowestOctreesIfHasTriPolyhedrons=function(e){var t=this.subOctrees_array.length;if(0==t&&this.triPolyhedronsCount>0)e.push(this);else for(var r=0;r<t;r++)this.subOctrees_array[r].extractLowestOctreesIfHasTriPolyhedrons(e)},Octree.prototype.multiplyKeyTransformMatrix=function(e,t){var r=this.subOctrees_array.length;if(0==r&&this.triPolyhedronsCount>0)this.neoReferencesMotherAndIndices&&this.neoReferencesMotherAndIndices.multiplyKeyTransformMatrix(e,t);else for(var s=0;s<r;s++)this.subOctrees_array[s].multiplyKeyTransformMatrix(e,t)},Octree.prototype.parseAsimetricVersion=function(e,t,r,s){var i=t.readInt32(e,r,r+4);if(r+=4,0==i){var o=t.readFloat32(e,r,r+4);r+=4;var n=t.readFloat32(e,r,r+4);r+=4;var a=t.readFloat32(e,r,r+4);r+=4;var h=t.readFloat32(e,r,r+4);r+=4;var c=t.readFloat32(e,r,r+4);r+=4;var u=t.readFloat32(e,r,r+4);r+=4,this.setBoxSize(o,n,a,h,c,u),this.octree_number_name=0}var l=t.readUInt8(e,r,r+1);r+=1,this.triPolyhedronsCount=t.readInt32(e,r,r+4),r+=4,this.triPolyhedronsCount>0&&(this.neoBuildingOwner=s);for(var y=0;y<l;y++){var f=this.new_subOctree();f.octree_number_name=10*this.octree_number_name+(y+1)}this.setSizesSubBoxes();for(var y=0;y<l;y++){var f=this.subOctrees_array[y];r=f.parseAsimetricVersion(e,t,r,s)}return r};
"use strict";var Plane=function(){if(!(this instanceof Plane))throw new Error(Messages.CONSTRUCT_ERROR);this.a=0,this.b=0,this.c=0,this.d=0};Plane.prototype.setPointAndNormal=function(t,i,s,n,e,h){this.a=n,this.b=e,this.c=h,this.d=-this.a*t-this.b*i-this.c*s},Plane.prototype.intersectionLine=function(t,i){var s=t.point.x,n=t.point.y,e=t.point.z,h=t.direction.x,o=t.direction.y,a=t.direction.z,r=this.a*h+this.b*o+this.c*a;if(Math.abs(r)>1e-7){var c=-((this.a*s+this.b*n+this.c*e+this.d)/r);return void 0==i&&(i=new Point3D),i.set(s+c*h,n+c*o,e+c*a),i}};
"use strict";var Point3D=function(){if(!(this instanceof Point3D))throw new Error(Messages.CONSTRUCT_ERROR);this.x=0,this.y=0,this.z=0};Point3D.prototype.destroy=function(){this.x=null,this.y=null,this.z=null},Point3D.prototype.getModul=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},Point3D.prototype.unitary=function(){var t=this.getModul();this.x/=t,this.y/=t,this.z/=t},Point3D.prototype.crossProduct=function(t,i){return void 0==i&&(i=new Point3D),i.x=this.y*t.z-t.y*this.z,i.y=t.x*this.z-this.x*t.z,i.z=this.x*t.y-t.x*this.y,i},Point3D.prototype.squareDistTo=function(t,i,s){var o=this.x-t,n=this.y-i,h=this.z-s;return o*o+n*n+h*h},Point3D.prototype.set=function(t,i,s){this.x=t,this.y=i,this.z=s},Point3D.prototype.add=function(t,i,s){this.x+=t,this.y+=i,this.z+=s};
"use strict";var Policy=function(){if(!(this instanceof Policy))throw new Error(Messages.CONSTRUCT_ERROR);this.magoEnable=!0,this.showOutFitting=!1,this.showBoundingBox=!1,this.showShadow=!1,this.frustumFarSquaredDistance=5e6,this.highLightedBuildings=[],this.colorBuildings=[],this.color=[],this.hideBuildings=[],this.mouseMoveMode=0,this.colorChangedObjectId};Policy.prototype.getMagoEnable=function(){return this.magoEnable},Policy.prototype.setMagoEnable=function(o){this.magoEnable=o},Policy.prototype.getShowOutFitting=function(){return this.showOutFitting},Policy.prototype.setShowOutFitting=function(o){this.showOutFitting=o},Policy.prototype.getShowBoundingBox=function(){return this.showBoundingBox},Policy.prototype.setShowBoundingBox=function(o){this.showBoundingBox=o},Policy.prototype.getShowShadow=function(){return this.showShadow},Policy.prototype.setShowShadow=function(o){this.showShadow=o},Policy.prototype.getFrustumFarSquaredDistance=function(){return this.frustumFarSquaredDistance},Policy.prototype.setFrustumFarSquaredDistance=function(o){this.frustumFarSquaredDistance=o},Policy.prototype.getHighLightedBuildings=function(){return this.highLightedBuildings},Policy.prototype.setHighLightedBuildings=function(o){this.highLightedBuildings=o},Policy.prototype.getColorBuildings=function(){return this.colorBuildings},Policy.prototype.setColorBuildings=function(o){this.colorBuildings=o},Policy.prototype.getColor=function(){return this.color},Policy.prototype.setColor=function(o){this.color=o},Policy.prototype.getHideBuildings=function(){return this.hideBuildings},Policy.prototype.setHideBuildings=function(o){this.hideBuildings=o},Policy.prototype.getMouseMoveMode=function(){return this.mouseMoveMode},Policy.prototype.setMouseMoveMode=function(o){this.mouseMoveMode=o};
"use strict";var UniformMatrix4fvDataPair=function(o,r){if(!(this instanceof UniformMatrix4fvDataPair))throw new Error(Messages.CONSTRUCT_ERROR);this.gl=o,this.name=r,this.uniformLocation,this.matrix4fv};UniformMatrix4fvDataPair.prototype.bindUniform=function(){this.gl.uniformMatrix4fv(this.uniformLocation,!1,this.matrix4fv)};var UniformVec2fvDataPair=function(o,r){if(!(this instanceof UniformVec2fvDataPair))throw new Error(Messages.CONSTRUCT_ERROR);this.gl=o,this.name=r,this.uniformLocation,this.vec2fv};UniformVec2fvDataPair.prototype.bindUniform=function(){this.gl.uniform2fv(this.uniformLocation,!1,this.vec2fv)};var UniformVec3fvDataPair=function(o,r){if(!(this instanceof UniformVec3fvDataPair))throw new Error(Messages.CONSTRUCT_ERROR);this.gl=o,this.name=r,this.uniformLocation,this.vec3fv};UniformVec3fvDataPair.prototype.bindUniform=function(){this.gl.uniform3fv(this.uniformLocation,!1,this.vec3fv)};var UniformVec4fvDataPair=function(o,r){if(!(this instanceof UniformVec4fvDataPair))throw new Error(Messages.CONSTRUCT_ERROR);this.gl=o,this.name=r,this.uniformLocation,this.vec4fv};UniformVec4fvDataPair.prototype.bindUniform=function(){this.gl.uniform4fv(this.uniformLocation,!1,this.vec4fv)};var Uniform1fDataPair=function(o,r){if(!(this instanceof Uniform1fDataPair))throw new Error(Messages.CONSTRUCT_ERROR);this.gl=o,this.name=r,this.uniformLocation,this.floatValue};Uniform1fDataPair.prototype.bindUniform=function(){this.gl.uniform1f(this.uniformLocation,!1,this.floatValue)};var Uniform1iDataPair=function(o,r){if(!(this instanceof Uniform1iDataPair))throw new Error(Messages.CONSTRUCT_ERROR);this.gl=o,this.name=r,this.uniformLocation,this.intValue};Uniform1iDataPair.prototype.bindUniform=function(){this.gl.uniform1i(this.uniformLocation,!1,this.intValue)};var PostFxShader=function(o){if(!(this instanceof PostFxShader))throw new Error(Messages.CONSTRUCT_ERROR);this.gl=o,this.name,this.attribLocationCacheObj={},this.uniformsArray=[],this.uniformsCacheObj={},this.program,this.shader_vertex,this.shader_fragment,this.position3_loc,this.color3_loc,this.normal3_loc,this.texCoord2_loc,this.projectionMatrix4_loc,this.modelViewMatrix4_loc,this.modelViewProjectionMatrix4_loc,this.modelViewMatrix4RelToEye_loc,this.modelViewProjectionMatrix4RelToEye_loc,this.normalMatrix4_loc,this.normalMatrix3_loc,this.RefTransfMatrix,this.buildingPosHIGH_loc,this.buildingPosLOW_loc,this.cameraPosHIGH_loc,this.cameraPosLOW_loc,this.noiseScale2_loc,this.kernel16_loc,this.near_loc,this.far_loc,this.fov_loc,this.aspectRatio_loc,this.screenWidth_loc,this.screenHeight_loc,this.diffuseTex_loc,this.depthTex_loc,this.noiseTex_loc,this.texelSize_loc,this.colorTex_loc,this.useRefTransfMatrix_loc,this.useTexture_loc,this.invertNormals_loc};PostFxShader.prototype.bindUniforms=function(){for(var o=this.uniformsArray.length,r=0;r<o;r++)this.uniformsArray[r].bindUniform()},PostFxShader.prototype.newUniformDataPair=function(o,r){var a;return"Matrix4fv"==o?(a=new UniformMatrix4fvDataPair(this.gl,r),this.uniformsArray.push(a),this.uniformsCacheObj[r]=a):"Vec4fv"==o?(a=new UniformVec4fvDataPair(this.gl,r),this.uniformsArray.push(a),this.uniformsCacheObj[r]=a):"Vec3fv"==o?(a=new UniformVec3fvDataPair(this.gl,r),this.uniformsArray.push(a),this.uniformsCacheObj[r]=a):"Vec2fv"==o?(a=new UniformVec2fvDataPair(this.gl,r),this.uniformsArray.push(a),this.uniformsCacheObj[r]=a):"1f"==o?(a=new Uniform1fDataPair(this.gl,r),this.uniformsArray.push(a),this.uniformsCacheObj[r]=a):"1i"==o&&(a=new Uniform1iDataPair(this.gl,r),this.uniformsArray.push(a),this.uniformsCacheObj[r]=a),a};var PostFxShadersManager=function(){if(!(this instanceof PostFxShadersManager))throw new Error(Messages.CONSTRUCT_ERROR);this.gl,this.pFx_shaders_array=[],this.shadersCache={}};PostFxShadersManager.prototype.newShader=function(o){var r=new PostFxShader(this.gl);return r.name=o,this.shadersCache[o]=r,r},PostFxShadersManager.prototype.getShader=function(o,r,a,t){var e=o.createShader(a);return o.shaderSource(e,r),o.compileShader(e),o.getShaderParameter(e,o.COMPILE_STATUS)?e:(alert("ERROR IN "+t+" SHADER : "+o.getShaderInfoLog(e)),!1)},PostFxShadersManager.prototype.createDefaultShaders=function(o){this.createRenderDepthShader(o),this.createSsaoShader(o),this.createBlurShader(o),this.createRenderDepthShaderModelRef(o),this.createSsaoShaderModelRef(o),this.createColorSelectionShaderModelRef(o),this.createSimpleDepthShaderModelRef(o),this.createRenderDepthShaderLODBuilding(o),this.createSsaoShaderLODBuilding(o),this.createRenderDepthShaderLego(o),this.createSsaoShaderLego(o),this.createDepthShaderBox(o),this.createSsaoShaderBox(o)},PostFxShadersManager.prototype.createBlurShader=function(o){var r=new PostFxShader(this.gl);this.pFx_shaders_array.push(r);var a=ShaderSource.blurVsSource,t=ShaderSource.blurFsSource;r.program=o.createProgram(),r.shader_vertex=this.getShader(o,a,o.VERTEX_SHADER,"VERTEX"),r.shader_fragment=this.getShader(o,t,o.FRAGMENT_SHADER,"FRAGMENT"),o.attachShader(r.program,r.shader_vertex),o.attachShader(r.program,r.shader_fragment),o.linkProgram(r.program),r.projectionMatrix4_loc=o.getUniformLocation(r.program,"projectionMatrix"),r.modelViewMatrix4_loc=o.getUniformLocation(r.program,"modelViewMatrix"),r.position3_loc=o.getAttribLocation(r.program,"position"),r.texCoord2_loc=o.getAttribLocation(r.program,"texCoord"),r.attribLocationCacheObj.position=o.getAttribLocation(r.program,"position"),r.attribLocationCacheObj.texCoord=o.getAttribLocation(r.program,"texCoord"),r.texelSize_loc=o.getUniformLocation(r.program,"texelSize"),r.colorTex_loc=o.getUniformLocation(r.program,"colorTex")},PostFxShadersManager.prototype.createSsaoShader=function(o){var r=new PostFxShader(this.gl);this.pFx_shaders_array.push(r);var a=ShaderSource.ssaoVsSource,t=ShaderSource.ssaoFsSource;r.program=o.createProgram(),r.shader_vertex=this.getShader(o,a,o.VERTEX_SHADER,"VERTEX"),r.shader_fragment=this.getShader(o,t,o.FRAGMENT_SHADER,"FRAGMENT"),o.attachShader(r.program,r.shader_vertex),o.attachShader(r.program,r.shader_fragment),o.linkProgram(r.program),r.cameraPosHIGH_loc=o.getUniformLocation(r.program,"encodedCameraPositionMCHigh"),r.cameraPosLOW_loc=o.getUniformLocation(r.program,"encodedCameraPositionMCLow"),r.buildingPosHIGH_loc=o.getUniformLocation(r.program,"buildingPosHIGH"),r.buildingPosLOW_loc=o.getUniformLocation(r.program,"buildingPosLOW"),r.modelViewMatrix4RelToEye_loc=o.getUniformLocation(r.program,"modelViewMatrixRelToEye"),r.modelViewProjectionMatrix4RelToEye_loc=o.getUniformLocation(r.program,"ModelViewProjectionMatrixRelToEye"),r.normalMatrix4_loc=o.getUniformLocation(r.program,"normalMatrix4"),r.projectionMatrix4_loc=o.getUniformLocation(r.program,"projectionMatrix"),r.modelViewMatrix4_loc=o.getUniformLocation(r.program,"modelViewMatrix"),r.position3_loc=o.getAttribLocation(r.program,"position"),r.texCoord2_loc=o.getAttribLocation(r.program,"texCoord"),r.normal3_loc=o.getAttribLocation(r.program,"normal"),r.attribLocationCacheObj.position=o.getAttribLocation(r.program,"position"),r.attribLocationCacheObj.normal=o.getAttribLocation(r.program,"normal"),r.attribLocationCacheObj.texCoord=o.getAttribLocation(r.program,"texCoord"),r.noiseScale2_loc=o.getUniformLocation(r.program,"noiseScale"),r.kernel16_loc=o.getUniformLocation(r.program,"kernel"),r.near_loc=o.getUniformLocation(r.program,"near"),r.far_loc=o.getUniformLocation(r.program,"far"),r.fov_loc=o.getUniformLocation(r.program,"fov"),r.aspectRatio_loc=o.getUniformLocation(r.program,"aspectRatio"),r.screenWidth_loc=o.getUniformLocation(r.program,"screenWidth"),r.screenHeight_loc=o.getUniformLocation(r.program,"screenHeight"),r.depthTex_loc=o.getUniformLocation(r.program,"depthTex"),r.noiseTex_loc=o.getUniformLocation(r.program,"noiseTex"),r.diffuseTex_loc=o.getUniformLocation(r.program,"diffuseTex")},PostFxShadersManager.prototype.createRenderDepthShader=function(o){var r=new PostFxShader(this.gl);this.pFx_shaders_array.push(r);var a=ShaderSource.showDepthVsSource,t=ShaderSource.showDepthFsSource;r.program=o.createProgram(),r.shader_vertex=this.getShader(o,a,o.VERTEX_SHADER,"VERTEX"),r.shader_fragment=this.getShader(o,t,o.FRAGMENT_SHADER,"FRAGMENT"),o.attachShader(r.program,r.shader_vertex),o.attachShader(r.program,r.shader_fragment),o.linkProgram(r.program),r.cameraPosHIGH_loc=o.getUniformLocation(r.program,"encodedCameraPositionMCHigh"),r.cameraPosLOW_loc=o.getUniformLocation(r.program,"encodedCameraPositionMCLow"),r.buildingPosHIGH_loc=o.getUniformLocation(r.program,"buildingPosHIGH"),r.buildingPosLOW_loc=o.getUniformLocation(r.program,"buildingPosLOW"),r.modelViewMatrix4RelToEye_loc=o.getUniformLocation(r.program,"modelViewMatrixRelToEye"),r.modelViewProjectionMatrix4RelToEye_loc=o.getUniformLocation(r.program,"ModelViewProjectionMatrixRelToEye"),r.normalMatrix4_loc=o.getUniformLocation(r.program,"normalMatrix4"),r.position3_loc=o.getAttribLocation(r.program,"position"),r.normal3_loc=o.getAttribLocation(r.program,"normal"),r.attribLocationCacheObj.position=o.getAttribLocation(r.program,"position"),r.attribLocationCacheObj.normal=o.getAttribLocation(r.program,"normal"),r.near_loc=o.getUniformLocation(r.program,"near"),r.far_loc=o.getUniformLocation(r.program,"far")},PostFxShadersManager.prototype.createSsaoShaderModelRef=function(o){var r=new PostFxShader(this.gl);this.pFx_shaders_array.push(r);var a=ShaderSource.modelRefSsaoVsSource,t=ShaderSource.modelRefSsaoFsSource;r.program=o.createProgram(),r.shader_vertex=this.getShader(o,a,o.VERTEX_SHADER,"VERTEX"),r.shader_fragment=this.getShader(o,t,o.FRAGMENT_SHADER,"FRAGMENT"),o.attachShader(r.program,r.shader_vertex),o.attachShader(r.program,r.shader_fragment),o.linkProgram(r.program),r.cameraPosHIGH_loc=o.getUniformLocation(r.program,"encodedCameraPositionMCHigh"),r.cameraPosLOW_loc=o.getUniformLocation(r.program,"encodedCameraPositionMCLow"),r.buildingPosHIGH_loc=o.getUniformLocation(r.program,"buildingPosHIGH"),r.buildingPosLOW_loc=o.getUniformLocation(r.program,"buildingPosLOW"),r.modelViewMatrix4RelToEye_loc=o.getUniformLocation(r.program,"modelViewMatrixRelToEye"),r.modelViewProjectionMatrix4RelToEye_loc=o.getUniformLocation(r.program,"ModelViewProjectionMatrixRelToEye"),r.normalMatrix4_loc=o.getUniformLocation(r.program,"normalMatrix4"),r.projectionMatrix4_loc=o.getUniformLocation(r.program,"projectionMatrix"),r.RefTransfMatrix=o.getUniformLocation(r.program,"RefTransfMatrix"),r.position3_loc=o.getAttribLocation(r.program,"position"),r.texCoord2_loc=o.getAttribLocation(r.program,"texCoord"),r.normal3_loc=o.getAttribLocation(r.program,"normal"),r.attribLocationCacheObj.position=o.getAttribLocation(r.program,"position"),r.attribLocationCacheObj.texCoord=o.getAttribLocation(r.program,"texCoord"),r.attribLocationCacheObj.normal=o.getAttribLocation(r.program,"normal"),r.aditionalMov_loc=o.getUniformLocation(r.program,"aditionalPosition"),r.noiseScale2_loc=o.getUniformLocation(r.program,"noiseScale"),r.kernel16_loc=o.getUniformLocation(r.program,"kernel"),r.near_loc=o.getUniformLocation(r.program,"near"),r.far_loc=o.getUniformLocation(r.program,"far"),r.fov_loc=o.getUniformLocation(r.program,"fov"),r.aspectRatio_loc=o.getUniformLocation(r.program,"aspectRatio"),r.screenWidth_loc=o.getUniformLocation(r.program,"screenWidth"),r.screenHeight_loc=o.getUniformLocation(r.program,"screenHeight"),r.hasTexture_loc=o.getUniformLocation(r.program,"hasTexture"),r.color4Aux_loc=o.getUniformLocation(r.program,"vColor4Aux"),r.depthTex_loc=o.getUniformLocation(r.program,"depthTex"),r.noiseTex_loc=o.getUniformLocation(r.program,"noiseTex"),r.diffuseTex_loc=o.getUniformLocation(r.program,"diffuseTex")},PostFxShadersManager.prototype.createRenderDepthShaderModelRef=function(o,r){var a=new PostFxShader(this.gl);this.pFx_shaders_array.push(a);var t=ShaderSource.renderShowDepthVsSource,e=ShaderSource.renderShowDepthFsSource;a.program=o.createProgram(),a.shader_vertex=this.getShader(o,t,o.VERTEX_SHADER,"VERTEX"),a.shader_fragment=this.getShader(o,e,o.FRAGMENT_SHADER,"FRAGMENT"),o.attachShader(a.program,a.shader_vertex),o.attachShader(a.program,a.shader_fragment),o.linkProgram(a.program),a.cameraPosHIGH_loc=o.getUniformLocation(a.program,"encodedCameraPositionMCHigh"),a.cameraPosLOW_loc=o.getUniformLocation(a.program,"encodedCameraPositionMCLow"),a.buildingPosHIGH_loc=o.getUniformLocation(a.program,"buildingPosHIGH"),a.buildingPosLOW_loc=o.getUniformLocation(a.program,"buildingPosLOW"),a.modelViewMatrix4RelToEye_loc=o.getUniformLocation(a.program,"modelViewMatrixRelToEye"),a.modelViewProjectionMatrix4RelToEye_loc=o.getUniformLocation(a.program,"ModelViewProjectionMatrixRelToEye"),a.modelViewMatrix4_loc=o.getUniformLocation(a.program,"modelViewMatrix"),a.RefTransfMatrix=o.getUniformLocation(a.program,"RefTransfMatrix"),a.position3_loc=o.getAttribLocation(a.program,"position"),a.texCoord2_loc=o.getAttribLocation(a.program,"texCoord"),a.normal3_loc=o.getAttribLocation(a.program,"normal"),a.attribLocationCacheObj.position=o.getAttribLocation(a.program,"position"),a.attribLocationCacheObj.normal=o.getAttribLocation(a.program,"normal"),a.attribLocationCacheObj.texCoord=o.getAttribLocation(a.program,"texCoord"),a.aditionalMov_loc=o.getUniformLocation(a.program,"aditionalPosition"),a.near_loc=o.getUniformLocation(a.program,"near"),a.far_loc=o.getUniformLocation(a.program,"far")},PostFxShadersManager.prototype.createColorSelectionShaderModelRef=function(o){var r=new PostFxShader(this.gl);this.pFx_shaders_array.push(r);var a=ShaderSource.colorSelectionSsaoVsSource,t=ShaderSource.colorSelectionSsaoFsSource;r.program=o.createProgram(),r.shader_vertex=this.getShader(o,a,o.VERTEX_SHADER,"VERTEX"),r.shader_fragment=this.getShader(o,t,o.FRAGMENT_SHADER,"FRAGMENT"),o.attachShader(r.program,r.shader_vertex),o.attachShader(r.program,r.shader_fragment),o.linkProgram(r.program),r.cameraPosHIGH_loc=o.getUniformLocation(r.program,"encodedCameraPositionMCHigh"),r.cameraPosLOW_loc=o.getUniformLocation(r.program,"encodedCameraPositionMCLow"),r.buildingPosHIGH_loc=o.getUniformLocation(r.program,"buildingPosHIGH"),r.buildingPosLOW_loc=o.getUniformLocation(r.program,"buildingPosLOW"),r.modelViewProjectionMatrix4RelToEye_loc=o.getUniformLocation(r.program,"ModelViewProjectionMatrixRelToEye"),r.RefTransfMatrix=o.getUniformLocation(r.program,"RefTransfMatrix"),r.position3_loc=o.getAttribLocation(r.program,"position"),r.attribLocationCacheObj.position=o.getAttribLocation(r.program,"position"),r.aditionalMov_loc=o.getUniformLocation(r.program,"aditionalPosition"),r.color4Aux_loc=o.getUniformLocation(r.program,"vColor4Aux")},PostFxShadersManager.prototype.createSimpleDepthShaderModelRef=function(o){var r=new PostFxShader(this.gl);this.pFx_shaders_array.push(r);var a=ShaderSource.simpleDepthSsaoVsSource,t=ShaderSource.simpleDepthSsaoFsSource;r.program=o.createProgram(),r.shader_vertex=this.getShader(o,a,o.VERTEX_SHADER,"VERTEX"),r.shader_fragment=this.getShader(o,t,o.FRAGMENT_SHADER,"FRAGMENT"),o.attachShader(r.program,r.shader_vertex),o.attachShader(r.program,r.shader_fragment),o.linkProgram(r.program),r.cameraPosHIGH_loc=o.getUniformLocation(r.program,"encodedCameraPositionMCHigh"),r.cameraPosLOW_loc=o.getUniformLocation(r.program,"encodedCameraPositionMCLow"),r.buildingPosHIGH_loc=o.getUniformLocation(r.program,"buildingPosHIGH"),r.buildingPosLOW_loc=o.getUniformLocation(r.program,"buildingPosLOW"),r.modelViewProjectionMatrix4RelToEye_loc=o.getUniformLocation(r.program,"ModelViewProjectionMatrixRelToEye"),r.RefTransfMatrix=o.getUniformLocation(r.program,"RefTransfMatrix"),r.modelViewMatrix4RelToEye_loc=o.getUniformLocation(r.program,"modelViewMatrixRelToEye"),r.position3_loc=o.getAttribLocation(r.program,"position"),r.attribLocationCacheObj.position=o.getAttribLocation(r.program,"position"),r.far_loc=o.getUniformLocation(r.program,"far")},PostFxShadersManager.prototype.createSsaoShaderLODBuilding=function(o){var r=new PostFxShader(this.gl);this.pFx_shaders_array.push(r);var a=ShaderSource.LodBuildingSsaoVsSource,t=ShaderSource.LodBuildingSsaoFsSource;r.program=o.createProgram(),r.shader_vertex=this.getShader(o,a,o.VERTEX_SHADER,"VERTEX"),r.shader_fragment=this.getShader(o,t,o.FRAGMENT_SHADER,"FRAGMENT"),o.attachShader(r.program,r.shader_vertex),o.attachShader(r.program,r.shader_fragment),o.linkProgram(r.program),r.cameraPosHIGH_loc=o.getUniformLocation(r.program,"encodedCameraPositionMCHigh"),r.cameraPosLOW_loc=o.getUniformLocation(r.program,"encodedCameraPositionMCLow"),r.buildingPosHIGH_loc=o.getUniformLocation(r.program,"buildingPosHIGH"),r.buildingPosLOW_loc=o.getUniformLocation(r.program,"buildingPosLOW"),r.modelViewMatrix4RelToEye_loc=o.getUniformLocation(r.program,"modelViewMatrixRelToEye"),r.modelViewProjectionMatrix4RelToEye_loc=o.getUniformLocation(r.program,"ModelViewProjectionMatrixRelToEye"),r.normalMatrix4_loc=o.getUniformLocation(r.program,"normalMatrix4"),r.projectionMatrix4_loc=o.getUniformLocation(r.program,"projectionMatrix"),r.modelViewMatrix4_loc=o.getUniformLocation(r.program,"modelViewMatrix"),r.RefTransfMatrix=o.getUniformLocation(r.program,"RefTransfMatrix"),r.buildingRotMatrix_loc=o.getUniformLocation(r.program,"buildingRotMatrix"),r.bUse1Color_loc=o.getUniformLocation(r.program,"bUse1Color"),r.oneColor4_loc=o.getUniformLocation(r.program,"oneColor4"),r.hasTexture_loc=o.getUniformLocation(r.program,"hasTexture"),r.position3_loc=o.getAttribLocation(r.program,"position"),r.texCoord2_loc=o.getAttribLocation(r.program,"texCoord"),r.normal3_loc=o.getAttribLocation(r.program,"normal"),r.color4_loc=o.getAttribLocation(r.program,"color4"),r.attribLocationCacheObj.position=o.getAttribLocation(r.program,"position"),r.attribLocationCacheObj.normal=o.getAttribLocation(r.program,"normal"),r.attribLocationCacheObj.color4=o.getAttribLocation(r.program,"color4"),r.aditionalMov_loc=o.getUniformLocation(r.program,"aditionalPosition"),r.noiseScale2_loc=o.getUniformLocation(r.program,"noiseScale"),r.kernel16_loc=o.getUniformLocation(r.program,"kernel"),r.near_loc=o.getUniformLocation(r.program,"near"),r.far_loc=o.getUniformLocation(r.program,"far"),r.fov_loc=o.getUniformLocation(r.program,"fov"),r.aspectRatio_loc=o.getUniformLocation(r.program,"aspectRatio"),r.screenWidth_loc=o.getUniformLocation(r.program,"screenWidth"),r.screenHeight_loc=o.getUniformLocation(r.program,"screenHeight"),r.color4Aux_loc=o.getUniformLocation(r.program,"vColor4Aux"),r.depthTex_loc=o.getUniformLocation(r.program,"depthTex"),r.noiseTex_loc=o.getUniformLocation(r.program,"noiseTex"),r.diffuseTex_loc=o.getUniformLocation(r.program,"diffuseTex"),r.useRefTransfMatrix_loc=o.getUniformLocation(r.program,"useRefTransfMatrix"),r.useTexture_loc=o.getUniformLocation(r.program,"useTexture"),r.invertNormals_loc=o.getUniformLocation(r.program,"invertNormals")},PostFxShadersManager.prototype.createRenderDepthShaderLODBuilding=function(o){var r=new PostFxShader(this.gl);this.pFx_shaders_array.push(r);var a=ShaderSource.lodBuildingDepthVsSource,t=ShaderSource.lodBuildingDepthFsSource;r.program=o.createProgram(),r.shader_vertex=this.getShader(o,a,o.VERTEX_SHADER,"VERTEX"),r.shader_fragment=this.getShader(o,t,o.FRAGMENT_SHADER,"FRAGMENT"),o.attachShader(r.program,r.shader_vertex),o.attachShader(r.program,r.shader_fragment),o.linkProgram(r.program),r.cameraPosHIGH_loc=o.getUniformLocation(r.program,"encodedCameraPositionMCHigh"),r.cameraPosLOW_loc=o.getUniformLocation(r.program,"encodedCameraPositionMCLow"),r.buildingPosHIGH_loc=o.getUniformLocation(r.program,"buildingPosHIGH"),r.buildingPosLOW_loc=o.getUniformLocation(r.program,"buildingPosLOW"),r.modelViewMatrix4RelToEye_loc=o.getUniformLocation(r.program,"modelViewMatrixRelToEye"),r.modelViewProjectionMatrix4RelToEye_loc=o.getUniformLocation(r.program,"ModelViewProjectionMatrixRelToEye"),r.modelViewMatrix4_loc=o.getUniformLocation(r.program,"modelViewMatrix"),r.RefTransfMatrix=o.getUniformLocation(r.program,"RefTransfMatrix"),r.buildingRotMatrix_loc=o.getUniformLocation(r.program,"buildingRotMatrix"),r.position3_loc=o.getAttribLocation(r.program,"position"),r.attribLocationCacheObj.position=o.getAttribLocation(r.program,"position"),r.aditionalMov_loc=o.getUniformLocation(r.program,"aditionalPosition"),r.near_loc=o.getUniformLocation(r.program,"near"),r.far_loc=o.getUniformLocation(r.program,"far")},PostFxShadersManager.prototype.createSsaoShaderLego=function(o){var r=new PostFxShader(this.gl);this.pFx_shaders_array.push(r);var a=ShaderSource.LegoSsaoVsSource,t=ShaderSource.LegoSsaoFsSource;r.program=o.createProgram(),r.shader_vertex=this.getShader(o,a,o.VERTEX_SHADER,"VERTEX"),r.shader_fragment=this.getShader(o,t,o.FRAGMENT_SHADER,"FRAGMENT"),o.attachShader(r.program,r.shader_vertex),o.attachShader(r.program,r.shader_fragment),o.linkProgram(r.program),r.cameraPosHIGH_loc=o.getUniformLocation(r.program,"encodedCameraPositionMCHigh"),r.cameraPosLOW_loc=o.getUniformLocation(r.program,"encodedCameraPositionMCLow"),r.buildingPosHIGH_loc=o.getUniformLocation(r.program,"buildingPosHIGH"),r.buildingPosLOW_loc=o.getUniformLocation(r.program,"buildingPosLOW"),r.modelViewMatrix4RelToEye_loc=o.getUniformLocation(r.program,"modelViewMatrixRelToEye"),r.modelViewProjectionMatrix4RelToEye_loc=o.getUniformLocation(r.program,"ModelViewProjectionMatrixRelToEye"),r.normalMatrix4_loc=o.getUniformLocation(r.program,"normalMatrix4"),r.projectionMatrix4_loc=o.getUniformLocation(r.program,"projectionMatrix"),r.modelViewMatrix4_loc=o.getUniformLocation(r.program,"modelViewMatrix"),r.RefTransfMatrix=o.getUniformLocation(r.program,"RefTransfMatrix"),r.buildingRotMatrix_loc=o.getUniformLocation(r.program,"buildingRotMatrix"),r.position3_loc=o.getAttribLocation(r.program,"position"),r.normal3_loc=o.getAttribLocation(r.program,"normal"),r.color4_loc=o.getAttribLocation(r.program,"color4"),r.attribLocationCacheObj.position=o.getAttribLocation(r.program,"position"),r.attribLocationCacheObj.normal=o.getAttribLocation(r.program,"normal"),r.attribLocationCacheObj.color4=o.getAttribLocation(r.program,"color4"),r.aditionalMov_loc=o.getUniformLocation(r.program,"aditionalPosition"),r.noiseScale2_loc=o.getUniformLocation(r.program,"noiseScale"),r.kernel16_loc=o.getUniformLocation(r.program,"kernel"),r.near_loc=o.getUniformLocation(r.program,"near"),r.far_loc=o.getUniformLocation(r.program,"far"),r.fov_loc=o.getUniformLocation(r.program,"fov"),r.aspectRatio_loc=o.getUniformLocation(r.program,"aspectRatio"),r.screenWidth_loc=o.getUniformLocation(r.program,"screenWidth"),r.screenHeight_loc=o.getUniformLocation(r.program,"screenHeight"),r.hasTexture_loc=o.getUniformLocation(r.program,"hasTexture"),r.color4Aux_loc=o.getUniformLocation(r.program,"vColor4Aux"),r.depthTex_loc=o.getUniformLocation(r.program,"depthTex"),r.noiseTex_loc=o.getUniformLocation(r.program,"noiseTex"),r.diffuseTex_loc=o.getUniformLocation(r.program,"diffuseTex"),r.useRefTransfMatrix_loc=o.getUniformLocation(r.program,"useRefTransfMatrix"),r.useTexture_loc=o.getUniformLocation(r.program,"useTexture"),r.invertNormals_loc=o.getUniformLocation(r.program,"invertNormals")},PostFxShadersManager.prototype.createRenderDepthShaderLego=function(o){var r=new PostFxShader(this.gl);this.pFx_shaders_array.push(r);var a=ShaderSource.LegoDepthVsSource,t=ShaderSource.LegoDepthFsSource;r.program=o.createProgram(),r.shader_vertex=this.getShader(o,a,o.VERTEX_SHADER,"VERTEX"),r.shader_fragment=this.getShader(o,t,o.FRAGMENT_SHADER,"FRAGMENT"),o.attachShader(r.program,r.shader_vertex),o.attachShader(r.program,r.shader_fragment),o.linkProgram(r.program),r.cameraPosHIGH_loc=o.getUniformLocation(r.program,"encodedCameraPositionMCHigh"),r.cameraPosLOW_loc=o.getUniformLocation(r.program,"encodedCameraPositionMCLow"),r.buildingPosHIGH_loc=o.getUniformLocation(r.program,"buildingPosHIGH"),r.buildingPosLOW_loc=o.getUniformLocation(r.program,"buildingPosLOW"),r.modelViewMatrix4RelToEye_loc=o.getUniformLocation(r.program,"modelViewMatrixRelToEye"),r.modelViewProjectionMatrix4RelToEye_loc=o.getUniformLocation(r.program,"ModelViewProjectionMatrixRelToEye"),r.modelViewMatrix4_loc=o.getUniformLocation(r.program,"modelViewMatrix"),r.RefTransfMatrix=o.getUniformLocation(r.program,"RefTransfMatrix"),r.buildingRotMatrix_loc=o.getUniformLocation(r.program,"buildingRotMatrix"),r.position3_loc=o.getAttribLocation(r.program,"position"),r.attribLocationCacheObj.position=o.getAttribLocation(r.program,"position"),r.aditionalMov_loc=o.getUniformLocation(r.program,"aditionalPosition"),r.near_loc=o.getUniformLocation(r.program,"near"),r.far_loc=o.getUniformLocation(r.program,"far")},PostFxShadersManager.prototype.createRenderDepthShaderLODBuilding=function(o){var r=new PostFxShader(this.gl);this.pFx_shaders_array.push(r);var a=ShaderSource.lodBuildingDepthVsSource,t=ShaderSource.lodBuildingDepthFsSource;r.program=o.createProgram(),r.shader_vertex=this.getShader(o,a,o.VERTEX_SHADER,"VERTEX"),r.shader_fragment=this.getShader(o,t,o.FRAGMENT_SHADER,"FRAGMENT"),o.attachShader(r.program,r.shader_vertex),o.attachShader(r.program,r.shader_fragment),o.linkProgram(r.program),r.cameraPosHIGH_loc=o.getUniformLocation(r.program,"encodedCameraPositionMCHigh"),r.cameraPosLOW_loc=o.getUniformLocation(r.program,"encodedCameraPositionMCLow"),r.buildingPosHIGH_loc=o.getUniformLocation(r.program,"buildingPosHIGH"),r.buildingPosLOW_loc=o.getUniformLocation(r.program,"buildingPosLOW"),r.modelViewMatrix4RelToEye_loc=o.getUniformLocation(r.program,"modelViewMatrixRelToEye"),r.modelViewProjectionMatrix4RelToEye_loc=o.getUniformLocation(r.program,"ModelViewProjectionMatrixRelToEye"),r.modelViewMatrix4_loc=o.getUniformLocation(r.program,"modelViewMatrix"),r.RefTransfMatrix=o.getUniformLocation(r.program,"RefTransfMatrix"),r.buildingRotMatrix_loc=o.getUniformLocation(r.program,"buildingRotMatrix"),r.position3_loc=o.getAttribLocation(r.program,"position"),r.attribLocationCacheObj.position=o.getAttribLocation(r.program,"position"),r.aditionalMov_loc=o.getUniformLocation(r.program,"aditionalPosition"),r.near_loc=o.getUniformLocation(r.program,"near"),r.far_loc=o.getUniformLocation(r.program,"far")},PostFxShadersManager.prototype.createDepthShaderBox=function(o){var r=new PostFxShader(this.gl);this.pFx_shaders_array.push(r);var a=ShaderSource.boxDepthVsSource,t=ShaderSource.boxDepthFsSource;r.program=o.createProgram(),r.shader_vertex=this.getShader(o,a,o.VERTEX_SHADER,"VERTEX"),r.shader_fragment=this.getShader(o,t,o.FRAGMENT_SHADER,"FRAGMENT"),o.attachShader(r.program,r.shader_vertex),o.attachShader(r.program,r.shader_fragment),o.linkProgram(r.program),r.cameraPosHIGH_loc=o.getUniformLocation(r.program,"encodedCameraPositionMCHigh"),r.cameraPosLOW_loc=o.getUniformLocation(r.program,"encodedCameraPositionMCLow"),r.buildingPosHIGH_loc=o.getUniformLocation(r.program,"buildingPosHIGH"),r.buildingPosLOW_loc=o.getUniformLocation(r.program,"buildingPosLOW"),r.modelViewMatrix4RelToEye_loc=o.getUniformLocation(r.program,"modelViewMatrixRelToEye"),r.modelViewProjectionMatrix4RelToEye_loc=o.getUniformLocation(r.program,"ModelViewProjectionMatrixRelToEye"),r.modelViewMatrix4_loc=o.getUniformLocation(r.program,"modelViewMatrix"),r.RefTransfMatrix=o.getUniformLocation(r.program,"RefTransfMatrix"),r.buildingRotMatrix_loc=o.getUniformLocation(r.program,"buildingRotMatrix"),r.position3_loc=o.getAttribLocation(r.program,"position"),r.attribLocationCacheObj.position=o.getAttribLocation(r.program,"position"),r.aditionalMov_loc=o.getUniformLocation(r.program,"aditionalPosition"),r.near_loc=o.getUniformLocation(r.program,"near"),r.far_loc=o.getUniformLocation(r.program,"far")},PostFxShadersManager.prototype.createSsaoShaderBox=function(o){var r=new PostFxShader(this.gl);this.pFx_shaders_array.push(r);var a=ShaderSource.boxSsaoVsSource,t=ShaderSource.boxSsaoFsSource;r.program=o.createProgram(),r.shader_vertex=this.getShader(o,a,o.VERTEX_SHADER,"VERTEX"),r.shader_fragment=this.getShader(o,t,o.FRAGMENT_SHADER,"FRAGMENT"),o.attachShader(r.program,r.shader_vertex),o.attachShader(r.program,r.shader_fragment),o.linkProgram(r.program),r.cameraPosHIGH_loc=o.getUniformLocation(r.program,"encodedCameraPositionMCHigh"),r.cameraPosLOW_loc=o.getUniformLocation(r.program,"encodedCameraPositionMCLow"),r.buildingPosHIGH_loc=o.getUniformLocation(r.program,"buildingPosHIGH"),r.buildingPosLOW_loc=o.getUniformLocation(r.program,"buildingPosLOW"),r.modelViewMatrix4RelToEye_loc=o.getUniformLocation(r.program,"modelViewMatrixRelToEye"),r.modelViewProjectionMatrix4RelToEye_loc=o.getUniformLocation(r.program,"ModelViewProjectionMatrixRelToEye"),r.normalMatrix4_loc=o.getUniformLocation(r.program,"normalMatrix4"),r.projectionMatrix4_loc=o.getUniformLocation(r.program,"projectionMatrix"),r.modelViewMatrix4_loc=o.getUniformLocation(r.program,"modelViewMatrix"),r.buildingRotMatrix_loc=o.getUniformLocation(r.program,"buildingRotMatrix"),r.bUse1Color_loc=o.getUniformLocation(r.program,"bUse1Color"),r.oneColor4_loc=o.getUniformLocation(r.program,"oneColor4"),r.bScale_loc=o.getUniformLocation(r.program,"bScale"),r.scale_loc=o.getUniformLocation(r.program,"scale"),r.position3_loc=o.getAttribLocation(r.program,"position"),r.normal3_loc=o.getAttribLocation(r.program,"normal"),r.color4_loc=o.getAttribLocation(r.program,"color4"),r.attribLocationCacheObj.position=o.getAttribLocation(r.program,"position"),r.attribLocationCacheObj.normal=o.getAttribLocation(r.program,"normal"),r.attribLocationCacheObj.color4=o.getAttribLocation(r.program,"color4"),r.aditionalMov_loc=o.getUniformLocation(r.program,"aditionalPosition"),r.noiseScale2_loc=o.getUniformLocation(r.program,"noiseScale"),r.kernel16_loc=o.getUniformLocation(r.program,"kernel"),r.near_loc=o.getUniformLocation(r.program,"near"),r.far_loc=o.getUniformLocation(r.program,"far"),r.fov_loc=o.getUniformLocation(r.program,"fov"),r.aspectRatio_loc=o.getUniformLocation(r.program,"aspectRatio"),r.screenWidth_loc=o.getUniformLocation(r.program,"screenWidth"),r.screenHeight_loc=o.getUniformLocation(r.program,"screenHeight"),r.hasTexture_loc=o.getUniformLocation(r.program,"hasTexture"),r.color4Aux_loc=o.getUniformLocation(r.program,"vColor4Aux"),r.depthTex_loc=o.getUniformLocation(r.program,"depthTex"),r.noiseTex_loc=o.getUniformLocation(r.program,"noiseTex"),r.diffuseTex_loc=o.getUniformLocation(r.program,"diffuseTex"),r.useRefTransfMatrix_loc=o.getUniformLocation(r.program,"useRefTransfMatrix"),r.useTexture_loc=o.getUniformLocation(r.program,"useTexture"),r.invertNormals_loc=o.getUniformLocation(r.program,"invertNormals")};
"use strict";var Quaternion=function(){if(!(this instanceof Quaternion))throw new Error(Messages.CONSTRUCT_ERROR);this.x=0,this.y=0,this.z=0,this.w=1};Quaternion.prototype.Modul=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},Quaternion.prototype.Unitary=function(){var t=this.Modul();this.x/=t,this.y/=t,this.z/=t,this.w/=t},Quaternion.prototype.rotationAngDeg=function(t,i,s,n){var h=t*Math.PI/180;this.rotationAngRad(h,i,s,n)},Quaternion.prototype.rotationAngRad=function(t,i,s,n){var h=Math.sqrt(i*i+s*s+n*n),o=1e-12;if(!h<o){var r=1/h,a=-.5*t;h=Math.sin(a),this.x=i*r*h,this.y=s*r*h,this.z=n*r*h,this.w=Math.cos(a),this.Unitary()}else this.x=0,this.y=0,this.z=0,this.w=1};
"use strict";function loadWithXhr(e){var t=$.Deferred(),a=new XMLHttpRequest;return a.open("GET",e,!0),a.responseType="arraybuffer",a.onload=function(){return a.status<200||a.status>=300?void t.reject(a.status):void t.resolve(a.response)},a.onerror=function(e){console.log("Invalid XMLHttpRequest response type."),t.reject(a.status)},a.send(null),t.promise()}var ReaderWriter=function(){if(!(this instanceof ReaderWriter))throw new Error(Messages.CONSTRUCT_ERROR);this.geometryDataPath=MagoConfig.getInformation().deployConfig.dataPath,this.viArraysContainer=new VertexIdxVBOArraysContainer,this.byteColorsVBOArraysContainer=new ByteColorsVBOArraysContainer,this.j_counter,this.k_counter,this.gl,this.incre_latAng=.001,this.incre_longAng=.001,this.GAIA3D__offset_latitude=-.001,this.GAIA3D__offset_longitude=-.001,this.GAIA3D__counter=0,this.uint32,this.uint16,this.int16,this.float32,this.float16,this.int8,this.int8_value,this.max_color_value=126,this.startBuff,this.endBuff,this.filesReadings_count=0,this.temp_var_to_waste,this.countSC,this.xSC,this.ySC,this.zSC,this.point3dSC=new Point3D,this.bboxSC=new BoundingBox};ReaderWriter.prototype.readUInt32=function(e,t,a){var r=new Uint32Array(e.slice(t,a));return r[0]},ReaderWriter.prototype.readInt32=function(e,t,a){var r=new Int32Array(e.slice(t,a));return r[0]},ReaderWriter.prototype.readUInt16=function(e,t,a){var r=new Uint16Array(e.slice(t,a));return r[0]},ReaderWriter.prototype.readInt16=function(e,t,a){var r=new Int16Array(e.slice(t,a));return r[0]},ReaderWriter.prototype.readFloat64=function(e,t,a){var r=new Float64Array(e.slice(t,a));return r[0]},ReaderWriter.prototype.readFloat32=function(e,t,a){var r=new Float32Array(e.slice(t,a));return r[0]},ReaderWriter.prototype.readFloat16=function(e,t,a){var r=new Float32Array(e.slice(t,a));return r[0]},ReaderWriter.prototype.readInt8=function(e,t,a){var r=new Int8Array(e.slice(t,a));return r[0]},ReaderWriter.prototype.readUInt8=function(e,t,a){var r=new Uint8Array(e.slice(t,a));return r[0]},ReaderWriter.prototype.readInt8ByteColor=function(e,t,a){var r=new Int8Array(e.slice(t,a)),o=r[0];return o>max_color_value&&(o=max_color_value),o<0&&(o+=256),o},ReaderWriter.prototype.getBoundingBoxFromFloat32Array=function(e,t){void 0==t&&(t=new BoundingBox);for(var a=e.length,r=0;r<a;r+=3)this.point3dSC.x=e[r],this.point3dSC.y=e[r+1],this.point3dSC.z=e[r+2],0==r?t.setInit(this.point3dSC):t.addPoint3D(this.point3dSC);return t},ReaderWriter.prototype.readNeoBlocks=function(e,t,a){var r=0,o=this.readUInt32(t,r,r+4);r+=4;for(var i=0;i<o;i++){var n=a.newBlock(),l=new BoundingBox;l.minX=new Float32Array(t.slice(r,r+4)),r+=4,l.minY=new Float32Array(t.slice(r,r+4)),r+=4,l.minZ=new Float32Array(t.slice(r,r+4)),r+=4,l.maxX=new Float32Array(t.slice(r,r+4)),r+=4,l.maxY=new Float32Array(t.slice(r,r+4)),r+=4,l.maxZ=new Float32Array(t.slice(r,r+4)),r+=4;var d=l.getMaxLength();d<1?n.isSmallObj=!0:n.isSmallObj=!1;var s=this.readUInt32(t,r,r+4);r+=4;for(var u=0;u<s;u++){var f=this.readUInt32(t,r,r+4);r+=4;var c=3*f;n.vertexCount=f;var _=r,h=r+4*c,m=n.vBOVertexIdxCacheKeysContainer.newVBOVertexIdxCacheKey();m.posVboDataArray=new Float32Array(t.slice(_,h)),r+=4*c,f=this.readUInt32(t,r,r+4),r+=4;var g=3*f;_=r,h=r+1*g,m.norVboDataArray=new Int8Array(t.slice(_,h)),r+=1*g;var v=this.readUInt32(t,r,r+4);r+=4,_=r,h=r+2*v,m.idxVboDataArray=new Int16Array(t.slice(_,h)),r+=2*v,m.indicesCount=v}}},ReaderWriter.prototype.readNeoReferences=function(e,t,a,r){var o,i,n=0,l=r.readUInt32(a,n,n+4);n+=4;for(var d=0;d<l;d++){var s=t.newNeoReference(),u=r.readUInt32(a,n,n+4);n+=4,s._id=u;var f=r.readUInt32(a,n,n+4);n+=4,s._block_idx=f;for(var c=s._originalMatrix4.floatArrays.length,_=0;_<c;_++)s._originalMatrix4.floatArrays[_]=r.readFloat32(a,n,n+4),n+=4;var h=r.readUInt8(a,n,n+1);if(n+=1,h){var m=r.readUInt16(a,n,n+2);n+=2;var g=r.readUInt8(a,n,n+1);n+=1;var v;5121==m&&(v=1);var R=r.readUInt8(a,n,n+v);n+=v;var y=r.readUInt8(a,n,n+v);n+=v;var x=r.readUInt8(a,n,n+v);n+=v;var C=255;4==g&&(C=r.readUInt8(a,n,n+v),n+=v),s.color4=new Color,s.color4.set(R,y,x,C)}var I=r.readUInt8(a,n,n+1);if(n+=1,I){var m=r.readUInt16(a,n,n+2);n+=2;var g=r.readUInt8(a,n,n+1);n+=1;var v;5121==m&&(v=1);var p=r.readInt32(a,n,n+4);n+=4;for(var A=0;A<p;A++){var R=r.readUInt8(a,n,n+v);n+=v;var y=r.readUInt8(a,n,n+v);n+=v;var x=r.readUInt8(a,n,n+v);if(n+=v,4==g){var C=r.readUInt8(a,n,n+v);n+=v}}}var D=r.readUInt8(a,n,n+1);if(n+=1,D){var m=r.readUInt16(a,n,n+2);n+=2;var S=r.readUInt32(a,n,n+4);n+=4,s.vertexCount=S;var b=2*S;o=n,i=n+4*b,s.MESH_TEXCOORD_cacheKey=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,s.MESH_TEXCOORD_cacheKey),e.bufferData(e.ARRAY_BUFFER,new Float32Array(a.slice(o,i)),e.STATIC_DRAW),n+=4*b}var w=r.readUInt32(a,n,n+4);if(n+=4,w>0){s.texture=new Texture,s.hasTexture=!0;var B=r.readUInt32(a,n,n+4);n+=4;for(var A=0;A<B;A++)s.texture.textureTypeName+=String.fromCharCode(new Int8Array(a.slice(n,n+1))),n+=1;var L=r.readUInt32(a,n,n+4);n+=4;for(var A=0;A<L;A++)s.texture.textureImageFileName+=String.fromCharCode(new Int8Array(a.slice(n,n+1))),n+=1}else s.hasTexture=!1}var F=t.exterior_ocCullOctree;n=this.readOcclusionCullingOctreeCell(a,n,F),F.expandBox(1e3),F.setSizesSubBoxes();var T=t.interior_ocCullOctree;n=this.readOcclusionCullingOctreeCell(a,n,T),T.setSizesSubBoxes()},ReaderWriter.prototype.readOcclusionCullingOctreeCell=function(e,t,a){var r=this.readInt8(e,t,t+1);if(t+=1,r){var o=this.readFloat32(e,t,t+4);t+=4;var i=this.readFloat32(e,t,t+4);t+=4;var n=this.readFloat32(e,t,t+4);t+=4;var l=this.readFloat32(e,t,t+4);t+=4;var d=this.readFloat32(e,t,t+4);t+=4;var s=this.readFloat32(e,t,t+4);t+=4,a.setDimensions(o,i,n,l,d,s)}var u=this.readUInt32(e,t,t+4);if(t+=4,0==u){var f=this.readUInt32(e,t,t+4);t+=4;for(var c=0;c<f;c++){var _=this.readUInt32(e,t,t+4);t+=4,a._indicesArray.push(_)}}else for(var c=0;c<u;c++){var h=a.newSubBox();t=this.readOcclusionCullingOctreeCell(e,t,h)}return t},ReaderWriter.prototype.readNeoSimpleBuilding=function(e,t){var a=0,r=this.readUInt32(e,a,a+4);a+=4;for(var o=0;o<r;o++){var i=t.newAccesor();i.bufferId=this.readInt32(e,a,a+4),a+=4,i.accesorType=this.readUInt8(e,a,a+1),a+=1,i.bufferStart=this.readInt32(e,a,a+4),a+=4,i.stride=this.readInt32(e,a,a+4),a+=4,i.dataType=this.readInt32(e,a,a+4),a+=4,i.dimension=this.readUInt8(e,a,a+1),a+=1,i.maxX=this.readFloat32(e,a,a+4),a+=4,i.maxY=this.readFloat32(e,a,a+4),a+=4,i.maxZ=this.readFloat32(e,a,a+4),a+=4,i.minX=this.readFloat32(e,a,a+4),a+=4,i.minY=this.readFloat32(e,a,a+4),a+=4,i.minZ=this.readFloat32(e,a,a+4),a+=4}this.readInt32(e,a,a+4),a+=4;var n=this.readInt32(e,a,a+4);a+=4;var l=a,d=a+n,s=t.vbo_vicks_container.newVBOVertexIdxCacheKey();s.buffer=new Buffer,s.buffer.dataArray=new Uint8Array(e.slice(l,d)),s.buffer.dataArrayByteLength=n},ReaderWriter.prototype.getNeoBlocksArraybuffer=function(e,t,a){a.fileRequestControler.filesRequestedCount+=1,t.fileLoadState=CODE.fileLoadState.LOADING_STARTED,loadWithXhr(e).done(function(e){var a=e;a?(t.dataArraybuffer=a,t.fileLoadState=CODE.fileLoadState.LOADING_FINISHED,a=null):t.fileLoadState=500}).fail(function(e){console.log("Invalid XMLHttpRequest status = "+e),0==e?t.fileLoadState=500:t.fileLoadState=e}).always(function(){a.fileRequestControler.filesRequestedCount-=1,a.fileRequestControler.filesRequestedCount<0&&(a.fileRequestControler.filesRequestedCount=0)})},ReaderWriter.prototype.getNeoBlocks=function(e,t,a,r,o){a.fileLoadState=CODE.fileLoadState.LOADING_STARTED,loadWithXhr(t).done(function(t){var o=t;o?(r.readNeoBlocks(e,o,a),a.fileLoadState=CODE.fileLoadState.LOADING_FINISHED,o=null):a.fileLoadState=500}).fail(function(e){console.log("xhr status = "+e),0==e?a.fileLoadState=500:a.fileLoadState=e}).always(function(){})},ReaderWriter.prototype.getNeoReferencesArraybuffer=function(e,t,a){a.fileRequestControler.filesRequestedCount+=1,t.fileLoadState=CODE.fileLoadState.LOADING_STARTED,loadWithXhr(e).done(function(e){var a=e;a?(t.dataArraybuffer=a,t.fileLoadState=CODE.fileLoadState.LOADING_FINISHED,a=null):t.fileLoadState=500}).fail(function(e){console.log("xhr status = "+e),0==e?t.fileLoadState=500:t.fileLoadState=e}).always(function(){a.fileRequestControler.filesRequestedCount-=1,a.fileRequestControler.filesRequestedCount<0&&(a.fileRequestControler.filesRequestedCount=0)})},ReaderWriter.prototype.getOctreeLegoArraybuffer=function(e,t,a){a.fileRequestControler.filesRequestedCount+=1,t.lego.fileLoadState=CODE.fileLoadState.LOADING_STARTED,loadWithXhr(e).done(function(e){var a=e;a?(t.lego?(t.lego.dataArrayBuffer=a,t.lego.fileLoadState=CODE.fileLoadState.LOADING_FINISHED):t=void 0,a=null):t.lego.fileLoadState=500}).fail(function(e){console.log("xhr status = "+e),0==e?t.lego.fileLoadState=500:t.lego.fileLoadState=e}).always(function(){a.fileRequestControler.filesRequestedCount-=1,a.fileRequestControler.filesRequestedCount<0&&(a.fileRequestControler.filesRequestedCount=0)})},ReaderWriter.prototype.getLodBuildingArraybuffer=function(e,t,a){a.fileRequestControler.filesRequestedCount+=1,t.fileLoadState=CODE.fileLoadState.LOADING_STARTED,loadWithXhr(e).done(function(e){var a=e;a?(t.dataArraybuffer=a,t.fileLoadState=CODE.fileLoadState.LOADING_FINISHED,a=null):t.fileLoadState=500}).fail(function(e){console.log("xhr status = "+e),0==e?t.fileLoadState=500:t.fileLoadState=e}).always(function(){a.fileRequestControler.filesRequestedCount-=1,a.fileRequestControler.filesRequestedCount<0&&(a.fileRequestControler.filesRequestedCount=0)})},ReaderWriter.prototype.getNeoReferences=function(e,t,a,r,o,i,n,l,d,s,u){loadWithXhr(t).done(function(t){var u=t;if(u){if(void 0!=s){void 0==l.octree&&(l.octree=new Octree((void 0)));var f=l.octree.getOctreeByNumberName(s),c=new NeoReferencesList;c.lod_level=o,c.blocksList=i,c.name=r,d.readNeoReferences(e,c,u,d),n&&c.multiplyReferencesMatrices(n),f.neoRefsList_Array.push(c)}else{var c=a.newNeoRefsList(i);c.lod_level=o,c.name=r,c.blocksList=i,d.readNeoReferences(e,c,u,d),n&&c.multiplyReferencesMatrices(n)}u=null}}).fail(function(e){console.log("xhr status = "+e)}).always(function(){})},ReaderWriter.prototype.getNeoSimpleBuilding=function(e,t,a,r){loadWithXhr(t).done(function(e){var t=e;t&&(r.readNeoSimpleBuilding(t,a),t=null)}).fail(function(e){console.log("xhr status = "+e)}).always(function(){})},ReaderWriter.prototype.readTerranTileFile=function(e,t,a,r,o,i){r._depth=this.readInt32(t,i,i+4),i+=4,0==r._depth&&(r.longitudeMin=this.readFloat64(t,i,i+8),i+=8,r.longitudeMax=this.readFloat64(t,i,i+8),i+=8,r.latitudeMin=this.readFloat64(t,i,i+8),i+=8,r.latitudeMax=this.readFloat64(t,i,i+8),i+=8);var n=this.readInt32(t,i,i+4);return i+=4,r.makeTree(n),i},ReaderWriter.prototype.getTerranTileFile=function(e,t,a,r){loadWithXhr(t).done(function(o){var i=o;if(i){var n=0;r.readTerranTileFile(e,i,t,a,r,n),a.setDimensionsSubTiles(),a.calculatePositionByLonLatSubTiles(),a.terranIndexFile_readed=!0,i=null}}).fail(function(e){console.log("xhr status = "+xhr.status)}).always(function(){})},ReaderWriter.prototype.getPCloudIndexFile=function(e,t,a,r){loadWithXhr(t).done(function(e){var t=e;if(t){var o,i=0,n=0,l=r.readInt32(t,i,i+4);i+=4;for(var d=0;d<l;d++){o=new PCloudMesh,a._pCloudMesh_array.push(o),o._header._f4d_version=2,n=r.readInt32(t,i,i+4),i+=4;for(var s=0;s<n;s++)o._f4d_rawPathName+=String.fromCharCode(new Int8Array(t.slice(i,i+1))),i+=1;o._f4d_headerPathName=o._f4d_rawPathName+"/pCloud_Header.hed",o._f4d_geometryPathName=o._f4d_rawPathName+"/pCloud_Geo.f4d"}t=null}}).fail(function(e){console.log("xhr status = "+e)}).always(function(){})},ReaderWriter.prototype.getPCloudHeader=function(e,t,a,r,o){a._f4d_header_readed=!0,loadWithXhr(t).done(function(e){var t=e;if(t){for(var i,n=0,l=5,d=0,s=a._header,u=0;u<l;u++)s._version+=String.fromCharCode(new Int8Array(t.slice(n,n+1))),n+=1;s._type=String.fromCharCode(new Int8Array(t.slice(n,n+1))),n+=1,d=r.readInt32(t,n,n+4),n+=4;for(var u=0;u<d;u++)s._global_unique_id+=String.fromCharCode(new Int8Array(t.slice(n,n+1))),n+=1;s._latitude=new Float64Array(t.slice(n,n+8))[0],n+=8,s._longitude=new Float64Array(t.slice(n,n+8))[0],n+=8,s._elevation=new Float32Array(t.slice(n,n+4))[0],n+=4,s._elevation+=60,i=new Float32Array(t.slice(n,n+4)),n+=4,i=new Float32Array(t.slice(n,n+4)),n+=4,i=new Float32Array(t.slice(n,n+4)),n+=4,s._boundingBox.minX=new Float32Array(t.slice(n,n+4))[0],n+=4,s._boundingBox.minY=new Float32Array(t.slice(n,n+4))[0],n+=4,s._boundingBox.minZ=new Float32Array(t.slice(n,n+4))[0],n+=4,s._boundingBox.maxX=new Float32Array(t.slice(n,n+4))[0],n+=4,s._boundingBox.maxY=new Float32Array(t.slice(n,n+4))[0],n+=4,s._boundingBox.maxZ=new Float32Array(t.slice(n,n+4))[0],n+=4;var f=!1;(s._boundingBox.maxX-s._boundingBox.minX>40||s._boundingBox.maxY-s._boundingBox.minY>40)&&(f=!0),!f&&s._boundingBox.maxZ-s._boundingBox.minZ<30&&(s.isSmall=!0),s._octZerothBox.minX=new Float32Array(t.slice(n,n+4))[0],n+=4,s._octZerothBox.minY=new Float32Array(t.slice(n,n+4))[0],n+=4,s._octZerothBox.minZ=new Float32Array(t.slice(n,n+4))[0],n+=4,s._octZerothBox.maxX=new Float32Array(t.slice(n,n+4))[0],n+=4,s._octZerothBox.maxY=new Float32Array(t.slice(n,n+4))[0],n+=4,s._octZerothBox.maxZ=new Float32Array(t.slice(n,n+4))[0],n+=4,d=r.readInt32(t,n,n+4),n+=4;for(var u=0;u<d;u++)s._dataFileName+=String.fromCharCode(new Int8Array(t.slice(n,n+1))),n+=1;var c=Cesium.Cartesian3.fromDegrees(s._longitude,s._latitude,s._elevation);a._pCloudPosition=c;var _=(Cesium.EncodedCartesian3.encode(c),Cesium.EncodedCartesian3.encode(c.x)),h=Cesium.EncodedCartesian3.encode(c.y),m=Cesium.EncodedCartesian3.encode(c.z);a._pCloudPositionHIGH=new Float32Array(3),a._pCloudPositionHIGH[0]=_.high,a._pCloudPositionHIGH[1]=h.high,a._pCloudPositionHIGH[2]=m.high,a._pCloudPositionLOW=new Float32Array(3),a._pCloudPositionLOW[0]=_.low,a._pCloudPositionLOW[1]=h.low,a._pCloudPositionLOW[2]=m.low,o.backGround_fileReadings_count>0&&(o.backGround_fileReadings_count-=1),a._f4d_header_readed_finished=!0,t=null}}).fail(function(e){console.log("xhr status = "+e)}).always(function(){})},ReaderWriter.prototype.getObjectIndexFile=function(e,t,a,r,o){loadWithXhr(t).done(function(e){var t=e;t&&(a.parseObjectIndexFile(t,r),t=null,o.createDeploymentGeoLocationsForHeavyIndustries())}).fail(function(e){console.log("xhr status = "+e)}).always(function(){})},ReaderWriter.prototype.parseObjectIndexFile=function(e,t){var a,r,o,i,n,l,d,s=0,u=this.readInt32(e,s,s+4);s+=4;for(var f=0;f<u;f++){var c=t.newNeoBuilding();a=this.readInt32(e,s,s+4),s+=4;var _=String.fromCharCode.apply(null,new Int8Array(e.slice(s,s+a)));s+=a,r=this.readFloat64(e,s,s+8),s+=8,o=this.readFloat64(e,s,s+8),s+=8,i=this.readFloat32(e,s,s+4),s+=4,n=0,l=0,d=0,i=50,c.bbox=new BoundingBox,c.bbox.minX=this.readFloat32(e,s,s+4),s+=4,c.bbox.minY=this.readFloat32(e,s,s+4),s+=4,c.bbox.minZ=this.readFloat32(e,s,s+4),s+=4,c.bbox.maxX=this.readFloat32(e,s,s+4),s+=4,c.bbox.maxY=this.readFloat32(e,s,s+4),s+=4,c.bbox.maxZ=this.readFloat32(e,s,s+4),s+=4;var h=_.split("_");c.buildingId=h[1]+"_"+h[2],c.buildingType=h[3],void 0==c.buildingType&&(c.buildingType="basicBuilding"),c.buildingFileName=_,void 0==c.metaData&&(c.metaData=new MetaData),void 0==c.metaData.geographicCoord&&(c.metaData.geographicCoord=new GeographicCoord),c.metaData.geographicCoord.setLonLatAlt(r,o,i),void 0==c.metaData.bbox&&(c.metaData.bbox=new BoundingBox);var m=c.metaData.bbox;m.minX=c.bbox.minX,m.minY=c.bbox.minY,m.minZ=c.bbox.minZ,m.maxX=c.bbox.maxX,m.maxY=c.bbox.maxY,m.maxZ=c.bbox.maxZ}t.neoBuildingsArray.reverse()},ReaderWriter.prototype.getNeoHeader=function(e,t,a,r,o){o.fileRequestControler.filesRequestedCount+=1,a.metaData.fileLoadState=CODE.fileLoadState.LOADING_STARTED,loadWithXhr(t).done(function(e){var t=e;t?(void 0==a.metaData&&(a.metaData=new MetaData),a.metaData.parseFileHeader(t,r),void 0==a.octree&&(a.octree=new Octree((void 0))),a.octree.setBoxSize(a.metaData.oct_min_x,a.metaData.oct_max_x,a.metaData.oct_min_y,a.metaData.oct_max_y,a.metaData.oct_min_z,a.metaData.oct_max_z),a.octree.makeTree(3),a.octree.setSizesSubBoxes(),a.metaData.fileLoadState=CODE.fileLoadState.LOADING_FINISHED,t=null):a.metaData.fileLoadState=500}).fail(function(e){console.log("xhr status = "+e),0==e?a.metaData.fileLoadState=500:a.metaData.fileLoadState=e}).always(function(){o.fileRequestControler.filesRequestedCount-=1,o.fileRequestControler.filesRequestedCount<0&&(o.fileRequestControler.filesRequestedCount=0)})},ReaderWriter.prototype.getNeoHeaderAsimetricVersion=function(e,t,a,r,o){o.fileRequestControler.filesRequestedCount+=1,a.metaData.fileLoadState=CODE.fileLoadState.LOADING_STARTED,loadWithXhr(t).done(function(e){var t=e;if(t){void 0==a.metaData&&(a.metaData=new MetaData);var o=a.metaData.parseFileHeaderAsimetricVersion(t,r);void 0==a.octree&&(a.octree=new Octree((void 0))),a.octree.parseAsimetricVersion(t,r,o,a),a.metaData.oct_min_x=a.octree.centerPos.x-a.octree.half_dx,a.metaData.oct_max_x=a.octree.centerPos.x+a.octree.half_dx,a.metaData.oct_min_y=a.octree.centerPos.y-a.octree.half_dy,a.metaData.oct_max_y=a.octree.centerPos.y+a.octree.half_dy,a.metaData.oct_min_z=a.octree.centerPos.z-a.octree.half_dz,a.metaData.oct_max_z=a.octree.centerPos.z+a.octree.half_dz,a.metaData.fileLoadState=CODE.fileLoadState.LOADING_FINISHED,t=void 0}else a.metaData.fileLoadState=500,t=void 0}).fail(function(e){console.log("xhr status = "+e),0==e?a.metaData.fileLoadState=500:a.metaData.fileLoadState=e}).always(function(){o.fileRequestControler.filesRequestedCount-=1,o.fileRequestControler.filesRequestedCount<0&&(o.fileRequestControler.filesRequestedCount=0)})},ReaderWriter.prototype.readNailImageOfArrayBuffer=function(e,t,a,r,o,i){var n=a._simpleBuilding_v1,l=new Blob([t],{type:"image/jpeg"}),d=window.URL||window.webkitURL,s=d.createObjectURL(l),u=new Image;u.onload=function(){void 0==n._simpleBuildingTexture&&(n._simpleBuildingTexture=e.createTexture()),handleTextureLoaded(e,u,n._simpleBuildingTexture),a._f4d_nailImage_readed_finished=!0,t=null,a._simpleBuilding_v1.textureArrayBuffer=null,o.backGround_imageReadings_count>0&&o.backGround_imageReadings_count--},u.onerror=function(){},u.src=s},ReaderWriter.prototype.readNailImage=function(e,t,a,r,o,i){void 0==i&&(i=3),3==i?a._f4d_nailImage_readed=!0:0==i&&(a._f4d_lod0Image_readed=!0),void 0==a._simpleBuilding_v1&&(a._simpleBuilding_v1=new SimpleBuildingV1);var n=a._simpleBuilding_v1,l=new Image;l.onload=function(){3==i?(handleTextureLoaded(e,l,n._simpleBuildingTexture),a._f4d_nailImage_readed_finished=!0):0==i&&(void 0==n._texture_0&&(n._texture_0=e.createTexture()),handleTextureLoaded(e,l,n._texture_0),a._f4d_lod0Image_readed_finished=!0),o.backGround_fileReadings_count>0&&(o.backGround_fileReadings_count-=1)},l.onerror=function(){a._f4d_lod0Image_readed_finished=!1,a._f4d_lod0Image_exists=!1,o.backGround_fileReadings_count>0&&(o.backGround_fileReadings_count-=1)};var d=t;l.src=d},ReaderWriter.prototype.readTexture=function(e,t,a,r){a.loadStarted=!0,a.texImage=new Image,a.texImage.onload=function(){a.loadFinished=!0,r.backGround_fileReadings_count>0&&(r.backGround_fileReadings_count-=1)},a.texImage.onerror=function(){a.loadStarted=!1,r.backGround_fileReadings_count>0&&(r.backGround_fileReadings_count-=1)},a.texImage.src=t},ReaderWriter.prototype.readNeoReferenceTexture=function(e,t,a,r,o){var i=new Image;a.fileLoadState=CODE.fileLoadState.LOADING_STARTED,i.onload=function(){handleTextureLoaded(e,i,a.texId),a.fileLoadState=CODE.fileLoadState.LOADING_FINISHED,o.backGround_fileReadings_count>0&&(o.backGround_fileReadings_count-=1)},i.onerror=function(){},i.src=t},ReaderWriter.prototype.readLegoSimpleBuildingTexture=function(e,t,a,r){var o=new Image;o.onload=function(){void 0==a.texId&&(a.texId=e.createTexture()),handleTextureLoaded(e,o,a.texId),r.backGround_fileReadings_count>0&&(r.backGround_fileReadings_count-=1)},o.onerror=function(){},o.src=t},ReaderWriter.prototype.openTerranTile=function(e,t,a){var r=this.geometryDataPath+Constant.RESULT_XDO2F4D_TERRAINTILEFILE_TXT;a.getTerranTileFile(e,r,t,a)},ReaderWriter.prototype.getTileArrayBuffer=function(e,t,a,r,o){a.fileReading_started=!0,loadWithXhr(t).done(function(e){var t=e;t&&(a.fileArrayBuffer=t,a.fileReading_finished=!0,o.backGround_fileReadings_count>0&&(o.backGround_fileReadings_count-=1),t=null)}).fail(function(e){console.log("xhr status = "+e)}).always(function(){})},ReaderWriter.prototype.getPCloudGeometry=function(e,t,a,r,o){a._f4d_geometry_readed=!0,loadWithXhr(t).done(function(t){var i=t;if(i){var n,l,d=0,s=r.readUInt32(i,d,d+4);d+=4;for(var u=0;u<s;u++){var f=r.readUInt32(i,d,d+4);d+=4;for(var c=0;c<f;c++){var _=a.vbo_datas.newVBOVertexIdxCacheKey(),h=r.readUInt32(i,d,d+4);d+=4,n=d,l=d+28*h,_.meshVertexCacheKey=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,_.meshVertexCacheKey),e.bufferData(e.ARRAY_BUFFER,i.slice(n,l),e.STATIC_DRAW),d+=28*h;var m=r.readUInt32(i,d,d+4);d+=4,_.indicesCount=m,n=d,l=d+2*m,_.meshFacesCacheKey=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,_.meshFacesCacheKey),e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Uint16Array(i.slice(n,l)),e.STATIC_DRAW),d+=2*m}}o.backGround_fileReadings_count>0&&(o.backGround_fileReadings_count-=1),a._f4d_geometry_readed_finished=!0,i=null}}).fail(function(e){console.log("xhr status = "+e)}).always(function(){})},ReaderWriter.prototype.openNeoBuilding=function(e,t,a,r,o,i,n,l){var d=this.geometryDataPath+"/"+t+"/Header.hed",s=n.newNeoBuilding();s.buildingFileName=t,void 0==s.octree&&(s.octree=new Octree((void 0))),i.getNeoHeader(e,d,s,i,l);var u=Cesium.Cartesian3.fromDegrees(r,a,o);s.buildingPosition=u;var f=(Cesium.EncodedCartesian3.encode(u),Cesium.EncodedCartesian3.encode(u.x)),c=Cesium.EncodedCartesian3.encode(u.y),_=Cesium.EncodedCartesian3.encode(u.z);s.buildingPositionHIGH=new Float32Array(3),s.buildingPositionHIGH[0]=f.high,s.buildingPositionHIGH[1]=c.high,s.buildingPositionHIGH[2]=_.high,s.buildingPositionLOW=new Float32Array(3),s.buildingPositionLOW[0]=f.low,s.buildingPositionLOW[1]=c.low,s.buildingPositionLOW[2]=_.low;var h=Cesium.Ellipsoid.WGS84.cartesianToCartographic(u),o=h.height;s.move_matrix=new Float32Array(16),s.moveMatrixInv=new Float32Array(16),Cesium.Transforms.eastNorthUpToFixedFrame(u,void 0,s.move_matrix),s.transfMat_inv=new Float32Array(16),Cesium.Matrix4.inverse(s.move_matrix,s.transfMat_inv),s.move_matrix[12]=0,s.move_matrix[13]=0,s.move_matrix[14]=0,s.buildingPosition=u,Cesium.Matrix4.inverse(s.move_matrix,s.moveMatrixInv);var m=s._blocksList_Container,g="";g=this.geometryDataPath+"/"+t+"/Blocks1";var v=m.getBlockList("Blocks1");i.getNeoBlocks(e,g,v,i);var R=this.geometryDataPath+"/"+t+"/Blocks2",y=m.getBlockList("Blocks2");i.getNeoBlocks(e,R,y,i);var x=this.geometryDataPath+"/"+t+"/Blocks3",C=m.getBlockList("Blocks3");i.getNeoBlocks(e,x,C,i);var I=this.geometryDataPath+"/"+t+"/BlocksBone",p=m.getBlockList("BlocksBone");i.getNeoBlocks(e,I,p,i);var A=this.geometryDataPath+"/"+t+"/Blocks4",D=m.getBlockList("Blocks4");i.getNeoBlocks(e,A,D,i);var S=new Matrix4;S.setByFloat32Array(s.move_matrix);var b=0,w=s._neoRefLists_Container;b=0,g=this.geometryDataPath+"/"+t+"/Ref_Skin1",i.getNeoReferences(e,g,w,"Ref_Skin1",b,v,S,s,i,void 0),b=1,g=this.geometryDataPath+"/"+t+"/Ref_Skin2",i.getNeoReferences(e,g,w,"Ref_Skin2",b,y,S,s,i,void 0),b=2,g=this.geometryDataPath+"/"+t+"/Ref_Skin3",i.getNeoReferences(e,g,w,"Ref_Skin3",b,C,S,s,i,void 0),b=3,g=this.geometryDataPath+"/"+t+"/Ref_Bone",i.getNeoReferences(e,g,w,"Ref_Bone",b,p,S,s,i,void 0);var B=this.geometryDataPath+"/"+t+"/inLOD4";b=4;for(var L=-1,F=1;F<9;F++)for(var T=1;T<9;T++)for(var E=1;E<9;E++){L=100*F+10*T+E;var N=L.toString(),O=B+"/"+N;i.getNeoReferences(e,O,null,N,b,D,S,s,i,L)}s.neoSimpleBuilding=new NeoSimpleBuilding,g=this.geometryDataPath+"/"+t+"/SimpleBuilding",i.getNeoSimpleBuilding(e,g,s.neoSimpleBuilding,i)},ReaderWriter.prototype.handleTextureLoaded=function(e,t,a){e.bindTexture(e.TEXTURE_2D,a),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT),e.generateMipmap(e.TEXTURE_2D),e.bindTexture(e.TEXTURE_2D,null)};
"use strict";var Renderer=function(){if(!(this instanceof Renderer))throw new Error(Messages.CONSTRUCT_ERROR);this.vbo_vi_cacheKey_aux,this.byteColorAux=new ByteColor,this.currentTimeSC,this.dateSC,this.startTimeSC,this.simpObj_scratch};Renderer.prototype.renderNeoRefLists=function(e,r,a,o,t,i,c,n){var _=r.length;if(0!=_){e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL),e.depthRange(0,1),e.enable(e.CULL_FACE);var s,f,u,h;e.activeTexture(e.TEXTURE2),c?1==n&&e.uniform1i(i.hasTexture_loc,!0):e.bindTexture(e.TEXTURE_2D,o.textureAux_1x1);for(var l=o.readerWriter.geometryDataPath,v=0;v<_;v++){var A=r[v],d=r[v].blocksList;if(void 0!=d)if(d.fileLoadState!=CODE.fileLoadState.LOADING_FINISHED){if(d.fileLoadState==CODE.fileLoadState.PARSE_FINISHED){var y=A._currentVisibleIndices.length;y=A.neoRefs_Array.length,o.isCameraMoving;for(var b=0;b<y;b++){var x=A.neoRefs_Array[b];if(x&&void 0!=x&&(f=x._block_idx,!(f>=d.blocksArray.length||(u=d.getBlock(f),o.isCameraMoving&&null!=u&&u.isSmallObj&&o.objectSelected!=x)))){if(void 0!=x.texture&&void 0==x.texture.texId){if(o.backGround_fileReadings_count>10)continue;var R=a.getTextureId(x.texture);if(void 0==R){var C=l+"/"+a.buildingFileName+"/Images/"+x.texture.textureImageFileName;o.readerWriter.readNeoReferenceTexture(e,C,x.texture,a,o),o.backGround_fileReadings_count++;continue}x.texture.texId=R}if(o.objectSelected==x)e.uniform1i(i.hasTexture_loc,!1),e.uniform4fv(i.color4Aux_loc,[1,0,0,1]);else if(c)if(x.hasTexture){if(void 0==x.texture)continue;if(void 0==x.texture.texId)continue;e.uniform1i(i.hasTexture_loc,!0),h!=x.texture.texId&&(e.bindTexture(e.TEXTURE_2D,x.texture.texId),h=x.texture.texId)}else 1==n&&(x.hasTexture||x.color4&&(e.uniform1i(i.hasTexture_loc,!1),e.uniform4fv(i.color4Aux_loc,[x.color4.r/255,x.color4.g/255,x.color4.b/255,x.color4.a/255])));else 1==n?x.hasTexture||x.color4&&(e.uniform1i(i.hasTexture_loc,!1),e.uniform4fv(i.color4Aux_loc,[x.color4.r/255,x.color4.g/255,x.color4.b/255,x.color4.a/255])):0==n&&x.color4;if(null!=u){s=u.vBOVertexIdxCacheKeysContainer.vboCacheKeysArray.length,e.uniformMatrix4fv(i.RefTransfMatrix,!1,x._matrix4._floatArrays),void 0!=x.moveVector?(e.uniform1i(i.hasAditionalMov_loc,!0),e.uniform3fv(i.aditionalMov_loc,[x.moveVector.x,x.moveVector.y,x.moveVector.z])):(e.uniform1i(i.hasAditionalMov_loc,!1),e.uniform3fv(i.aditionalMov_loc,[0,0,0]));for(var m=0;m<s;m++)if(this.vbo_vi_cacheKey_aux=u.vBOVertexIdxCacheKeysContainer.vboCacheKeysArray[m],void 0!=this.vbo_vi_cacheKey_aux.meshVertexCacheKey)if(void 0!=this.vbo_vi_cacheKey_aux.meshNormalCacheKey)if(void 0!=this.vbo_vi_cacheKey_aux.meshFacesCacheKey)e.bindBuffer(e.ARRAY_BUFFER,this.vbo_vi_cacheKey_aux.meshVertexCacheKey),e.vertexAttribPointer(i.position3_loc,3,e.FLOAT,!1,0,0),i.normal3_loc!=-1&&(e.bindBuffer(e.ARRAY_BUFFER,this.vbo_vi_cacheKey_aux.meshNormalCacheKey),e.vertexAttribPointer(i.normal3_loc,3,e.BYTE,!0,0,0)),c&&x.hasTexture&&u.vertexCount<=x.vertexCount?(e.enableVertexAttribArray(i.texCoord2_loc),e.bindBuffer(e.ARRAY_BUFFER,x.MESH_TEXCOORD_cacheKey),e.vertexAttribPointer(i.texCoord2_loc,2,e.FLOAT,!1,0,0)):i.texCoord2_loc!=-1&&e.disableVertexAttribArray(i.texCoord2_loc),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.vbo_vi_cacheKey_aux.meshFacesCacheKey),e.drawElements(e.TRIANGLES,this.vbo_vi_cacheKey_aux.indicesCount,e.UNSIGNED_SHORT,0);else{if(void 0==this.vbo_vi_cacheKey_aux.idxVboDataArray)continue;this.vbo_vi_cacheKey_aux.meshFacesCacheKey=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.vbo_vi_cacheKey_aux.meshFacesCacheKey),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.vbo_vi_cacheKey_aux.idxVboDataArray,e.STATIC_DRAW),this.vbo_vi_cacheKey_aux.idxVboDataArray=void 0}else{if(void 0==this.vbo_vi_cacheKey_aux.norVboDataArray)continue;this.vbo_vi_cacheKey_aux.meshNormalCacheKey=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.vbo_vi_cacheKey_aux.meshNormalCacheKey),e.bufferData(e.ARRAY_BUFFER,this.vbo_vi_cacheKey_aux.norVboDataArray,e.STATIC_DRAW),this.vbo_vi_cacheKey_aux.norVboDataArray=void 0}else{if(void 0==this.vbo_vi_cacheKey_aux.posVboDataArray)continue;this.vbo_vi_cacheKey_aux.meshVertexCacheKey=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.vbo_vi_cacheKey_aux.meshVertexCacheKey),e.bufferData(e.ARRAY_BUFFER,this.vbo_vi_cacheKey_aux.posVboDataArray,e.STATIC_DRAW),this.vbo_vi_cacheKey_aux.posVboDataArray=void 0}}}}}}else d.parseArrayBuffer(e,d.dataArraybuffer,o.readerWriter),d.dataArraybuffer=void 0}e.enable(e.DEPTH_TEST)}},Renderer.prototype.renderNeoRefListsAsimetricVersion=function(e,r,a,o,t,i,c,n,_,s,f){var u=r.neoRefsIndices.length;if(0!=u){e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL),e.depthRange(0,1),MagoConfig.getInformation().renderingConfg.cullFaceEnable?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),e.enable(e.CULL_FACE),e.frontFace(e.CCW);var h,l,v,A;e.activeTexture(e.TEXTURE2),c?1==n&&e.uniform1i(i.hasTexture_loc,!0):e.bindTexture(e.TEXTURE_2D,o.textureAux_1x1);for(var d=o.readerWriter.geometryDataPath,y=0;y<1;y++){var b=r.blocksList;if(void 0!=b)if(b.fileLoadState!=CODE.fileLoadState.LOADING_FINISHED||o.isCameraMoving){if(b.fileLoadState==CODE.fileLoadState.PARSE_FINISHED)for(var x=r.currentVisibleIndices.length,R=0;R<x;R++){var C=r.motherNeoRefsList[r.currentVisibleIndices[R]];if(void 0!=C&&!C.bRendered&&(l=C._block_idx,v=a.motherBlocksArray[l],void 0!=v&&!(_&&null!=v&&v.radius<_||o.isCameraMoving&&null!=v&&v.isSmallObj&&o.objectSelected!=C))){if(void 0!=C.texture)if(void 0==C.texture.texId){var m=a.getSameTexture(C.texture);if(void 0==m){if(o.backGround_fileReadings_count>10)continue;if(C.texture.fileLoadState==CODE.fileLoadState.READY){C.texture.texId=e.createTexture();var E=d+"/"+a.buildingFileName+"/Images_Resized/"+C.texture.textureImageFileName;a.texturesLoaded.push(C.texture),o.readerWriter.readNeoReferenceTexture(e,E,C.texture,a,o),o.backGround_fileReadings_count++}continue}if(m.fileLoadState!=CODE.fileLoadState.LOADING_FINISHED)continue;C.texture=m}else if(C.texture.fileLoadState!=CODE.fileLoadState.LOADING_FINISHED)continue;if(a.isHighLighted)e.uniform1i(i.hasTexture_loc,!1),e.uniform4fv(i.color4Aux_loc,o.highLightColor4);else if(a.isColorChanged)e.uniform1i(i.hasTexture_loc,!1),o.objectSelected==C?e.uniform4fv(i.color4Aux_loc,[1,0,0,1]):e.uniform4fv(i.color4Aux_loc,[a.aditionalColor.r,a.aditionalColor.g,a.aditionalColor.b,a.aditionalColor.a]);else if(C.aditionalColor)e.uniform1i(i.hasTexture_loc,!1),o.objectSelected==C?e.uniform4fv(i.color4Aux_loc,[1,0,0,1]):e.uniform4fv(i.color4Aux_loc,[C.aditionalColor.r,C.aditionalColor.g,C.aditionalColor.b,C.aditionalColor.a]);else if(o.objectSelected==C)e.uniform1i(i.hasTexture_loc,!1),e.uniform4fv(i.color4Aux_loc,[1,0,0,1]);else if(o.magoPolicy.colorChangedObjectId==C.objectId)e.uniform1i(i.hasTexture_loc,!1),e.uniform4fv(i.color4Aux_loc,[o.magoPolicy.color[0],o.magoPolicy.color[1],o.magoPolicy.color[2],1]);else if(c){if("gangbuk_cultur"==a.buildingId);if(C.hasTexture){if(void 0==C.texture)continue;if(void 0==C.texture.texId)continue;e.uniform1i(i.hasTexture_loc,!0),A!=C.texture.texId&&(e.bindTexture(e.TEXTURE_2D,C.texture.texId),A=C.texture.texId)}else 1==n&&(C.hasTexture||C.color4&&(e.uniform1i(i.hasTexture_loc,!1),e.uniform4fv(i.color4Aux_loc,[C.color4.r/255,C.color4.g/255,C.color4.b/255,C.color4.a/255])))}else 1==n?C.hasTexture?(e.uniform1i(i.hasTexture_loc,!1),e.uniform4fv(i.color4Aux_loc,[.8,.8,.8,1])):C.color4&&(e.uniform1i(i.hasTexture_loc,!1),e.uniform4fv(i.color4Aux_loc,[C.color4.r/255,C.color4.g/255,C.color4.b/255,C.color4.a/255])):0==n?C.color4:n==-1&&C.selColor4&&(e.uniform1i(i.hasTexture_loc,!1),e.uniform4fv(i.color4Aux_loc,[C.selColor4.r/255,C.selColor4.g/255,C.selColor4.b/255,1]));if(null!=v){if(h=v.vBOVertexIdxCacheKeysContainer.vboCacheKeysArray.length,void 0==f)e.uniformMatrix4fv(i.RefTransfMatrix,!1,C._matrix4._floatArrays);else if(f==-1)e.uniformMatrix4fv(i.RefTransfMatrix,!1,C._matrix4._floatArrays);else{if(void 0==C.tMatrixAuxArray)continue;e.uniformMatrix4fv(i.RefTransfMatrix,!1,C.tMatrixAuxArray[f]._floatArrays)}void 0!=C.moveVector?(e.uniform1i(i.hasAditionalMov_loc,!0),e.uniform3fv(i.aditionalMov_loc,[C.moveVector.x,C.moveVector.y,C.moveVector.z])):(e.uniform1i(i.hasAditionalMov_loc,!1),e.uniform3fv(i.aditionalMov_loc,[0,0,0]));for(var K=0;K<h;K++)if(this.vbo_vi_cacheKey_aux=v.vBOVertexIdxCacheKeysContainer.vboCacheKeysArray[K],void 0!=this.vbo_vi_cacheKey_aux.meshVertexCacheKey)if(void 0!=this.vbo_vi_cacheKey_aux.meshNormalCacheKey)if(void 0!=this.vbo_vi_cacheKey_aux.meshFacesCacheKey){if(e.bindBuffer(e.ARRAY_BUFFER,this.vbo_vi_cacheKey_aux.meshVertexCacheKey),e.vertexAttribPointer(i.attribLocationCacheObj.position,3,e.FLOAT,!1,0,0),i.normal3_loc!=-1&&(e.bindBuffer(e.ARRAY_BUFFER,this.vbo_vi_cacheKey_aux.meshNormalCacheKey),e.vertexAttribPointer(i.normal3_loc,3,e.BYTE,!0,0,0)),c&&C.hasTexture)if(v.vertexCount<=C.vertexCount){var T=C.vBOVertexIdxCacheKeysContainer.vboCacheKeysArray[K];if(void 0==T.meshTexcoordsCacheKey){if(void 0==T.tcoordVboDataArray)continue;T.meshTexcoordsCacheKey=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,T.meshTexcoordsCacheKey),e.bufferData(e.ARRAY_BUFFER,T.tcoordVboDataArray,e.STATIC_DRAW),T.tcoordVboDataArray=null;continue}e.enableVertexAttribArray(i.texCoord2_loc),e.bindBuffer(e.ARRAY_BUFFER,T.meshTexcoordsCacheKey),e.vertexAttribPointer(i.texCoord2_loc,2,e.FLOAT,!1,0,0)}else i.texCoord2_loc!=-1&&e.disableVertexAttribArray(i.texCoord2_loc);else i.texCoord2_loc!=-1&&e.disableVertexAttribArray(i.texCoord2_loc);var F;o.isCameraMoving?(F=this.vbo_vi_cacheKey_aux.bigTrianglesIndicesCount,F>this.vbo_vi_cacheKey_aux.indicesCount&&(F=this.vbo_vi_cacheKey_aux.indicesCount)):F=this.vbo_vi_cacheKey_aux.indicesCount,e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.vbo_vi_cacheKey_aux.meshFacesCacheKey),e.drawElements(e.TRIANGLES,F,e.UNSIGNED_SHORT,0)}else{if(void 0==this.vbo_vi_cacheKey_aux.idxVboDataArray)continue;this.vbo_vi_cacheKey_aux.meshFacesCacheKey=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.vbo_vi_cacheKey_aux.meshFacesCacheKey),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.vbo_vi_cacheKey_aux.idxVboDataArray,e.STATIC_DRAW),this.vbo_vi_cacheKey_aux.idxVboDataArray=null}else{if(void 0==this.vbo_vi_cacheKey_aux.norVboDataArray)continue;this.vbo_vi_cacheKey_aux.meshNormalCacheKey=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.vbo_vi_cacheKey_aux.meshNormalCacheKey),e.bufferData(e.ARRAY_BUFFER,this.vbo_vi_cacheKey_aux.norVboDataArray,e.STATIC_DRAW),this.vbo_vi_cacheKey_aux.norVboDataArray=null}else{if(void 0==this.vbo_vi_cacheKey_aux.posVboDataArray)continue;this.vbo_vi_cacheKey_aux.meshVertexCacheKey=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.vbo_vi_cacheKey_aux.meshVertexCacheKey),e.bufferData(e.ARRAY_BUFFER,this.vbo_vi_cacheKey_aux.posVboDataArray,e.STATIC_DRAW),this.vbo_vi_cacheKey_aux.posVboDataArray=null}C.bRendered=!0}}}}else{if("basicBuilding"==a.buildingType);b.parseArrayBufferAsimetricVersion(e,b.dataArraybuffer,o.readerWriter,a.motherBlocksArray),b.dataArraybuffer=void 0}}e.enable(e.DEPTH_TEST)}},Renderer.prototype.renderNeoRefListsAsimetricVersionColorSelection=function(e,r,a,o,t,i,c,n,_,s){var f=r.neoRefsIndices.length;if(0!=f){e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL),e.depthRange(0,1),e.disable(e.CULL_FACE);for(var u,h,l,v=(o.readerWriter.geometryDataPath,0);v<1;v++){var A=r.blocksList;if(void 0!=A&&(A.fileLoadState!=CODE.fileLoadState.LOADING_FINISHED||o.isCameraMoving)&&A.fileLoadState==CODE.fileLoadState.PARSE_FINISHED)for(var d=r.neoRefsIndices.length,y=0;y<d;y++){var b=r.motherNeoRefsList[r.neoRefsIndices[y]];if(b&&void 0!=b&&(h=b._block_idx,l=a.motherBlocksArray[h],void 0!=l&&!(_&&null!=l&&l.radius<_||o.isCameraMoving&&null!=l&&l.isSmallObj&&o.objectSelected!=b||(b.selColor4&&(e.uniform1i(i.hasTexture_loc,!1),e.uniform4fv(i.color4Aux_loc,[b.selColor4.r/255,b.selColor4.g/255,b.selColor4.b/255,1])),null==l)))){if(u=l.vBOVertexIdxCacheKeysContainer.vboCacheKeysArray.length,void 0==s)e.uniformMatrix4fv(i.RefTransfMatrix,!1,b._matrix4._floatArrays);else if(s==-1)e.uniformMatrix4fv(i.RefTransfMatrix,!1,b._matrix4._floatArrays);else{if(void 0==b.tMatrixAuxArray)continue;e.uniformMatrix4fv(i.RefTransfMatrix,!1,b.tMatrixAuxArray[s]._floatArrays)}void 0!=b.moveVector?(e.uniform1i(i.hasAditionalMov_loc,!0),e.uniform3fv(i.aditionalMov_loc,[b.moveVector.x,b.moveVector.y,b.moveVector.z])):(e.uniform1i(i.hasAditionalMov_loc,!1),e.uniform3fv(i.aditionalMov_loc,[0,0,0]));for(var x=0;x<u;x++)if(this.vbo_vi_cacheKey_aux=l.vBOVertexIdxCacheKeysContainer.vboCacheKeysArray[x],void 0!=this.vbo_vi_cacheKey_aux.meshVertexCacheKey)if(void 0!=this.vbo_vi_cacheKey_aux.meshFacesCacheKey)e.bindBuffer(e.ARRAY_BUFFER,this.vbo_vi_cacheKey_aux.meshVertexCacheKey),e.vertexAttribPointer(i.position3_loc,3,e.FLOAT,!1,0,0),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.vbo_vi_cacheKey_aux.meshFacesCacheKey),e.drawElements(e.TRIANGLES,this.vbo_vi_cacheKey_aux.indicesCount,e.UNSIGNED_SHORT,0);else{if(void 0==this.vbo_vi_cacheKey_aux.idxVboDataArray)continue;this.vbo_vi_cacheKey_aux.meshFacesCacheKey=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.vbo_vi_cacheKey_aux.meshFacesCacheKey),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.vbo_vi_cacheKey_aux.idxVboDataArray,e.STATIC_DRAW),this.vbo_vi_cacheKey_aux.idxVboDataArray=null}else{if(void 0==this.vbo_vi_cacheKey_aux.posVboDataArray)continue;this.vbo_vi_cacheKey_aux.meshVertexCacheKey=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.vbo_vi_cacheKey_aux.meshVertexCacheKey),e.bufferData(e.ARRAY_BUFFER,this.vbo_vi_cacheKey_aux.posVboDataArray,e.STATIC_DRAW),this.vbo_vi_cacheKey_aux.posVboDataArray=null}}}}e.enable(e.DEPTH_TEST)}},Renderer.prototype.renderNeoRefListsColorSelection=function(e,r,a,o,t,i,c,n){var _=r.length;if(0!=_){this.dateSC=new Date,this.startTimeSC=this.dateSC.getTime(),this.currentTimeSC;var s=0;e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL),e.depthRange(0,1),e.enable(e.CULL_FACE);for(var f,u,h,l=0;l<_;l++)for(var v=r[l],A=r[l].blocksList,d=v._currentVisibleIndices.length,y=0;y<d;y++){var b=v.neoRefs_Array[v._currentVisibleIndices[y]];if(b&&void 0!=b&&(u=b._block_idx,!(u>=A.blocksArray.length)&&(h=A.getBlock(u),b.selColor4))){if(e.uniform4fv(i.color4Aux_loc,[b.selColor4.r/255,b.selColor4.g/255,b.selColor4.b/255,b.selColor4.a/255]),null!=h){f=h.vBOVertexIdxCacheKeysContainer.vboCacheKeysArray.length,e.uniformMatrix4fv(i.RefTransfMatrix,!1,b._matrix4._floatArrays),void 0!=b.moveVector?(e.uniform1i(i.hasAditionalMov_loc,!0),e.uniform3fv(i.aditionalMov_loc,[b.moveVector.x,b.moveVector.y,b.moveVector.z])):(e.uniform1i(i.hasAditionalMov_loc,!1),e.uniform3fv(i.aditionalMov_loc,[0,0,0]));for(var x=0;x<f;x++)if(this.vbo_vi_cacheKey_aux=h.vBOVertexIdxCacheKeysContainer.vboCacheKeysArray[x],void 0!=this.vbo_vi_cacheKey_aux.meshVertexCacheKey)if(void 0!=this.vbo_vi_cacheKey_aux.meshFacesCacheKey)e.bindBuffer(e.ARRAY_BUFFER,this.vbo_vi_cacheKey_aux.meshVertexCacheKey),e.vertexAttribPointer(i.position3_loc,3,e.FLOAT,!1,0,0),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.vbo_vi_cacheKey_aux.meshFacesCacheKey),e.drawElements(e.TRIANGLES,this.vbo_vi_cacheKey_aux.indicesCount,e.UNSIGNED_SHORT,0);else{if(void 0==this.vbo_vi_cacheKey_aux.idxVboDataArray)continue;this.vbo_vi_cacheKey_aux.meshFacesCacheKey=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.vbo_vi_cacheKey_aux.meshFacesCacheKey),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.vbo_vi_cacheKey_aux.idxVboDataArray,e.STATIC_DRAW),this.vbo_vi_cacheKey_aux.idxVboDataArray=null}else{if(void 0==this.vbo_vi_cacheKey_aux.posVboDataArray)continue;this.vbo_vi_cacheKey_aux.meshVertexCacheKey=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.vbo_vi_cacheKey_aux.meshVertexCacheKey),e.bufferData(e.ARRAY_BUFFER,this.vbo_vi_cacheKey_aux.posVboDataArray,e.STATIC_DRAW),this.vbo_vi_cacheKey_aux.posVboDataArray.length=0}}s++,s>20&&(s=0)}}e.enable(e.DEPTH_TEST)}},Renderer.prototype.renderLodBuilding=function(e,r,a,o,t,i){if(0!=r.vbo_vicks_container.vboCacheKeysArray.length)if(e.frontFace(e.CCW),0==t){var c=r.vbo_vicks_container.vboCacheKeysArray[0];if(null==c.meshVertexCacheKey)return void(void 0!=c.posVboDataArray&&(c.meshVertexCacheKey=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,c.meshVertexCacheKey),e.bufferData(e.ARRAY_BUFFER,c.posVboDataArray,e.STATIC_DRAW),c.posVboDataArray=void 0));var n=c.vertexCount;if(0==n)return;e.bindBuffer(e.ARRAY_BUFFER,c.meshVertexCacheKey),e.vertexAttribPointer(o.position3_loc,3,e.FLOAT,!1,0,0),e.drawArrays(e.TRIANGLES,0,n)}else if(1==t){var c=r.vbo_vicks_container.vboCacheKeysArray[0],n=c.vertexCount;if(0==n)return;if(null==c.meshVertexCacheKey)return void(void 0!=c.posVboDataArray&&(c.meshVertexCacheKey=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,c.meshVertexCacheKey),e.bufferData(e.ARRAY_BUFFER,c.posVboDataArray,e.STATIC_DRAW),c.posVboDataArray=void 0));if(null==c.meshNormalCacheKey)return void(void 0!=c.norVboDataArray&&(c.meshNormalCacheKey=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,c.meshNormalCacheKey),e.bufferData(e.ARRAY_BUFFER,c.norVboDataArray,e.STATIC_DRAW),c.norVboDataArray=void 0));if(null==c.meshColorCacheKey)return void(void 0!=c.colVboDataArray&&(c.meshColorCacheKey=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,c.meshColorCacheKey),e.bufferData(e.ARRAY_BUFFER,c.colVboDataArray,e.STATIC_DRAW),c.colVboDataArray=void 0));if(i&&null==c.meshTexcoordsCacheKey&&void 0!=c.tcoordVboDataArray)return c.meshTexcoordsCacheKey=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,c.meshTexcoordsCacheKey),e.bufferData(e.ARRAY_BUFFER,c.tcoordVboDataArray,e.STATIC_DRAW),c.tcoordVboDataArray=void 0,void 0;e.bindBuffer(e.ARRAY_BUFFER,c.meshVertexCacheKey),e.vertexAttribPointer(o.position3_loc,3,e.FLOAT,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,c.meshNormalCacheKey),e.vertexAttribPointer(o.normal3_loc,3,e.BYTE,!0,0,0),e.bindBuffer(e.ARRAY_BUFFER,c.meshColorCacheKey),e.vertexAttribPointer(o.color4_loc,4,e.UNSIGNED_BYTE,!0,0,0),i&&c.meshTexcoordsCacheKey&&(e.bindBuffer(e.ARRAY_BUFFER,c.meshTexcoordsCacheKey),e.vertexAttribPointer(o.texCoord2_loc,2,e.FLOAT,!1,0,0)),e.drawArrays(e.TRIANGLES,0,n)}},Renderer.prototype.renderLodBuildingColorSelection=function(e,r,a,o,t,i){if(0!=r.vbo_vicks_container.vboCacheKeysArray.length){e.frontFace(e.CCW);var c=r.vbo_vicks_container.vboCacheKeysArray[0];if(null==c.meshVertexCacheKey)return void(void 0!=c.posVboDataArray&&(c.meshVertexCacheKey=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,c.meshVertexCacheKey),e.bufferData(e.ARRAY_BUFFER,c.posVboDataArray,e.STATIC_DRAW),c.posVboDataArray=void 0));var n=c.vertexCount;0!=n&&(e.bindBuffer(e.ARRAY_BUFFER,c.meshVertexCacheKey),e.vertexAttribPointer(o.position3_loc,3,e.FLOAT,!1,0,0),e.drawArrays(e.TRIANGLES,0,n))}},Renderer.prototype.renderTriPolyhedron=function(e,r,a,o,t,i){if(0!=r.vbo_vicks_container.vboCacheKeysArray.length)if(e.frontFace(e.CCW),0==t){var c=r.vbo_vicks_container.vboCacheKeysArray[0];if(null==c.meshVertexCacheKey)return void(void 0!=c.posVboDataArray&&(c.meshVertexCacheKey=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,c.meshVertexCacheKey),e.bufferData(e.ARRAY_BUFFER,c.posVboDataArray,e.STATIC_DRAW),c.posVboDataArray=void 0));var n=c.vertexCount;if(0==n)return;e.bindBuffer(e.ARRAY_BUFFER,c.meshVertexCacheKey),e.vertexAttribPointer(o.position3_loc,3,e.FLOAT,!1,0,0),e.drawArrays(e.TRIANGLES,0,n)}else if(1==t){var c=r.vbo_vicks_container.vboCacheKeysArray[0],n=c.vertexCount;if(0==n)return;if(i&&1==i);if(null==c.meshVertexCacheKey)return void(void 0!=c.posVboDataArray&&(c.meshVertexCacheKey=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,c.meshVertexCacheKey),e.bufferData(e.ARRAY_BUFFER,c.posVboDataArray,e.STATIC_DRAW),c.posVboDataArray=void 0));if(null==c.meshNormalCacheKey)return void(void 0!=c.norVboDataArray&&(c.meshNormalCacheKey=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,c.meshNormalCacheKey),e.bufferData(e.ARRAY_BUFFER,c.norVboDataArray,e.STATIC_DRAW),c.norVboDataArray=void 0));if(null==c.meshColorCacheKey)return void(void 0!=c.colVboDataArray&&(c.meshColorCacheKey=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,c.meshColorCacheKey),e.bufferData(e.ARRAY_BUFFER,c.colVboDataArray,e.STATIC_DRAW),c.colVboDataArray=void 0));e.bindBuffer(e.ARRAY_BUFFER,c.meshVertexCacheKey),e.vertexAttribPointer(o.position3_loc,3,e.FLOAT,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,c.meshNormalCacheKey),e.vertexAttribPointer(o.normal3_loc,3,e.BYTE,!0,0,0),e.drawArrays(e.LINE_STRIP,0,n)}},Renderer.prototype.renderLego=function(e,r,a,o,t){if(0!=r.vbo_vicks_container.vboCacheKeysArray.length)if(0==t){var i=r.vbo_vicks_container.vboCacheKeysArray[0];if(null==i.meshVertexCacheKey)return void(void 0!=i.posVboDataArray&&(i.meshVertexCacheKey=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,i.meshVertexCacheKey),e.bufferData(e.ARRAY_BUFFER,i.posVboDataArray,e.STATIC_DRAW),i.posVboDataArray=void 0));var c=i.vertexCount;if(0==c)return;e.bindBuffer(e.ARRAY_BUFFER,i.meshVertexCacheKey),e.vertexAttribPointer(o.position3_loc,3,e.FLOAT,!1,0,0),e.drawArrays(e.TRIANGLES,0,c)}else if(1==t){var i=r.vbo_vicks_container.vboCacheKeysArray[0],c=i.vertexCount;if(0==c)return;if(null==i.meshVertexCacheKey)return void(void 0!=i.posVboDataArray&&(i.meshVertexCacheKey=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,i.meshVertexCacheKey),e.bufferData(e.ARRAY_BUFFER,i.posVboDataArray,e.STATIC_DRAW),i.posVboDataArray=void 0));if(null==i.meshNormalCacheKey)return void(void 0!=i.norVboDataArray&&(i.meshNormalCacheKey=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,i.meshNormalCacheKey),e.bufferData(e.ARRAY_BUFFER,i.norVboDataArray,e.STATIC_DRAW),i.norVboDataArray=void 0));if(null==i.meshColorCacheKey)return void(void 0!=i.colVboDataArray&&(i.meshColorCacheKey=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,i.meshColorCacheKey),e.bufferData(e.ARRAY_BUFFER,i.colVboDataArray,e.STATIC_DRAW),i.colVboDataArray=void 0));e.bindBuffer(e.ARRAY_BUFFER,i.meshVertexCacheKey),e.vertexAttribPointer(o.position3_loc,3,e.FLOAT,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,i.meshNormalCacheKey),e.vertexAttribPointer(o.normal3_loc,3,e.BYTE,!0,0,0),e.bindBuffer(e.ARRAY_BUFFER,i.meshColorCacheKey),e.vertexAttribPointer(o.color4_loc,4,e.UNSIGNED_BYTE,!0,0,0),e.drawArrays(e.TRIANGLES,0,c)}},Renderer.prototype.renderNeoSimpleBuildingPostFxShader=function(e,r,a,o,t){var i=r.neoSimpleBuilding;a.shadersManager;if(0!=i.vbo_vicks_container.vboCacheKeysArray.length){void 0==o&&(o=3);t.program;e.uniform3fv(t.buildingPosHIGH_loc,r.buildingPositionHIGH),e.uniform3fv(t.buildingPosLOW_loc,r.buildingPositionLOW);var c=i.texturesArray[0];e.activeTexture(e.TEXTURE2),3==o?e.bindTexture(e.TEXTURE_2D,c.textureId):0==o&&e.bindTexture(e.TEXTURE_2D,c.textureId);for(var n=i.accesorsArray.length,_=0,s=0;s<n;s++){var f=i.accesorsArray[s],u=!1;5120==f.data_ytpe?u=!0:5121==f.data_ytpe?u=!0:5122==f.data_ytpe?u=!0:5123==f.data_ytpe?u=!0:5126==f.data_ytpe&&(u=!1),0==f.accesor_type?(e.enableVertexAttribArray(t.position3_loc),e.vertexAttribPointer(t.position3_loc,f.dimension,f.data_ytpe,u,f.stride,f.buffer_start),_=f.stride):1==f.accesor_type?(e.enableVertexAttribArray(t.normal3_loc),e.vertexAttribPointer(t.normal3_loc,f.dimension,f.data_ytpe,u,f.stride,f.buffer_start)):3==f.accesor_type&&o!=-1&&(e.enableVertexAttribArray(t.texCoord2_loc),e.vertexAttribPointer(t.texCoord2_loc,f.dimension,f.data_ytpe,u,f.stride,f.buffer_start))}var h=i.vbo_vicks_container.vboCacheKeysArray[0];null==h.meshVertexCacheKey&&void 0!=h.buffer.dataArray&&(h.meshVertexCacheKey=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,h.meshVertexCacheKey),e.bufferData(e.ARRAY_BUFFER,h.buffer.dataArray,e.STATIC_DRAW),h.buffer.dataArray=void 0);var l=h.buffer.dataArrayByteLength/_;e.bindBuffer(e.ARRAY_BUFFER,h.meshVertexCacheKey),e.drawArrays(e.TRIANGLES,0,l)}},Renderer.prototype.renderNeoSimpleBuildingDepthShader=function(e,r,a,o){var t=r.neoSimpleBuilding;a.shadersManager;if(0!=t.vbo_vicks_container.vboCacheKeysArray.length){o.program;e.uniform3fv(o.buildingPosHIGH_loc,r.buildingPositionHIGH),e.uniform3fv(o.buildingPosLOW_loc,r.buildingPositionLOW);for(var i=t.accesorsArray.length,c=0,n=0;n<i;n++){var _=t.accesorsArray[n],s=!1;5120==_.data_ytpe?s=!0:5121==_.data_ytpe?s=!0:5122==_.data_ytpe?s=!0:5123==_.data_ytpe?s=!0:5126==_.data_ytpe&&(s=!1),0==_.accesor_type&&(e.enableVertexAttribArray(o.position3_loc),e.vertexAttribPointer(o.position3_loc,_.dimension,_.data_ytpe,s,_.stride,_.buffer_start),c=_.stride)}var f=t.vbo_vicks_container.vboCacheKeysArray[0];null==f.meshVertexCacheKey&&void 0!=f.buffer.dataArray&&(f.meshVertexCacheKey=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,f.meshVertexCacheKey),e.bufferData(e.ARRAY_BUFFER,f.buffer.dataArray,e.STATIC_DRAW),f.buffer.dataArray=void 0);var u=f.buffer.dataArrayByteLength/c;e.bindBuffer(e.ARRAY_BUFFER,f.meshVertexCacheKey),e.drawArrays(e.TRIANGLES,0,u)}},Renderer.prototype.renderSimpleBuildingV1PostFxShader=function(e,r,a,o,t){var i=r._simpleBuilding_v1;a.shadersManager;if(0!=i._simpleObjects_array.length){void 0==o&&(o=3);t.program;e.uniform3fv(t.buildingPosHIGH_loc,r.buildingPositionHIGH),e.uniform3fv(t.buildingPosLOW_loc,r.buildingPositionLOW),e.activeTexture(e.TEXTURE2),3==o?e.bindTexture(e.TEXTURE_2D,i._simpleBuildingTexture):0==o&&e.bindTexture(e.TEXTURE_2D,i._texture_0),this.simpObj_scratch=i._simpleObjects_array[0];var c=this.simpObj_scratch._vtCacheKeys_container._vtArrays_cacheKeys_array[0]._vertices_count;e.bindBuffer(e.ARRAY_BUFFER,this.simpObj_scratch._vtCacheKeys_container._vtArrays_cacheKeys_array[0]._verticesArray_cacheKey),e.vertexAttribPointer(t.position3_loc,3,e.FLOAT,!1,20,0),o!=-1&&e.vertexAttribPointer(t.texCoord2_loc,2,e.UNSIGNED_SHORT,!0,20,12),e.vertexAttribPointer(t.normal3_loc,3,e.BYTE,!0,20,16),e.drawArrays(e.TRIANGLES,0,c)}},Renderer.prototype.renderPCloudProject=function(e,r,a,o,t,i){var c=i.shadersManager,n=c.getMagoShader(6),_=n.SHADER_PROGRAM;e.uniform1i(_.samplerUniform,0),e.uniform3fv(n._BuildingPosHIGH,r._pCloudPositionHIGH),e.uniform3fv(n._BuildingPosLOW,r._pCloudPositionLOW);for(var s=r.vbo_datas.vboCacheKeysArray.length,f=0;f<s;f++){var u=r.vbo_datas.vboCacheKeysArray[f];e.bindBuffer(e.ARRAY_BUFFER,u.meshVertexCacheKey),e.vertexAttribPointer(n._position,3,e.FLOAT,!1,28,0),e.vertexAttribPointer(n._color,3,e.UNSIGNED_BYTE,!0,28,24),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,u.meshFacesCacheKey),e.drawElements(e.TRIANGLES,u.indicesCount,e.UNSIGNED_SHORT,0)}};
"use strict";var SceneState=function(){if(!(this instanceof SceneState))throw new Error(Messages.CONSTRUCT_ERROR);this.modelViewProjRelToEyeMatrix=new Matrix4,this.modelViewRelToEyeMatrix=new Matrix4,this.modelViewMatrix=new Matrix4,this.modelViewMatrixInv=new Matrix4,this.projectionMatrix=new Matrix4,this.normalMatrix4=new Matrix4,this.encodedCamPosHigh=new Float32Array([0,0,0]),this.encodedCamPosLow=new Float32Array([0,0,0]),this.camera=new Camera,this.drawingBufferWidth=new Int32Array([1e3]),this.drawingBufferHeight=new Int32Array([1e3])};
"use strict";var Selection=function(){if(!(this instanceof Selection))throw new Error(Messages.CONSTRUCT_ERROR);this.drawing_height,this.drawing_width,this.GAIA_selectFrameBuffer,this.GAIA_selectRenderBuffer,this.GAIA_selectRttTexture,this.currentByteColorPicked=new Uint8Array(4),this.currentSelectedObj_idx=-1};Selection.prototype.init=function(e,t,r){this.drawing_height=r,this.drawing_width=t,this.GAIA_selectFrameBuffer=e.createFramebuffer(),e.bindFramebuffer(e.FRAMEBUFFER,this.GAIA_selectFrameBuffer),this.GAIA_selectRenderBuffer=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,this.GAIA_selectRenderBuffer),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,this.drawing_width,this.drawing_height),this.GAIA_selectRttTexture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.GAIA_selectRttTexture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.drawing_width,this.drawing_height,0,e.RGBA,e.UNSIGNED_BYTE,null),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.GAIA_selectRttTexture,0),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,this.GAIA_selectRenderBuffer),e.bindTexture(e.TEXTURE_2D,null),e.bindRenderbuffer(e.RENDERBUFFER,null),e.bindFramebuffer(e.FRAMEBUFFER,null)};
"use strict";var Shader=function(){if(!(this instanceof Shader))throw new Error(Messages.CONSTRUCT_ERROR);this.shader_name,this.shader_vertex_source,this.shader_fragment_source,this.SHADER_PROGRAM,this.shader_vertex,this.shader_fragment,this._ModelViewProjectionMatrixRelToEye,this._RefTransfMatrix,this._NormalMatrix,this._encodedCamPosHIGH,this._encodedCamPosLOW,this._BuildingPosHIGH,this._BuildingPosLOW,this._lightDirection,this._color,this._position,this._texcoord,this._normal,this.samplerUniform},ShadersManager=function(){if(!(this instanceof ShadersManager))throw new Error(Messages.CONSTRUCT_ERROR);this.shaders_array=[]};ShadersManager.prototype.getMagoShader=function(e){var r;return e>=0&&e<this.shaders_array.length&&(r=this.shaders_array[e]),r},ShadersManager.prototype.getShader=function(e,r,o,a){var t=e.createShader(o);return e.shaderSource(t,r),e.compileShader(t),e.getShaderParameter(t,e.COMPILE_STATUS)?t:(alert("ERROR IN "+a+" SHADER : "+e.getShaderInfoLog(t)),!1)},ShadersManager.prototype.createDefaultShader=function(e){this.createStandardShader(e),this.createTextureSimpleObjectShader(e),this.createColorSelectionShader(e),this.createTextureSimpleObjectA1Shader(e),this.createCloudShader(e),this.createBlendingCubeShader(e),this.createPCloudShader(e),this.createSimpleObjectTexNormalShader(e)},ShadersManager.prototype.createColorSelectionShader=function(e){var r=new Shader;this.shaders_array.push(r),r.shader_vertex_source=ShaderSource.colorShaderVertexSource,r.shader_fragment_source=ShaderSource.colorShaderFragmentSource,r.SHADER_PROGRAM=e.createProgram(),r.shader_vertex=this.getShader(e,r.shader_vertex_source,e.VERTEX_SHADER,"VERTEX"),r.shader_fragment=this.getShader(e,r.shader_fragment_source,e.FRAGMENT_SHADER,"FRAGMENT"),e.attachShader(r.SHADER_PROGRAM,r.shader_vertex),e.attachShader(r.SHADER_PROGRAM,r.shader_fragment),e.linkProgram(r.SHADER_PROGRAM),r._ModelViewProjectionMatrixRelToEye=e.getUniformLocation(r.SHADER_PROGRAM,"ModelViewProjectionMatrixRelToEye"),r._encodedCamPosHIGH=e.getUniformLocation(r.SHADER_PROGRAM,"encodedCameraPositionMCHigh"),r._encodedCamPosLOW=e.getUniformLocation(r.SHADER_PROGRAM,"encodedCameraPositionMCLow"),r._BuildingPosHIGH=e.getUniformLocation(r.SHADER_PROGRAM,"buildingPosHIGH"),r._BuildingPosLOW=e.getUniformLocation(r.SHADER_PROGRAM,"buildingPosLOW"),r._RefTransfMatrix=e.getUniformLocation(r.SHADER_PROGRAM,"RefTransfMatrix"),r._position=e.getAttribLocation(r.SHADER_PROGRAM,"position")},ShadersManager.prototype.createTextureSimpleObjectShader=function(e){var r=new Shader;this.shaders_array.push(r),r.shader_vertex_source=ShaderSource.textureShaderVertexSource,r.shader_fragment_source=ShaderSource.textureShaderFragmentSource,r.SHADER_PROGRAM=e.createProgram(),r.shader_vertex=this.getShader(e,r.shader_vertex_source,e.VERTEX_SHADER,"VERTEX"),r.shader_fragment=this.getShader(e,r.shader_fragment_source,e.FRAGMENT_SHADER,"FRAGMENT"),e.attachShader(r.SHADER_PROGRAM,r.shader_vertex),e.attachShader(r.SHADER_PROGRAM,r.shader_fragment),e.linkProgram(r.SHADER_PROGRAM),r._encodedCamPosHIGH=e.getUniformLocation(r.SHADER_PROGRAM,"encodedCameraPositionMCHigh"),r._encodedCamPosLOW=e.getUniformLocation(r.SHADER_PROGRAM,"encodedCameraPositionMCLow"),r._BuildingPosHIGH=e.getUniformLocation(r.SHADER_PROGRAM,"buildingPosHIGH"),r._BuildingPosLOW=e.getUniformLocation(r.SHADER_PROGRAM,"buildingPosLOW"),r._Mmatrix=e.getUniformLocation(r.SHADER_PROGRAM,"Mmatrix"),r._ModelViewProjectionMatrixRelToEye=e.getUniformLocation(r.SHADER_PROGRAM,"ModelViewProjectionMatrixRelToEye"),r.SHADER_PROGRAM.samplerUniform=e.getUniformLocation(r.SHADER_PROGRAM,"uSampler"),r._position=e.getAttribLocation(r.SHADER_PROGRAM,"position"),r._texcoord=e.getAttribLocation(r.SHADER_PROGRAM,"aTextureCoord")},ShadersManager.prototype.createTextureSimpleObjectA1Shader=function(e){var r=new Shader;this.shaders_array.push(r),r.shader_vertex_source=ShaderSource.textureA1ShaderVertexSource,r.shader_fragment_source=ShaderSource.textureA1ShaderFragmentSource,r.SHADER_PROGRAM=e.createProgram(),r.shader_vertex=this.getShader(e,r.shader_vertex_source,e.VERTEX_SHADER,"VERTEX"),r.shader_fragment=this.getShader(e,r.shader_fragment_source,e.FRAGMENT_SHADER,"FRAGMENT"),e.attachShader(r.SHADER_PROGRAM,r.shader_vertex),e.attachShader(r.SHADER_PROGRAM,r.shader_fragment),e.linkProgram(r.SHADER_PROGRAM),r._encodedCamPosHIGH=e.getUniformLocation(r.SHADER_PROGRAM,"encodedCameraPositionMCHigh"),r._encodedCamPosLOW=e.getUniformLocation(r.SHADER_PROGRAM,"encodedCameraPositionMCLow"),r._BuildingPosHIGH=e.getUniformLocation(r.SHADER_PROGRAM,"buildingPosHIGH"),r._BuildingPosLOW=e.getUniformLocation(r.SHADER_PROGRAM,"buildingPosLOW"),r._ModelViewProjectionMatrixRelToEye=e.getUniformLocation(r.SHADER_PROGRAM,"ModelViewProjectionMatrixRelToEye"),r.SHADER_PROGRAM.samplerUniform=e.getUniformLocation(r.SHADER_PROGRAM,"uSampler"),r._position=e.getAttribLocation(r.SHADER_PROGRAM,"position"),r._texcoord=e.getAttribLocation(r.SHADER_PROGRAM,"aTextureCoord")},ShadersManager.prototype.createStandardShader=function(e){var r=new Shader;this.shaders_array.push(r),r.shader_vertex_source=ShaderSource.standardShaderVertexSource,r.shader_fragment_source=ShaderSource.standardShaderFragmentSource,r.SHADER_PROGRAM=e.createProgram(),r.shader_vertex=this.getShader(e,r.shader_vertex_source,e.VERTEX_SHADER,"VERTEX"),r.shader_fragment=this.getShader(e,r.shader_fragment_source,e.FRAGMENT_SHADER,"FRAGMENT"),e.attachShader(r.SHADER_PROGRAM,r.shader_vertex),e.attachShader(r.SHADER_PROGRAM,r.shader_fragment),e.linkProgram(r.SHADER_PROGRAM),r._ModelViewProjectionMatrixRelToEye=e.getUniformLocation(r.SHADER_PROGRAM,"ModelViewProjectionMatrixRelToEye"),r._RefTransfMatrix=e.getUniformLocation(r.SHADER_PROGRAM,"RefTransfMatrix"),r._encodedCamPosHIGH=e.getUniformLocation(r.SHADER_PROGRAM,"encodedCameraPositionMCHigh"),r._encodedCamPosLOW=e.getUniformLocation(r.SHADER_PROGRAM,"encodedCameraPositionMCLow"),r._BuildingPosHIGH=e.getUniformLocation(r.SHADER_PROGRAM,"buildingPosHIGH"),r._BuildingPosLOW=e.getUniformLocation(r.SHADER_PROGRAM,"buildingPosLOW"),r._color=e.getAttribLocation(r.SHADER_PROGRAM,"color"),r._position=e.getAttribLocation(r.SHADER_PROGRAM,"position")},ShadersManager.prototype.createCloudShader=function(e){var r=new Shader;this.shaders_array.push(r),r.shader_vertex_source=ShaderSource.cloudShaderVertexSource,r.shader_fragment_source=ShaderSource.cloudShaderFragmentSource,r.SHADER_PROGRAM=e.createProgram(),r.shader_vertex=this.getShader(e,r.shader_vertex_source,e.VERTEX_SHADER,"VERTEX"),r.shader_fragment=this.getShader(e,r.shader_fragment_source,e.FRAGMENT_SHADER,"FRAGMENT"),e.attachShader(r.SHADER_PROGRAM,r.shader_vertex),e.attachShader(r.SHADER_PROGRAM,r.shader_fragment),e.linkProgram(r.SHADER_PROGRAM),r._ModelViewProjectionMatrixRelToEye=e.getUniformLocation(r.SHADER_PROGRAM,"ModelViewProjectionMatrixRelToEye"),r._encodedCamPosHIGH=e.getUniformLocation(r.SHADER_PROGRAM,"encodedCameraPositionMCHigh"),r._encodedCamPosLOW=e.getUniformLocation(r.SHADER_PROGRAM,"encodedCameraPositionMCLow"),r._cloudPosHIGH=e.getUniformLocation(r.SHADER_PROGRAM,"cloudPosHIGH"),r._cloudPosLOW=e.getUniformLocation(r.SHADER_PROGRAM,"cloudPosLOW"),r._color=e.getAttribLocation(r.SHADER_PROGRAM,"color"),r._position=e.getAttribLocation(r.SHADER_PROGRAM,"position")},ShadersManager.prototype.createBlendingCubeShader=function(e){var r=new Shader;this.shaders_array.push(r),r.shader_vertex_source=ShaderSource.blendingCubeShaderVertexSource,r.shader_fragment_source=ShaderSource.blendingCubeShaderFragmentSource,r.SHADER_PROGRAM=e.createProgram(),r.shader_vertex=this.getShader(e,r.shader_vertex_source,e.VERTEX_SHADER,"VERTEX"),r.shader_fragment=this.getShader(e,r.shader_fragment_source,e.FRAGMENT_SHADER,"FRAGMENT"),e.attachShader(r.SHADER_PROGRAM,r.shader_vertex),e.attachShader(r.SHADER_PROGRAM,r.shader_fragment),e.linkProgram(r.SHADER_PROGRAM),r._ModelViewProjectionMatrixRelToEye=e.getUniformLocation(r.SHADER_PROGRAM,"ModelViewProjectionMatrixRelToEye"),r._encodedCamPosHIGH=e.getUniformLocation(r.SHADER_PROGRAM,"encodedCameraPositionMCHigh"),r._encodedCamPosLOW=e.getUniformLocation(r.SHADER_PROGRAM,"encodedCameraPositionMCLow"),r._color=e.getAttribLocation(r.SHADER_PROGRAM,"color"),r._position=e.getAttribLocation(r.SHADER_PROGRAM,"position")},ShadersManager.prototype.createPCloudShader=function(e){var r=new Shader;this.shaders_array.push(r),r.shader_vertex_source=ShaderSource.pCloudShaderVertexSource,r.shader_fragment_source=ShaderSource.pCloundShaderFragmentSource,r.SHADER_PROGRAM=e.createProgram(),r.shader_vertex=this.getShader(e,r.shader_vertex_source,e.VERTEX_SHADER,"VERTEX"),r.shader_fragment=this.getShader(e,r.shader_fragment_source,e.FRAGMENT_SHADER,"FRAGMENT"),e.attachShader(r.SHADER_PROGRAM,r.shader_vertex),e.attachShader(r.SHADER_PROGRAM,r.shader_fragment),e.linkProgram(r.SHADER_PROGRAM),r._ModelViewProjectionMatrixRelToEye=e.getUniformLocation(r.SHADER_PROGRAM,"ModelViewProjectionMatrixRelToEye"),r._encodedCamPosHIGH=e.getUniformLocation(r.SHADER_PROGRAM,"encodedCameraPositionMCHigh"),r._encodedCamPosLOW=e.getUniformLocation(r.SHADER_PROGRAM,"encodedCameraPositionMCLow"),r._BuildingPosHIGH=e.getUniformLocation(r.SHADER_PROGRAM,"buildingPosHIGH"),r._BuildingPosLOW=e.getUniformLocation(r.SHADER_PROGRAM,"buildingPosLOW"),r._color=e.getAttribLocation(r.SHADER_PROGRAM,"color"),r._position=e.getAttribLocation(r.SHADER_PROGRAM,"position")},ShadersManager.prototype.createSimpleObjectTexNormalShader=function(e){var r=new Shader;this.shaders_array.push(r),r.shader_vertex_source=ShaderSource.texNormalShaderVertexSource,r.shader_fragment_source=ShaderSource.texNormalShaderFragmentSource,r.SHADER_PROGRAM=e.createProgram(),r.shader_vertex=this.getShader(e,r.shader_vertex_source,e.VERTEX_SHADER,"VERTEX"),r.shader_fragment=this.getShader(e,r.shader_fragment_source,e.FRAGMENT_SHADER,"FRAGMENT"),e.attachShader(r.SHADER_PROGRAM,r.shader_vertex),e.attachShader(r.SHADER_PROGRAM,r.shader_fragment),e.linkProgram(r.SHADER_PROGRAM),r._encodedCamPosHIGH=e.getUniformLocation(r.SHADER_PROGRAM,"encodedCameraPositionMCHigh"),r._encodedCamPosLOW=e.getUniformLocation(r.SHADER_PROGRAM,"encodedCameraPositionMCLow"),r._BuildingPosHIGH=e.getUniformLocation(r.SHADER_PROGRAM,"buildingPosHIGH"),r._BuildingPosLOW=e.getUniformLocation(r.SHADER_PROGRAM,"buildingPosLOW"),r._ModelViewProjectionMatrixRelToEye=e.getUniformLocation(r.SHADER_PROGRAM,"ModelViewProjectionMatrixRelToEye"),r._NormalMatrix=e.getUniformLocation(r.SHADER_PROGRAM,"uNMatrix"),r.samplerUniform=e.getUniformLocation(r.SHADER_PROGRAM,"uSampler"),r._lightDirection=e.getUniformLocation(r.SHADER_PROGRAM,"uLightingDirection"),r._position=e.getAttribLocation(r.SHADER_PROGRAM,"position"),r._texcoord=e.getAttribLocation(r.SHADER_PROGRAM,"aTextureCoord"),r._normal=e.getAttribLocation(r.SHADER_PROGRAM,"aVertexNormal")};
"use strict";var ShaderSource=ShaderSource||{};ShaderSource.colorShaderVertexSource="\n\tattribute vec3 position;\n\tuniform mat4 ModelViewProjectionMatrixRelToEye;\n\tuniform vec3 buildingPosHIGH;\n\tuniform vec3 buildingPosLOW;\n\tuniform vec3 encodedCameraPositionMCHigh;\n\tuniform vec3 encodedCameraPositionMCLow;\n\tuniform mat4 RefTransfMatrix;\n\tvoid main(void) { //pre-built function\n\t\tvec4 rotatedPos = RefTransfMatrix * vec4(position.xyz, 1.0);\n\t\tvec3 objPosHigh = buildingPosHIGH;\n\t\tvec3 objPosLow = buildingPosLOW.xyz + rotatedPos.xyz;\n\t\tvec3 highDifference = objPosHigh.xyz - encodedCameraPositionMCHigh.xyz;\n\t\tvec3 lowDifference = objPosLow.xyz - encodedCameraPositionMCLow.xyz;\n\t\tvec4 pos = vec4(highDifference.xyz + lowDifference.xyz, 1.0);\n\t\tgl_Position = ModelViewProjectionMatrixRelToEye * pos;\n\t}",ShaderSource.colorShaderFragmentSource="\n\tprecision mediump float;\n\tuniform int byteColor_r;\n\tuniform int byteColor_g;\n\tuniform int byteColor_b;\n\tvoid main(void) {\n\tfloat byteMaxValue = 255.0;\n\t\tgl_FragColor = vec4(float(byteColor_r)/byteMaxValue, float(byteColor_g)/byteMaxValue, float(byteColor_b)/byteMaxValue, 1);\n\t}",ShaderSource.textureShaderVertexSource="\n\tattribute vec3 position;\n\tattribute vec4 aVertexColor;\n\tattribute vec2 aTextureCoord;\n\tuniform mat4 Mmatrix;\n\tuniform mat4 ModelViewProjectionMatrixRelToEye;\n\tuniform vec3 buildingPosHIGH;\n\tuniform vec3 buildingPosLOW;\n\tuniform vec3 encodedCameraPositionMCHigh;\n\tuniform vec3 encodedCameraPositionMCLow;\n\tvarying vec4 vColor;\n\tvarying vec2 vTextureCoord;\n\tvoid main(void) { //pre-built function\n\t\tvec4 rotatedPos = Mmatrix * vec4(position.xyz, 1.0);\n\t\tvec3 objPosHigh = buildingPosHIGH;\n\t\tvec3 objPosLow = buildingPosLOW.xyz + rotatedPos.xyz;\n\t\tvec3 highDifference = objPosHigh.xyz - encodedCameraPositionMCHigh.xyz;\n\t\tvec3 lowDifference = objPosLow.xyz - encodedCameraPositionMCLow.xyz;\n\t\tvec4 pos = vec4(highDifference.xyz + lowDifference.xyz, 1.0);\n\t\tgl_Position = ModelViewProjectionMatrixRelToEye * pos;\n\t\tvColor=aVertexColor;\n\t\tvTextureCoord = aTextureCoord;\n\t}",ShaderSource.textureShaderFragmentSource="\n\tprecision mediump float;\n\tvarying vec4 vColor;\n\tvarying vec2 vTextureCoord;\n\tuniform sampler2D uSampler;\n\tvoid main(void) {\n\t\tgl_FragColor = texture2D(uSampler, vec2(vTextureCoord.s, vTextureCoord.t));\n\t}",ShaderSource.textureA1ShaderVertexSource="\n\tattribute vec3 position;\n\tattribute vec4 aVertexColor;\n\tattribute vec2 aTextureCoord;\n\tuniform mat4 ModelViewProjectionMatrixRelToEye;\n\tuniform vec3 buildingPosHIGH;\n\tuniform vec3 buildingPosLOW;\n\tuniform vec3 encodedCameraPositionMCHigh;\n\tuniform vec3 encodedCameraPositionMCLow;\n\tvarying vec4 vColor;\n\tvarying vec2 vTextureCoord;\n\tvoid main(void) { //pre-built function\n\t\tvec3 objPosHigh = buildingPosHIGH;\n\t\tvec3 objPosLow = buildingPosLOW.xyz + position.xyz;\n\t\tvec3 highDifference = objPosHigh.xyz - encodedCameraPositionMCHigh.xyz;\n\t\tvec3 lowDifference = objPosLow.xyz - encodedCameraPositionMCLow.xyz;\n\t\tvec4 pos = vec4(highDifference.xyz + lowDifference.xyz, 1.0);\n\t\tgl_Position = ModelViewProjectionMatrixRelToEye * pos;\n\t\tvColor=aVertexColor;\n\t\tvTextureCoord = aTextureCoord;\n\t}",ShaderSource.textureA1ShaderFragmentSource="\n\tprecision mediump float;\n\tvarying vec4 vColor;\n\tvarying vec2 vTextureCoord;\n\tuniform sampler2D uSampler;\n\tvoid main(void) {\n\t\tgl_FragColor = texture2D(uSampler, vec2(vTextureCoord.s, vTextureCoord.t));\n\t}",ShaderSource.standardShaderVertexSource="\n\tattribute vec3 position;\n\tuniform mat4 ModelViewProjectionMatrixRelToEye;\n\tuniform vec3 buildingPosHIGH;\n\tuniform vec3 buildingPosLOW;\n\tuniform vec3 encodedCameraPositionMCHigh;\n\tuniform vec3 encodedCameraPositionMCLow;\n\tuniform mat4 RefTransfMatrix;\n\tattribute vec3 color; //the color of the point\n\tvarying vec3 vColor;\n\tvoid main(void) { //pre-built function\n\t\tvec4 rotatedPos = RefTransfMatrix * vec4(position.xyz, 1.0);\n\t\tvec3 objPosHigh = buildingPosHIGH;\n\t\tvec3 objPosLow = buildingPosLOW.xyz + rotatedPos.xyz;\n\t\tvec3 highDifference = objPosHigh.xyz - encodedCameraPositionMCHigh.xyz;\n\t\tvec3 lowDifference = objPosLow.xyz - encodedCameraPositionMCLow.xyz;\n\t\tvec4 pos = vec4(highDifference.xyz + lowDifference.xyz, 1.0);\n\t\tgl_Position = ModelViewProjectionMatrixRelToEye * pos;\n\t\tvColor=color;\n\t}",ShaderSource.standardShaderFragmentSource="\n\tprecision lowp float;\n\tvarying vec3 vColor;\n\tvoid main(void) {\n\t\tgl_FragColor = vec4(vColor, 1.);\n\t}",ShaderSource.cloudShaderVertexSource="\n\tattribute vec3 position;\n\tuniform mat4 ModelViewProjectionMatrixRelToEye;\n\tuniform vec3 cloudPosHIGH;\n\tuniform vec3 cloudPosLOW;\n\tuniform vec3 encodedCameraPositionMCHigh;\n\tuniform vec3 encodedCameraPositionMCLow;\n\tattribute vec3 color; //the color of the point\n\tvarying vec3 vColor;\n\tvoid main(void) { //pre-built function\n\t\tvec3 objPosHigh = cloudPosHIGH;\n\t\tvec3 objPosLow = cloudPosLOW.xyz + position.xyz;\n\t\tvec3 highDifference = objPosHigh.xyz - encodedCameraPositionMCHigh.xyz;\n\t\tvec3 lowDifference = objPosLow.xyz - encodedCameraPositionMCLow.xyz;\n\t\tvec4 pos = vec4(highDifference.xyz + lowDifference.xyz, 1.0);\n\t\tgl_Position = ModelViewProjectionMatrixRelToEye * pos;\n\t\tvColor=color;\n\t}",ShaderSource.cloudShaderFragmentSource="\n\tprecision lowp float;\n\tvarying vec3 vColor;\n\tvoid main(void) {\n\t\tgl_FragColor = vec4(vColor, 1.);\n\t}",ShaderSource.blendingCubeShaderVertexSource="\n\tattribute vec3 position;\n\tuniform mat4 ModelViewProjectionMatrixRelToEye;\n\tuniform vec3 encodedCameraPositionMCHigh;\n\tuniform vec3 encodedCameraPositionMCLow;\n\tattribute vec4 color; //the color of the point\n\tvarying vec4 vColor;\n\tvoid main(void) { //pre-built function\n\t\tvec3 highDifference = -encodedCameraPositionMCHigh.xyz;\n\t\tvec3 lowDifference = position.xyz - encodedCameraPositionMCLow.xyz;\n\t\tvec4 pos = vec4(position.xyz, 1.0);\n\t\tgl_Position = ModelViewProjectionMatrixRelToEye * pos;\n\t\tvColor=color;\n\t}",ShaderSource.blendingCubeShaderFragmentSource="\n\tprecision lowp float;\n\tvarying vec4 vColor;\n\tvoid main(void) {\n\t\tgl_FragColor = vColor;\n\t}",ShaderSource.pCloudShaderVertexSource="\n\tattribute vec3 position;\n\tuniform mat4 ModelViewProjectionMatrixRelToEye;\n\tuniform vec3 buildingPosHIGH;\n\tuniform vec3 buildingPosLOW;\n\tuniform vec3 encodedCameraPositionMCHigh;\n\tuniform vec3 encodedCameraPositionMCLow;\n\tattribute vec4 color; //the color of the point\n\tvarying vec4 vColor;\n\tvoid main(void) { //pre-built function\n\t\tvec3 objPosHigh = buildingPosHIGH;\n\t\tvec3 objPosLow = buildingPosLOW.xyz + position.xyz;\n\t\tvec3 highDifference = objPosHigh.xyz - encodedCameraPositionMCHigh.xyz;\n\t\tvec3 lowDifference = objPosLow.xyz - encodedCameraPositionMCLow.xyz;\n\t\tvec4 pos = vec4(highDifference.xyz + lowDifference.xyz, 1.0);\n\t\tgl_Position = ModelViewProjectionMatrixRelToEye * pos;\n\t\tvColor=color;\n\t}",ShaderSource.pCloundShaderFragmentSource="\n\tprecision lowp float;\n\tvarying vec4 vColor;\n\tvoid main(void) {\n\t\tgl_FragColor = vColor;\n\t}",ShaderSource.texNormalShaderVertexSource="\n\tattribute vec3 position;\n\tattribute vec4 aVertexColor;\n\tattribute vec2 aTextureCoord;\n\tuniform mat4 ModelViewProjectionMatrixRelToEye;\n\tuniform vec3 buildingPosHIGH;\n\tuniform vec3 buildingPosLOW;\n\tuniform vec3 encodedCameraPositionMCHigh;\n\tuniform vec3 encodedCameraPositionMCLow;\n\tvarying vec4 vColor;\n\tvarying vec2 vTextureCoord;\n\tattribute vec3 aVertexNormal;\n\tvarying vec3 uAmbientColor;\n\tvarying vec3 vLightWeighting;\n\t//uniform vec3 uLightingDirection;\n\tuniform mat3 uNMatrix;\n\tvoid main(void) { //pre-built function\n\t\tvec3 objPosHigh = buildingPosHIGH;\n\t\tvec3 objPosLow = buildingPosLOW.xyz + position.xyz;\n\t\tvec3 highDifference = objPosHigh.xyz - encodedCameraPositionMCHigh.xyz;\n\t\tvec3 lowDifference = objPosLow.xyz - encodedCameraPositionMCLow.xyz;\n\t\tvec4 pos = vec4(highDifference.xyz + lowDifference.xyz, 1.0);\n\t\tgl_Position = ModelViewProjectionMatrixRelToEye * pos;\n\t\tvColor = aVertexColor;\n\t\tvTextureCoord = aTextureCoord;\n\t\t\n\t\tvLightWeighting = vec3(1.0, 1.0, 1.0);\n\t\tuAmbientColor = vec3(0.7, 0.7, 0.7);\n\t\tvec3 uLightingDirection = vec3(0.8, 0.2, -0.9);\n\t\tvec3 directionalLightColor = vec3(0.4, 0.4, 0.4);\n\t\tvec3 transformedNormal = uNMatrix * aVertexNormal;\n\t\tfloat directionalLightWeighting = max(dot(transformedNormal, uLightingDirection), 0.0);\n\t\tvLightWeighting = uAmbientColor + directionalLightColor * directionalLightWeighting;\n\t}",ShaderSource.texNormalShaderFragmentSource="\n\tprecision mediump float;\n\tvarying vec4 vColor;\n\tvarying vec2 vTextureCoord;\n\tuniform sampler2D uSampler;\n\tvarying vec3 vLightWeighting;\n\tvoid main(void) {\n\t\tvec4 textureColor = texture2D(uSampler, vec2(vTextureCoord.s, vTextureCoord.t));\n\t\tgl_FragColor = vec4(textureColor.rgb * vLightWeighting, textureColor.a);\n\t}",ShaderSource.blurVsSource="\n\tattribute vec4 position;\n\tattribute vec2 texCoord;\n\n\tuniform mat4 projectionMatrix;\n\tuniform mat4 modelViewMatrix;  \n\n\tvarying vec2 vTexCoord;\n\n\tvoid main() {\t\n\t\tgl_Position = projectionMatrix * modelViewMatrix * position;\n\t\tvTexCoord = texCoord;\n\t}",ShaderSource.blurFsSource="\n\t#ifdef GL_ES\n\t\tprecision highp float;\n\t\t#endif\n\tuniform sampler2D colorTex;\n\tuniform vec2 texelSize;\n\tvarying vec2 vTexCoord; \t \t\n\t\n\tvoid main() {\n\t\tvec3 result = vec3(0.0);\n\t\tfor (int i = 0; i < 4; ++i) {\n\t\t\tfor (int j = 0; j < 4; ++j) {\n\t\t\t\tvec2 offset = vec2(texelSize.x * float(j), texelSize.y * float(i));\n\t\t\t\tresult += texture2D(colorTex, vTexCoord + offset).rgb;\n\t\t\t}\n\t\t}\n\t\t\t   \n\t\tgl_FragColor.rgb = vec3(result * 0.0625); \n\t\tgl_FragColor.a = 1.0;\n\t}",ShaderSource.ssaoVsSource="\n\tattribute vec3 position;\n\tattribute vec3 normal;\n\tattribute vec2 texCoord;\n\t\n\tuniform mat4 projectionMatrix;  \n\tuniform mat4 modelViewMatrix;// No used. *** \n\tuniform mat4 modelViewMatrixRelToEye; \n\tuniform mat4 ModelViewProjectionMatrixRelToEye;\n\tuniform mat4 normalMatrix4;\n\tuniform vec3 buildingPosHIGH;\n\tuniform vec3 buildingPosLOW;\n\tuniform vec3 encodedCameraPositionMCHigh;\n\tuniform vec3 encodedCameraPositionMCLow;\n\t\n\tvarying vec3 vNormal;\n\tvarying vec2 vTexCoord;  \n\t\n\tvoid main() {\t\n\t\tvec3 objPosHigh = buildingPosHIGH;\n\t\tvec3 objPosLow = buildingPosLOW.xyz + position.xyz;\n\t\tvec3 highDifference = objPosHigh.xyz - encodedCameraPositionMCHigh.xyz;\n\t\tvec3 lowDifference = objPosLow.xyz - encodedCameraPositionMCLow.xyz;\n\t\tvec4 pos4 = vec4(highDifference.xyz + lowDifference.xyz, 1.0);\n\t\tgl_Position = ModelViewProjectionMatrixRelToEye * pos4;\n\t\t//vNormal = (normalMatrix4 * vec4(normal, 1.0)).xyz; // Original.***\n\t\tvNormal = (normalMatrix4 * vec4(-normal.x, -normal.y, -normal.z, 1.0)).xyz;\n\t\tvTexCoord = texCoord;\n\t}",ShaderSource.ssaoFsSource="\n\t#ifdef GL_ES\n\t\tprecision highp float;\n\t\t#endif\n\tuniform sampler2D depthTex;\n\tuniform sampler2D noiseTex;  \n\tuniform sampler2D diffuseTex;\n\tvarying vec3 vNormal;\n\tuniform mat4 projectionMatrix;\n\tuniform mat4 m;\n\tuniform vec2 noiseScale;\n\tuniform float near;\n\tuniform float far;            \n\tuniform float fov;\n\tuniform float aspectRatio;    \n\tuniform float screenWidth;    \n\tuniform float screenHeight;    \n\tuniform vec3 kernel[16];   \n\t\n\tvarying vec2 vTexCoord;   \n\t\n\tconst int kernelSize = 16;  \n\t//const float radius = 0.01;      \n\tconst float radius = 1.0;      \n\t\n\tfloat unpackDepth(const in vec4 rgba_depth) {\n\t\t//const vec4 bit_shift = vec4(1.0/(256.0*256.0*256.0), 1.0/(256.0*256.0), 1.0/256.0, 1.0); // original.***\n\t\tconst vec4 bit_shift = vec4(0.000000059605, 0.000015258789, 0.00390625, 1.0);\n\t\tfloat depth = dot(rgba_depth, bit_shift);\n\t\treturn depth;\n\t}                \n\t\n\tvec3 getViewRay(vec2 tc) {\n\t\tfloat hfar = 2.0 * tan(fov/2.0) * far;\n\t\tfloat wfar = hfar * aspectRatio;    \n\t\tvec3 ray = vec3(wfar * (tc.x - 0.5), hfar * (tc.y - 0.5), -far);    \n\t\treturn ray;                      \n\t}         \n\t\t\t   \n\t//linear view space depth\n\tfloat getDepth(vec2 coord) {                          \n\t\treturn unpackDepth(texture2D(depthTex, coord.xy));\n\t}    \n\t\n\tvoid main() {          \n\t\tvec2 screenPos = vec2(gl_FragCoord.x / screenWidth, gl_FragCoord.y / screenHeight);\t\t                 \n\t\t//screenPos.y = 1.0 - screenPos.y;   \n\t\t\n\t\t\n\t\tfloat linearDepth = getDepth(screenPos);          \n\t\tvec3 origin = getViewRay(screenPos) * linearDepth;   \n\t\t\t\t\n\t\t//vec3 normal2 = normalize(vNormal);   \n\t\tvec3 normal2 = vNormal;   \n\t\t\t\t\n\t\tvec3 rvec = texture2D(noiseTex, screenPos.xy * noiseScale).xyz * 2.0 - 1.0;\n\t\tvec3 tangent = normalize(rvec - normal2 * dot(rvec, normal2));\n\t\tvec3 bitangent = cross(normal2, tangent);\n\t\tmat3 tbn = mat3(tangent, bitangent, normal2);        \n\t\t\n\t\tfloat occlusion = 0.0;\n\t\tfor(int i = 0; i < kernelSize; ++i) {    \t \n\t\t\tvec3 sample = origin + (tbn * kernel[i]) * radius; // original.***\n\t\t\t//vec3 sample = origin + (kernel[i]) * radius; // Test.***\n\t\t\tvec4 offset = projectionMatrix * vec4(sample, 1.0);\t\t\n\t\t\toffset.xy /= offset.w;\n\t\t\toffset.xy = offset.xy * 0.5 + 0.5;        \n\t\t\tfloat sampleDepth = -sample.z/far;\n\t\t\tfloat depthBufferValue = getDepth(offset.xy);\t\t\t\t              \n\t\t\t//float range_check = abs(linearDepth - depthBufferValue); // original.***\n\t\t\tfloat range_check = abs(linearDepth - depthBufferValue)+radius*0.998; // test.***\n\t\t\tif (range_check < radius && depthBufferValue <= sampleDepth) {\n\t\t\t\tocclusion +=  1.0;\n\t\t\t}\n\t\t\t\n\t\t}   \n\t\t   \n\t\tocclusion = 1.0 - (occlusion) / float(kernelSize);\n\t\t\t\t\t\t\t\t   \n\t\tvec3 lightPos = vec3(10.0, 10.0, 10.0);\n\t\tvec3 L = normalize(lightPos);\n\t\tfloat NdotL = abs(dot(normal2, L));\n\t\tvec3 diffuse = vec3(NdotL);\n\t\tvec3 ambient = vec3(1.0);\n\t\tvec4 textureColor = texture2D(diffuseTex, vec2(vTexCoord.s, vTexCoord.t));\n\t\t//gl_FragColor.rgb = vec3((diffuse*0.2 + ambient*0.8) * occlusion); // original.***\n\t\t//gl_FragColor.rgb = vec3((diffuse*0.2 + ambient*0.8 * occlusion)); // test.***\n\t\tgl_FragColor.rgb = vec3((textureColor.xyz*0.2 + textureColor.xyz*0.8) * occlusion); // with texture.***\n\t\tgl_FragColor.a = 1.0;   \n\t}",ShaderSource.showDepthVsSource="\n\tattribute vec3 position;\n\tattribute vec3 normal;\n\t\n\tuniform mat4 modelViewMatrixRelToEye; \n\tuniform mat4 ModelViewProjectionMatrixRelToEye;\n\tuniform mat4 normalMatrix3;\n\tuniform mat4 normalMatrix4;\n\tuniform vec3 buildingPosHIGH;\n\tuniform vec3 buildingPosLOW;\n\tuniform vec3 encodedCameraPositionMCHigh;\n\tuniform vec3 encodedCameraPositionMCLow;\n\tuniform float near;\n\tuniform float far;\n\t\n\tvarying vec3 vN;\n\tvarying float depth;  \n\tvarying vec4 vVSPos;\n\tvoid main() {\t\n\t\tvec3 objPosHigh = buildingPosHIGH;\n\t\tvec3 objPosLow = buildingPosLOW.xyz + position.xyz;\n\t\tvec3 highDifference = objPosHigh.xyz - encodedCameraPositionMCHigh.xyz;\n\t\tvec3 lowDifference = objPosLow.xyz - encodedCameraPositionMCLow.xyz;\n\t\tvec4 pos4 = vec4(highDifference.xyz + lowDifference.xyz, 1.0);\n\t\tgl_Position = ModelViewProjectionMatrixRelToEye * pos4; // original.**\n\t\tvN = normalize((normalMatrix4 * vec4(normal, 1.0)).xyz);\n\t\t\n\t\t\n\t\t//linear depth in camera space (0..far)\n\t\tdepth = (modelViewMatrixRelToEye * pos4).z/far; // Original.***\n\t\t\n\t\tvVSPos = modelViewMatrixRelToEye * pos4;\n\t}",ShaderSource.showDepthFsSource="\n\t#ifdef GL_ES\n\tprecision highp float;\n\t#endif\n\tuniform float near;\n\tuniform float far;\n\t\n\tvarying float depth;  \n\tvarying vec3 vN; \n\tvarying vec4 vVSPos;\n\t\n\t//from http://spidergl.org/example.php?id=6\n\tvec4 packDepth(const in float depth) {\n\t\t//const vec4 bit_shift = vec4(256.0*256.0*256.0, 256.0*256.0, 256.0, 1.0); // original.***\n\t\tconst vec4 bit_shift = vec4(16777216.0, 65536.0, 256.0, 1.0);\n\t\t//const vec4 bit_mask  = vec4(0.0, 1.0/256.0, 1.0/256.0, 1.0/256.0); // original.***\n\t\tconst vec4 bit_mask  = vec4(0.0, 0.00390625, 0.00390625, 0.00390625); \n\t\tvec4 res = fract(depth * bit_shift);\n\t\tres -= res.xxyz * bit_mask; // original.***\n\t\treturn res;  \n\t}\n\t\n\tvoid main() {     \n\t\tgl_FragData[0] = packDepth(-depth); // original.***\n\t\tgl_FragData[0].r = -depth/far; // original\n\t\t//gl_FragData[0].g = 1.0; // test\n\t\t//gl_FragData[0].b = 1.0; // test\n\t}",ShaderSource.modelRefSsaoVsSource="\n\tattribute vec3 position;\n\tattribute vec3 normal;\n\tattribute vec2 texCoord;\n\t\n\tuniform mat4 projectionMatrix;  \n\tuniform mat4 modelViewMatrix;// No used. *** \n\tuniform mat4 modelViewMatrixRelToEye; \n\tuniform mat4 ModelViewProjectionMatrixRelToEye;\n\tuniform mat4 RefTransfMatrix;\n\tuniform mat4 normalMatrix4;\n\tuniform vec3 buildingPosHIGH;\n\tuniform vec3 buildingPosLOW;\n\tuniform vec3 encodedCameraPositionMCHigh;\n\tuniform vec3 encodedCameraPositionMCLow;\n\tuniform vec3 aditionalPosition;\n\t\n\tvarying vec3 vNormal;\n\tvarying vec2 vTexCoord;  \n\tvarying vec3 uAmbientColor;\n\tvarying vec3 vLightWeighting;\n\tvarying vec3 vertexPos;\n\t\n\tvoid main() {\t\n\t\tvec4 rotatedPos = RefTransfMatrix * vec4(position.xyz, 1.0) + vec4(aditionalPosition.xyz, 0.0);\n\t\tvec3 objPosHigh = buildingPosHIGH;\n\t\tvec3 objPosLow = buildingPosLOW.xyz + rotatedPos.xyz;\n\t\tvec3 highDifference = objPosHigh.xyz - encodedCameraPositionMCHigh.xyz;\n\t\tvec3 lowDifference = objPosLow.xyz - encodedCameraPositionMCLow.xyz;\n\t\tvec4 pos4 = vec4(highDifference.xyz + lowDifference.xyz, 1.0);\n\t\tgl_Position = ModelViewProjectionMatrixRelToEye * pos4;\n\t\t\n\t\tvertexPos = vec3(modelViewMatrixRelToEye * pos4);\n\t\t//vertexPos = gl_Position.xyz;\n\t\tvec3 rotatedNormal = mat3(RefTransfMatrix) * normal;\n\t\tvLightWeighting = vec3(1.0, 1.0, 1.0);\n\t\tuAmbientColor = vec3(0.8);\n\t\tvec3 uLightingDirection = vec3(0.7, 0.7, 0.7);\n\t\tvec3 directionalLightColor = vec3(0.6, 0.6, 0.6);\n\t\tvNormal = (normalMatrix4 * vec4(rotatedNormal.x, rotatedNormal.y, rotatedNormal.z, 1.0)).xyz;\n\t\tif(vNormal.z < 0.0)\n\t\t{\n\t\t\t//vNormal.x *= -1.0;\n\t\t\t//vNormal.y *= -1.0;\n\t\t\t//vNormal.z *= -1.0;\n\t\t}\n\t\tvTexCoord = texCoord;\n\t\tfloat directionalLightWeighting = max(dot(vNormal, uLightingDirection), 0.0);\n\t\tvLightWeighting = uAmbientColor + directionalLightColor * directionalLightWeighting;\n\t}",ShaderSource.modelRefSsaoFsSource="\n\t#ifdef GL_ES\n\t\tprecision highp float;\n\t\t#endif\n\tuniform sampler2D depthTex;\n\tuniform sampler2D noiseTex;  \n\tuniform sampler2D diffuseTex;\n\tuniform bool hasTexture;\n\tvarying vec3 vNormal;\n\tuniform mat4 projectionMatrix;\n\tuniform mat4 m;\n\tuniform vec2 noiseScale;\n\tuniform float near;\n\tuniform float far;            \n\tuniform float fov;\n\tuniform float aspectRatio;    \n\tuniform float screenWidth;    \n\tuniform float screenHeight;    \n\tuniform vec3 kernel[16];   \n\tuniform vec4 vColor4Aux;\n\t\n\tvarying vec2 vTexCoord;   \n\tvarying vec3 vLightWeighting;\n\t\n\tvarying vec3 ambientColor;\n\tvarying vec3 diffuseColor;\n\tvarying vec3 specularColor;\n\tvarying vec3 vertexPos;\n\t\n\tconst int kernelSize = 16;  \n\t//const float radius = 0.01;      \n\tconst float radius = 0.15;      \n\t\n\tconst float ambientReflectionCoef = 0.5;  \n\tconst float diffuseReflectionCoef = 1.0;  \n\tconst float specularReflectionCoef = 1.0; \n\tconst float shininessVal = 5.0; \n\t\n\tfloat unpackDepth(const in vec4 rgba_depth) {\n\t\t//const vec4 bit_shift = vec4(1.0/(256.0*256.0*256.0), 1.0/(256.0*256.0), 1.0/256.0, 1.0); // original.***\n\t\tconst vec4 bit_shift = vec4(0.000000059605, 0.000015258789, 0.00390625, 1.0);\n\t\tfloat depth = dot(rgba_depth, bit_shift);\n\t\treturn depth;\n\t}                \n\t\n\tvec3 getViewRay(vec2 tc) {\n\t\tfloat hfar = 2.0 * tan(fov/2.0) * far;\n\t\tfloat wfar = hfar * aspectRatio;    \n\t\tvec3 ray = vec3(wfar * (tc.x - 0.5), hfar * (tc.y - 0.5), -far);    \n\t\treturn ray;                      \n\t}         \n\t\t\t   \n\t//linear view space depth\n\tfloat getDepth(vec2 coord) {                          \n\t\treturn unpackDepth(texture2D(depthTex, coord.xy));\n\t}    \n\t\n\tvoid main() {          \n\t\tvec2 screenPos = vec2(gl_FragCoord.x / screenWidth, gl_FragCoord.y / screenHeight);\t\t                 \n\t\t//screenPos.y = 1.0 - screenPos.y;   \n\t\t\n\t\t\n\t\tfloat linearDepth = getDepth(screenPos);          \n\t\tvec3 origin = getViewRay(screenPos) * linearDepth;   \n\t\t\t\t\n\t\t//vec3 normal2 = normalize(vNormal);   \n\t\tvec3 normal2 = vNormal;\n\t\t\t\t\n\t\tvec3 rvec = texture2D(noiseTex, screenPos.xy * noiseScale).xyz * 2.0 - 1.0;\n\t\tvec3 tangent = normalize(rvec - normal2 * dot(rvec, normal2));\n\t\tvec3 bitangent = cross(normal2, tangent);\n\t\tmat3 tbn = mat3(tangent, bitangent, normal2);        \n\t\t\n\t\tfloat occlusion = 0.0;\n\t\tfor(int i = 0; i < kernelSize; ++i) {    \t \n\t\t\tvec3 sample = origin + (tbn * kernel[i]) * radius;\n\t\t\tvec4 offset = projectionMatrix * vec4(sample, 1.0);\t\t\n\t\t\toffset.xy /= offset.w;\n\t\t\toffset.xy = offset.xy * 0.5 + 0.5;        \n\t\t\tfloat sampleDepth = -sample.z/far;\n\t\t\tfloat depthBufferValue = getDepth(offset.xy);\t\t\t\t              \n\t\t\t//float range_check = abs(linearDepth - depthBufferValue); // original.***\n\t\t\tfloat range_check = abs(linearDepth - depthBufferValue)+radius*0.998; // modified.***\n\t\t\tif (range_check < radius*1.001 && depthBufferValue <= sampleDepth) {\n\t\t\t\tocclusion +=  1.0;\n\t\t\t}\n\t\t\t\n\t\t}   \n\t\t   \n\t\tocclusion = 1.0 - occlusion / float(kernelSize);\n\t\t\n\t\tvec3 lightPos = vec3(0.0, 0.0, 20.0);\n\t\tvec3 L = normalize(lightPos - vertexPos);\n\t\t//vec3 L = normalize(lightPos);\n\t\tfloat lambertian = max(dot(normal2, L), 0.0);\n\t\tfloat specular = 0.0;\n\t\tif(lambertian > 0.0) {\n\t\t\tvec3 R = reflect(-L, normal2);      // Reflected light vector\n\t\t\tvec3 V = normalize(-vertexPos); // Vector to viewer\n\t\t\t\n\t\t\t// Compute the specular term\n\t\t\tfloat specAngle = max(dot(R, V), 0.0);\n\t\t\tspecular = pow(specAngle, shininessVal);\n\t\t}\n\t\t//float DiffuseFactor = dot(normal2, L);\n\t\t//float NdotL = abs(DiffuseFactor);\n\t\t//vec3 diffuse = vec3(NdotL);\n\t\t//vec3 ambient = vec3(1.0);\n\t\t\t//if(!gl_FrontFacing)\n\t\t\t//{\n\t\t\t//\tdiscard;\n\t\t\t//}\n\t\tvec4 textureColor;\n\t\tif(hasTexture)\n\t\t{\n\t\t\ttextureColor = texture2D(diffuseTex, vec2(vTexCoord.s, vTexCoord.t));\n\t\t}\n\t\telse{\n\t\t\ttextureColor = vColor4Aux;\n\t\t}\n\t\tvec3 specularColor = vec3(0.7);\n\t\tvec3 ambientColor = vec3(textureColor.x * 0.4, textureColor.y * 0.4, textureColor.z * 0.4);\n\t\tgl_FragColor = vec4((ambientReflectionCoef * ambientColor + diffuseReflectionCoef * lambertian * textureColor.xyz + specularReflectionCoef * specular * specularColor)*vLightWeighting * occlusion, 1.0);\n\t\t//gl_FragColor.rgb = vec3((textureColor.xyz*0.2 + textureColor.xyz*0.8)*vLightWeighting * occlusion); \n\t\t//gl_FragColor.a = 1.0;   \n\t}",ShaderSource.renderShowDepthVsSource="\n\tattribute vec3 position;\n\tattribute vec3 normal;\n\tattribute vec2 texCoord;\n\t\n\tuniform mat4 modelViewMatrixRelToEye; \n\tuniform mat4 RefTransfMatrix;\n\tuniform mat4 ModelViewProjectionMatrixRelToEye;\n\tuniform vec3 buildingPosHIGH;\n\tuniform vec3 buildingPosLOW;\n\tuniform vec3 encodedCameraPositionMCHigh;\n\tuniform vec3 encodedCameraPositionMCLow;\n\tuniform float near;\n\tuniform float far;\n\tuniform vec3 aditionalPosition;\n\t\n\tvarying float depth;  \n\tvoid main() {\t\n\t\tvec4 rotatedPos = RefTransfMatrix * vec4(position.xyz, 1.0) + vec4(aditionalPosition.xyz, 0.0);\n\t\tvec3 objPosHigh = buildingPosHIGH;\n\t\tvec3 objPosLow = buildingPosLOW.xyz + rotatedPos.xyz;\n\t\tvec3 highDifference = objPosHigh.xyz - encodedCameraPositionMCHigh.xyz;\n\t\tvec3 lowDifference = objPosLow.xyz - encodedCameraPositionMCLow.xyz;\n\t\tvec4 pos4 = vec4(highDifference.xyz + lowDifference.xyz, 1.0);\n\t\tgl_Position = ModelViewProjectionMatrixRelToEye * pos4; // original.**\n\t\t\n\t\t\n\t\t//linear depth in camera space (0..far)\n\t\tdepth = (modelViewMatrixRelToEye * pos4).z/far; // Original.***\n\t}",ShaderSource.renderShowDepthFsSource="\n\t#ifdef GL_ES\n\tprecision highp float;\n\t#endif\n\tuniform float near;\n\tuniform float far;\n\t\n\tvarying float depth;  \n\t\n\tvec4 packDepth(const in float depth) {\n\t\t//const vec4 bit_shift = vec4(256.0*256.0*256.0, 256.0*256.0, 256.0, 1.0); // original.***\n\t\tconst vec4 bit_shift = vec4(16777216.0, 65536.0, 256.0, 1.0);\n\t\t//const vec4 bit_mask  = vec4(0.0, 1.0/256.0, 1.0/256.0, 1.0/256.0); // original.***\n\t\tconst vec4 bit_mask  = vec4(0.0, 0.00390625, 0.00390625, 0.00390625); \n\t\tvec4 res = fract(depth * bit_shift);\n\t\tres -= res.xxyz * bit_mask; // original.***\n\t\treturn res;  \n\t}\n\t\n\tvoid main() {     \n\t\tgl_FragData[0] = packDepth(-depth); // original.***\n\t\t//gl_FragData[0].r = -depth/far; // original\n\t\t//gl_FragData[0].r = -depth; // test\n\t\t//gl_FragData[0].g = -depth; // test\n\t\t//gl_FragData[0].b = -depth; // test\n\t}",ShaderSource.colorSelectionSsaoVsSource="\n\tattribute vec3 position;\n\t\n\tuniform mat4 ModelViewProjectionMatrixRelToEye;\n\tuniform mat4 RefTransfMatrix;\n\tuniform vec3 buildingPosHIGH;\n\tuniform vec3 buildingPosLOW;\n\tuniform vec3 encodedCameraPositionMCHigh;\n\tuniform vec3 encodedCameraPositionMCLow;\n\tuniform vec3 aditionalPosition;\n\t\n\tvoid main() {\t\n\t\tvec4 rotatedPos = RefTransfMatrix * vec4(position.xyz, 1.0) + vec4(aditionalPosition.xyz, 1.0);\n\t\tvec3 objPosHigh = buildingPosHIGH;\n\t\tvec3 objPosLow = buildingPosLOW.xyz + rotatedPos.xyz;\n\t\tvec3 highDifference = objPosHigh.xyz - encodedCameraPositionMCHigh.xyz;\n\t\tvec3 lowDifference = objPosLow.xyz - encodedCameraPositionMCLow.xyz;\n\t\tvec4 pos4 = vec4(highDifference.xyz + lowDifference.xyz, 1.0);\n\t\tgl_Position = ModelViewProjectionMatrixRelToEye * pos4;\n\t}",ShaderSource.colorSelectionSsaoFsSource="\n\t\tprecision highp float;\n\tuniform vec4 vColor4Aux;\n\t\n\tvoid main() {          \n\t\tgl_FragColor = vColor4Aux;\n\t}",ShaderSource.simpleDepthSsaoVsSource="\n\tattribute vec3 position;\n\t\n\tuniform mat4 modelViewMatrixRelToEye; \n\tuniform mat4 ModelViewProjectionMatrixRelToEye;\n\tuniform mat4 RefTransfMatrix;\n\tuniform vec3 buildingPosHIGH;\n\tuniform vec3 buildingPosLOW;\n\tuniform vec3 encodedCameraPositionMCHigh;\n\tuniform vec3 encodedCameraPositionMCLow;\n\tvarying float zDepth;\n\tuniform float far;\n\t\n\tvoid main() {\t\n\t\tvec4 rotatedPos = RefTransfMatrix * vec4(position.xyz, 1.0);\n\t\tvec3 objPosHigh = buildingPosHIGH;\n\t\tvec3 objPosLow = buildingPosLOW.xyz + rotatedPos.xyz;\n\t\tvec3 highDifference = objPosHigh.xyz - encodedCameraPositionMCHigh.xyz;\n\t\tvec3 lowDifference = objPosLow.xyz - encodedCameraPositionMCLow.xyz;\n\t\tvec4 pos4 = vec4(highDifference.xyz + lowDifference.xyz, 1.0);\n\t\tgl_Position = ModelViewProjectionMatrixRelToEye * pos4;\n\t\tzDepth = (modelViewMatrixRelToEye * pos4).z/far; // Original.***\n\t}",ShaderSource.simpleDepthSsaoFsSource="\n\t\tprecision highp float;\n\t\tconst vec4 bitEnc = vec4(1.0,255.0,65025.0,16581375.0);\n\t\tconst vec4 bitDec = 1.0/bitEnc;\n\t\tvec4 EncodeFloatRGBA (float v) {\n\t\t\tvec4 enc = bitEnc * v;\n\t\t\tenc = fract(enc);\n\t\t\tenc -= enc.yzww * vec2(1.0/255.0, 0.0).xxxy;\n\t\t\treturn enc;\n\t\t}\n\tvarying float zDepth;\n\t\n\tvoid main() {          \n\tvec4 encodedZ = EncodeFloatRGBA(zDepth);\n\t\tgl_FragData[0] = encodedZ;\n\t}",ShaderSource.LodBuildingSsaoVsSource="\n\tattribute vec3 position;\n\tattribute vec3 normal;\n\tattribute vec4 color4;\n\tattribute vec2 texCoord;\n\t\n\tuniform sampler2D diffuseTex;\n\tuniform mat4 projectionMatrix;  \n\tuniform mat4 modelViewMatrix;// No used. *** \n\tuniform mat4 modelViewMatrixRelToEye; \n\tuniform mat4 ModelViewProjectionMatrixRelToEye;\n\tuniform mat4 normalMatrix4;\n\tuniform mat4 buildingRotMatrix;  \n\tuniform vec3 buildingPosHIGH;\n\tuniform vec3 buildingPosLOW;\n\tuniform vec3 encodedCameraPositionMCHigh;\n\tuniform vec3 encodedCameraPositionMCLow;\n\tuniform vec3 aditionalPosition;\n\tuniform vec4 oneColor4;\n\tuniform bool bUse1Color;\n\tuniform bool hasTexture;\n\t\n\tvarying vec3 vNormal;\n\tvarying vec2 vTexCoord;   \n\tvarying vec3 uAmbientColor;\n\tvarying vec3 vLightWeighting;\n\tvarying vec4 vcolor4;\n\t\n\tvoid main() {\t\n\t\tvec4 rotatedPos = buildingRotMatrix * vec4(position.xyz + aditionalPosition.xyz, 1.0);\n\t\tvec3 objPosHigh = buildingPosHIGH;\n\t\tvec3 objPosLow = buildingPosLOW.xyz + rotatedPos.xyz;\n\t\tvec3 highDifference = objPosHigh.xyz - encodedCameraPositionMCHigh.xyz;\n\t\tvec3 lowDifference = objPosLow.xyz - encodedCameraPositionMCLow.xyz;\n\t\tvec4 pos4 = vec4(highDifference.xyz + lowDifference.xyz, 1.0);\n\t\tgl_Position = ModelViewProjectionMatrixRelToEye * pos4;\n\t\t\n\t\tvec4 rotatedNormal = buildingRotMatrix * vec4(normal.xyz, 1.0);\n\t\tvLightWeighting = vec3(1.0, 1.0, 1.0);\n\t\tuAmbientColor = vec3(0.8, 0.8, 0.8);\n\t\tvec3 uLightingDirection = vec3(0.5, 0.5, 0.5);\n\t\tvec3 directionalLightColor = vec3(0.6, 0.6, 0.6);\n\t\tvNormal = (normalMatrix4 * vec4(rotatedNormal.x, rotatedNormal.y, rotatedNormal.z, 1.0)).xyz;\n\t\tfloat directionalLightWeighting = max(dot(vNormal, uLightingDirection), 0.0);\n\t\tvLightWeighting = uAmbientColor + directionalLightColor * directionalLightWeighting;\n\t\tif(bUse1Color)\n\t\t{\n\t\t\tvcolor4 = oneColor4;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tvcolor4 = color4;\n\t\t}\n\t\tvTexCoord = texCoord;\n\t}",ShaderSource.LodBuildingSsaoFsSource="\n\t#ifdef GL_ES\n\t\tprecision highp float;\n\t\t#endif\n\tuniform sampler2D depthTex;\n\tuniform sampler2D noiseTex;  \n\tuniform sampler2D diffuseTex;\n\tuniform bool hasTexture;\n\tvarying vec3 vNormal;\n\tuniform mat4 projectionMatrix;\n\tuniform mat4 m;\n\tuniform vec2 noiseScale;\n\tuniform float near;\n\tuniform float far;            \n\tuniform float fov;\n\tuniform float aspectRatio;    \n\tuniform float screenWidth;    \n\tuniform float screenHeight;    \n\tuniform vec3 kernel[16];   \n\tuniform vec4 vColor4Aux;\n\t\n\tvarying vec2 vTexCoord;   \n\tvarying vec3 vLightWeighting;\n\tvarying vec4 vcolor4;\n\t\n\tconst int kernelSize = 16;  \n\t//const float radius = 0.01;      \n\t//const float radius = 0.15;      \n\tconst float radius = 0.5;      \n\t\n\tfloat unpackDepth(const in vec4 rgba_depth) {\n\t\t//const vec4 bit_shift = vec4(1.0/(256.0*256.0*256.0), 1.0/(256.0*256.0), 1.0/256.0, 1.0); // original.***\n\t\tconst vec4 bit_shift = vec4(0.000000059605, 0.000015258789, 0.00390625, 1.0);\n\t\tfloat depth = dot(rgba_depth, bit_shift);\n\t\treturn depth;\n\t}                \n\t\n\tvec3 getViewRay(vec2 tc) {\n\t\tfloat hfar = 2.0 * tan(fov/2.0) * far;\n\t\tfloat wfar = hfar * aspectRatio;    \n\t\tvec3 ray = vec3(wfar * (tc.x - 0.5), hfar * (tc.y - 0.5), -far);    \n\t\treturn ray;                      \n\t}         \n\t\t\t   \n\t//linear view space depth\n\tfloat getDepth(vec2 coord) {                          \n\t\treturn unpackDepth(texture2D(depthTex, coord.xy));\n\t}    \n\t\n\tvoid main() {          \n\t\tvec2 screenPos = vec2(gl_FragCoord.x / screenWidth, gl_FragCoord.y / screenHeight);\t\t                 \n\t\t//screenPos.y = 1.0 - screenPos.y;   \n\t\t\n\t\t\n\t\tfloat linearDepth = getDepth(screenPos);          \n\t\tvec3 origin = getViewRay(screenPos) * linearDepth;   \n\t\t\t\t\n\t\t//vec3 normal2 = normalize(vNormal);   \n\t\tvec3 normal2 = vNormal;   \n\t\t\t\t\n\t\tvec3 rvec = texture2D(noiseTex, screenPos.xy * noiseScale).xyz * 2.0 - 1.0;\n\t\tvec3 tangent = normalize(rvec - normal2 * dot(rvec, normal2));\n\t\tvec3 bitangent = cross(normal2, tangent);\n\t\tmat3 tbn = mat3(tangent, bitangent, normal2);        \n\t\t\n\t\tfloat occlusion = 0.0;\n\t\tfor(int i = 0; i < kernelSize; ++i) {    \t \n\t\t\tvec3 sample = origin + (tbn * kernel[i]) * radius;\n\t\t\tvec4 offset = projectionMatrix * vec4(sample, 1.0);\t\t\n\t\t\toffset.xy /= offset.w;\n\t\t\toffset.xy = offset.xy * 0.5 + 0.5;        \n\t\t\tfloat sampleDepth = -sample.z/far;\n\t\t\tfloat depthBufferValue = getDepth(offset.xy);\t\t\t\t              \n\t\t\t//float range_check = abs(linearDepth - depthBufferValue); // original.***\n\t\t\tfloat range_check = abs(linearDepth - depthBufferValue)+radius*0.998; // modified.***\n\t\t\tif (range_check < radius*1.001 && depthBufferValue <= sampleDepth) {\n\t\t\t\tocclusion +=  1.0;\n\t\t\t}\n\t\t\t\n\t\t}   \n\t\t   \n\t\tocclusion = 1.0 - occlusion / float(kernelSize);\n\t\t\t\t\t\t\t\t   \n\t\tvec3 lightPos = vec3(10.0, 10.0, 10.0);\n\t\tvec3 L = normalize(lightPos);\n\t\tfloat DiffuseFactor = dot(normal2, L);\n\t\tfloat NdotL = abs(DiffuseFactor);\n\t\tvec3 diffuse = vec3(NdotL);\n\t\tvec3 ambient = vec3(1.0);\n\t\tvec4 textureColor;\n\t\tif(hasTexture)\n\t\t{\n\t\t\ttextureColor = texture2D(diffuseTex, vec2(vTexCoord.s, vTexCoord.t));\n\t\t}\n\t\telse{\n\t\t\ttextureColor = vcolor4;\n\t\t}\n\t\t//textureColor = vcolor4;\n\t\t////gl_FragColor.rgb = vec3((diffuse*0.2 + ambient*0.8) * occlusion); // original.***\n\t\tgl_FragColor.rgb = vec3((textureColor.xyz)*vLightWeighting * occlusion); \n\t\t//gl_FragColor.rgb = vec3((textureColor.xyz)*vLightWeighting); \n\t\t//gl_FragColor.rgb = textureColor.xyz; \n\t\tgl_FragColor.a = 1.0;   \n\t}",
ShaderSource.lodBuildingDepthVsSource="\n\tattribute vec3 position;\n\t\n\tuniform mat4 modelViewMatrixRelToEye; \n\tuniform mat4 ModelViewProjectionMatrixRelToEye;\n\tuniform mat4 buildingRotMatrix;  \n\tuniform vec3 buildingPosHIGH;\n\tuniform vec3 buildingPosLOW;\n\tuniform vec3 encodedCameraPositionMCHigh;\n\tuniform vec3 encodedCameraPositionMCLow;\n\tuniform float near;\n\tuniform float far;\n\tuniform vec3 aditionalPosition;\n\t\n\tvarying float depth;  \n\tvoid main() {\t\n\t\tvec4 rotatedPos = buildingRotMatrix * vec4(position.xyz + aditionalPosition.xyz, 1.0);\n\t\tvec3 objPosHigh = buildingPosHIGH;\n\t\tvec3 objPosLow = buildingPosLOW.xyz + rotatedPos.xyz;\n\t\tvec3 highDifference = objPosHigh.xyz - encodedCameraPositionMCHigh.xyz;\n\t\tvec3 lowDifference = objPosLow.xyz - encodedCameraPositionMCLow.xyz;\n\t\tvec4 pos4 = vec4(highDifference.xyz + lowDifference.xyz, 1.0);\n\t\tgl_Position = ModelViewProjectionMatrixRelToEye * pos4; // original.**\n\t\t\n\t\t\n\t\t//linear depth in camera space (0..far)\n\t\tdepth = (modelViewMatrixRelToEye * pos4).z/far; // Original.***\n\t}",ShaderSource.lodBuildingDepthFsSource="\n\t#ifdef GL_ES\n\tprecision highp float;\n\t#endif\n\tuniform float near;\n\tuniform float far;\n\t\n\tvarying float depth;  \n\t\n\tvec4 packDepth(const in float depth) {\n\t\t//const vec4 bit_shift = vec4(256.0*256.0*256.0, 256.0*256.0, 256.0, 1.0); // original.***\n\t\tconst vec4 bit_shift = vec4(16777216.0, 65536.0, 256.0, 1.0);\n\t\t//const vec4 bit_mask  = vec4(0.0, 1.0/256.0, 1.0/256.0, 1.0/256.0); // original.***\n\t\tconst vec4 bit_mask  = vec4(0.0, 0.00390625, 0.00390625, 0.00390625); \n\t\tvec4 res = fract(depth * bit_shift);\n\t\tres -= res.xxyz * bit_mask; // original.***\n\t\treturn res;  \n\t}\n\t\n\tvoid main() {     \n\t\tgl_FragData[0] = packDepth(-depth); // original.***\n\t\t//gl_FragData[0].r = -depth/far; // original\n\t\t//gl_FragData[0].r = -depth; // test\n\t\t//gl_FragData[0].g = -depth; // test\n\t\t//gl_FragData[0].b = -depth; // test\n\t}",ShaderSource.LegoSsaoVsSource="\n\tattribute vec3 position;\n\tattribute vec3 normal;\n\tattribute vec4 color4;\n\tattribute vec2 texCoord;\n\t\n\tuniform mat4 projectionMatrix;  \n\tuniform mat4 modelViewMatrix;// No used. *** \n\tuniform mat4 modelViewMatrixRelToEye; \n\tuniform mat4 ModelViewProjectionMatrixRelToEye;\n\tuniform mat4 RefTransfMatrix;\n\tuniform mat4 normalMatrix4;\n\tuniform vec3 buildingPosHIGH;\n\tuniform vec3 buildingPosLOW;\n\tuniform vec3 encodedCameraPositionMCHigh;\n\tuniform vec3 encodedCameraPositionMCLow;\n\tuniform vec3 aditionalPosition;\n\t\n\tvarying vec3 vNormal;\n\tvarying vec2 vTexCoord;  \n\tvarying vec3 uAmbientColor;\n\tvarying vec3 vLightWeighting;\n\tvarying vec4 vcolor4;\n\t\n\tvoid main() {\t\n\t\tvec4 rotatedPos = RefTransfMatrix * vec4(position.xyz + aditionalPosition.xyz, 1.0);\n\t\tvec3 objPosHigh = buildingPosHIGH;\n\t\tvec3 objPosLow = buildingPosLOW.xyz + rotatedPos.xyz;\n\t\tvec3 highDifference = objPosHigh.xyz - encodedCameraPositionMCHigh.xyz;\n\t\tvec3 lowDifference = objPosLow.xyz - encodedCameraPositionMCLow.xyz;\n\t\tvec4 pos4 = vec4(highDifference.xyz + lowDifference.xyz, 1.0);\n\t\tgl_Position = ModelViewProjectionMatrixRelToEye * pos4;\n\t\t\n\t\tvec3 rotatedNormal = mat3(RefTransfMatrix) * normal;\n\t\tvLightWeighting = vec3(1.0, 1.0, 1.0);\n\t\tuAmbientColor = vec3(0.8, 0.8, 0.8);\n\t\tvec3 uLightingDirection = vec3(0.5, 0.5, 0.5);\n\t\tvec3 directionalLightColor = vec3(0.6, 0.6, 0.6);\n\t\tvNormal = (normalMatrix4 * vec4(rotatedNormal.x, rotatedNormal.y, rotatedNormal.z, 1.0)).xyz;\n\t\t//vTexCoord = texCoord;\n\t\tfloat directionalLightWeighting = max(dot(vNormal, uLightingDirection), 0.0);\n\t\tvLightWeighting = uAmbientColor + directionalLightColor * directionalLightWeighting;\n\t\tvcolor4 = color4;\n\t}",ShaderSource.LegoSsaoFsSource="\n\t#ifdef GL_ES\n\t\tprecision highp float;\n\t\t#endif\n\tuniform sampler2D depthTex;\n\tuniform sampler2D noiseTex;  \n\tuniform sampler2D diffuseTex;\n\tuniform bool hasTexture;\n\tvarying vec3 vNormal;\n\tuniform mat4 projectionMatrix;\n\tuniform mat4 m;\n\tuniform vec2 noiseScale;\n\tuniform float near;\n\tuniform float far;            \n\tuniform float fov;\n\tuniform float aspectRatio;    \n\tuniform float screenWidth;    \n\tuniform float screenHeight;    \n\tuniform vec3 kernel[16];   \n\tuniform vec4 vColor4Aux;\n\t\n\tvarying vec2 vTexCoord;   \n\tvarying vec3 vLightWeighting;\n\tvarying vec4 vcolor4;\n\t\n\tconst int kernelSize = 16;  \n\t//const float radius = 0.01;      \n\t//const float radius = 0.15;      \n\tconst float radius = 0.5;      \n\t\n\tfloat unpackDepth(const in vec4 rgba_depth) {\n\t\t//const vec4 bit_shift = vec4(1.0/(256.0*256.0*256.0), 1.0/(256.0*256.0), 1.0/256.0, 1.0); // original.***\n\t\tconst vec4 bit_shift = vec4(0.000000059605, 0.000015258789, 0.00390625, 1.0);\n\t\tfloat depth = dot(rgba_depth, bit_shift);\n\t\treturn depth;\n\t}                \n\t\n\tvec3 getViewRay(vec2 tc) {\n\t\tfloat hfar = 2.0 * tan(fov/2.0) * far;\n\t\tfloat wfar = hfar * aspectRatio;    \n\t\tvec3 ray = vec3(wfar * (tc.x - 0.5), hfar * (tc.y - 0.5), -far);    \n\t\treturn ray;                      \n\t}         \n\t\t\t   \n\t//linear view space depth\n\tfloat getDepth(vec2 coord) {                          \n\t\treturn unpackDepth(texture2D(depthTex, coord.xy));\n\t}    \n\t\n\tvoid main() {          \n\t\tvec2 screenPos = vec2(gl_FragCoord.x / screenWidth, gl_FragCoord.y / screenHeight);\t\t                 \n\t\t//screenPos.y = 1.0 - screenPos.y;   \n\t\t\n\t\t\n\t\tfloat linearDepth = getDepth(screenPos);          \n\t\tvec3 origin = getViewRay(screenPos) * linearDepth;   \n\t\t\t\t\n\t\t//vec3 normal2 = normalize(vNormal);   \n\t\tvec3 normal2 = vNormal;   \n\t\t\t\t\n\t\tvec3 rvec = texture2D(noiseTex, screenPos.xy * noiseScale).xyz * 2.0 - 1.0;\n\t\tvec3 tangent = normalize(rvec - normal2 * dot(rvec, normal2));\n\t\tvec3 bitangent = cross(normal2, tangent);\n\t\tmat3 tbn = mat3(tangent, bitangent, normal2);        \n\t\t\n\t\tfloat occlusion = 0.0;\n\t\tfor(int i = 0; i < kernelSize; ++i) {    \t \n\t\t\tvec3 sample = origin + (tbn * kernel[i]) * radius;\n\t\t\tvec4 offset = projectionMatrix * vec4(sample, 1.0);\t\t\n\t\t\toffset.xy /= offset.w;\n\t\t\toffset.xy = offset.xy * 0.5 + 0.5;        \n\t\t\tfloat sampleDepth = -sample.z/far;\n\t\t\tfloat depthBufferValue = getDepth(offset.xy);\t\t\t\t              \n\t\t\t//float range_check = abs(linearDepth - depthBufferValue); // original.***\n\t\t\tfloat range_check = abs(linearDepth - depthBufferValue)+radius*0.998; // modified.***\n\t\t\tif (range_check < radius*1.001 && depthBufferValue <= sampleDepth) {\n\t\t\t\tocclusion +=  1.0;\n\t\t\t}\n\t\t\t\n\t\t}   \n\t\t   \n\t\tocclusion = 1.0 - occlusion / float(kernelSize);\n\t\t\t\t\t\t\t\t   \n\t\tvec3 lightPos = vec3(10.0, 10.0, 10.0);\n\t\tvec3 L = normalize(lightPos);\n\t\tfloat DiffuseFactor = dot(normal2, L);\n\t\tfloat NdotL = abs(DiffuseFactor);\n\t\tvec3 diffuse = vec3(NdotL);\n\t\tvec3 ambient = vec3(1.0);\n\t\tvec4 textureColor;\n\t\ttextureColor = vcolor4;\n\t\t////gl_FragColor.rgb = vec3((diffuse*0.2 + ambient*0.8) * occlusion); // original.***\n\t\tgl_FragColor.rgb = vec3((textureColor.xyz)*vLightWeighting * occlusion); \n\t\t//gl_FragColor.rgb = vec3((textureColor.xyz)*vLightWeighting); \n\t\t//gl_FragColor.rgb = textureColor.xyz; \n\t\tgl_FragColor.a = 1.0;   \n\t}",ShaderSource.LegoDepthVsSource="\n\tattribute vec3 position;\n\tattribute vec3 normal;\n\tattribute vec2 texCoord;\n\t\n\tuniform mat4 modelViewMatrixRelToEye; \n\tuniform mat4 RefTransfMatrix;\n\tuniform mat4 ModelViewProjectionMatrixRelToEye;\n\tuniform vec3 buildingPosHIGH;\n\tuniform vec3 buildingPosLOW;\n\tuniform vec3 encodedCameraPositionMCHigh;\n\tuniform vec3 encodedCameraPositionMCLow;\n\tuniform float near;\n\tuniform float far;\n\tuniform vec3 aditionalPosition;\n\t\n\tvarying float depth;  \n\tvoid main() {\t\n\t\tvec4 rotatedPos = RefTransfMatrix * vec4(position.xyz + aditionalPosition.xyz, 1.0);\n\t\tvec3 objPosHigh = buildingPosHIGH;\n\t\tvec3 objPosLow = buildingPosLOW.xyz + rotatedPos.xyz;\n\t\tvec3 highDifference = objPosHigh.xyz - encodedCameraPositionMCHigh.xyz;\n\t\tvec3 lowDifference = objPosLow.xyz - encodedCameraPositionMCLow.xyz;\n\t\tvec4 pos4 = vec4(highDifference.xyz + lowDifference.xyz, 1.0);\n\t\tgl_Position = ModelViewProjectionMatrixRelToEye * pos4; // original.**\n\t\t\n\t\t\n\t\t//linear depth in camera space (0..far)\n\t\tdepth = (modelViewMatrixRelToEye * pos4).z/far; // Original.***\n\t}",ShaderSource.LegoDepthFsSource="\n\t#ifdef GL_ES\n\tprecision highp float;\n\t#endif\n\tuniform float near;\n\tuniform float far;\n\t\n\tvarying float depth;  \n\t\n\tvec4 packDepth(const in float depth) {\n\t\t//const vec4 bit_shift = vec4(256.0*256.0*256.0, 256.0*256.0, 256.0, 1.0); // original.***\n\t\tconst vec4 bit_shift = vec4(16777216.0, 65536.0, 256.0, 1.0);\n\t\t//const vec4 bit_mask  = vec4(0.0, 1.0/256.0, 1.0/256.0, 1.0/256.0); // original.***\n\t\tconst vec4 bit_mask  = vec4(0.0, 0.00390625, 0.00390625, 0.00390625); \n\t\tvec4 res = fract(depth * bit_shift);\n\t\tres -= res.xxyz * bit_mask; // original.***\n\t\treturn res;  \n\t}\n\t\n\tvoid main() {     \n\t\tgl_FragData[0] = packDepth(-depth); // original.***\n\t\t//gl_FragData[0].r = -depth/far; // original\n\t\t//gl_FragData[0].r = -depth; // test\n\t\t//gl_FragData[0].g = -depth; // test\n\t\t//gl_FragData[0].b = -depth; // test\n\t}",ShaderSource.boxDepthVsSource="\n\tattribute vec3 position;\n\t\n\tuniform mat4 modelViewMatrixRelToEye; \n\tuniform mat4 ModelViewProjectionMatrixRelToEye;\n\tuniform mat4 buildingRotMatrix;  \n\tuniform vec3 buildingPosHIGH;\n\tuniform vec3 buildingPosLOW;\n\tuniform vec3 encodedCameraPositionMCHigh;\n\tuniform vec3 encodedCameraPositionMCLow;\n\tuniform float near;\n\tuniform float far;\n\tuniform vec3 aditionalPosition;\n\t\n\tvarying float depth;  \n\tvoid main() {\t\n\t\tvec4 rotatedPos = buildingRotMatrix * vec4(position.xyz + aditionalPosition.xyz, 1.0);\n\t\tvec3 objPosHigh = buildingPosHIGH;\n\t\tvec3 objPosLow = buildingPosLOW.xyz + rotatedPos.xyz;\n\t\tvec3 highDifference = objPosHigh.xyz - encodedCameraPositionMCHigh.xyz;\n\t\tvec3 lowDifference = objPosLow.xyz - encodedCameraPositionMCLow.xyz;\n\t\tvec4 pos4 = vec4(highDifference.xyz + lowDifference.xyz, 1.0);\n\t\tgl_Position = ModelViewProjectionMatrixRelToEye * pos4; // original.**\n\t\t\n\t\t\n\t\t//linear depth in camera space (0..far)\n\t\tdepth = (modelViewMatrixRelToEye * pos4).z/far; // Original.***\n\t}",ShaderSource.boxDepthFsSource="\n\t#ifdef GL_ES\n\tprecision highp float;\n\t#endif\n\tuniform float near;\n\tuniform float far;\n\t\n\tvarying float depth;  \n\t\n\tvec4 packDepth(const in float depth) {\n\t\t//const vec4 bit_shift = vec4(256.0*256.0*256.0, 256.0*256.0, 256.0, 1.0); // original.***\n\t\tconst vec4 bit_shift = vec4(16777216.0, 65536.0, 256.0, 1.0);\n\t\t//const vec4 bit_mask  = vec4(0.0, 1.0/256.0, 1.0/256.0, 1.0/256.0); // original.***\n\t\tconst vec4 bit_mask  = vec4(0.0, 0.00390625, 0.00390625, 0.00390625); \n\t\tvec4 res = fract(depth * bit_shift);\n\t\tres -= res.xxyz * bit_mask; // original.***\n\t\treturn res;  \n\t}\n\t\n\tvoid main() {     \n\t\tgl_FragData[0] = packDepth(-depth); // original.***\n\t\t//gl_FragData[0].r = -depth/far; // original\n\t\t//gl_FragData[0].r = -depth; // test\n\t\t//gl_FragData[0].g = -depth; // test\n\t\t//gl_FragData[0].b = -depth; // test\n\t}",ShaderSource.boxSsaoVsSource="\n\tattribute vec3 position;\n\tattribute vec3 normal;\n\tattribute vec4 color4;\n\t\n\tuniform mat4 projectionMatrix;  \n\tuniform mat4 modelViewMatrix;// No used. *** \n\tuniform mat4 modelViewMatrixRelToEye; \n\tuniform mat4 ModelViewProjectionMatrixRelToEye;\n\tuniform mat4 normalMatrix4;\n\tuniform mat4 buildingRotMatrix;  \n\tuniform vec3 buildingPosHIGH;\n\tuniform vec3 buildingPosLOW;\n\tuniform vec3 encodedCameraPositionMCHigh;\n\tuniform vec3 encodedCameraPositionMCLow;\n\tuniform vec3 aditionalPosition;\n\tuniform vec4 oneColor4;\n\tuniform bool bUse1Color;\n\tuniform vec3 scale;\n\tuniform bool bScale;\n\t\n\tvarying vec3 vNormal;\n\tvarying vec2 vTexCoord;  \n\tvarying vec3 uAmbientColor;\n\tvarying vec3 vLightWeighting;\n\tvarying vec4 vcolor4;\n\t\n\tvoid main() {\t\n\t\tvec4 position2 = vec4(position.xyz, 1.0);\n\t\tif(bScale)\n\t\t{\n\t\t\tposition2.x *= scale.x;\n\t\t\tposition2.y *= scale.y;\n\t\t\tposition2.z *= scale.z;\n\t\t}\n\t\tvec4 rotatedPos = buildingRotMatrix * vec4(position2.xyz + aditionalPosition.xyz, 1.0);\n\t\tvec3 objPosHigh = buildingPosHIGH;\n\t\tvec3 objPosLow = buildingPosLOW.xyz + rotatedPos.xyz;\n\t\tvec3 highDifference = objPosHigh.xyz - encodedCameraPositionMCHigh.xyz;\n\t\tvec3 lowDifference = objPosLow.xyz - encodedCameraPositionMCLow.xyz;\n\t\tvec4 pos4 = vec4(highDifference.xyz + lowDifference.xyz, 1.0);\n\t\tgl_Position = ModelViewProjectionMatrixRelToEye * pos4;\n\t\t\n\t\tvec4 rotatedNormal = buildingRotMatrix * vec4(normal.xyz, 1.0);\n\t\tvLightWeighting = vec3(1.0, 1.0, 1.0);\n\t\tuAmbientColor = vec3(0.8, 0.8, 0.8);\n\t\tvec3 uLightingDirection = vec3(0.5, 0.5, 0.5);\n\t\tvec3 directionalLightColor = vec3(0.6, 0.6, 0.6);\n\t\tvNormal = (normalMatrix4 * vec4(rotatedNormal.x, rotatedNormal.y, rotatedNormal.z, 1.0)).xyz;\n\t\tfloat directionalLightWeighting = max(dot(vNormal, uLightingDirection), 0.0);\n\t\tvLightWeighting = uAmbientColor + directionalLightColor * directionalLightWeighting;\n\t\tif(bUse1Color)\n\t\t{\n\t\t\tvcolor4 = oneColor4;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tvcolor4 = color4;\n\t\t}\n\t}",ShaderSource.boxSsaoFsSource="\n\t#ifdef GL_ES\n\t\tprecision highp float;\n\t\t#endif\n\tuniform sampler2D depthTex;\n\tuniform sampler2D noiseTex;  \n\tuniform sampler2D diffuseTex;\n\tuniform bool hasTexture;\n\tvarying vec3 vNormal;\n\tuniform mat4 projectionMatrix;\n\tuniform mat4 m;\n\tuniform vec2 noiseScale;\n\tuniform float near;\n\tuniform float far;            \n\tuniform float fov;\n\tuniform float aspectRatio;    \n\tuniform float screenWidth;    \n\tuniform float screenHeight;    \n\tuniform vec3 kernel[16];   \n\tuniform vec4 vColor4Aux;\n\t\n\tvarying vec2 vTexCoord;   \n\tvarying vec3 vLightWeighting;\n\tvarying vec4 vcolor4;\n\t\n\tconst int kernelSize = 16;  \n\t//const float radius = 0.01;      \n\t//const float radius = 0.15;      \n\tconst float radius = 0.5;      \n\t\n\tfloat unpackDepth(const in vec4 rgba_depth) {\n\t\t//const vec4 bit_shift = vec4(1.0/(256.0*256.0*256.0), 1.0/(256.0*256.0), 1.0/256.0, 1.0); // original.***\n\t\tconst vec4 bit_shift = vec4(0.000000059605, 0.000015258789, 0.00390625, 1.0);\n\t\tfloat depth = dot(rgba_depth, bit_shift);\n\t\treturn depth;\n\t}                \n\t\n\tvec3 getViewRay(vec2 tc) {\n\t\tfloat hfar = 2.0 * tan(fov/2.0) * far;\n\t\tfloat wfar = hfar * aspectRatio;    \n\t\tvec3 ray = vec3(wfar * (tc.x - 0.5), hfar * (tc.y - 0.5), -far);    \n\t\treturn ray;                      \n\t}         \n\t\t\t   \n\t//linear view space depth\n\tfloat getDepth(vec2 coord) {                          \n\t\treturn unpackDepth(texture2D(depthTex, coord.xy));\n\t}    \n\t\n\tvoid main() {          \n\t\tvec2 screenPos = vec2(gl_FragCoord.x / screenWidth, gl_FragCoord.y / screenHeight);\t\t                 \n\t\t//screenPos.y = 1.0 - screenPos.y;   \n\t\t\n\t\t\n\t\tfloat linearDepth = getDepth(screenPos);          \n\t\tvec3 origin = getViewRay(screenPos) * linearDepth;   \n\t\t\t\t\n\t\t//vec3 normal2 = normalize(vNormal);   \n\t\tvec3 normal2 = vNormal;   \n\t\t\t\t\n\t\tvec3 rvec = texture2D(noiseTex, screenPos.xy * noiseScale).xyz * 2.0 - 1.0;\n\t\tvec3 tangent = normalize(rvec - normal2 * dot(rvec, normal2));\n\t\tvec3 bitangent = cross(normal2, tangent);\n\t\tmat3 tbn = mat3(tangent, bitangent, normal2);        \n\t\t\n\t\tfloat occlusion = 0.0;\n\t\tfor(int i = 0; i < kernelSize; ++i) {    \t \n\t\t\tvec3 sample = origin + (tbn * kernel[i]) * radius;\n\t\t\tvec4 offset = projectionMatrix * vec4(sample, 1.0);\t\t\n\t\t\toffset.xy /= offset.w;\n\t\t\toffset.xy = offset.xy * 0.5 + 0.5;        \n\t\t\tfloat sampleDepth = -sample.z/far;\n\t\t\tfloat depthBufferValue = getDepth(offset.xy);\t\t\t\t              \n\t\t\t//float range_check = abs(linearDepth - depthBufferValue); // original.***\n\t\t\tfloat range_check = abs(linearDepth - depthBufferValue)+radius*0.998; // modified.***\n\t\t\tif (range_check < radius*1.001 && depthBufferValue <= sampleDepth) {\n\t\t\t\tocclusion +=  1.0;\n\t\t\t}\n\t\t\t\n\t\t}   \n\t\t   \n\t\tocclusion = 1.0 - occlusion / float(kernelSize);\n\t\t\t\t\t\t\t\t   \n\t\tvec3 lightPos = vec3(10.0, 10.0, 10.0);\n\t\tvec3 L = normalize(lightPos);\n\t\tfloat DiffuseFactor = dot(normal2, L);\n\t\tfloat NdotL = abs(DiffuseFactor);\n\t\tvec3 diffuse = vec3(NdotL);\n\t\tvec3 ambient = vec3(1.0);\n\t\tvec4 textureColor;\n\t\ttextureColor = vcolor4;\n\t\t////gl_FragColor.rgb = vec3((diffuse*0.2 + ambient*0.8) * occlusion); // original.***\n\t\tgl_FragColor.rgb = vec3((textureColor.xyz)*vLightWeighting * occlusion); \n\t\t//gl_FragColor.rgb = vec3((textureColor.xyz)*vLightWeighting); \n\t\t//gl_FragColor.rgb = textureColor.xyz; \n\t\tgl_FragColor.a = 1.0;   \n\t}";
"use strict";var SplitValue=function(){this.high=void 0,this.low=void 0};
"use strict";var TerranTile=function(){if(!(this instanceof TerranTile))throw new Error(Messages.CONSTRUCT_ERROR);this._depth=0,this._numberName=1,this._terranTile_owner,this.projectsArray=[],this._BR_buildingsArray=[],this._boundingBox,this._pCloudMesh_array=[],this.position,this.radius,this.leftDown_position,this.rightDown_position,this.rightUp_position,this.leftUp_position,this.visibilityType,this.subTiles_array=[],this.terranIndexFile_readed=!1,this.empty_tile=!1,this.fileReading_started=!1,this.fileReading_finished=!1,this.fileArrayBuffer,this.fileBytesReaded=0,this.fileParsingFinished=!1,this.projectsParsed_count=0,this.current_BRProject_parsing,this.current_BRProject_parsing_state=0,this.readWriter};TerranTile.prototype.newBRProject=function(){var i=new BRBuildingProject;return this._BR_buildingsArray.push(i),i},TerranTile.prototype.newSubTerranTile=function(){var i=this.subTiles_array.length,e=new TerranTile;return e._depth=this._depth+1,e._numberName=10*this._numberName+i+1,this.subTiles_array.push(e),e},TerranTile.prototype.make4subTiles=function(){for(var i=0;i<4;i++){this.newSubTerranTile()}},TerranTile.prototype.setDimensions=function(i,e,t,r){this.longitudeMin=i,this.longitudeMax=e,this.latitudeMin=t,this.latitudeMax=r},TerranTile.prototype.makeTree=function(i){if(this._depth<i)for(var e,t=0;t<4;t++)e=this.newSubTerranTile(),e.makeTree(i)},TerranTile.prototype.calculatePositionByLonLat=function(){var i=(this.longitudeMax+this.longitudeMin)/2,e=(this.latitudeMax+this.latitudeMin)/2;this.position=Cesium.Cartesian3.fromDegrees(i,e,0),this.leftDown_position=Cesium.Cartesian3.fromDegrees(this.longitudeMin,this.latitudeMin,0),this.rightDown_position=Cesium.Cartesian3.fromDegrees(this.longitudeMax,this.latitudeMin,0),this.rightUp_position=Cesium.Cartesian3.fromDegrees(this.longitudeMax,this.latitudeMax,0),this.leftUp_position=Cesium.Cartesian3.fromDegrees(this.longitudeMin,this.latitudeMax,0),this.radius=Cesium.Cartesian3.distance(this.leftDown_position,this.rightUp_position)/2*.9},TerranTile.prototype.calculatePositionByLonLatSubTiles=function(){this.calculatePositionByLonLat();for(var i=this.subTiles_array.length,e=0;e<i;e++)this.subTiles_array[e].calculatePositionByLonLatSubTiles()},TerranTile.prototype.parseFileHeader=function(i){var e=this.fileArrayBuffer.byteLength;if(!(this.fileBytesReaded>=e)){var t=5,r=0,s=i._header,n=this.fileArrayBuffer,a=this.fileBytesReaded;void 0==this.readWriter&&(this.readWriter=new ReaderWriter);for(var o=0;o<t;o++)s._version+=String.fromCharCode(new Int8Array(n.slice(a,a+1))),a+=1;s._f4d_version=2,r=this.readWriter.readInt32(n,a,a+4),a+=4;for(var o=0;o<r;o++)s._global_unique_id+=String.fromCharCode(new Int8Array(n.slice(a,a+1))),a+=1;s._longitude=new Float64Array(n.slice(a,a+8))[0],a+=8,s._latitude=new Float64Array(n.slice(a,a+8))[0],a+=8,s._elevation=new Float32Array(n.slice(a,a+4))[0],a+=4,s._boundingBox.minX=new Float32Array(n.slice(a,a+4))[0],a+=4,s._boundingBox.minY=new Float32Array(n.slice(a,a+4))[0],a+=4,s._boundingBox.minZ=new Float32Array(n.slice(a,a+4))[0],a+=4,s._boundingBox.maxX=new Float32Array(n.slice(a,a+4))[0],a+=4,s._boundingBox.maxY=new Float32Array(n.slice(a,a+4))[0],a+=4,s._boundingBox.maxZ=new Float32Array(n.slice(a,a+4))[0],a+=4;var l=(s._boundingBox.maxZ-s._boundingBox.minZ)/2;s._elevation=45+l-.5;var h=!1;(s._boundingBox.maxX-s._boundingBox.minX>40||s._boundingBox.maxY-s._boundingBox.minY>40)&&(h=!0),!h&&s._boundingBox.maxZ-s._boundingBox.minZ<30&&(s.isSmall=!0);this.readWriter.readUInt8(n,a,a+1);a+=1;var d=Cesium.Cartesian3.fromDegrees(s._longitude,s._latitude,s._elevation),u=Cesium.Ellipsoid.WGS84.cartesianToCartographic(d),_=u.height;d=Cesium.Cartesian3.fromDegrees(s._longitude,s._latitude,_),i.buildingPosition=d;var g=(Cesium.EncodedCartesian3.encode(d),Cesium.EncodedCartesian3.encode(d.x)),p=Cesium.EncodedCartesian3.encode(d.y),c=Cesium.EncodedCartesian3.encode(d.z);i.buildingPositionHIGH=new Float32Array(3),i.buildingPositionHIGH[0]=g.high,i.buildingPositionHIGH[1]=p.high,i.buildingPositionHIGH[2]=c.high,i.buildingPositionLOW=new Float32Array(3),i.buildingPositionLOW[0]=g.low,i.buildingPositionLOW[1]=p.low,i.buildingPositionLOW[2]=c.low,this.fileBytesReaded=a}},TerranTile.prototype.parseFileSimpleBuilding=function(i){var e=this.fileArrayBuffer.byteLength;if(!(this.fileBytesReaded>=e)){void 0==this.readWriter&&(this.readWriter=new ReaderWriter);var t,r,s=this.fileBytesReaded,n=this.fileArrayBuffer;void 0==i._simpleBuilding_v1&&(i._simpleBuilding_v1=new SimpleBuildingV1);var a=i._simpleBuilding_v1,o=this.readWriter.readUInt32(n,s,s+4);s+=4;for(var l=0;l<o;l++){var h=a.newSimpleObject(),d=h._vtCacheKeys_container.newVertexTexcoordsArraysCacheKey(),u=this.readWriter.readUInt32(n,s,s+4);s+=4,t=s,r=s+20*u,d.verticesArrayBuffer=n.slice(t,r),s+=20*u,d._vertices_count=u}this.readWriter.readInt32(n,s,s+4);s+=4,this.fileBytesReaded=s}},TerranTile.prototype.parseFileNailImage=function(i,e){void 0==i._simpleBuilding_v1&&(i._simpleBuilding_v1=new SimpleBuildingV1),void 0==this.readWriter&&(this.readWriter=new ReaderWriter);var t=i._simpleBuilding_v1,r=this.fileBytesReaded,s=this.fileArrayBuffer,n=this.readWriter.readUInt32(s,r,r+4);r+=4;var a=r,o=r+n;t.textureArrayBuffer=new Uint8Array(s.slice(a,o)),r+=n,this.fileBytesReaded=r},TerranTile.prototype.parseFileAllBuildings=function(i){var e=this.fileArrayBuffer.byteLength;if(this.fileBytesReaded>=e)return void(this.fileParsingFinished=!0);void 0==this.readWriter&&(this.readWriter=new ReaderWriter);var t=this.fileArrayBuffer,r=this.readWriter.readInt32(t,0,4);this.fileBytesReaded+=4,0==r&&(this.empty_tile=!0);for(var s=0;s<r;s++){var n=this.fileBytesReaded;this.fileBytesReaded=n,this.current_BRProject_parsing=this.newBRProject(),this.parseFileHeader(this.current_BRProject_parsing),this.parseFileSimpleBuilding(this.current_BRProject_parsing),this.parseFileNailImage(this.current_BRProject_parsing,i)}this.fileParsingFinished=!0,this.fileArrayBuffer=null},TerranTile.prototype.parseFileOneBuilding=function(i,e){var t=this.fileArrayBuffer.byteLength;if(this.fileBytesReaded>=t)return void(this.fileParsingFinished=!0);void 0==this.readWriter&&(this.readWriter=new ReaderWriter);var r=this.readWriter.readInt32(this.fileArrayBuffer,0,4);if(this.projectsParsed_count>=r)return this.fileParsingFinished=!0,void(this.fileBytesReaded=null);0==this.current_BRProject_parsing_state&&(0==this.projectsParsed_count&&(this.fileBytesReaded=4),this.current_BRProject_parsing=this.newBRProject());var s=this.current_BRProject_parsing;0==this.current_BRProject_parsing_state?(this.parseFileHeader(s),this.current_BRProject_parsing_state=1):1==this.current_BRProject_parsing_state?e.backGround_imageReadings_count<1&&(this.parseFile_simpleBuilding_old(i,s),this.current_BRProject_parsing_state=2):2==this.current_BRProject_parsing_state&&e.backGround_imageReadings_count<1&&(this.parseFile_nailImage_old(i,s,e),this.current_BRProject_parsing_state=0,this.projectsParsed_count++,e.backGround_imageReadings_count++)},TerranTile.prototype.setDimensionsSubTiles=function(){var i,e=this.subTiles_array.length;if(4==e){var t=(this.longitudeMax+this.longitudeMin)/2,r=(this.latitudeMax+this.latitudeMin)/2;i=this.subTiles_array[0],i.setDimensions(this.longitudeMin,t,this.latitudeMin,r),i=this.subTiles_array[1],i.setDimensions(t,this.longitudeMax,this.latitudeMin,r),i=this.subTiles_array[2],i.setDimensions(t,this.longitudeMax,r,this.latitudeMax),i=this.subTiles_array[3],i.setDimensions(this.longitudeMin,t,r,this.latitudeMax);for(var s=0;s<e;s++)this.subTiles_array[s].setDimensionsSubTiles()}},TerranTile.prototype.getSmallestTiles=function(i){if(this.subTiles_array.length>0)for(var e=0;e<this.subTiles_array.length;e++)this.subTiles_array[e].visibilityType=this.visibilityType,this.subTiles_array[e].getSmallestTiles(i);else this.empty_tile.length||i.push(this)},TerranTile.prototype.getIntersectedSmallestTiles=function(i,e,t){var r=[];this.getIntersectedTiles(i,r,t);for(var s=r.length,n=0;n<s;n++)r[n].getSmallestTiles(e);r.length=0},TerranTile.prototype.getIntersectedTiles=function(i,e,t){if(void 0!=this.position){void 0==t&&(t=new Cesium.BoundingSphere);if(t.radius=this.radius,t.center.x=this.position.x,t.center.y=this.position.y,t.center.z=this.position.z,this.visibilityType=i.computeVisibility(t),this.visibilityType==Cesium.Intersect.OUTSIDE);else if(this.visibilityType==Cesium.Intersect.INSIDE)e.push(this);else if(this.subTiles_array.length>0)for(var r=0;r<this.subTiles_array.length;r++)this.subTiles_array[r].getIntersectedTiles(i,e);else e.push(this)}};
"use strict";var Triangle=function(){if(!(this instanceof Triangle))throw new Error(Messages.CONSTRUCT_ERROR);this.vertex0,this.vertex1,this.vertex2,this.normal};Triangle.prototype.destroy=function(){this.vertex0=void 0,this.vertex1=void 0,this.vertex2=void 0,this.normal=void 0},Triangle.prototype.setVertices=function(t,e,i){this.vertex0=t,this.vertex1=e,this.vertex2=i},Triangle.prototype.calculatePlaneNormal=function(){void 0==this.normal&&(this.normal=new Point3D),this.getCrossProduct(0,this.normal),this.normal.unitary()},Triangle.prototype.getCrossProduct=function(t,e){void 0==e&&(e=new Point3D);var i,r,o;0==t?(i=this.vertex0.point3d,r=this.vertex2.point3d,o=this.vertex1.point3d):1==t?(i=this.vertex1.point3d,r=this.vertex0.point3d,o=this.vertex2.point3d):2==t&&(i=this.vertex2.point3d,r=this.vertex1.point3d,o=this.vertex0.point3d);var n=new Point3D,s=new Point3D;return n.set(i.x-r.x,i.y-r.y,i.z-r.z),s.set(o.x-i.x,o.y-i.y,o.z-i.z),n.unitary(),s.unitary(),e=n.crossProduct(s,e)};
"use strict";var TriPolyhedron=function(){if(!(this instanceof TriPolyhedron))throw new Error(Messages.CONSTRUCT_ERROR);this.vertexList=new VertexList,this.triSurfacesArray=[]};TriPolyhedron.prototype.newTriSurface=function(){var r=new TriSurface;return this.triSurfacesArray.push(r),r},TriPolyhedron.prototype.getVBOArrayModePosNorCol=function(r){void 0==r&&(r=new VBOVertexIdxCacheKey),void 0==r.posVboDataArray&&(r.posVboDataArray=[]),void 0==r.norVboDataArray&&(r.norVboDataArray=[]),void 0==r.colVboDataArray&&(r.colVboDataArray=[]);var o=[],a=[],s=[];r.vertexCount=0;for(var t,p,u,h,n,e,i=this.triSurfacesArray.length,l=0;l<i;l++){e=this.triSurfacesArray[l],n=e.trianglesArray.length;for(var y=0;y<n;y++)h=e.trianglesArray[y],void 0==h.normal&&h.calculatePlaneNormal(),t=h.vertex0,p=h.vertex1,u=h.vertex2,o.push(t.point3d.x),o.push(t.point3d.y),o.push(t.point3d.z),o.push(p.point3d.x),o.push(p.point3d.y),o.push(p.point3d.z),o.push(u.point3d.x),o.push(u.point3d.y),o.push(u.point3d.z),a.push(h.normal.x),a.push(h.normal.y),a.push(h.normal.z),a.push(h.normal.x),a.push(h.normal.y),a.push(h.normal.z),a.push(h.normal.x),a.push(h.normal.y),a.push(h.normal.z),void 0==t.color4?(s.push(255),s.push(255),s.push(255),s.push(255),s.push(255),s.push(255),s.push(255),s.push(255),s.push(255),s.push(255),s.push(255),s.push(255)):(s.push(t.color4.r),s.push(t.color4.g),s.push(t.color4.b),s.push(t.color4.a),s.push(p.color4.r),s.push(p.color4.g),s.push(p.color4.b),s.push(p.color4.a),s.push(u.color4.r),s.push(u.color4.g),s.push(u.color4.b),s.push(u.color4.a)),r.vertexCount+=3}var c=r.vertexCount;r.norVboDataArray=new Int8Array(3*c),r.colVboDataArray=new Uint8Array(4*c),r.posVboDataArray=new Float32Array(3*c);for(var l=0;l<3*c;l++)r.posVboDataArray[l]=o[l],r.norVboDataArray[l]=a[l];for(var l=0;l<4*c;l++)r.colVboDataArray[l]=s[l];return o=void 0,a=void 0,s=void 0,r};
"use strict";var TriSurface=function(){if(!(this instanceof TriSurface))throw new Error(Messages.CONSTRUCT_ERROR);this.trianglesArray=[]};TriSurface.prototype.newTriangle=function(){var r=new Triangle;return this.trianglesArray.push(r),r};
"use strict";var VBOManager=function(){if(!(this instanceof VBOManager))throw new Error(Messages.CONSTRUCT_ERROR)},Buffer=function(){if(!(this instanceof Buffer))throw new Error(Messages.CONSTRUCT_ERROR);this.dataArray,this.dataArrayByteLength=0},VBOVertexIdxCacheKey=function(){if(!(this instanceof VBOVertexIdxCacheKey))throw new Error(Messages.CONSTRUCT_ERROR);this.indicesCount=-1,this.vertexCount=-1,this.bigTrianglesIndicesCount=-1,this.meshVertexCacheKey=null,this.meshFacesCacheKey=null,this.meshNormalCacheKey=null,this.meshColorCacheKey=null,this.meshTexcoordsCacheKey=null,this.posVboDataArray,this.norVboDataArray,this.idxVboDataArray,this.colVboDataArray,this.tcoordVboDataArray,this.buffer};VBOVertexIdxCacheKey.prototype.deleteGlObjects=function(e){this.meshVertexCacheKey&&(e.deleteBuffer(this.meshVertexCacheKey),this.meshVertexCacheKey=void 0),this.posVboDataArray=void 0,this.meshNormalCacheKey&&(e.deleteBuffer(this.meshNormalCacheKey),this.meshNormalCacheKey=void 0),this.norVboDataArray=void 0,this.meshColorCacheKey&&(e.deleteBuffer(this.meshColorCacheKey),this.meshColorCacheKey=void 0),this.colVboDataArray=void 0,this.meshTexcoordsCacheKey&&(e.deleteBuffer(this.meshTexcoordsCacheKey),this.meshTexcoordsCacheKey=void 0),this.tcoordVboDataArray=void 0,this.meshFacesCacheKey&&(e.deleteBuffer(this.meshFacesCacheKey),this.meshFacesCacheKey=void 0),this.idxVboDataArray=void 0,this.buffer=void 0};var VBOVertexIdxCacheKeysContainer=function(){if(!(this instanceof VBOVertexIdxCacheKeysContainer))throw new Error(Messages.CONSTRUCT_ERROR);this.vboCacheKeysArray=[]};VBOVertexIdxCacheKeysContainer.prototype.newVBOVertexIdxCacheKey=function(){var e=new VBOVertexIdxCacheKey;return this.vboCacheKeysArray.push(e),e},VBOVertexIdxCacheKeysContainer.prototype.deleteGlObjects=function(e){for(var t=this.vboCacheKeysArray.length,r=0;r<t;r++)this.vboCacheKeysArray[r].deleteGlObjects(e),this.vboCacheKeysArray[r]=void 0;this.vboCacheKeysArray.length=0,this.vboCacheKeysArray=void 0};var VBOByteColorCacheKey=function(){if(!(this instanceof VBOByteColorCacheKey))throw new Error(Messages.CONSTRUCT_ERROR);this.meshColorsCacheKey=null,this.meshTexcoordsCacheKey=null},VBOByteColorCacheKeysContainer=function(){if(!(this instanceof VBOByteColorCacheKeysContainer))throw new Error(Messages.CONSTRUCT_ERROR);this.vboByteColorsCacheKeysArray=[]};VBOByteColorCacheKeysContainer.prototype.newVBOByteColorsCacheKey=function(){var e=new VBOByteColorCacheKey;return this.vboByteColorsCacheKeysArray.push(e),e};
"use strict";var Vertex=function(){if(!(this instanceof Vertex))throw new Error(Messages.CONSTRUCT_ERROR);this.point3d=new Point3D,this.normal,this.texCoord,this.color4};Vertex.prototype.setPosition=function(t,o,e){this.point3d.set(t,o,e)},Vertex.prototype.setColorRGB=function(t,o,e){void 0==this.color4&&(this.color4=new Color),this.color4.setRGB(t,o,e)},Vertex.prototype.setColorRGBA=function(t,o,e,r){void 0==this.color4&&(this.color4=new Color),this.color4.setRGBA(t,o,e,r)},Vertex.prototype.translate=function(t,o,e,r){this.point3d.add(t*r,o*r,e*r)};
"use strict";var VertexList=function(){if(!(this instanceof VertexList))throw new Error(Messages.CONSTRUCT_ERROR);this.vertexArray=[]};VertexList.prototype.newVertex=function(){var t=new Vertex;return this.vertexArray.push(t),t},VertexList.prototype.getVertex=function(t){return this.vertexArray[t]},VertexList.prototype.getVertexCount=function(){return this.vertexArray.length},VertexList.prototype.translateVertices=function(t,r,e,n){for(var i=0,o=this.vertexArray.length;i<o;i++)this.vertexArray[i].translate(t,r,e,n)},VertexList.prototype.getBoundingBox=function(t){void 0==t&&(t=new BoundingBox);for(var r=0,e=this.vertexArray.length;r<e;r++)0==r?t.setInit(this.vertexArray[r].point3d):t.addPoint3D(this.vertexArray[r].point3d);return t},VertexList.prototype.transformPointsByMatrix4=function(t){for(var r=0,e=this.vertexArray.length;r<e;r++){var n=this.vertexArray[r];t.transformPoint3D(n.point3d,n.point3d)}};
"use strict";var VertexMatrix=function(){if(!(this instanceof VertexMatrix))throw new Error(Messages.CONSTRUCT_ERROR);this.vertexListsArray=[],this.totalVertexArraySC=[]};VertexMatrix.prototype.newVertexList=function(){var t=new VertexList;return this.vertexListsArray.push(t),t},VertexMatrix.prototype.getVertexList=function(t){return t>=0&&t<this.vertexListsArray.length?this.vertexListsArray[t]:void 0},VertexMatrix.prototype.getBoundingBox=function(t){void 0==t&&(t=new BoundingBox),this.totalVertexArraySC.length=0,this.totalVertexArraySC=this.getTotalVertexArray(this.totalVertexArraySC);for(var r=0,e=this.totalVertexArraySC.length;r<e;r++)0==r?t.setInit(this.totalVertexArraySC[r].point3d):t.addPoint3D(this.totalVertexArraySC[r].point3d);return t},VertexMatrix.prototype.setVertexIdxInList=function(){for(var t=0,r=0,e=this.vertexListsArray.length;r<e;r++)for(var a=this.vertexListsArray[r],i=0,o=a.vertexArray.length;i<o;i++){var s=a.getVertex(i);s.mIdxInList=t,t++}},VertexMatrix.prototype.getVertexCount=function(){for(var t=0,r=0,e=this.vertexListsArray.length;r<e;r++)t+=this.vertexListsArray[r].getVertexCount();return t},VertexMatrix.prototype.getTotalVertexArray=function(t){for(var r=0,e=this.vertexListsArray.length;r<e;r++)for(var a=this.vertexListsArray[r],i=0,o=a.vertexArray.length;i<o;i++){var s=a.getVertex(i);t.push(s)}return t},VertexMatrix.prototype.getVBOVertexColorFloatArray=function(t){this.totalVertexArraySC.length=0,this.totalVertexArraySC=this.getTotalVertexArray(this.totalVertexArraySC);var r=this.totalVertexArraySC.length;void 0==t&&(t=new Float32Array(6*r));for(var e=0;e<r;e++){var a=this.totalVertexArraySC[e];t[6*e]=a.point3d.x,t[6*e+1]=a.point3d.y,t[6*e+2]=a.point3d.z,t[6*e+3]=a.color4.r,t[6*e+4]=a.color4.g,t[6*e+5]=a.color4.b}return t},VertexMatrix.prototype.getVBOVertexColorRGBAFloatArray=function(t){this.totalVertexArraySC.length=0,this.totalVertexArraySC=this.getTotalVertexArray(this.totalVertexArraySC);var r=this.totalVertexArraySC.length;void 0==t&&(t=new Float32Array(7*r));for(var e=0;e<r;e++){var a=this.totalVertexArraySC[e];t[7*e]=a.point3d.x,t[7*e+1]=a.point3d.y,t[7*e+2]=a.point3d.z,t[7*e+3]=a.color4.r,t[7*e+4]=a.color4.g,t[7*e+5]=a.color4.b,t[7*e+6]=a.color4.a}return t},VertexMatrix.prototype.getVBOVertexFloatArray=function(t){this.totalVertexArraySC.length=0,this.totalVertexArraySC=this.getTotalVertexArray(this.totalVertexArraySC);var r=this.totalVertexArraySC.length;void 0==t&&(t=new Float32Array(3*r));for(var e=0;e<r;e++){var a=this.totalVertexArraySC[e];t[3*e]=a.point3d.x,t[3*e+1]=a.point3d.y,t[3*e+2]=a.point3d.z}return t},VertexMatrix.prototype.translateVertices=function(t,r,e,a){for(var i=0,o=this.vertexListsArray.length;i<o;i++)this.vertexListsArray[i].translateVertices(t,r,e,a)},VertexMatrix.prototype.makeTTrianglesLateralSidesLOOP=function(t){for(var r,e,a,i,o,s=0,x=0,n=this.vertexListsArray.length;x<n-1;x++){r=this.vertexListsArray[x],e=this.vertexListsArray[x+1],a=t.newTTrianglesList(),s=r.vertexArray.length;for(var V=0;V<s;V++)i=a.newTTriangle(),o=a.newTTriangle(),V==s-1?(i.setVertices(r.getVertex(V),e.getVertex(V),e.getVertex(0)),o.setVertices(r.getVertex(V),e.getVertex(0),r.getVertex(0))):(i.setVertices(r.getVertex(V),e.getVertex(V),e.getVertex(V+1)),o.setVertices(r.getVertex(V),e.getVertex(V+1),r.getVertex(V+1)))}},VertexMatrix.prototype.transformPointsByMatrix4=function(t){for(var r=0,e=this.vertexListsArray.length;r<e;r++){var a=this.vertexListsArray[r];a.transformPointsByMatrix4(t)}};
"use strict";var VisibleObjectsControler=function(){if(!(this instanceof VisibleObjectsControler))throw new Error(Messages.CONSTRUCT_ERROR);this.currentVisibles0=[],this.currentVisibles1=[],this.currentVisibles2=[],this.currentVisibles3=[],this.currentRenderables0=[],this.currentRenderables1=[],this.currentRenderables2=[],this.currentRenderables3=[],this.currentRenderableRefArray=[]};VisibleObjectsControler.prototype.initArrays=function(){this.currentVisibles0=[],this.currentVisibles1=[],this.currentVisibles2=[],this.currentVisibles3=[],this.currentRenderables0=[],this.currentRenderables1=[],this.currentRenderables2=[],this.currentRenderables3=[]};
"use strict";function setTest(e){squareDistUmbral=e}function possibleCameraPositionChanged(e){var o=e.data[0],s=e.data[1],i=e.data[2],t=i.x,a=i.y,n=i.z,r=geoModifier.compoundReferencesListContainerGetVisibleCompRefObjectsList(s,t,a,n),c=geoModifier.compoundReferencesListContainerGetVisibleCompRefObjectsList(o,t,a,n),m=c.concat(r);return m}var currentCamPos=new Point3D,lastCamPos=new Point3D,squareDistUmbral=22,building_project,compRefList_array_background,geoModifier=new GeometryModifier;onmessage=function(e){console.log("Message received from main script");console.log("Posting message back to main script");var o=possibleCameraPositionChanged(e);postMessage([o])};
"use strict";var ProjectLayer=function(){if(!(this instanceof ProjectLayer))throw new Error(Messages.CONSTRUCT_ERROR);this.projectId=null,this.blockId=null,this.objectId=null};ProjectLayer.prototype.getProjectId=function(){return this.projectId},ProjectLayer.prototype.setProjectId=function(t){this.projectId=t},ProjectLayer.prototype.getBlockId=function(){return this.blockId},ProjectLayer.prototype.setBlockId=function(t){this.blockId=t},ProjectLayer.prototype.getObjectId=function(){return this.objectId},ProjectLayer.prototype.setObjectId=function(t){this.objectId=t};
"use strict";function defaultValue(t,u){return void 0!==t?t:u}